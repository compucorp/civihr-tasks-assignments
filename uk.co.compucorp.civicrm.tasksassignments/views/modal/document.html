<form novalidate name="documentForm" class="form-horizontal form-document" role="form" ng-submit="confirm()" ct-spinner>
    <div class="modal-header">
        <div class="row">
            <div class="col-xs-11">
                <ui-select
                        allow-clear
                        ng-model="document.target_contact_id[0]"
                        on-select="cacheContact($item)"
                        ng-required="true">
                    <ui-select-match class="ui-select-match" placeholder="Start typing a name or email...">
                        {{$select.selected.label}}
                    </ui-select-match>
                    <ui-select-choices class="ui-select-choices"
                                        repeat="contact.id as contact in contacts | filter: $select.search"
                                       refresh="refreshContacts($select.search)"
                                       refresh-delay="0">
                        <div ng-bind="contact.label"></div>
                        <small ng-bind="contact.description[0]"></small>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div class="col-xs-1">
                <button type="button" class="close" ng-click="cancel()">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
        </div>
    </div>
    <div class="modal-body" nv-file-drop uploader="uploader">
        <div class="container">
            <!-- Document Type -->
            <div class="row">
                <div class="col-xs-12">
                    <ui-select ng-model="document.activity_type_id"
                               ng-required="true">
                        <ui-select-match
                                class="ui-select-match"
                                placeholder="Select document type">{{$select.selected.value}}
                        </ui-select-match>
                        <ui-select-choices
                                class="ui-select-choices"
                                repeat="type.key as type in cache.documentType.arr | filter: $select.search">
                            <div ng-bind="type.value"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <!-- Dates -->
            <div class="row double-spacing">
                <!-- Due Date -->
                <label for="{{prefix}}document-due" class="col-xs-12 col-sm-2 text-nowrap control-label">Due Date:</label>

                <div class="col-xs-12 col-sm-4 input-group">
                    <input type="text" ng-model="document.activity_date_time"
                           class="form-control"
                           id="{{prefix}}document-due"
                           date-input
                           placeholder="dd/mm/yyyy"
                           name="documentDue" ng-required="true"
                    />
                    <span class="input-group-addon">
                        <a href class="text-normal calendar-popup-link"
                           ng-model="document.activity_date_time"
                           is-open="dpOpened.due"
                           datepicker-popup
                           ng-click="dpOpen($event, 'due')">
                            <i class="fa fa-calendar"></i>
                        </a>
                    </span>
                </div>
                <!-- Expires -->
                <label for="{{prefix}}document-exp" class="col-xs-12 col-sm-2 control-label no-gutter">
                    <span class="pull-right">Expiry Date:</span>
                </label>

                <div class="col-xs-12 col-sm-4 input-group">
                    <input type="text" ng-model="document.expire_date"
                           class="form-control"
                           id="{{prefix}}document-exp"
                           date-input
                           placeholder="dd/mm/yyyy"
                           name="documentExpireDate"
                    />
                    <span class="input-group-addon">
                        <a href class="text-normal calendar-popup-link"
                           ng-model="document.expire_date"
                           is-open="dpOpened.exp"
                           datepicker-popup
                           ng-click="dpOpen($event, 'exp')">
                            <i class="fa fa-calendar"></i>
                        </a>
                    </span>
                </div>
            </div>
            <!-- Drop Zone -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="well drop-zone" ng-click="dropzoneClick();">
                        <i class="fa fa-cloud-upload"></i><br/>
                        <strong>Drop file here</strong><br/>
                        or click to browse
                    </div>
                    <input type="file"
                           class="form-control-file file-input pull-right"
                           id="{{prefix}}document-files"
                           multiple
                           nv-file-select uploader="uploader"/>
                </div>
                <div class="col-xs-12 table-responsive">
                    <table class="table table-condensed {{prefix}}table-upload"
                           ng-show="uploader.queue.length || files.length">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th ng-show="uploader.isHTML5">Size</th>
                            <th class="pull-right"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="file in files">
                            <td><a ng-href="{{file.url}}">{{file.name}}</a></td>
                            <td ng-show="uploader.isHTML5" nowrap>
                                <span>{{file.fileSize ? (file.fileSize/1024/1024|number:2) : '0.00' }} MB</span>
                            </td>
                            <td class="text-right" nowrap>
                                <button type="button" class="btn btn-danger btn-xs"
                                        ng-click="fileMoveToTrash($index)">
                                    <span class="glyphicon glyphicon-trash"></span> Remove
                                </button>
                            </td>
                        </tr>
                        <tr ng-repeat="item in uploader.queue">
                            <td>{{item.file.name}}</td>
                            <td ng-show="uploader.isHTML5" nowrap>
                                <span>{{ item.file.size/1024/1024|number:2 }} MB</span>
                            </td>
                            <td class="text-right" nowrap>
                                <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">
                                    <span class="glyphicon glyphicon-trash"></span> Remove
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Assignee & Assignment -->
            <div class="row">
                <!-- Assignee -->
                <div class="col-xs-12 col-sm-6" ng-show="!showAssigneeField">
                    <span class="form-control-static">
                        <a href class="btn btn-indent" ng-click="showAssigneeField = true;">Add Assignee</a>
                    </span>
                </div>
                <div class="col-xs-12 col-sm-6" ng-show="showAssigneeField">
                    <ui-select
                            ng-required="true"
                            allow-clear
                            ng-model="document.assignee_contact_id[0]"
                            on-select="cacheContact($item)">
                        <ui-select-match
                                class="ui-select-match"
                                placeholder="Start typing a name or email...">{{$select.selected.label}}
                        </ui-select-match>
                        <ui-select-choices
                                class="ui-select-choices"
                                repeat="contact.id as contact in contacts | filter: $select.search"
                                refresh="refreshContacts($select.search)"
                                refresh-delay="0">
                            <div ng-bind="contact.label"></div>
                            <small ng-bind="contact.description[0]"></small>
                        </ui-select-choices>
                    </ui-select>
                </div>

                <!-- Assignment -->
                <div class="col-xs-12 col-sm-6" ng-show="!showAssignmentField">
                    <span class="form-control-static">
                        <a href class="btn btn-indent" ng-click="showAssignmentField = true;">Add to Assignment</a>
                    </span>
                </div>
                <div class="col-xs-12 col-sm-6" ng-show="showAssignmentField">
                    <ui-select
                            allow-clear
                            ng-model="document.case_id"
                            on-select="cacheAssignment($item);">
                        <ui-select-match
                                class="ui-select-match"
                                placeholder="Enter search term...">{{$select.selected.label}}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices"
                                           repeat="assignment.id as assignment in assignments"
                                           refresh="refreshAssignments($select.search)"
                                           refresh-delay="0">
                            <div>
                                <div ng-class="assignment.label_class">{{assignment.label}}</div>
                                <small>
                                    #{{assignment.id}}: {{assignment.extra.case_status}} (opened: {{assignment.extra.start_date | date:'MMM d, yyyy'}})
                                    <br>
                                    {{assignment.extra.case_subject}}
                                </small>
                            </div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <!-- Show More -->
            <div class="row">
                <div class="col-xs-12">
                    <span ng-click="expanded = !expanded;"><i class="fa" ng-class="{'fa-chevron-down': expanded, 'fa-chevron-right': !expanded}"></i> Show more</span>
                </div>
            </div>
            <div class="row" ng-show="expanded">
                <label class="col-xs-12 col-sm-6" ng-show="!showStatusField">
                    <span class="form-control-static">
                        <a href class="btn btn-indent" ng-click="showStatusField = true;">Set Status</a>
                    </span>
                </label>

                <div class="col-xs-12 col-sm-6" ng-show="showStatusField">
                    <ui-select allow-clear
                               ng-model="document.status_id">
                        <ui-select-match class="ui-select-match" placeholder="Set Status">
                            {{$select.selected.value}}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="status.key as status in cache.documentStatus.arr | filter: $select.search">
                            <div ng-bind="status.value"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
                <label class="col-xs-12 control-label">Details</label>
                <div class="col-xs-12">
                    <div text-angular
                        ta-toolbar="[['bold','italics','underline','strikeThrough','ul','ol','undo','redo','clear']]"
                        ng-model="document.details">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="cancel()">
            Cancel
        </button>

        <button type="submit" ng-click="openNew = true;" class="btn btn-default" ng-disabled="!documentForm.$valid">
            Save And New
        </button>

        <button type="submit" class="btn btn-default btn-primary" ng-disabled="!documentForm.$valid">
            Save
        </button>
    </div>
</form>

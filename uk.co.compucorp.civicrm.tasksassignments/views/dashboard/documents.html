<div class="{{prefix}}sidebar {{prefix}}sidebar-inner">
    <div class="panel panel-light  panel-secondary">
        <div class="panel-heading">
            <h3 class="panel-title">View Documents By:</h3>
        </div>
        <div class="panel-body">
            <div class="{{prefix}}filter-date">
                <ul class="nav nav-pills nav-stacked">
                    <li role="presentation"><a href ng-model="filterParams.due" uib-btn-radio="'overdue'" uncheckable>{{label.overdue}} <i class="fa fa-calendar" ng-click="viewInCalendar('month');"></i> <span class="badge badge-danger" ng-bind="(documentListOngoing | filterByDue:'overdue' | filterByUserRole:filterParams.userRole.field:filterParams.userRole.isEqual).length"></span></a></li>
                    <li role="presentation"><a href ng-model="filterParams.due" uib-btn-radio="'dueToday'" uncheckable>{{label.dueToday}} <i class="fa fa-calendar" ng-click="viewInCalendar('day');"></i> <span class="badge badge-primary" ng-bind="(documentListOngoing | filterByDue:'dueToday' | filterByUserRole:filterParams.userRole.field:filterParams.userRole.isEqual).length"></span></a></li>
                    <li role="presentation"><a href ng-model="filterParams.due"  uib-btn-radio="'dueThisWeek'" uncheckable>{{label.dueThisWeek}} <i class="fa fa-calendar" ng-click="viewInCalendar('week');"></i> <span class="badge badge-primary" ng-bind="(documentListOngoing | filterByDue:'dueThisWeek' | filterByUserRole:filterParams.userRole.field:filterParams.userRole.isEqual).length"></span></a></li>
                </ul>
                <hr>
                <a href
                   ng-click="isCollapsed.filterDates = !isCollapsed.filterDates"
                   class="btn btn-block {{prefix}}select-dates"><i
                        class="fa"
                        ng-class="{fa: true, 'fa-chevron-down': !isCollapsed.filterDates, 'fa-chevron-right': isCollapsed.filterDates }"></i>
                    <em>OR</em> Select Dates
                </a>
                <div class="form-horizontal" uib-collapse="isCollapsed.filterDates">
                    <div class="form-group">
                        <label for="{{prefix}}filter-date-from" class="col-xs-12 col-sm-3 control-label">From</label>
                        <div class="col-xs-12 col-sm-9 col-lg-7">
                            <input
                                    is-open="dpOpened.filterDates.from"
                                    uib-datepicker-popup="dd/MM/yyyy"
                                    ng-click="dpOpened.filterDates.from = !dpOpened.filterDates.from"
                                    ng-model="filterParamsHolder.dateRange.from"
                                    max-date="filterParamsHolder.dateRange.until"
                                    id="{{prefix}}filter-date-from" class="form-control" name="filterDateFrom">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="{{prefix}}filter-date-until" class="col-xs-12 col-sm-3 control-label">Until</label>
                        <div class="col-xs-12 col-sm-9  col-lg-7">
                            <input
                                    is-open="dpOpened.filterDates.until"
                                    uib-datepicker-popup="dd/MM/yyyy"
                                    min-date="filterParamsHolder.dateRange.from"
                                    ng-click="dpOpened.filterDates.until = !dpOpened.filterDates.until"
                                    ng-model="filterParamsHolder.dateRange.until"
                                    id="{{prefix}}filter-date-until" class="form-control" name="filterDateUntil">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="{{prefix}}filter-date-until" class="col-xs-12 col-sm-3 control-label">Status</label>
                        <div class="col-xs-12 col-sm-9">
                            <ui-select
                                    multiple
                                    ng-model="filterParamsHolder.documentStatus">
                                <ui-select-match class="ui-select-match" placeholder="Select status...">{{$item.value}}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="status.key as status in cache.documentStatus.arr">
                                    <div ng-bind-html="status.value | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <button class="btn btn-default btn-primary btn-block"
                            ng-click="filterParams.dateRange.from = filterParamsHolder.dateRange.from;
                                      filterParams.dateRange.until = filterParamsHolder.dateRange.until;
                                      filterParams.documentStatus = filterParamsHolder.documentStatus;
                                      filterParams.due = 'dateRange';
                                      labelDateRange(filterParams.dateRange.from, filterParams.dateRange.until)">
                        Apply Filter</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="{{prefix}}content-wrapper">
    <div class="{{prefix}}content">
        <div class="panel panel-light panel-secondary panel-filter">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-12 col-sm-3">
                        <h3 class="panel-title">{{label[filterParams.due]}}</h3>
                    </div>
                    <div class="col-xs-12 col-sm-6 text-center">
                        <div class="btn-group btn-group-sm">
                            <a ui-sref="documents.my"
                               class="btn btn-gray active panel-filter__filter"
                               ng-model="filterParams.userRole"
                               uib-btn-radio="{
                                   field: 'assignee_contact_id',
                                   isEqual: true
                               }">My Docs ({{(documentListOngoing | filterByUserRole:'assignee_contact_id').length}})</a>
                            <a ui-sref="documents.delegated"
                               class="btn btn-gray panel-filter__filter"
                               ng-model="filterParams.userRole"
                               uib-btn-radio="{
                                   field: 'assignee_contact_id',
                                   isEqual: false
                               }">Delegated Docs ({{(documentListOngoing | filterByUserRole:'assignee_contact_id':false).length}})</a>
                            <a ui-sref="documents.all"
                               class="btn btn-gray panel-filter__filter"
                               ng-model="filterParams.userRole"
                               uib-btn-radio="{
                                   field: null,
                                   isEqual: null
                               }">All</a>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-3 text-right">
                        <a href ng-click="isCollapsed.filterAdvanced = !isCollapsed.filterAdvanced" class="btn btn-collapse"><span
                                class="fa"
                                ng-class="{fa: true, 'fa-chevron-down': !isCollapsed.filterAdvanced, 'fa-chevron-right': isCollapsed.filterAdvanced }"
                                aria-hidden="true"></span> Filter Documents</a>
                    </div>
                </div>
                <div class="{{prefix}}filter-advanced" uib-collapse="isCollapsed.filterAdvanced">
                    <div class="row form-horizontal">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-2 control-label">Contact:</label>
                                <div class="col-xs-12 col-sm-10">
                                    <div class="input-group">
                                        <ui-select
                                                allow-clear
                                                ng-model="filterParams.contactId">
                                            <ui-select-match class="ui-select-match"
                                                    placeholder="Search / Filter">{{$select.selected.label}}</ui-select-match>
                                            <ui-select-choices class="ui-select-choices" repeat="contact.id as contact in cache.contact.arrSearch | filter: $select.search"
                                                                refresh-delay="0">
                                                <div ng-bind="contact.label"></div>
                                                <small ng-bind="contact.description[0]"></small>
                                            </ui-select-choices>
                                        </ui-select>
                                        <span class="input-group-btn">
                                          <a ng-click="filterParams.contactId = ''" class="btn btn-default">
                                              <span class="fa fa-remove"></span>
                                          </a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-4 control-label">Assignment Type:</label>
                                <div class="col-xs-12 col-sm-8">
                                    <ui-select
                                            multiple
                                            ng-model="filterParams.assignmentType">
                                        <ui-select-match class="ui-select-match" placeholder="Select assignment...">{{$item.title}}</ui-select-match>
                                        <ui-select-choices class="ui-select-choices" repeat="type.id as type in cache.assignmentType.arr">
                                            <div ng-bind-html="type.title | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div class="{{prefix}}form-action">
                    <div class="row form-horizontal">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-2 control-label">Action:</label>
                                <div class="col-xs-12 col-sm-10">
                                    <div class="input-group">
                                        <ui-select
                                                ng-model="action.selected">
                                            <ui-select-match class="ui-select-match"
                                                    placeholder="Select action">{{$select.selected.label}}</ui-select-match>
                                            <ui-select-choices class="ui-select-choices"
                                                    repeat="actionObj.type as actionObj in actionList">
                                                <div ng-bind="actionObj.label"></div>
                                            </ui-select-choices>
                                        </ui-select>
                                        <span class="input-group-btn">
                                          <a ng-click="apply(action.selected, (action.applyTo == 'all' ? documentListOngoing : checklist.selected[pagination.currentPage]))" class="btn btn-default">
                                              Apply
                                          </a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-5 col-xs-offset-1">
                            <label class="radio-inline">
                                <input type="radio" ng-model="action.applyTo" value="all"> All {{documentListFiltered.length}} Docs
                            </label>
                            <label class="radio-inline">
                                <input type="radio" ng-model="action.applyTo" value="selected"> {{checklist.selected[pagination.currentPage].length || 0}} Selected Docs Only
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="{{prefix}}documents-container" ct-spinner ct-spinner-id="documentList">
            <table class="table table-striped {{prefix}}table-documents">
                <thead>
                    <tr>
                        <th class="{{prefix}}col-select"><input type="checkbox" name="toggleAll" ng-model="checklist.isCheckedAll[pagination.currentPage]" ng-change="toggleAll(pagination.currentPage);"></th>
                        <th>Type</th>
                        <th>Contact</th>
                        <th ng-if="settings.extEnabled.assignments">Assignment</th>
                        <th>Due Date</th>
                        <th>Expiry Date</th>
                        <th>Status</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                 <tr ng-repeat="document in
                 documentListPaginated = (documentListFiltered = (documentListOngoing = (documentList
                    | filterByStatus:cache.documentStatusResolve:false)
                        | filterByDue:filterParams.due:filterParams.dateRange
                        | filterByUserRole:filterParams.userRole.field:filterParams.userRole.isEqual
                        | filterByAssignmentType:filterParams.assignmentType
                        | filterByContactId:filterParams.contactId
                        | filterByStatus:filterParams.documentStatus
                        | orderBy: 'activity_date_time')
                            | offset: (pagination.currentPage-1)*pagination.itemsPerPage
                            | limitTo: pagination.itemsPerPage)"
                        ng-controller="DocumentCtrl"
                        ng-include
                        src="'document.html'">
                    </tr>
                </tbody>
            </table>
            <div class="clearfix"></div>
            <nav class="row" ng-show="(documentListFiltered.length > pagination.itemsPerPage)">
                <div class="col-xs-12 text-center">
                    <uib-pagination boundary-links="true" total-items="documentListFiltered.length" rotate="false" items-per-page="pagination.itemsPerPage" max-size="pagination.maxSize" ng-model="pagination.currentPage" class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
                </div>
            </nav>
        </div>
    </div>
</div>

<script type="text/ng-template" id="document.html">
    <td class="{{prefix}}col-select"><input type="checkbox" checklist-model="checklist.selected[pagination.currentPage]" checklist-value="document" ng-change="toggleIsCheckedAll()"></td>
    <td><a ng-href="{{urlFile}}" ng-click="(!document.file_count || document.file_count == '0') && modalDocument(document, $event);" ng-bind="cache.documentType.obj[document.activity_type_id]"></a></td>
    <td><a ng-href="{{url.CONTACT+'?reset=1&cid='+cache.contact.obj[document.assignee_contact_id[0]].id}}" ng-bind="cache.contact.obj[document.assignee_contact_id[0]].sort_name"></a></td>
    <td ng-if="settings.extEnabled.assignments" ng-bind="(cache.assignmentType.obj[cache.assignment.obj[document.case_id].case_type_id].title || '-')"></td>
    <td ng-bind="(document.activity_date_time | date: 'dd/MM/yyyy') || '-'"></td>
    <td ng-bind="(document.expire_date | date: 'dd/MM/yyyy') || '-'"></td>
    <td>
        <div class="dropdown" uib-dropdown>
            <a href class="dropdown-toggle"
               ng-class="{
                'text-danger-light': (document.status_id == 4 || document.status_id == 1),
                'text-success-light': (document.status_id == 3),
                'text-warning-light': (document.status_id == 2)
            }" uib-dropdown-toggle>{{cache.documentStatus.obj[document.status_id]}} <i class="caret"></i></a>
            <ul class="dropdown-menu" uib-dropdown-menu>
                <li ng-repeat="status in cache.documentStatus.arr"><a href ng-bind="status.value" ng-click="changeStatus(document, status.key)"></a></li>
            </ul>
        </div>
    </td>
    <td>
        <div class="dropdown" uib-dropdown>
            <a href class="dropdown-toggle {{prefix}}context-menu-toggle" uib-dropdown-toggle><i class="fa fa-ellipsis-v"></i></a>
            <ul class="dropdown-menu pull-right" uib-dropdown-menu>
                <li ng-show="document.file_count && document.file_count != '0'"><a ng-href="{{urlFile}}"><i class="fa fa-download"></i> Download</a></li>
                <li><a href ng-click="modalDocument(document, $event);"><i class="fa fa-pencil"></i> Edit</a></li>
                <li><a href ng-click="modalReminder(document, 'document');"><i class="fa fa-envelope-o"></i> Send reminder</a></li>
                <li ng-if="permissions.allowDelete"><a href ng-click="deleteDocument(document);"><i class="fa fa-trash-o"></i> Delete</a></li>
            </ul>
        </div>
    </td>
</script>

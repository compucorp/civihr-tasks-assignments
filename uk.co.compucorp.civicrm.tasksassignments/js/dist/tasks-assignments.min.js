/**
 * CiviTasks Dashboard Calendar based on:
 * angular-bootstrap-calendar - A pure AngularJS bootstrap themed responsive calendar that can display events and has views for year, month, week and day
 * @version v0.10.6
 * @link https://github.com/mattlewis92/angular-bootstrap-calendar
 * @license MIT
 */

/**
 * State-based routing for AngularJS
 * @version v0.2.15
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

define("tasks-assignments/modules/config",["common/angular"],function(e){"use strict";e.module("civitasks.config",[]).constant("config",{DEBUG:!!+CRM.debug,CLASS_NAME_PREFIX:"ct-",CONTACT_ID:CRM.contactId||null,LOGGED_IN_CONTACT_ID:CRM.adminId||null,path:{EXT:CRM.tasksAssignments.extensionPath,TPL:CRM.tasksAssignments.extensionPath+"views/"},permissions:{allowDelete:CRM.tasksAssignments.permissions.delete_tasks_and_documents},url:{REST:CRM.url("civicrm/ajax/rest"),ASSIGNMENTS:CRM.url("civicrm/case"),CIVI_DASHBOARD:CRM.url("civicrm/"),CONTACT:CRM.url("civicrm/contact/view"),FILE:"/civicrm/tasksassignments/file",CSV_EXPORT:CRM.url("civicrm/tasksassignments")},status:{resolve:{DOCUMENT:["3","4"],TASK:["2","3","6","8"]}}})}),define("tasks-assignments/modules/settings",["common/angular"],function(e){"use strict";e.module("civitasks.settings",[]).value("settings",{tabEnabled:{documents:CRM.tasksAssignments.settings.documents_tab,keyDates:CRM.tasksAssignments.settings.keydates_tab},extEnabled:{assignments:CRM.tasksAssignments.case_extension},copy:{button:{assignmentAdd:CRM.tasksAssignments.settings.add_assignment_button_title}},isTaskDashboardDefault:CRM.tasksAssignments.settings.is_task_dashboard_default,daysToCreateADocumentClone:CRM.tasksAssignments.settings.days_to_create_a_document_clone})}),define("tasks-assignments/vendor/angular-bootstrap-calendar",["common/moment"],function(e){"use strict";angular.module("mwl.calendar",[]),angular.module("mwl.calendar").run(["$templateCache",function(e){e.put("src/templates/calendar.html",'<div class="cal-context" ng-switch="view"><div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div><div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div><mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year"></mwl-calendar-year><mwl-calendar-month events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month"></mwl-calendar-month><mwl-calendar-week events="events" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week"></mwl-calendar-week><mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day"></mwl-calendar-day></div>'),e.put("src/templates/calendarCustom.html",'<div class="cal-context" ng-switch="view"> <div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div> <div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div> <mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year" ></mwl-calendar-year> <mwl-calendar-month events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month" ></mwl-calendar-month> <mwl-calendar-week events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week" ></mwl-calendar-week> <mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day" ></mwl-calendar-day></div>'),e.put("src/templates/calendarDayView.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.timeLabel"></div><div class="span11 col-xs-11 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.eventsLabel"></div></div><div class="cal-day-panel clearfix" ng-style="{height: (vm.hours.length * vm.hourHeight) + \'px\'}"><div class="cal-day-panel-hour"><div class="cal-day-hour" ng-repeat="hour in vm.hours track by $index"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><strong ng-bind="hour.label"></strong></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight" ng-class="\'dh-event-\' + event.type" ng-repeat="event in vm.view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title | calendarTruncateEventTitle:20:event.height"></span></a></div></div></div>'),e.put("src/templates/calendarMonthDay.html",'<div class="cal-month-day" ng-class="{\n            \'cal-day-outmonth\': !day.inMonth,\n            \'cal-day-inmonth\': day.inMonth,\n            \'cal-day-weekend\': day.isWeekend,\n            \'cal-day-past\': day.isPast,\n            \'cal-day-today\': day.isToday,\n            \'cal-day-future\': day.isFuture\n          }"><small class="cal-events-num badge badge-important pull-left" ng-show="day.badgeTotal > 0" ng-bind="day.badgeTotal"></small> <span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" ng-bind="day.label"></span><div class="cal-day-tick" ng-show="dayIndex === vm.openDayIndex && vm.view[vm.openDayIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div ng-include="\'src/templates/calendarMonthEventsList.html\'"></div></div>'),e.put("src/templates/calendarMonthDayCustom.html",'<div class="cal-month-day" ng-class="{ \'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture }"> <ul class="cal-list-events-num"> <li ng-show="day.badgeEventsTotal > 0"> <small class="badge badge-danger-light" ng-bind="day.badgeEventsTotal"></small> Tasks </li> <li ng-show="day.badgeDocumentsTotal > 0"> <small class="badge badge-dark" ng-bind="day.badgeDocumentsTotal"></small> Documents </li> </ul> <span class="pull-right" data-cal-date ng-bind="day.label"> </span></div>'),e.put("src/templates/calendarMonthEventsList.html",'<div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" ng-repeat="event in day.events track by $index" class="pull-left event" ng-class="\'event-\' + event.type" ng-mouseenter="vm.highlightEvent(event, true)" ng-mouseleave="vm.highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div>'),e.put("src/templates/calendarMonthView.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"><div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"><div class="cal-row-fluid cal-before-eventlist"><div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.dayClicked(day)" ng-class="{pointer: day.events.length > 0}"><div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openDayIndex].events.length > 0" events="vm.view[vm.openDayIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>'),e.put("src/templates/calendarMonthViewCustom.html",'<div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"> <div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"> <div class="cal-row-fluid cal-before-eventlist"> <div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="pointer cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.calendarCtrl.drillDown(day.date)"> <div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div> </div> </div> </div></div>'),e.put("src/templates/calendarSlideBox.html",'<div class="cal-slide-box" collapse="vm.shouldCollapse" mwl-collapse-fallback="vm.shouldCollapse"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in events track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title"></span> <span ng-show="isMonthView">(<span ng-bind="event.startsAt | date:\'shortTime\'"></span>)</span> <span ng-show="isYearView">(<span ng-bind="event.startsAt | date:\'MMM d, h:mm a\'"></span>)</span></a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="vm.$sce.trustAsHtml(editEventHtml)" ng-click="onEditEventClick({calendarEvent: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="vm.$sce.trustAsHtml(deleteEventHtml)" ng-click="onDeleteEventClick({calendarEvent: event})"></a></li></ul></div></div>'),e.put("src/templates/calendarWeekView.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{\n        \'cal-day-weekend\': day.isWeekend,\n        \'cal-day-past\': day.isPast,\n        \'cal-day-today\': day.isToday,\n        \'cal-day-future\': day.isFuture}"><span ng-bind="day.weekDayLabel"></span><br><small><span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"></span></small></div></div><div class="cal-row-fluid" ng-repeat="event in vm.view.events track by $index"><div ng-class="\'cal-cell\' + event.daySpan + \' cal-offset\' + event.dayOffset + \' day-highlight dh-event-\' + event.type" data-event-class><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"></a></div></div></div>'),e.put("src/templates/calendarWeekViewCustom.html",'<div class="cal-week-box"> <div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{ \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture}"> <span ng-bind="day.weekDayLabel"></span> <br> <small> <span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"> </span> </small> </div> </div> <div class="cal-col-fluid" ng-repeat="col in vm.view.cols track by $index"> <div class="cal-row-fluid" ng-repeat="event in col track by $index"> <div ng-if="event.title" ng-class="\'day-highlight dh-event-\' + event.type + \' dh-event-overdue-\' + event.overdue" data-event-class> <a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"> </a> </div> </div> </div></div>'),e.put("src/templates/calendarYearView.html",'<div class="cal-year-box"><div ng-repeat="rowOffset in [0, 4, 8] track by rowOffset"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in vm.view | calendarLimitTo:4:rowOffset track by $index" ng-init="monthIndex = vm.view.indexOf(month)" ng-click="vm.monthClicked(month)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(month.date)" ng-bind="month.label"></span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.badgeTotal > 0" ng-bind="month.badgeTotal"></small><div class="cal-day-tick" ng-show="monthIndex === vm.openMonthIndex && vm.view[vm.openMonthIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openMonthIndex].events.length > 0" events="vm.view[vm.openMonthIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>')}]),angular.module("mwl.calendar").constant("moment",e),angular.module("mwl.calendar").factory("calendarTitle",["moment","calendarConfig",function(e,t){function n(n){return e(n).format(t.titleFormats.day)}function a(n){return t.titleFormats.week.replace("{week}",e(n).week()).replace("{year}",e(n).format("YYYY"))}function r(n){return e(n).format(t.titleFormats.month)}function i(n){return e(n).format(t.titleFormats.year)}return{day:n,week:a,month:r,year:i}}]),angular.module("mwl.calendar").factory("calendarHelper",["moment","calendarConfig",function(e,t){function n(t,n,a,r){return t=e(t),n=e(n),a=e(a),r=e(r),t.isAfter(a)&&t.isBefore(r)||n.isAfter(a)&&n.isBefore(r)||t.isBefore(a)&&n.isAfter(r)||t.isSame(a)||n.isSame(r)}function a(t,a,r){var i=e(t).startOf(a),s=e(t).endOf(a);return r.filter(function(e){return n(e.startsAt,e.endsAt,i,s)})}function r(e){return e.filter(function(e){return!1!==e.incrementsBadgeTotal}).length}function i(){for(var n=[],a=0;a<7;)n.push(e().weekday(a++).format(t.dateFormats.weekDay));return n}function s(e,t,a){return e.filter(function(e){return n(e.startsAt,e.endsAt,t,a)})}function o(n,i){for(var o=[],c=a(i,"year",n),l=e(i).startOf("year"),u=0;u<12;){var d=l.clone(),m=d.clone().endOf("month"),f=s(c,d,m);o.push({label:d.format(t.dateFormats.month),isToday:d.isSame(e().startOf("month")),events:f,date:d,badgeTotal:r(f)}),l.add(1,"month"),u++}return o}function c(t,n,i){for(var o=a(i,"month",t),c=a(i,"month",n),l=e(i).startOf("month"),u=l.clone().startOf("week"),d=e(i).endOf("month").endOf("week"),m=[],f=e().startOf("day");u.isBefore(d);){var v=u.month()===e(i).month(),p=[],g=[];v&&(p=s(o,u,u.clone().endOf("day")),g=s(c,u,u.clone().endOf("day"))),m.push({label:u.date(),date:u.clone(),inMonth:v,isPast:f.isAfter(u),isToday:f.isSame(u),isFuture:f.isBefore(u),isWeekend:[0,6].indexOf(u.day())>-1,events:p,documents:g,badgeEventsTotal:r(p),badgeDocumentsTotal:r(g)}),u.add(1,"day")}return m}function l(n,a,r){for(var i=e(r).startOf("week"),o=e(r).endOf("week"),c=i.clone(),l=[],u=[],d=10,m=e().startOf("day");l.length<7;)u.push([]),l.push({weekDayLabel:c.format(t.dateFormats.weekDay),date:c.clone(),dayLabel:c.format(t.dateFormats.day),isPast:c.isBefore(m),isToday:c.isSame(m),isFuture:c.isAfter(m),isWeekend:[0,6].indexOf(c.day())>-1}),c.add(1,"day");var f=s(n.concat(a),i,o).map(function(t){var n,a,r=e(t.startsAt).startOf("day"),s=e(t.endsAt).startOf("day"),c=e(i).startOf("day"),l=e(o).startOf("day");return n=r.isBefore(c)||r.isSame(c)?0:r.diff(c,"days"),s.isAfter(l)&&(s=l),r.isBefore(c)&&(r=c),a=e(s).diff(r,"days")+1,t.daySpan=a,t.dayOffset=n,t.overdue=r.isBefore(m),u[n].push(t),t});return u.map(function(e){d=e.length>d?e.length:d}),u.map(function(e){if(e.length<d)for(var t=e.length;t<d;t++)e.push({})}),{days:l,events:f,cols:u,rowsMax:d}}function u(t,a,r,i,o){var c=e(a).startOf("day").add(r,"hours"),l=e(a).startOf("day").add(i,"hours"),u=(i-r+1)*o,d=o/60,m=[];return s(t,e(a).startOf("day").toDate(),e(a).endOf("day").toDate()).map(function(t){if(e(t.startsAt).isBefore(c)?t.top=0:t.top=e(t.startsAt).startOf("minute").diff(c.startOf("minute"),"minutes")*d-2,e(t.endsAt).isAfter(l))t.height=u-t.top;else{var n=t.startsAt;e(t.startsAt).isBefore(c)&&(n=c.toDate()),t.height=e(t.endsAt).diff(n,"minutes")*d}return t.top-t.height>u&&(t.height=0),t.left=0,t}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return m.forEach(function(a,r){var i=!0;a.forEach(function(t){(n(e.startsAt,e.endsAt,t.startsAt,t.endsAt)||n(t.startsAt,t.endsAt,e.startsAt,e.endsAt))&&(i=!1)}),i&&t&&(t=!1,e.left=150*r,m[r].push(e))}),t&&(e.left=150*m.length,m.push([e])),e})}return{getWeekDayNames:i,getYearView:o,getMonthView:c,getWeekView:l,getDayView:u}}]),angular.module("mwl.calendar").service("calendarDebounce",["$timeout",function(e){function t(t,n,a){var r;return function(){function i(){r=null,a||t.apply(s,o)}var s=this,o=arguments,c=a&&!r;e.cancel(r),r=e(i,n),c&&t.apply(s,o)}}return t}]),angular.module("mwl.calendar").provider("calendarConfig",function(){var e={hour:"ha",day:"D MMM",month:"MMMM",weekDay:"dddd"},t={day:"dddd D MMMM, YYYY",week:"Week {week} of {year}",month:"MMMM YYYY",year:"YYYY"},n={eventsLabel:"Events",timeLabel:"Time"},a=this;a.setDateFormats=function(t){return angular.extend(e,t),a},a.setTitleFormats=function(e){return angular.extend(t,e),a},a.setI18nStrings=function(e){return angular.extend(n,e),a},a.$get=function(){return{dateFormats:e,titleFormats:t,i18nStrings:n}}}),angular.module("mwl.calendar").filter("calendarTruncateEventTitle",function(){return function(e,t,n){return e?e.length>=t&&e.length/20>n/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").filter("calendarLimitTo",function(){return function(e,t,n){return t=Math.abs(Number(t))===1/0?Number(t):parseInt(t),isNaN(t)?e:(angular.isNumber(e)&&(e=e.toString()),angular.isArray(e)||angular.isString(e)?(n=!n||isNaN(n)?0:parseInt(n),n=n<0&&n>=-e.length?e.length+n:n,t>=0?e.slice(n,n+t):0===n?e.slice(t,e.length):e.slice(Math.max(0,n+t),n)):e)}}),angular.module("mwl.calendar").directive("mwlDateModifier",function(){return{restrict:"A",controller:["$element","$attrs","$scope","moment",function(e,t,n,a){function r(){angular.isDefined(t.setToToday)?n.date=new Date:angular.isDefined(t.increment)?n.date=a(n.date).add(1,n.increment).toDate():angular.isDefined(t.decrement)&&(n.date=a(n.date).subtract(1,n.decrement).toDate()),n.$apply()}e.bind("click",r),n.$on("$destroy",function(){e.unbind("click",r)})}],scope:{date:"=",increment:"=",decrement:"="}}}),angular.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,n){var a=e.$watch(t.mwlCollapseFallback,function(e){e?n.addClass("ng-hide"):n.removeClass("ng-hide")}),r=e.$on("$destroy",function(){r(),a()})}]}}]),angular.module("mwl.calendar").directive("mwlCalendarYear",function(){return{templateUrl:"src/templates/calendarYearView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var a=this,r=!0;e.$on("calendar.refreshView",function(){a.view=n.getYearView(e.events,e.currentDay),e.autoOpen&&r&&(r=!1,a.view.forEach(function(n){t(e.currentDay).startOf("month").isSame(n.date)&&a.monthClicked(n,!0)}))}),a.monthClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),a.openRowIndex=null;var r=a.view.indexOf(t);r===a.openMonthIndex?a.openMonthIndex=null:(a.openMonthIndex=r,a.openRowIndex=Math.floor(r/4))}}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"src/templates/calendarWeekViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{documents:"=",events:"=",currentDay:"=",onEventClick:"="},controller:["$scope","calendarHelper",function(e,t){var n=this;e.$on("calendar.refreshView",function(){n.view=t.getWeekView(e.events,e.documents,e.currentDay)})}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"src/templates/calendarSlideBox.html",replace:!0,controller:["$scope","$sce",function(e,t){var n=this;n.$sce=t;var a=e.$watch("isOpen",function(e){n.shouldCollapse=!e}),r=e.$on("$destroy",function(){r(),a()})}],controllerAs:"vm",require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,n,a){e.isMonthView=!!a[0],e.isYearView=!!a[1]},scope:{isOpen:"=",events:"=",onEventClick:"=",editEventHtml:"=",onEditEventClick:"=",deleteEventHtml:"=",onDeleteEventClick:"="}}}),angular.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"src/templates/calendarMonthViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",documents:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var a=this,r=!0;e.$on("calendar.refreshView",function(){a.weekDays=n.getWeekDayNames(),a.view=n.getMonthView(e.events,e.documents,e.currentDay);var i=Math.floor(a.view.length/7);a.monthOffsets=[];for(var s=0;s<i;s++)a.monthOffsets.push(7*s);e.autoOpen&&r&&(r=!1,a.view.forEach(function(n){n.inMonth&&t(e.currentDay).startOf("day").isSame(n.date)&&a.dayClicked(n,!0)}))}),a.dayClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),a.openRowIndex=null;var r=a.view.indexOf(t);r===a.openDayIndex?a.openDayIndex=null:(a.openDayIndex=r,a.openRowIndex=Math.floor(r/7))},a.highlightEvent=function(e,t){a.view.forEach(function(n){if(delete n.highlightClass,t){n.events.indexOf(e)>-1&&(n.highlightClass="day-highlight dh-event-"+e.type)}})}}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"src/templates/calendarDayView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",dayViewStart:"=",dayViewEnd:"=",dayViewSplit:"="},controller:["$scope","$timeout","moment","calendarHelper","calendarConfig",function(e,t,n,a,r){function i(){s=n(e.dayViewStart||"00:00","HH:mm"),o=n(e.dayViewEnd||"23:00","HH:mm"),c.dayViewSplit=parseInt(e.dayViewSplit),c.hourHeight=60/e.dayViewSplit*30,c.hours=[];for(var t=n(s),a=0;a<=o.diff(s,"hours");a++)c.hours.push({label:t.format(r.dateFormats.hour)}),t.add(1,"hour")}var s,o,c=this;c.calendarConfig=r;var l=n.locale();e.$on("calendar.refreshView",function(){l!==n.locale()&&(l=n.locale(),i()),c.view=a.getDayView(e.events,e.currentDay,s.hours(),o.hours(),c.hourHeight)}),i()}],controllerAs:"vm"}}),angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"src/templates/calendarCustom.html",restrict:"EA",scope:{events:"=",documents:"=",view:"=",viewTitle:"=",currentDay:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onEventClick:"&",onEditEventClick:"&",onDeleteEventClick:"&",onTimespanClick:"&",onDrillDownClick:"&",dayViewStart:"@",dayViewEnd:"@",dayViewSplit:"@"},controller:["$scope","$timeout","moment","calendarTitle","calendarDebounce",function(e,t,n,a,r){var i=this;e.events=e.events||[],e.documents=e.documents||[],i.changeView=function(t,n){e.view=t,e.currentDay=n},i.drillDown=function(t){var a=n(t).toDate(),r={year:"month",month:"day",week:"day"};!1!==e.onDrillDownClick({calendarDate:a,calendarNextView:r[e.view]})&&i.changeView(r[e.view],a)};var s=n(e.currentDay),o=angular.copy(e.view),c=r(function(){a[e.view]&&(e.viewTitle=a[e.view](e.currentDay));var t=n(e.currentDay),r=!0;s.clone().startOf(e.view).isSame(t.clone().startOf(e.view))&&!s.isSame(t)&&e.view===o&&(r=!1),s=t,o=angular.copy(e.view),r&&e.$broadcast("calendar.refreshView")},50),l=e.$watch(function(){return n.locale()},c),u=[];u.push(l),u.push(e.$watch("currentDay",c)),u.push(e.$watch("view",c)),u.push(e.$watch("events",c,!0)),u.push(e.$watch("documents",c,!0));var d=e.$on("$destroy",function(){u.forEach(function(e){e()})});u.push(d)}]}})}),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,t){function n(e,t,n){if(angular.isArray(e))for(var a=e.length;a--;)if(n(e[a],t))return!0;return!1}function a(e,t,a){return e=angular.isArray(e)?e:[],n(e,t,a)||e.push(t),e}function r(e,t,n){if(angular.isArray(e))for(var a=e.length;a--;)if(n(e[a],t)){e.splice(a,1);break}return e}function i(i,s,o){function c(e,t){i.checked=n(e,m,f)}t(s)(i);var l=e(o.checklistModel),u=l.assign,d=e(o.checklistChange),m=e(o.checklistValue)(i.$parent),f=angular.equals;o.hasOwnProperty("checklistComparator")&&(f=e(o.checklistComparator)(i.$parent)),i.$watch("checked",function(e,t){if(e!==t){var n=l(i.$parent);!0===e?u(i.$parent,a(n,m,f)):u(i.$parent,r(n,m,f)),d&&d(i)}}),angular.isFunction(i.$parent.$watchCollection)?i.$parent.$watchCollection(o.checklistModel,c):i.$parent.$watch(o.checklistModel,c,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if("INPUT"!==e[0].tagName||"checkbox"!==t.type)throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!t.checklistValue)throw"You should provide `checklist-value`.";return e.removeAttr("checklist-model"),e.attr("ng-model","checked"),i}}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(e,t,n){function a(e,t){return F(new(F(function(){},{prototype:e})),t)}function r(e){return N(arguments,function(t){t!==e&&N(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function i(e,t){var n=[];for(var a in e.path){if(e.path[a]!==t.path[a])break;n.push(e.path[a])}return n}function s(e){if(Object.keys)return Object.keys(e);var t=[];return N(e,function(e,n){t.push(n)}),t}function o(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,a=Number(arguments[2])||0;for(a=a<0?Math.ceil(a):Math.floor(a),a<0&&(a+=n);a<n;a++)if(a in e&&e[a]===t)return a;return-1}function c(e,t,n,a){var r,c=i(n,a),l={},u=[];for(var d in c)if(c[d].params&&(r=s(c[d].params),r.length))for(var m in r)o(u,r[m])>=0||(u.push(r[m]),l[r[m]]=e[r[m]]);return F({},l,t)}function l(e,t,n){if(!n){n=[];for(var a in e)n.push(a)}for(var r=0;r<n.length;r++){var i=n[r];if(e[i]!=t[i])return!1}return!0}function u(e,t){var n={};return N(e,function(e){n[e]=t[e]}),n}function d(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t}function m(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var a in e)-1==o(n,a)&&(t[a]=e[a]);return t}function f(e,t){var n=P(e),a=n?[]:{};return N(e,function(e,r){t(e,r)&&(a[n?a.length:r]=e)}),a}function v(e,t){var n=P(e)?[]:{};return N(e,function(e,a){n[a]=t(e,a)}),n}function p(e,t){var a=1,i=2,c={},l=[],u=c,d=F(e.when(c),{$$promises:c,$$values:c});this.study=function(c){function f(e,n){if(y[n]!==i){if(h.push(n),y[n]===a)throw h.splice(0,o(h,n)),new Error("Cyclic dependency: "+h.join(" -> "));if(y[n]=a,R(e))g.push(n,[function(){return t.get(e)}],l);else{var r=t.annotate(e);N(r,function(e){e!==n&&c.hasOwnProperty(e)&&f(c[e],e)}),g.push(n,e,r)}h.pop(),y[n]=i}}function v(e){return L(e)&&e.then&&e.$$promises}if(!L(c))throw new Error("'invocables' must be an object");var p=s(c||{}),g=[],h=[],y={};return N(c,f),c=h=y=null,function(a,i,s){function o(){--_||($||r(y,i.$$values),f.$$values=y,f.$$promises=f.$$promises||!0,delete f.$$inheritedValues,l.resolve(y))}function c(e){f.$$failure=e,l.reject(e)}if(v(a)&&s===n&&(s=i,i=a,a=null),a){if(!L(a))throw new Error("'locals' must be an object")}else a=u;if(i){if(!v(i))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else i=d;var l=e.defer(),f=l.promise,h=f.$$promises={},y=F({},a),_=1+g.length/3,$=!1;if(O(i.$$failure))return c(i.$$failure),f;i.$$inheritedValues&&r(y,m(i.$$inheritedValues,p)),F(h,i.$$promises),i.$$values?($=r(y,m(i.$$values,p)),f.$$inheritedValues=m(i.$$values,p),o()):(i.$$inheritedValues&&(f.$$inheritedValues=m(i.$$inheritedValues,p)),i.then(o,c));for(var b=0,k=g.length;b<k;b+=3)a.hasOwnProperty(g[b])?o():function(n,r,i){function l(e){d.reject(e),c(e)}function u(){if(!O(f.$$failure))try{d.resolve(t.invoke(r,s,y)),d.promise.then(function(e){y[n]=e,o()},l)}catch(e){l(e)}}var d=e.defer(),m=0;N(i,function(e){h.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(m++,h[e].then(function(t){y[e]=t,--m||u()},l))}),m||u(),h[n]=d.promise}(g[b],g[b+1],g[b+2]);return f}},this.resolve=function(e,t,n,a){return this.study(e)(t,n,a)}}function g(e,t,n){this.fromConfig=function(e,t,n){return O(e.template)?this.fromString(e.template,t):O(e.templateUrl)?this.fromUrl(e.templateUrl,t):O(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return I(e)?e(t):e},this.fromUrl=function(n,a){return I(n)&&(n=n(a)),null==n?null:e.get(n,{cache:t,headers:{Accept:"text/html"}}).then(function(e){return e.data})},this.fromProvider=function(e,t,a){return n.invoke(e,null,a||{params:t})}}function h(e,t,r){function i(t,n,a,r){if(g.push(t),v[t])return v[t];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(p[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");return p[t]=new U.Param(t,n,a,r),p[t]}function s(e,t,n,a){var r=["",""],i=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return i;switch(n){case!1:r=["(",")"+(a?"?":"")];break;case!0:r=["?(",")?"];break;default:r=["("+n+"|",")?"]}return i+r[0]+t+r[1]}function o(r,i){var s,o,c,l,u;return s=r[2]||r[3],u=t.params[s],c=e.substring(m,r.index),o=i?r[4]:r[4]||("*"==r[1]?".*":null),l=U.type(o||"string")||a(U.type("string"),{pattern:new RegExp(o,t.caseInsensitive?"i":n)}),{id:s,regexp:o,segment:c,type:l,cfg:u}}t=F({params:{}},L(t)?t:{});var c,l=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,u=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,d="^",m=0,f=this.segments=[],v=r?r.params:{},p=this.params=r?r.params.$$new():new U.ParamSet,g=[];this.source=e;for(var h,y,_;(c=l.exec(e))&&(h=o(c,!1),!(h.segment.indexOf("?")>=0));)y=i(h.id,h.type,h.cfg,"path"),d+=s(h.segment,y.type.pattern.source,y.squash,y.isOptional),f.push(h.segment),m=l.lastIndex;_=e.substring(m);var $=_.indexOf("?");if($>=0){var b=this.sourceSearch=_.substring($);if(_=_.substring(0,$),this.sourcePath=e.substring(0,m+$),b.length>0)for(m=0;c=u.exec(b);)h=o(c,!0),y=i(h.id,h.type,h.cfg,"search"),m=l.lastIndex}else this.sourcePath=e,this.sourceSearch="";d+=s(_)+(!1===t.strict?"/?":"")+"$",
f.push(_),this.regexp=new RegExp(d,t.caseInsensitive?"i":n),this.prefix=f[0],this.$$paramNames=g}function y(e){F(this,e)}function _(){function e(e){return null!=e?e.toString().replace(/\//g,"%2F"):e}function r(e){return null!=e?e.toString().replace(/%2F/g,"/"):e}function i(){return{strict:p,caseInsensitive:m}}function c(e){return I(e)||P(e)&&I(e[e.length-1])}function l(){for(;k.length;){var e=k.shift();if(e.pattern)throw new Error("You cannot override a type's .pattern at runtime.");t.extend($[e.name],d.invoke(e.def))}}function u(e){F(this,e||{})}U=this;var d,m=!1,p=!0,g=!1,$={},b=!0,k=[],w={string:{encode:e,decode:r,is:function(e){return null==e||!O(e)||"string"==typeof e},pattern:/[^\/]*/},int:{encode:e,decode:function(e){return parseInt(e,10)},is:function(e){return O(e)&&this.decode(e.toString())===e},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return 0!==parseInt(e,10)},is:function(e){return!0===e||!1===e},pattern:/0|1/},date:{encode:function(e){return this.is(e)?[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-"):n},decode:function(e){if(this.is(e))return e;var t=this.capture.exec(e);return t?new Date(t[1],t[2]-1,t[3]):n},is:function(e){return e instanceof Date&&!isNaN(e.valueOf())},equals:function(e,t){return this.is(e)&&this.is(t)&&e.toISOString()===t.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:t.toJson,decode:t.fromJson,is:t.isObject,equals:t.equals,pattern:/[^\/]*/},any:{encode:t.identity,decode:t.identity,equals:t.equals,pattern:/.*/}};_.$$getDefaultValue=function(e){if(!c(e.value))return e.value;if(!d)throw new Error("Injectable functions cannot be called at configuration time");return d.invoke(e.value)},this.caseInsensitive=function(e){return O(e)&&(m=e),m},this.strictMode=function(e){return O(e)&&(p=e),p},this.defaultSquashPolicy=function(e){if(!O(e))return g;if(!0!==e&&!1!==e&&!R(e))throw new Error("Invalid squash policy: "+e+". Valid policies: false, true, arbitrary-string");return g=e,e},this.compile=function(e,t){return new h(e,F(i(),t))},this.isMatcher=function(e){if(!L(e))return!1;var t=!0;return N(h.prototype,function(n,a){I(n)&&(t=t&&O(e[a])&&I(e[a]))}),t},this.type=function(e,t,n){if(!O(t))return $[e];if($.hasOwnProperty(e))throw new Error("A type named '"+e+"' has already been defined.");return $[e]=new y(F({name:e},t)),n&&(k.push({name:e,def:n}),b||l()),this},N(w,function(e,t){$[t]=new y(F({name:t},e))}),$=a($,{}),this.$get=["$injector",function(e){return d=e,b=!1,l(),N(w,function(e,t){$[t]||($[t]=new y(e))}),this}],this.Param=function(e,t,a,r){function i(){if(!d)throw new Error("Injectable functions cannot be called at configuration time");var e=d.invoke(a.$$fn);if(null!==e&&e!==n&&!m.type.is(e))throw new Error("Default value ("+e+") for parameter '"+m.id+"' is not an instance of Type ("+m.type.name+")");return e}function l(e){function t(e){return function(t){return t.from===e}}return e=function(e){var n=v(f(m.replace,t(e)),function(e){return e.to});return n.length?n[0]:e}(e),O(e)?m.type.$normalize(e):i()}function u(){return"{Param:"+e+" "+t+" squash: '"+_+"' optional: "+h+"}"}var m=this;a=function(e){var t=L(e)?s(e):[];return-1===o(t,"value")&&-1===o(t,"type")&&-1===o(t,"squash")&&-1===o(t,"array")&&(e={value:e}),e.$$fn=c(e.value)?e.value:function(){return e.value},e}(a),t=function(t,n,a){if(t.type&&n)throw new Error("Param '"+e+"' has two type configurations.");return n||(t.type?t.type instanceof y?t.type:new y(t.type):"config"===a?$.any:$.string)}(a,t,r);var p=function(){var t={array:"search"===r&&"auto"},n=e.match(/\[\]$/)?{array:!0}:{};return F(t,n,a).array}();t=p?t.$asArray(p,"search"===r):t,"string"!==t.name||p||"path"!==r||a.value!==n||(a.value="");var h=a.value!==n,_=function(e,t){var n=e.squash;if(!t||!1===n)return!1;if(!O(n)||null==n)return g;if(!0===n||R(n))return n;throw new Error("Invalid squash policy: '"+n+"'. Valid policies: false, true, or arbitrary string")}(a,h),b=function(e,t,a,r){var i,s,c=[{from:"",to:a||t?n:""},{from:null,to:a||t?n:""}];return i=P(e.replace)?e.replace:[],R(r)&&i.push({from:r,to:n}),s=v(i,function(e){return e.from}),f(c,function(e){return-1===o(s,e.from)}).concat(i)}(a,p,h,_);F(this,{id:e,type:t,location:r,array:p,squash:_,replace:b,isOptional:h,value:l,dynamic:n,config:a,toString:u})},u.prototype={$$new:function(){return a(this,F(new u,{$$parent:this}))},$$keys:function(){for(var e=[],t=[],n=this,a=s(u.prototype);n;)t.push(n),n=n.$$parent;return t.reverse(),N(t,function(t){N(s(t),function(t){-1===o(e,t)&&-1===o(a,t)&&e.push(t)})}),e},$$values:function(e){var t={},n=this;return N(n.$$keys(),function(a){t[a]=n[a].value(e&&e[a])}),t},$$equals:function(e,t){var n=!0,a=this;return N(a.$$keys(),function(r){var i=e&&e[r],s=t&&t[r];a[r].type.equals(i,s)||(n=!1)}),n},$$validates:function(e){var a,r,i,s,o,c=this.$$keys();for(a=0;a<c.length&&(r=this[c[a]],(i=e[c[a]])!==n&&null!==i||!r.isOptional);a++){if(s=r.type.$normalize(i),!r.type.is(s))return!1;if(o=r.type.encode(s),t.isString(o)&&!r.type.pattern.exec(o))return!1}return!0},$$parent:n},this.ParamSet=u}function $(e,a){function r(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return null!=t?t[1].replace(/\\(.)/g,"$1"):""}function i(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t["$"===n?0:Number(n)]})}function s(e,t,n){if(!n)return!1;var a=e.invoke(t,t,{$match:n});return!O(a)||a}function o(a,r,i,s){function o(e,t,n){return"/"===p?e:t?p.slice(0,-1)+e:n?p.slice(1)+e:e}function m(e){function t(e){var t=e(i,a);return!!t&&(R(t)&&a.replace().url(t),!0)}if(!e||!e.defaultPrevented){v&&a.url();v=n;var r,s=l.length;for(r=0;r<s;r++)if(t(l[r]))return;u&&t(u)}}function f(){return c=c||r.$on("$locationChangeSuccess",m)}var v,p=s.baseHref(),g=a.url();return d||f(),{sync:function(){m()},listen:function(){return f()},update:function(e){if(e)return void(g=a.url());a.url()!==g&&(a.url(g),a.replace())},push:function(e,t,r){var i=e.format(t||{});null!==i&&t&&t["#"]&&(i+="#"+t["#"]),a.url(i),v=r&&r.$$avoidResync?a.url():n,r&&r.replace&&a.replace()},href:function(n,r,i){if(!n.validates(r))return null;var s=e.html5Mode();t.isObject(s)&&(s=s.enabled);var c=n.format(r);if(i=i||{},s||null===c||(c="#"+e.hashPrefix()+c),null!==c&&r&&r["#"]&&(c+="#"+r["#"]),c=o(c,s,i.absolute),!i.absolute||!c)return c;var l=!s&&c?"/":"",u=a.port();return u=80===u||443===u?"":":"+u,[a.protocol(),"://",a.host(),u,l,c].join("")}}}var c,l=[],u=null,d=!1;this.rule=function(e){if(!I(e))throw new Error("'rule' must be a function");return l.push(e),this},this.otherwise=function(e){if(R(e)){var t=e;e=function(){return t}}else if(!I(e))throw new Error("'rule' must be a function");return u=e,this},this.when=function(e,t){var n,o=R(t);if(R(e)&&(e=a.compile(e)),!o&&!I(t)&&!P(t))throw new Error("invalid 'handler' in when()");var c={matcher:function(e,t){return o&&(n=a.compile(t),t=["$match",function(e){return n.format(e)}]),F(function(n,a){return s(n,t,e.exec(a.path(),a.search()))},{prefix:R(e.prefix)?e.prefix:""})},regex:function(e,t){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return o&&(n=t,t=["$match",function(e){return i(n,e)}]),F(function(n,a){return s(n,t,e.exec(a.path()))},{prefix:r(e)})}},l={matcher:a.isMatcher(e),regex:e instanceof RegExp};for(var u in l)if(l[u])return this.rule(c[u](e,t));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(e){e===n&&(e=!0),d=e},this.$get=o,o.$inject=["$location","$rootScope","$injector","$browser"]}function b(e,r){function i(e){return 0===e.indexOf(".")||0===e.indexOf("^")}function m(e,t){if(!e)return n;var a=R(e),r=a?e:e.name;if(i(r)){if(!t)throw new Error("No reference point given for path '"+r+"'");t=m(t);for(var s=r.split("."),o=0,c=s.length,l=t;o<c;o++)if(""!==s[o]||0!==o){if("^"!==s[o])break;if(!l.parent)throw new Error("Path '"+r+"' not valid for state '"+t.name+"'");l=l.parent}else l=t;s=s.slice(o).join("."),r=l.name+(l.name&&s?".":"")+s}var u=D[r];return!u||!a&&(a||u!==e&&u.self!==e)?n:u}function f(e,t){S[e]||(S[e]=[]),S[e].push(t)}function p(e){for(var t=S[e]||[];t.length;)g(t.shift())}function g(t){t=a(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}});var n=t.name;if(!R(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(D.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var r=-1!==n.indexOf(".")?n.substring(0,n.lastIndexOf(".")):R(t.parent)?t.parent:L(t.parent)&&R(t.parent.name)?t.parent.name:"";if(r&&!D[r])return f(r,t.self);for(var i in E)I(E[i])&&(t[i]=E[i](t,E.$delegates[i]));return D[n]=t,!t[T]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){C.$current.navigable==t&&l(e,n)||C.transitionTo(t,e,{inherit:!0,location:!1})}]),p(n),t}function h(e){return e.indexOf("*")>-1}function y(e){for(var t=e.split("."),n=C.$current.name.split("."),a=0,r=t.length;a<r;a++)"*"===t[a]&&(n[a]="*");return"**"===t[0]&&(n=n.slice(o(n,t[1])),n.unshift("**")),"**"===t[t.length-1]&&(n.splice(o(n,t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length==n.length&&n.join("")===t.join("")}function _(e,t){return R(e)&&!O(t)?E[e]:I(t)&&R(e)?(E[e]&&!E.$delegates[e]&&(E.$delegates[e]=E[e]),E[e]=t,this):this}function $(e,t){return L(e)?t=e:t.name=e,g(t),this}function b(e,r,i,o,d,f,p,g,_){function $(t,n,a,i){var s=e.$broadcast("$stateNotFound",t,n,a);if(s.defaultPrevented)return p.update(),A;if(!s.retry)return null;if(i.$retry)return p.update(),x;var o=C.transition=r.when(s.retry);return o.then(function(){return o!==C.transition?S:(t.options.$retry=!0,C.transitionTo(t.to,t.toParams,t.options))},function(){return A}),p.update(),o}function b(e,n,a,s,c,l){function m(){var n=[];return N(e.views,function(a,r){var s=a.resolve&&a.resolve!==e.resolve?a.resolve:{};s.$template=[function(){return i.load(r,{view:a,locals:c.globals,params:f,notify:l.notify})||""}],n.push(d.resolve(s,c.globals,c.resolve,e).then(function(n){if(I(a.controllerProvider)||P(a.controllerProvider)){var i=t.extend({},s,c.globals);n.$$controller=o.invoke(a.controllerProvider,null,i)}else n.$$controller=a.controller;n.$$state=e,n.$$controllerAs=a.controllerAs,c[r]=n}))}),r.all(n).then(function(){return c.globals})}var f=a?n:u(e.params.$$keys(),n),v={$stateParams:f};c.resolve=d.resolve(e.resolve,v,c.resolve,e);var p=[c.resolve.then(function(e){c.globals=e})];return s&&p.push(s),r.all(p).then(m).then(function(e){return c})}var S=r.reject(new Error("transition superseded")),E=r.reject(new Error("transition prevented")),A=r.reject(new Error("transition aborted")),x=r.reject(new Error("transition failed"));return w.locals={resolve:null,globals:{$stateParams:{}}},C={params:{},current:w.self,$current:w,transition:null},C.reload=function(e){return C.transitionTo(C.current,f,{reload:e||!0,inherit:!1,notify:!0})},C.go=function(e,t,n){return C.transitionTo(e,t,F({inherit:!0,relative:C.$current},n))},C.transitionTo=function(t,n,i){n=n||{},i=F({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},i||{});var s,l=C.$current,d=C.params,v=l.path,g=m(t,i.relative),h=n["#"];if(!O(g)){var y={to:t,toParams:n,options:i},_=$(y,l.self,d,i);if(_)return _;if(t=y.to,n=y.toParams,i=y.options,g=m(t,i.relative),!O(g)){if(!i.relative)throw new Error("No such state '"+t+"'");throw new Error("Could not resolve '"+t+"' from state '"+i.relative+"'")}}if(g[T])throw new Error("Cannot transition to abstract state '"+t+"'");if(i.inherit&&(n=c(f,n||{},C.$current,g)),!g.params.$$validates(n))return x;n=g.params.$$values(n),t=g;var D=t.path,A=0,j=D[A],M=w.locals,I=[];if(i.reload){if(R(i.reload)||L(i.reload)){if(L(i.reload)&&!i.reload.name)throw new Error("Invalid reload state object");var P=!0===i.reload?v[0]:m(i.reload);if(i.reload&&!P)throw new Error("No such reload state '"+(R(i.reload)?i.reload:i.reload.name)+"'");for(;j&&j===v[A]&&j!==P;)M=I[A]=j.locals,A++,j=D[A]}}else for(;j&&j===v[A]&&j.ownParams.$$equals(n,d);)M=I[A]=j.locals,A++,j=D[A];if(k(t,n,l,d,M,i))return h&&(n["#"]=h),C.params=n,q(C.params,f),i.location&&t.navigable&&t.navigable.url&&(p.push(t.navigable.url,n,{$$avoidResync:!0,replace:"replace"===i.location}),p.update(!0)),C.transition=null,r.when(C.current);if(n=u(t.params.$$keys(),n||{}),i.notify&&e.$broadcast("$stateChangeStart",t.self,n,l.self,d).defaultPrevented)return e.$broadcast("$stateChangeCancel",t.self,n,l.self,d),p.update(),E;for(var N=r.when(M),U=A;U<D.length;U++,j=D[U])M=I[U]=a(M),N=b(j,n,j===t,N,M,i);var H=C.transition=N.then(function(){var a,r,s;if(C.transition!==H)return S;for(a=v.length-1;a>=A;a--)s=v[a],s.self.onExit&&o.invoke(s.self.onExit,s.self,s.locals.globals),s.locals=null;for(a=A;a<D.length;a++)r=D[a],r.locals=I[a],r.self.onEnter&&o.invoke(r.self.onEnter,r.self,r.locals.globals);return h&&(n["#"]=h),C.transition!==H?S:(C.$current=t,C.current=t.self,C.params=n,q(C.params,f),C.transition=null,i.location&&t.navigable&&p.push(t.navigable.url,t.navigable.locals.globals.$stateParams,{$$avoidResync:!0,replace:"replace"===i.location}),i.notify&&e.$broadcast("$stateChangeSuccess",t.self,n,l.self,d),p.update(!0),C.current)},function(a){return C.transition!==H?S:(C.transition=null,s=e.$broadcast("$stateChangeError",t.self,n,l.self,d,a),s.defaultPrevented||p.update(),r.reject(a))});return H},C.is=function(e,t,a){a=F({relative:C.$current},a||{});var r=m(e,a.relative);return O(r)?C.$current===r&&(!t||l(r.params.$$values(t),f)):n},C.includes=function(e,t,a){if(a=F({relative:C.$current},a||{}),R(e)&&h(e)){if(!y(e))return!1;e=C.$current.name}var r=m(e,a.relative);return O(r)?!!O(C.$current.includes[r.name])&&(!t||l(r.params.$$values(t),f,s(t))):n},C.href=function(e,t,a){a=F({lossy:!0,inherit:!0,absolute:!1,relative:C.$current},a||{});var r=m(e,a.relative);if(!O(r))return null;a.inherit&&(t=c(f,t||{},C.$current,r));var i=r&&a.lossy?r.navigable:r;return i&&i.url!==n&&null!==i.url?p.href(i.url,u(r.params.$$keys().concat("#"),t||{}),{absolute:a.absolute}):null},C.get=function(e,t){if(0===arguments.length)return v(s(D),function(e){return D[e].self});var n=m(e,t||C.$current);return n&&n.self?n.self:null},C}function k(e,t,n,a,r,i){if(!i.reload&&e===n&&(r===n.locals||!1===e.self.reloadOnSearch&&function(e,t,n){function a(t){return"search"!=e.params[t].location}var r=e.params.$$keys().filter(a),i=d.apply({},[e.params].concat(r));return new U.ParamSet(i).$$equals(t,n)}(n,a,t)))return!0}var w,C,D={},S={},T="abstract",E={parent:function(e){if(O(e.parent)&&e.parent)return m(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?m(t[1]):w},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=F({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url,n={params:e.params||{}};if(R(t))return"^"==t.charAt(0)?r.compile(t.substring(1),n):(e.parent.navigable||w).url.concat(t,n);if(!t||r.isMatcher(t))return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},ownParams:function(e){var t=e.url&&e.url.params||new U.ParamSet;return N(e.params||{},function(e,n){t[n]||(t[n]=new U.Param(n,null,e,"config"))}),t},params:function(e){return e.parent&&e.parent.params?F(e.parent.params.$$new(),e.ownParams):new U.ParamSet},views:function(e){var t={};return N(O(e.views)?e.views:{"":e},function(n,a){a.indexOf("@")<0&&(a+="@"+e.parent.name),t[a]=n}),t},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?F({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};w=g({name:"",url:"^",views:null,abstract:!0}),w.navigable=null,this.decorator=_,this.state=$,this.$get=b,b.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter","$location","$urlMatcherFactory"]}function k(){function e(e,t){return{load:function(n,a){var r;return a=F({template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}},a),a.view&&(r=t.fromConfig(a.view,a.params,a.locals)),r&&a.notify&&e.$broadcast("$viewContentLoading",a),r}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function w(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){return n(function(){e[0].scrollIntoView()},0,!1)}}]}function C(e,n,a,r){function i(e,t){if(c)return{enter:function(e,t,n){var a=c.enter(e,null,t,n);a&&a.then&&a.then(n)},leave:function(e,t){var n=c.leave(e,t);n&&n.then&&n.then(t)}};if(o){var n=o&&o(t,e);return{enter:function(e,t,a){n.enter(e,null,t),a()},leave:function(e,t){n.leave(e),t()}}}return function(){return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}}()}var s=function(){return n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(e){return null}}}(),o=s("$animator"),c=s("$animate");return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,s,o){return function(n,s,c){function l(){d&&(d.remove(),d=null),f&&(f.$destroy(),f=null),m&&(h.leave(m,function(){d=null}),d=m,m=null)}function u(i){var u,d=S(n,c,s,r),y=d&&e.$current&&e.$current.locals[d];if(i||y!==v){u=n.$new(),v=e.$current.locals[d];var _=o(u,function(e){h.enter(e,s,function(){f&&f.$emit("$viewContentAnimationEnded"),(t.isDefined(g)&&!g||n.$eval(g))&&a(e)}),l()});m=_,f=u,f.$emit("$viewContentLoaded"),f.$eval(p)}}var d,m,f,v,p=c.onload||"",g=c.autoscroll,h=i(c,n);n.$on("$stateChangeSuccess",function(){u(!1)}),n.$on("$viewContentLoading",function(){u(!1)}),u(!0)}}}}function D(e,t,n,a){return{restrict:"ECA",priority:-400,compile:function(r){var i=r.html();return function(r,s,o){var c=n.$current,l=S(r,o,s,a),u=c&&c.locals[l];if(u){s.data("$uiView",{name:l,state:u.$$state}),s.html(u.$template?u.$template:i);var d=e(s.contents());if(u.$$controller){u.$scope=r,u.$element=s;var m=t(u.$$controller,u);u.$$controllerAs&&(r[u.$$controllerAs]=m),s.data("$ngControllerController",m),s.children().data("$ngControllerController",m)}d(r)}}}}}function S(e,t,n,a){var r=a(t.uiView||t.name||"")(e),i=n.inheritedData("$uiView");return r.indexOf("@")>=0?r:r+"@"+(i?i.state.name:"")}function T(e,t){var n,a=e.match(/^\s*({[^}]*})\s*$/);if(a&&(e=t+"("+a[1]+")"),!(n=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/))||4!==n.length)throw new Error("Invalid state ref '"+e+"'");return{state:n[1],paramExpr:n[3]||null}}function E(e){var t=e.parent().inheritedData("$uiView");if(t&&t.state&&t.state.name)return t.state}function A(e,n){var a=["location","inherit","reload","absolute"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(r,i,s,o){var c=T(s.uiSref,e.current.name),l=null,u=E(i)||e.$current,d="[object SVGAnimatedString]"===Object.prototype.toString.call(i.prop("href"))?"xlink:href":"href",m=null,f="A"===i.prop("tagName").toUpperCase(),v="FORM"===i[0].nodeName,p=v?"action":d,g=!0,h={relative:u,inherit:!0},y=r.$eval(s.uiSrefOpts)||{};t.forEach(a,function(e){e in y&&(h[e]=y[e])});var _=function(n){if(n&&(l=t.copy(n)),g){m=e.href(c.state,l,h);var a=o[1]||o[0];if(a&&a.$$addStateInfo(c.state,l),null===m)return g=!1,!1;s.$set(p,m)}};c.paramExpr&&(r.$watch(c.paramExpr,function(e,t){e!==l&&_(e)},!0),l=t.copy(r.$eval(c.paramExpr))),_(),v||i.bind("click",function(t){if(!((t.which||t.button)>1||t.ctrlKey||t.metaKey||t.shiftKey||i.attr("target"))){var a=n(function(){e.go(c.state,l,h)});t.preventDefault();var r=f&&!m?1:0;t.preventDefault=function(){r--<=0&&n.cancel(a)}}})}}}function x(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,a,r){function i(){s()?a.addClass(c):a.removeClass(c)}function s(){for(var e=0;e<l.length;e++)if(o(l[e].state,l[e].params))return!0;return!1}function o(t,n){return void 0!==r.uiSrefActiveEq?e.is(t.name,n):e.includes(t.name,n)}var c,l=[];c=n(r.uiSrefActiveEq||r.uiSrefActive||"",!1)(t),this.$$addStateInfo=function(t,n){var r=e.get(t,E(a));l.push({state:r||{name:t},params:n}),i()},t.$on("$stateChangeSuccess",i)}]}}function j(e){var t=function(t){return e.is(t)};return t.$stateful=!0,t}function M(e){var t=function(t){return e.includes(t)};return t.$stateful=!0,t}var O=t.isDefined,I=t.isFunction,R=t.isString,L=t.isObject,P=t.isArray,N=t.forEach,F=t.extend,q=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),p.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",p),g.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",g);var U;h.prototype.concat=function(e,t){var n={caseInsensitive:U.caseInsensitive(),strict:U.strictMode(),squash:U.defaultSquashPolicy()};return new h(this.sourcePath+e+this.sourceSearch,F(n,t),this)},h.prototype.toString=function(){return this.source},h.prototype.exec=function(e,t){var n=this.regexp.exec(e);if(!n)return null;t=t||{};var a,r,i,s=this.parameters(),o=s.length,c=this.segments.length-1,l={};if(c!==n.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(a=0;a<c;a++){i=s[a];var u=this.params[i],d=n[a+1];for(r=0;r<u.replace;r++)u.replace[r].from===d&&(d=u.replace[r].to);d&&!0===u.array&&(d=function(e){function t(e){return e.split("").reverse().join("")}function n(e){return e.replace(/\\-/g,"-")}return v(v(t(e).split(/-(?!\\)/),t),n).reverse()}(d)),l[i]=u.value(d)}for(;a<o;a++)i=s[a],l[i]=this.params[i].value(t[i]);return l},h.prototype.parameters=function(e){return O(e)?this.params[e]||null:this.$$paramNames},h.prototype.validates=function(e){return this.params.$$validates(e)},h.prototype.format=function(e){function t(e){return encodeURIComponent(e).replace(/-/g,function(e){return"%5C%"+e.charCodeAt(0).toString(16).toUpperCase()})}e=e||{};var n=this.segments,a=this.parameters(),r=this.params;if(!this.validates(e))return null;var i,s=!1,o=n.length-1,c=a.length,l=n[0];for(i=0;i<c;i++){var u=i<o,d=a[i],m=r[d],f=m.value(e[d]),p=m.isOptional&&m.type.equals(m.value(),f),g=!!p&&m.squash,h=m.type.encode(f);if(u){var y=n[i+1];if(!1===g)null!=h&&(P(h)?l+=v(h,t).join("-"):l+=encodeURIComponent(h)),l+=y;else if(!0===g){var _=l.match(/\/$/)?/\/?(.*)/:/(.*)/;l+=y.match(_)[1]}else R(g)&&(l+=g+y)}else{if(null==h||p&&!1!==g)continue;P(h)||(h=[h]),h=v(h,encodeURIComponent).join("&"+d+"="),l+=(s?"&":"?")+d+"="+h,s=!0}}return l},y.prototype.is=function(e,t){return!0},y.prototype.encode=function(e,t){return e},y.prototype.decode=function(e,t){return e},y.prototype.equals=function(e,t){return e==t},y.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)},y.prototype.pattern=/.*/,y.prototype.toString=function(){return"{Type:"+this.name+"}"},y.prototype.$normalize=function(e){return this.is(e)?e:this.decode(e)},y.prototype.$asArray=function(e,t){function a(e,t){function a(e,t){return function(){return e[t].apply(e,arguments)}}function r(e){return P(e)?e:O(e)?[e]:[]}function i(e){switch(e.length){case 0:return n;case 1:return"auto"===t?e[0]:e;default:return e}}function s(e){return!e}function o(e,t){return function(n){n=r(n);var a=v(n,e);return!0===t?0===f(a,s).length:i(a)}}this.encode=o(a(e,"encode")),this.decode=o(a(e,"decode")),this.is=o(a(e,"is"),!0),this.equals=function(e){return function(t,n){var a=r(t),i=r(n);if(a.length!==i.length)return!1;for(var s=0;s<a.length;s++)if(!e(a[s],i[s]))return!1;return!0}}(a(e,"equals")),this.pattern=e.pattern,this.$normalize=o(a(e,"$normalize")),this.name=e.name,this.$arrayMode=t}if(!e)return this;if("auto"===e&&!t)throw new Error("'auto' array mode is for query parameters only");return new a(this,e)},t.module("ui.router.util").provider("$urlMatcherFactory",_),t.module("ui.router.util").run(["$urlMatcherFactory",function(e){}]),$.$inject=["$locationProvider","$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",$),b.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",b),k.$inject=[],t.module("ui.router.state").provider("$view",k),t.module("ui.router.state").provider("$uiViewScroll",w),C.$inject=["$state","$injector","$uiViewScroll","$interpolate"],D.$inject=["$compile","$controller","$state","$interpolate"],t.module("ui.router.state").directive("uiView",C),t.module("ui.router.state").directive("uiView",D),A.$inject=["$state","$timeout"],x.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",A).directive("uiSrefActive",x).directive("uiSrefActiveEq",x),j.$inject=["$state"],M.$inject=["$state"],t.module("ui.router.state").filter("isState",j).filter("includedByState",M)}(window,window.angular),define("tasks-assignments/modules/run.module",["common/angular","common/ui-select","common/modules/xeditable-civi","tasks-assignments/vendor/angular-bootstrap-calendar","tasks-assignments/vendor/angular-checklist-model","tasks-assignments/vendor/angular-router","tasks-assignments/modules/config","tasks-assignments/modules/settings","common/modules/routers/compu-ui-router","common/filters/angular-date/format-date","common/directives/angular-date/date-input","common/directives/prevent-animations","common/directives/loading"],function(e){"use strict";e.module("civitasks.run",["angularFileUpload","ngResource","ngAnimate","ngSanitize","compu.ui.router","ui.select","mwl.calendar","textAngular","checklist-model","civitasks.config","civitasks.controllers","civitasks.directives","civitasks.filters","civitasks.resources","civitasks.services","civitasks.settings","xeditable","xeditable-civi","common.angularDate","common.directives"]).run(["$rootScope","$rootElement","$q","$location","$log","config","settings","DocumentService","TaskService","AssignmentService","KeyDateService","ContactService","editableOptions",function(t,n,a,r,i,s,o,c,l,u,d,m,f){i.debug("civitasks.run");var v=[s.LOGGED_IN_CONTACT_ID];t.cache={contact:{obj:{},arr:[],arrSearch:[]},assignment:{obj:{},arr:[],arrSearch:[]},assignmentType:{obj:{},arr:[]},dateType:{obj:{period_start_date:"Contract Start Date",period_end_date:"Contract End Date",birth_date:"Birthday",probation_end_date:"Probation End Date"},arr:[]},documentType:{obj:{},arr:[]},documentStatus:{obj:{},arr:[]},documentStatusResolve:s.status.resolve.DOCUMENT,taskType:{obj:{},arr:[]},taskStatus:{obj:{},arr:[]},taskStatusResolve:s.status.resolve.TASK},t.location=r,t.pathTpl=s.path.TPL,t.permissions=s.permissions,t.prefix=s.CLASS_NAME_PREFIX,t.settings=o,t.url=s.url,s.CONTACT_ID&&v.push(s.CONTACT_ID),l.getOptions().then(function(n){e.extend(t.cache,n)}),c.getOptions().then(function(n){e.extend(t.cache,n)}),u.getTypes().then(function(n){e.extend(t.cache.assignmentType.obj,n),e.forEach(n,function(e){this.push(e)},t.cache.assignmentType.arr)}),m.get({IN:v}).then(function(e){m.updateCache(e)}),e.forEach(t.cache.dateType.obj,function(e,t){this.push({key:t,value:e})},t.cache.dateType.arr),t.$on("$stateChangeSuccess",function(){n.removeClass("ct-page-loading")}),f.theme="bs3"}])}),define("tasks-assignments/modules/app-dashboard.module",["common/angular","common/moment","common/lodash","common/services/angular-date/date-format","tasks-assignments/modules/run.module"],function(e,t,n){"use strict";e.module("civitasks.app-dashboard",["civitasks.run"]).config(["config","$resourceProvider","$httpProvider","$logProvider","$urlRouterProvider","$stateProvider","calendarConfigProvider","uibDatepickerConfig","uiSelectConfig",function(a,r,i,s,o,c,l,u,d){s.debugEnabled(a.DEBUG),o.otherwise("/tasks"),c.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("tasks",{url:"/tasks",controller:"TaskListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/tasks.html?v="+(new Date).getTime(),resolve:{taskList:["TaskService",function(e){return e.get({status_id:{"NOT IN":a.status.resolve.TASK}})}]}}).state("tasks.my",{url:"/my",params:{ownership:"assigned"}}).state("tasks.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("tasks.all",{url:"/all",params:{ownership:null}}).state("documents",{url:"/documents",controller:"DocumentListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/documents.html?v=8",resolve:{documentList:["DocumentService",function(e){return e.get({})}]}}).state("documents.my",{url:"/my",params:{ownership:"assigned"}}).state("documents.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("documents.all",{url:"/all",params:{ownership:null}}).state("assignments",{url:"/assignments",controller:"ExternalPageCtrl",templateUrl:a.path.TPL+"dashboard/assignments.html?v=5"}).state("calendar",{abstract:!0,controller:"CalendarCtrl",templateUrl:a.path.TPL+"dashboard/calendar.html?v=3",resolve:{documentList:["$q","DocumentService","settings",function(t,n,r){var i=t.defer();return+r.tabEnabled.documents||i.resolve([]),t.all([n.get({sequential:0,assignee_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.DOCUMENT}}),n.get({sequential:0,source_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.DOCUMENT}})]).then(function(t){var n,a=[];e.extend(t[0],t[1]);for(n in t[0])a.push(t[0][n]);i.resolve(a)}),i.promise}],taskList:["$q","TaskService",function(e,t){var r=e.defer();return e.all([t.get({sequential:1,assignee_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.TASK}}),t.get({sequential:1,source_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.TASK}})]).then(function(e){var t=n(e[0]).assign(e[1]);r.resolve(t.values().value())}),r.promise}]}}).state("calendar.mwl",{url:"/calendar",views:{documentList:{controller:"DocumentListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/calendar.documentList.html?v=6"},taskList:{controller:"TaskListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/calendar.taskList.html?v=5"}}}).state("calendar.mwl.day",{params:{calendarView:"day"}}).state("calendar.mwl.month",{params:{calendarView:"month"}}).state("calendar.mwl.week",{params:{calendarView:"week"}}).state("reports",{url:"/reports",controller:"ExternalPageCtrl",templateUrl:a.path.TPL+"dashboard/reports.html?v=4"}).state("keyDates",{url:"/key-dates",controller:"DateListCtrl",templateUrl:a.path.TPL+"dashboard/key-dates.html?v=4",resolve:{contactList:["KeyDateService",function(e){return e.get(t().startOf("month"),t().endOf("month"))}]}}),r.defaults.stripTrailingSlashes=!1,i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",l.setDateFormats({weekDay:"ddd"}),u.showWeeks=!1,d.theme="bootstrap"}])}),define("tasks-assignments/modules/app-documents.module",["common/angular","tasks-assignments/modules/run.module"],function(e){"use strict";e.module("civitasks.app-documents",["civitasks.run"]).config(["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,a,r,i,s,o){o.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"DocumentListController",controllerAs:"list",templateUrl:e.path.TPL+"contact/documents.html?v=4",resolve:{documentList:["DocumentService",function(t){return t.get({target_contact_id:e.CONTACT_ID})}]}}),a.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.showWeeks=!1,s.theme="bootstrap"}])}),define("tasks-assignments/modules/app-tasks",["common/angular","tasks-assignments/modules/run.module"],function(e){"use strict";e.module("civitasks.app-tasks",["civitasks.run"]).config(["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,a,r,i,s,o){o.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"TaskListController",
controllerAs:"list",templateUrl:e.path.TPL+"contact/tasks.html?v=222",resolve:{taskList:["TaskService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.TASK}})}]}}),a.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.showWeeks=!1,s.theme="bootstrap"}])}),define("tasks-assignments/modules/app-settings",["common/angular","tasks-assignments/modules/run.module"],function(e){"use strict";e.module("civitasks.app-settings",["civitasks.run"]).config(["config","$stateProvider","$urlRouterProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,a,r,i,s,o){o.debugEnabled(e.DEBUG),n.otherwise("/"),t.state("settings",{url:"/",controller:"SettingsCtrl",templateUrl:e.path.TPL+"settings.html?v=5"}),a.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.showWeeks=!1,s.theme="bootstrap"}])}),define("tasks-assignments/controllers/assignments.controller",[],function(){"use strict";function e(e,t,n,a,r,i,s){t.info("Controller: AssignmentsCtrl")}return e.__name="AssignmentsCtrl",e.$inject=["$scope","$log","$uibModal","$rootElement","$rootScope","$state","config"],e}),define("tasks-assignments/controllers/calendar.controller",["common/angular","common/moment"],function(e,t){"use strict";function n(n,a,r,i,s,o,c,l,u,d){function m(e,n,a,r,i){var s,o,c,l=e.id,u=n.id,d=a.length,m=0;if(u)for(;m<d;m++)+a[m].id==+u&&(a.splice(m,1),m--,d--);l&&(s=t(e.activity_date_time).toDate(),o=r[e.activity_type_id],a.push({id:l,title:o,type:i,startsAt:s,endsAt:s,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),e.expire_date&&+(c=t(e.expire_date).toDate())!=+s&&a.push({id:l,title:o,type:i,startsAt:c,endsAt:c,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))}this.init=function(){n.calTaskList=this.createCalEventList("task",l,r.cache.taskType.obj),+d.tabEnabled.documents&&(n.calDocList=this.createCalEventList("document",u,r.cache.documentType.obj))},this.createCalEventList=function(n,a,r){var i=[];return e.forEach(a,function(e){e.activity_date_time=t(e.activity_date_time).toDate(),this.push({id:e.id,title:r[e.activity_type_id],type:n,startsAt:e.activity_date_time,endsAt:e.activity_date_time,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),e.expire_date&&(e.expire_date=t(e.expire_date).toDate(),+e.expire_date!=+e.activity_date_time&&this.push({id:e.id,title:r[e.activity_type_id],type:n,startsAt:e.expire_date,endsAt:e.expire_date,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))},i),i},n.calendarDay=new Date,n.calendarTitle="",n.calendarView=o.params.calendarView||"month",n.calTaskList=[],n.calDocList=[],n.displayDayView=function(e){n.calendarDay=t(e).toDate(),n.calendarView="day"},n.$on("taskDelete",function(e,t){m({},{id:t},n.calTaskList)}),n.$on("taskFormSuccess",function(e,t,a){m(r.cache.taskStatusResolve.indexOf(t.status_id)>-1?{}:t,a,n.calTaskList,r.cache.taskType.obj,"task")}),n.$on("documentDelete",function(e,t){m({},{id:t},n.calDocList)}),n.$on("documentFormSuccess",function(e,t,a){m(r.cache.documentStatusResolve.indexOf(t.status_id)>-1?{}:t,a,n.calDocList,r.cache.documentType.obj,"document")}),n.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(n.calTaskList,this.createCalEventList("task",t.taskList,r.cache.taskType.obj)),+d.tabEnabled.documents&&Array.prototype.push.apply(n.calDocList,this.createCalEventList("document",t.documentList,r.cache.documentType.obj))}.bind(this)),this.init()}return n.__name="CalendarCtrl",n.$inject=["$scope","$log","$rootScope","$filter","$timeout","$state","$stateParams","taskList","documentList","settings"],n}),define("tasks-assignments/controllers/date-list.controller",["common/moment"],function(e){"use strict";function t(t,n,a,r,i,s,o,c,l,u){function d(){t.$watch("filterParams.dateRange.from",function(e){t.datepickerOptions.until.minDate=e}),t.$watch("filterParams.dateRange.until",function(e){t.datepickerOptions.from.maxDate=e})}s.debug("Controller: DateListCtrl"),this.init=function(){t.dateList=this.createDateList(c),r.$broadcast("ct-spinner-hide"),l.get(e().startOf("year"),e().endOf("year")).then(function(e){t.dateList=this.createDateList(e),t.dataLoading=!1}.bind(this)),d()},this.createDateList=function(e){for(var t,n=0,a=e.length,r={},i=[];n<a;n++)r[e[n].keydate]=r[e[n].keydate]||[],r[e[n].keydate].push(e[n]);for(t in r)i.push({date:t,dateContactList:r[t]});return i},t.dataLoading=!0,t.dateList=[],t.dateListLimit=5,t.dateListSelected=[],t.dpOpened={filterDates:{}},t.isCollapsed={filterDates:!0},t.filterParams={dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()},date:"month",dateType:[]},t.datepickerOptions={from:{maxDate:t.filterParams.dateRange.until},until:{minDate:t.filterParams.dateRange.from}},t.label={isoWeek:"Week",month:"Month",year:"Year",dateRange:""},t.csvExport=function(){var n,a;"dateRange"===t.filterParams.date?(n=t.filterParams.dateRange.from?e(t.filterParams.dateRange.from).format("YYYY-MM-DD"):"",a=t.filterParams.dateRange.until?e(t.filterParams.dateRange.until).format("YYYY-MM-DD"):""):(n=e().startOf(t.filterParams.date).format("YYYY-MM-DD"),a=e().endOf(t.filterParams.date).format("YYYY-MM-DD")),window.location.href=u.url.CSV_EXPORT+"/keydatescsv?start_date="+n+"&end_date="+a},t.labelDateRange=function(e,n){var a=i("date")(e,"dd/MM/yyyy")||"",r=i("date")(n,"dd/MM/yyyy")||"";r&&(r=a?" - "+r:"Until: "+r),a&&(a=r?a:"From: "+a),t.label.dateRange=a+r},t.showDateRange=function(n,a){t.$broadcast("ct-spinner-show","dateList"),l.get(e(n),e(a)).then(function(e){t.dateListSelected=this.createDateList(e),t.filterParams.date="dateRange",t.$broadcast("ct-spinner-hide","dateList")}.bind(this))}.bind(this),this.init()}return t.__name="DateListCtrl",t.$inject=["$scope","$uibModal","$rootElement","$rootScope","$filter","$log","$timeout","contactList","KeyDateService","config"],t}),define("tasks-assignments/controllers/document-list.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function a(n,a,r,i,s,o,c,l,u,d,m,f,v,p,g,h,y){function _(e,t){var a,i=t.length,o=[];if(e&&i)switch(e){case"delete":r.open({msg:"Are you sure you want to delete "+i+" document(s)?"}).then(function(e){if(e){for(n.$broadcast("ct-spinner-show","documentList"),a=0;a<i;a++)o.push(g.delete(t[a].id));u.all(o).then(function(e){for(a=0;a<i;a++)s.$broadcast("documentDelete",t[a].id),n.list.splice(n.list.indexOf(t[a]),1);n.$broadcast("ct-spinner-hide","documentList"),p.updateTab()})}})}}function $(){M.filterParams.dateRange.from=M.filterParamsHolder.dateRange.from,M.filterParams.dateRange.until=M.filterParamsHolder.dateRange.until,M.filterParams.due="dateRange",M.isDocumentSection=null!==M.filterParamsHolder.dateRange.from||null!==M.filterParamsHolder.dateRange.until,M.labelDateRange()}function b(e,t){if(!t||"number"!=typeof+t)return null;n.$broadcast("ct-spinner-show","documentList"),g.save({id:e.id,status_id:t}).then(function(t){e.id=t.id,e.status_id=t.status_id,n.$broadcast("ct-spinner-hide","documentList"),p.updateTab()})}function k(e){var n=c("filterByDateField")(M.list,e,"activity_date_time",M.filterParams.dateRange),a=c("filterByDateField")(M.list,e,"expire_date",M.filterParams.dateRange);return t.uniq(t.union(n,a),"id")}function w(){var e=c("date")(M.filterParams.dateRange.from,"dd/MM/yyyy")||"",t=c("date")(M.filterParams.dateRange.until,"dd/MM/yyyy")||"";t&&(t=e?" - "+t:"Until: "+t),e&&(e=t?e:"From: "+e),M.label.dateRange=e+t}function C(e){var n={};return e.length&&t.each(e,function(e){var a=t.find(s.cache.contact.obj,{contact_id:e});a&&(n[e]=a.sort_name.replace(",",""))}),n}function D(e){r.open({msg:"Are you sure you want to delete this document?"}).then(function(t){t&&g.delete(e.id).then(function(t){M.list.splice(M.list.indexOf(e),1),s.$broadcast("documentDelete",e.id),p.updateTab()})})}function S(e){o.go("calendar.mwl."+e)}function T(e,t){return t.crmMessages&&t.crmMessages.length&&e.test(t.crmMessages[0].title)}function E(e,t,n){switch(!0){case"3"!==t.status_id&&"4"!==t.status_id&&!n.status_id:e.push(t)}}function A(e){switch(M.reverse=M.propertyName===e&&!M.reverse,M.propertyName=e,e){case"type":M.list=t.sortBy(M.list,function(e){return s.cache.documentType.obj[e.activity_type_id].toLowerCase()});break;case"status_id":M.list=t.sortBy(M.list,function(e){return s.cache.documentStatus.obj[e.status_id].toLowerCase()});break;case"target_contact":M.list=t.sortBy(M.list,function(e){return s.cache.contact.obj[e.target_contact_id[0]].sort_name.toLowerCase()});break;case"assignee":M.list=t.sortBy(M.list,function(e){var n=e.assignee_contact_id.length&&t.find(s.cache.contact.obj,{id:e.assignee_contact_id[0]});return n?n.sort_name.toLowerCase():""});break;case"case_id":M.list=t.sortBy(M.list,function(e){var t=s.cache.assignment.obj[e.case_id],n=t&&s.cache.assignmentType.obj[t.case_type_id];return n&&n.title.toLowerCase()})}}function x(){n.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(M.list,t.documentList)}),n.$on("documentFormSuccess",function(t,n,a){e.equals({},a)?E(M.list,n,a):e.extend(a,n)}),n.$on("crmFormSuccess",function(e,t){if("success"===t.status){var n=/case|activity|assignment/i;(n.test(t.title)||T(n,t)||n.test(t.crmMessages[0].text))&&(s.cache.assignment={obj:{},arr:[]},o.go(o.current,{},{reload:!0}))}})}function j(){n.$watch("filterParamsHolder.dateRange.from",function(e){M.datepickerOptions.until.minDate=e}),n.$watch("filterParamsHolder.dateRange.until",function(e){M.datepickerOptions.from.maxDate=e})}l.debug("Controller: DocumentListController");var M=this,O=["1","2"];M.isDocumentSection=!1,M.dueThisWeek=0,M.dueToday=0,M.list=m,M.listFiltered=[],M.listOngoing=[],M.listPaginated=[],M.overdue=0,M.propertyName="activity_date_time",M.reverse=!0,M.documentContactColumns=[{label:"Type",property:"type"},{label:"Document Number",property:"document_number"},{label:"Assigned to",property:"assignee"},{label:"Workflow",property:"case_id",condition:y.extEnabled.assignments},{label:"Valid From",property:"valid_from"},{label:"Expiry Date",property:"expire_date"},{label:"Status",property:"status_id"}],M.documentDashboardColumns=[{label:"Type",property:"type"},{label:"Staff",property:"target_contact"},{label:"Assigned to",property:"assignee"},{label:"Workflow",property:"case_id",condition:y.extEnabled.assignments},{label:"Due Date",property:"activity_date_time"},{label:"Expiry Date",property:"expire_date"},{label:"Status",property:"status_id"}],M.dpOpened={filterDates:{}},M.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue"},{badgeClass:"primary",calendarView:"month",value:"dueInNextFortnight"},{badgeClass:"primary",calendarView:"month",value:"dueInNinetyDays"},{badgeClass:"primary",calendarView:"month",value:"all"}],M.filterParams={contactId:null,documentStatus:[],ownership:o.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},M.filterParamsHolder={documentStatus:O,dateRange:{from:null,until:null}},M.datepickerOptions={from:{maxDate:M.filterParamsHolder.dateRange.until},until:{minDate:M.filterParamsHolder.dateRange.from}},M.isCollapsed={filterAdvanced:!0,filterDates:!0},M.label={addNew:"Add Document",overdue:"Overdue",dueInNextFortnight:"Next fortnight",dueInNinetyDays:"90 days",all:"All",dateRange:""},M.pagination={currentPage:1,itemsPerPage:10,maxSize:5},M.apply=_,M.applySidebarFilters=$,M.changeStatus=b,M.filterByDateField=k,M.deleteDocument=D,M.filterByDateField=k,M.labelDateRange=w,M.listAssignees=C,M.sortBy=A,M.viewInCalendar=S,function(){x(),j(),M.applySidebarFilters(),g.cacheContactsAndAssignments(m).then(function(){s.$broadcast("ct-spinner-hide"),l.debug(s.cache)})}()}return a.__name="DocumentListController",a.$inject=["$scope","$uibModal","$dialog","$rootElement","$rootScope","$state","$filter","$log","$q","$timeout","documentList","config","ContactService","AssignmentService","DocumentService","FileService","settings"],a}),define("tasks-assignments/controllers/document.controller",["common/moment"],function(e){"use strict";function t(t,n,a,r){r.debug("Controller: DocumentCtrl"),t.document.activity_date_time=t.document.activity_date_time?e(t.document.activity_date_time).toDate():null,t.document.expire_date=t.document.expire_date?e(t.document.expire_date).toDate():null,t.document.valid_from=t.document.valid_from?e(t.document.valid_from).toDate():null,t.document.remind_me=1===t.document.remind_me,t.urlFile=a.url.FILE+"/zip?entityID="+t.document.id+"&entityTable=civicrm_activity",t.$watch("document.activity_date_time",function(e){t.document.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}return t.__name="DocumentCtrl",t.$inject=["$scope","$rootScope","config","$log"],t}),define("tasks-assignments/controllers/external-page.controller",[],function(){"use strict";function e(e,t,n,a,r,i,s){t.debug("Controller: ExternalPageCtrl"),e.assignmentsUrl=s.url.ASSIGNMENTS+"?reset=1",e.reportsUrl=s.url.CIVI_DASHBOARD+"?reset=1",e.$on("assignmentFormSuccess",function(){i.go(i.current,{},{reload:!0})}),e.$on("iframe-ready",function(){r.$broadcast("ct-spinner-hide")})}return e.__name="ExternalPageCtrl",e.$inject=["$scope","$log","$uibModal","$rootElement","$rootScope","$state","config"],e}),define("tasks-assignments/controllers/main.controller",[],function(){"use strict";function e(e,t,n,a,r,i,s,o){a.debug("Controller: MainCtrl"),t.modalDocument=function(t,i,c){c&&c.preventDefault(),t=t||"new",i=i||{},r.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/document.html?v=3",controller:"ModalDocumentController",controllerAs:"documentModal",resolve:{modalMode:function(){return t},role:function(){return"admin"},data:function(){return i},files:function(){return i.id&&+i.file_count?s.get(i.id,"civicrm_activity"):[]}}}).result.then(function(t){e.$broadcast("documentFormSuccess",t,i)},function(){a.info("Modal dismissed")})},t.modalTask=function(i){i=i||{},r.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/task.html?v=5",controller:"ModalTaskCtrl",resolve:{data:function(){return i}}}).result.then(function(n){e.$broadcast("taskFormSuccess",n,i),n.open&&t.modalTask(i)},function(){a.info("Modal dismissed")})},t.modalAssignment=function(t){t=t||{},r.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/assignment.html?v=3",controller:"ModalAssignmentCtrl",size:"lg",resolve:{data:function(){return t}}}).result.then(function(n){e.$broadcast("assignmentFormSuccess",n,t)},function(){a.info("Modal dismissed")})},t.modalReminder=function(e,t){if(!e||"object"!=typeof e||!t||"string"!=typeof t)return null;r.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/reminder.html?v=1",controller:"ModalReminderCtrl",resolve:{data:function(){return e},type:function(){return t}}})}}return e.__name="MainCtrl",e.$inject=["$scope","$rootScope","$rootElement","$log","$uibModal","$q","FileService","config"],e}),define("tasks-assignments/controllers/settings.controller",["common/angular"],function(e){"use strict";function t(t,n,a,r,i,s,o,c,l,u,d,m,f){o.debug("Controller: SettingsCtrl"),t.settings=e.copy(f),t.configureAddAssignmentBtn=!!t.settings.copy.button.assignmentAdd;var v=function(){var e=s.defer();return d.get({entity:"Activity",action:"getoptions",json:{field:"activity_type_id"}},function(t){e.resolve(t.values||[])},function(){e.reject("Unable to get activity types")}),e.promise}();t.modalTaskMigrate=function(){l.open({appendTo:a.find("div").eq(0),templateUrl:m.path.TPL+"modal/taskMigrate.html?v=1",controller:"ModalTaskMigrateCtrl",resolve:{activityType:function(){return v}}}).result.then(function(e){t.$broadcast("taskMigrateFormSuccess",e)},function(){o.info("Modal dismissed")})},t.confirm=function(){t.$broadcast("ct-spinner-show"),u.set({documents_tab:t.settings.tabEnabled.documents,keydates_tab:t.settings.tabEnabled.keyDates,add_assignment_button_title:t.settings.copy.button.assignmentAdd,is_task_dashboard_default:t.settings.isTaskDashboardDefault,days_to_create_a_document_clone:t.settings.daysToCreateADocumentClone}).then(function(e){t.$broadcast("ct-spinner-hide"),t.settingsForm.$pristine=!0},function(e){CRM.alert(e,"Error","error"),t.$broadcast("ct-spinner-hide")})},t.$on("$stateChangeStart",function(e,a,r,s,o){t.settingsForm.$pristine||(e.preventDefault(),i.open({copyCancel:"No",msg:"Are you sure you want to leave this page? Changes will be lost!"}).then(function(e){if(!e)return void n.$broadcast("$stateChangeSuccess");c.go(a.name,r,{notify:!1}).then(function(){n.$broadcast("$stateChangeSuccess",a,r,s,o)})}))}),n.$broadcast("ct-spinner-hide")}return t.__name="SettingsCtrl",t.$inject=["$scope","$rootScope","$rootElement","$location","$dialog","$q","$log","$state","$uibModal","SettingsService","Task","config","settings"],t}),define("tasks-assignments/controllers/task-list.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function a(t,a,r,i,s,o,c,l,u,d,m,f,v,p,g,h){function y(t){function n(e){r.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&r.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&r.push(e.target_contact_id[0])}function a(e){e.case_id&&i.push(e.case_id)}var r=O.contactIds,i=O.assignmentIds;r.push(m.LOGGED_IN_CONTACT_ID),m.CONTACT_ID&&r.push(m.CONTACT_ID),e.forEach(t,function(e){n(e),a(e)})}function _(){O.filterParams.dateRange.from=O.filterParamsHolder.dateRange.from,O.filterParams.dateRange.until=O.filterParamsHolder.dateRange.until,O.filterParams.due="dateRange"}function $(e){if(!s.cache.assignment.obj[e.id]){var t={};t[e.id]={case_type_id:o("filter")(s.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},v.updateCache(t)}}function b(e){var t={},n=O.contacts.filter(function(t){return t.id===e})[0];if(n)return t[n.id]={contact_id:n.id,contact_type:n.icon_class,sort_name:n.label,display_name:n.label,email:n.description.length?n.description[0]:""},f.updateCache(t),!0}function k(e,n){t.$broadcast("ct-spinner-show","task"+e.id),p.save({id:e.id,status_id:n||"2"}).then(function(n){s.$broadcast("taskFormSuccess",n,e),t.$broadcast("ct-spinner-hide","task"+e.id),v.updateTab()})}function w(e){return o("filterByDateField")(O.list,e,"activity_date_time",O.filterParams.dateRange)}function C(t,n){return O.cacheContact(t.assignee_contact_id[0]),p.save(e.extend({},t,n)).catch(function(e){CRM.alert(e,"Error","error")})}function D(e){O.contacts=e}function S(e){e&&f.search(e,{contact_type:"Individual"}).then(function(e){O.contacts=e})}function T(e,t,n){e&&t&&n&&v.search(e,n).then(function(e){O.assignments=o("filter")(e,function(e){return+e.extra.contact_id==+t})})}function E(){O.listResolvedLoaded||(o("filterByStatus")(O.list,s.cache.taskStatusResolve,!1),p.get({target_contact_id:m.CONTACT_ID,status_id:{IN:m.status.resolve.TASK}}).then(function(e){var t=O.contactIds,n=O.assignmentIds;O.collectId(e),t&&t.length&&f.get({IN:t}).then(function(e){f.updateCache(e)}),n&&n.length&&g.extEnabled.assignments&&v.get({IN:n}).then(function(e){v.updateCache(e)}),Array.prototype.push.apply(O.list,e),O.listResolvedLoaded=!0}))}function A(e){r.open({msg:"Are you sure you want to delete this task?"}).then(function(t){t&&p.delete(e.id).then(function(t){O.list.splice(O.list.indexOf(e),1),s.$broadcast("taskDelete",e.id),v.updateTab()})})}function x(e){l.go("calendar.mwl."+e)}function j(e,t){return t.crmMessages&&t.crmMessages.length&&e.test(t.crmMessages[0].title)}function M(){t.$watch("filterParamsHolder.dateRange.from",function(e){O.datepickerOptions.until.minDate=e}),t.$watch("filterParamsHolder.dateRange.until",function(e){O.datepickerOptions.from.maxDate=e})}u.debug("Controller: TaskListController");var O=this;O.assignmentIds=[],O.assignments=[],O.contactIds=[],O.contacts=[],O.dueThisWeek=0,O.dueToday=0,O.format=h.DATE_FORMAT,O.list=d,O.listFiltered=[],O.listLimit=5,O.listOngoing=[],O.listResolved=[],O.listResolvedLoaded=!1,O.overdue=0,O.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue"},{badgeClass:"primary",calendarView:"day",value:"dueToday"},{badgeClass:"primary",calendarView:"week",value:"dueThisWeek"}],O.dpOpened={filterDates:{}},O.isCollapsed={filterAdvanced:!0,filterDates:!0,taskListResolved:!0},O.filterParams={contactId:null,ownership:l.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},O.filterParamsHolder={dateRange:{from:n().startOf("day").toDate(),until:n().add(1,"month").startOf("day").toDate()}},O.datepickerOptions={from:{maxDate:O.filterParamsHolder.dateRange.until},until:{minDate:O.filterParamsHolder.dateRange.from}},O.label={overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:"Due Tasks"},O.applySidebarFilters=_,O.cacheAssignment=$,O.cacheContact=b,O.changeStatus=k,O.collectId=y,O.deleteTask=A,O.filterByDateField=w,O.loadTasksResolved=E,O.refreshAssignments=T,O.refreshContacts=S,O.updateContacts=D,O.updateTask=C,O.viewInCalendar=x,O.watchDateFilters=M,function(){var e=O.contactIds,t=O.assignmentIds;O.collectId(d),e&&e.length&&f.get({IN:e}).then(function(e){f.updateCache(e)}),t&&t.length&&g.extEnabled.assignments&&v.get({IN:t}).then(function(e){v.updateCache(e)}),M(),s.$broadcast("ct-spinner-hide"),u.info(s.cache)}(),t.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(O.list,t.taskList)}),t.$on("taskFormSuccess",function(t,n,a){e.equals({},a)?O.list.push(n):e.extend(a,n)}),t.$on("crmFormSuccess",function(e,t){if("success"===t.status){var n=/case|activity|assignment/i;(n.test(t.title)||j(n,t)||n.test(t.crmMessages[0].text))&&(s.cache.assignment={obj:{},arr:[]},l.go(l.current,{},{reload:!0}))}})}return a.__name="TaskListController",a.$inject=["$scope","$uibModal","$dialog","$rootElement","$rootScope","$filter","$timeout","$state","$log","taskList","config","ContactService","AssignmentService","TaskService","settings","HR_settings"],a}),define("tasks-assignments/controllers/task.controller",["common/moment"],function(e,t){"use strict";function n(t,n,a){n.debug("Controller: TaskCtrl"),t.isCollapsed=!0,t.picker={opened:!1},t.task.activity_date_time=t.task.activity_date_time?e(t.task.activity_date_time).toDate():null,t.dpOpen=function(e){t.picker.opened=!0},t.$watch("task.status_id",function(e){var n=a.cache.taskStatusResolve.indexOf(e)>-1;t.task.resolved=n,t.task.completed=n}),t.$watch("task.activity_date_time",function(e){t.task.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}return n.__name="TaskCtrl",n.$inject=["$scope","$log","$rootScope"],n}),define("tasks-assignments/controllers/dashboard/nav-main.controller",[],function(){"use strict";function e(e,t,n){n.debug("Controller: NavMainCtrl"),e.isActive=function(e){return t.includes(e)}}return e.__name="NavMainCtrl",e.$inject=["$scope","$state","$log"],e}),define("tasks-assignments/controllers/dashboard/top-bar.controller",[],function(){"use strict";function e(e,t,n,a){a.debug("Controller: TopBarCtrl"),t.itemAdd={},t.itemAdd.fn=function(){n.includes("documents")?t.modalDocument():t.modalTask()},t.itemAdd.label=function(){return n.includes("documents")?"Add Document":"Add Task"}}return e.__name="TopBarCtrl",e.$inject=["$scope","$rootScope","$state","$log"],e}),define("tasks-assignments/services/contact.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,a,r,i,s,o,c,l){return l.debug("Service: ContactService"),{get:function(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null;var a=i.defer();return e={IN:t.uniq(e.IN)},n.get({json:{id:e,return:"display_name, sort_name, id, contact_id, contact_type, email"}},function(e){c.errorHandler(e,"Unable to fetch contacts",a)||a.resolve(e.values)},function(){a.reject("Unable to fetch contact")}),a.promise},search:function(t,a){if(a&&"object"!=typeof a)return null;var r=i.defer(),s={};return e.extend(s,a),s.display_name=t,s.return="display_name, contact_id, contact_type, email",n.get({action:"get",json:s},function(e){if(!c.errorHandler(e,"Unable to fetch contact list",r)){var t=[];for(var n in e.values)t.push({label:e.values[n].display_name,description:[e.values[n].email],id:e.values[n].contact_id,icon_class:e.values[n].contact_type});r.resolve(t)}},function(){r.reject("Unable to fetch contact list")}),r.promise},updateCache:function(t){var n,a,r=o.cache.contact.obj||{},i=[],c=[];e.extend(r,t);for(a in r)n=r[a],i.push(n),c.push({description:n.email?[n.email]:[],label:n.display_name,icon_class:n.contact_type,id:n.contact_id});i=s("orderBy")(i,"sort_name"),c=s("orderBy")(c,"label"),o.cache.contact={arr:i,obj:r,arrSearch:c}}}}return n.__name="ContactService",n.$inject=["Contact","$resource","config","$q","$filter","$rootScope","UtilsService","$log"],n}),define("tasks-assignments/services/document.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,a,r,i,s,o,c,l){function u(e){return t(e).map(function(e){var t=[];return t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&(t=t.concat(e.assignee_contact_id)),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0]),t}).flatten().value()}function d(e){return e.filter(function(e){return!!e.case_id}).map(function(e){return e.case_id})}return l.debug("Service: DocumentService"),{assign:function(t,r){if(!t||!e.isArray(t)||!r||"number"!=typeof+r)return null;if(!t.length)return t;var i=a.defer();return n.save({action:"copy_to_assignment"},{json:{id:t,case_id:r}||{}},function(e){s.errorHandler(e,"Unable to assign documents",i)||i.resolve(e.values)},function(){i.reject("Unable to assign documents")}),i.promise},get:function(t){var r=a.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviDocument",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id, expire_date"},t),n.get({json:t},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch documents list")}),r.promise},getOptions:function(){return a.all({documentType:this.getDocumentTypes(),documentStatus:this.getDocumentStatus()})},getDocumentStatus:function(){var e=a.defer(),r={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"status_id"}},function(n){t.each(n.values,function(e){r.arr.push({key:e.key.toString(),value:e.value}),r.obj[e.key]=e.value}),e.resolve(r)}),e.promise},getDocumentTypes:function(){var e=a.defer(),r={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(n){t.each(n.values,function(e){r.arr.push({key:e.key,value:e.value}),r.obj[e.key]=e.value}),e.resolve(r)}),e.promise},save:function(t){if(!t||"object"!=typeof t)return null;var i,o=a.defer(),c=e.extend({sequential:1,debug:r.DEBUG},t);return n.save({action:"create"},{json:c||{}},function(e){s.errorHandler(e,"Unable to save document",o)||(i=e.values,o.resolve(1===i.length?i[0]:null))},function(){o.reject("Unable to save document")}),o.promise},saveMultiple:function(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;var r=a.defer();return n.save({action:"create_multiple"},{json:{document:t}||{}},function(e){s.errorHandler(e,"Unable to save documents",r)||r.resolve(e.values)},function(){r.reject("Unable to save documents")}),r.promise},sendReminder:function(e,t){if(!e||"number"!=typeof+e)return null;var r=a.defer();return n.save({action:"sendreminder"},{json:{activity_id:e,notes:t||""}||{}},function(e){s.errorHandler(e,"Unable to send a reminder",r)||r.resolve(e)},function(){r.reject("Unable to send a reminder")}),r.promise},delete:function(e){if(!e||"number"!=typeof+e)return null;var t=a.defer();return n.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete document ID: "+e)}),t.promise},cacheContactsAndAssignments:function(e,n){var s,l,m=[],f=[];return void 0===n&&(n=["contacts","assignments"]),n=Array.isArray(n)?n:[n],t.contains(n,"contacts")&&(m=u(e),r.CONTACT_ID&&m.push(r.CONTACT_ID),s=m&&m.length?o.get({IN:m}).then(function(e){o.updateCache(e)}):a.resolve()),t.contains(n,"assignments")&&(f=d(e),l=f&&f.length&&i.extEnabled.assignments?c.get({IN:f}).then(function(e){c.updateCache(e)}):a.resolve()),a.all([s,l])}}}return n.__name="DocumentService",n.$inject=["Document","$q","config","settings","UtilsService","ContactService","AssignmentService","$log"],n}),define("tasks-assignments/services/task.service",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function a(a,r,i,s,o){return o.debug("Service: TaskService"),{assign:function(t,n){if(!t||!e.isArray(t)||!n||"number"!=typeof+n)return null;if(!t.length)return t;var i=r.defer();return a.save({action:"copy_to_assignment"},{json:{id:t,case_id:n}||{}},function(e){s.errorHandler(e,"Unable to assign tasks",i)||i.resolve(e.values)},function(){i.reject("Unable to assign tasks")}),i.promise},get:function(t){var n=r.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviTask",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id"},t),a.get({json:t},function(e){n.resolve(e.values)},function(){n.reject("Unable to fetch tasks list")}),n.promise},getOptions:function(){return r.all({taskType:this.getActivityTypes(),taskStatus:this.getTaskStatus()})},getTaskStatus:function(){var e=r.defer(),n={arr:[],obj:{}};return a.get({action:"getoptions",json:{field:"status_id"}},function(a){t.each(a.values,function(e){n.arr.push({key:e.key,value:e.value}),n.obj[e.key]=e.value}),e.resolve(n)}),e.promise},getActivityTypes:function(){var e=r.defer(),n={arr:[],obj:{}};return a.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(a){t.each(a.values,function(e){n.arr.push({key:e.key,value:e.value}),n.obj[e.key]=e.value}),e.resolve(n)}),e.promise},save:function(t){if(!t||"object"!=typeof t)return null;t.activity_date_time instanceof Date&&(t.activity_date_time=n(t.activity_date_time.getTime()).format("YYYY-MM-DD"));var i,o=r.defer(),c=e.extend({},t);return a.save({action:"create"},{json:c||{}},function(e){s.errorHandler(e,"Unable to save task",o)||(i=e.values,o.resolve(1===i.length?i[0]:null))},function(){o.reject("Unable to save task")}),o.promise},saveMultiple:function(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;t.forEach(function(e){e.activity_date_time instanceof Date&&(e.activity_date_time=n(e.activity_date_time.getTime()).format("YYYY-MM-DD"))});var i=r.defer();return a.save({action:"create_multiple"},{json:{task:t}||{}},function(e){s.errorHandler(e,"Unable to save tasks",i)||i.resolve(e.values)},function(){i.reject("Unable to save tasks")}),i.promise},sendReminder:function(e,t){if(!e||"number"!=typeof+e)return null;var n=r.defer();return a.save({action:"sendreminder"},{json:{activity_id:e,notes:t}},function(e){s.errorHandler(e,"Unable to send a reminder",n)||n.resolve(e)},function(){n.reject("Unable to send a reminder")}),n.promise},delete:function(e){if(!e||"number"!=typeof+e)return null;var t=r.defer();return a.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete task ID: "+e)}),t.promise}}}return a.__name="TaskService",a.$inject=["Task","$q","config","UtilsService","$log"],a}),define("tasks-assignments/services/assignment.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(t,n,a,r,i,s,o,c,l,u,d,m,f,v){return f.debug("Service: AssignmentService"),{get:function(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null
;var t=s.defer();return n.get({json:{options:{limit:0},id:e,return:["case_type_id","contacts","client_id","contact_id","id","is_deleted","start_date","status_id","subject"],debug:o.DEBUG}},function(e){c.errorHandler(e,"Unable to fetch assignments",t)||t.resolve(e.values)},function(){t.reject("Unable to fetch assignments")}),t.promise},assignCoordinator:function(e,n){if(!e||"number"!=typeof+e||!n||"number"!=typeof+n)return null;var a=s.defer();return t.save({action:"create",json:{sequential:1,contact_id_a:e,contact_id_b:o.LOGGED_IN_CONTACT_ID,relationship_type_id:9,case_id:n}},null,function(e){c.errorHandler(e,"Unable to assign coordinator",a)||a.resolve(e.values)},function(){a.reject("Unable to assign coordinator")}),a.promise},getTypes:function(){var e=s.defer();return r.get({},function(t){c.errorHandler(t,"Unable to fetch assignment types",e)||e.resolve(t.values)},function(){e.reject("Unable to fetch assignment types")}),e.promise},save:function(t){if(!t||"object"!=typeof t)return null;var a,r=s.defer(),i=e.extend({sequential:1,debug:o.DEBUG},t);return n.save({action:"create",json:i},null,function(e){c.errorHandler(e,"Unable to save an assignment",r)||(a=e.values,r.resolve(1===a.length?a[0]:null))},function(){r.reject("Unable to save an assignment")}),r.promise},search:function(e,t,n){return n=Array.isArray(n)?n.join(","):n,a.query({sortName:e,excludeCaseIds:t,includeContactIds:n}).$promise},updateTab:function(e){return document.getElementsByClassName("CRM_Case_Form_Search").length?void CRM.refreshParent(".CRM_Case_Form_Search"):document.getElementById("tab_case")?void CRM.tabHeader.updateCount("#tab_case",CRM.tabHeader.getCount("#tab_case")+(e||0)):void("/assignments"===u.path()&&d.reload(!0))},updateCache:function(t){var n,a,r,i=m.cache.assignment.obj||{},s=[],o=[];e.extend(i,t);for(a in i)n=i[a],r=m.cache.assignmentType.obj[n.case_type_id].title,s.push(n),o.push({label:n.contacts[0].sort_name+" - "+r+(n.end_date?" (closed)":""),label_class:+n.is_deleted||n.end_date?"strikethrough":"",id:a,extra:{case_subject:n.subject,case_type:r,contact_id:n.contacts[0].contact_id,end_date:n.end_date,sort_name:n.contacts[0].sort_name,start_date:n.start_date}});s=l("orderBy")(s,"subject"),o=l("orderBy")(o,"label"),m.cache.assignment={arr:s,obj:i,arrSearch:o}}}}return n.__name="AssignmentService",n.$inject=["Relationship","Assignment","AssignmentSearch","AssignmentType","ContactService","$q","config","UtilsService","$filter","$location","$state","$rootScope","$log","$timeout"],n}),define("tasks-assignments/controllers/modal/modal-assignment-activity.controller",["common/lodash","common/angular","common/moment","tasks-assignments/services/contact.service","tasks-assignments/services/document.service","tasks-assignments/services/task.service","tasks-assignments/services/assignment.service"],function(e,t,n){"use strict";function a(e,t){t.debug("Controller: ModalAssignmentTaskCtrl"),e.isDisabled=!e.activity.activity_type_id&&!e.activity.isAdded,e.activity.create=!e.isDisabled,e.$watch("$parent.assignment.dueDate",function(t){e.activity.create&&(e.activity.activity_date_time=t?n(t).add(e.activity.offset,"days").toDate():null)}),e.$watch("$parent.assignment.contact_id",function(t){t&&e.activity.create&&(e.activity.target_contact_id=[t])})}return a.__name="ModalAssignmentActivityCtrl",a.$inject=["$scope","$log"],a}),define("tasks-assignments/controllers/modal/modal-assignment.controller",["common/lodash","common/angular","common/moment"],function(e,t,n){"use strict";function a(n,a,r,i,s,o,c,l,u,d,m,f,v,p,g){function h(t){return e.find(t,function(e){return e.create})}function y(t){var r=[];if(!t.contact_id&&r.push("Target Contact"),!t.case_type_id&&r.push("Assignment type"),!t.dueDate&&r.push("Key date"),a.taskList.filter(function(e){return e.create}).forEach(function(t){e.includes(r,"Activity type")||!t.activity_type_id&&r.push("Activity type"),e.includes(r,"Activity Due Date")||!t.activity_date_time&&r.push("Activity Due Date")}),r.length){var i=CRM.alert(r.join(", "),1===r.length?"Required field":"Required fields","error");return n(function(){i.close(),i=null},5e3),!1}return!0}o.debug("Controller: ModalAssignmentCtrl");var _={activity_type_id:null,assignee_contact_id:[],case_id:null,create:!0,isAdded:!1,name:null,source_contact_id:v.LOGGED_IN_CONTACT_ID,status_id:"1",offset:0};a.format=g.DATE_FORMAT.toLowerCase(),a.copyMessage="Click here to copy the value in row one to all rows.",a.alert={show:!1,msg:"",type:"danger"},a.assignment={},a.assignment.status_id="1",a.assignment.contact_id=v.CONTACT_ID,a.assignment.client_id=a.assignment.contact_id,a.assignment.subject="",a.assignment.dueDate=null,a.dpOpened={},a.showCId=!v.CONTACT_ID,a.activity={activitySet:{}},a.taskList=[],a.documentList=[],a.contacts={target:[],document:[],task:[]},a.updateTimeline=function(e){a.activity.activitySet=e},a.addActivity=function(e){e&&e.push(t.extend(t.copy(_),{isAdded:!0}))},a.removeActivity=function(e,t){e&&e.splice(t,1)},a.dpOpen=function(e,t){e.preventDefault(),e.stopPropagation(),a.dpOpened[t]=!0},a.refreshContacts=function(e,t,n){e&&m.search(e,{contact_type:"Individual"}).then(function(e){"target"===t?a.contacts[t]=e:a.contacts[t][n]=e})},a.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},m.updateCache(t)},a.setData=function(){var e=i.cache.assignmentType.obj[a.assignment.case_type_id];if(!e)return a.activity.activitySet={},void(a.assignment.subject="");a.activity.activitySet=e.definition.activitySets[0],a.assignment.subject=i.cache.assignmentType.obj[a.assignment.case_type_id].title,a.assignment.dueDate=a.assignment.dueDate||new Date((new Date).setHours(0,0,0,0))},a.cancel=function(){r.dismiss("cancel")},a.confirm=function(){if(!c("filter")(a.taskList,{create:!0}).length&&!c("filter")(a.documentList,{create:!0}).length)return a.alert.msg="Please add at least one task.",void(a.alert.show=!0);y(a.assignment)&&(a.$broadcast("ct-spinner-show"),a.assignment.start_date=new Date,l.save(a.assignment).then(function(e){var n=a.documentList.filter(function(e){return e.create}).map(function(t){return t.case_id=e.id,t}),o=a.taskList.filter(function(e){return e.create}).map(function(t){return t.case_id=e.id,t});s.all({relationship:l.assignCoordinator(a.assignment.contact_id,e.id),document:d.saveMultiple(n.map(function(e){return t.copy(e)})),task:u.saveMultiple(o.map(function(e){return t.copy(e)}))}).then(function(s){var c,u=[],d=[],m={};for(c=0;c<s.task.length;c++)o[c].id=s.task[c].id,u.push(s.task[c].id);for(c=0;c<s.document.length;c++)n[c].id=s.document[c].id,d.push(s.document[c].id);m[e.id]=t.extend(t.copy(a.assignment),{id:e.id,client_id:{1:a.assignment.client_id},contact_id:{1:a.assignment.contact_id},contacts:[{sort_name:i.cache.contact.obj[a.assignment.contact_id].sort_name,contact_id:a.assignment.contact_id,role:"Client"},{sort_name:i.cache.contact.obj[v.LOGGED_IN_CONTACT_ID].sort_name,contact_id:v.LOGGED_IN_CONTACT_ID,role:"Case Coordinator"}],is_deleted:"0",end_date:"",activities:u.concat(d)}),l.updateCache(m),l.updateTab(1),r.close({documentList:n,taskList:o}),a.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),a.$broadcast("ct-spinner-hide"),s.reject()})},function(e){return CRM.alert(e,"Error","error"),a.$broadcast("ct-spinner-hide"),s.reject()}))},a.copyAssignee=function(t,n){var r=h(t);t.forEach(function(i,s){var o=a.contacts[n][e.indexOf(t,r)]||[],c=r.assignee_contact_id?[r.assignee_contact_id[0]]:r.assignee_contact_id;i.create&&(a.contacts[n][s]=o.slice(),i.assignee_contact_id=c)})},a.copyDate=function(e){e.forEach(function(t){t.create&&(t.activity_date_time=h(e).activity_date_time)})},a.$watch("activity.activitySet",function(e){if(!e||!e.activityTypes)return void(a.taskList=[]);for(var n,r,s,o=e.activityTypes,l=o.length,u=[],d=[],m=0;m<l;m++)n=t.copy(_),n.name=o[m].name,n.offset=o[m].reference_offset,r=n.name?c("filter")(i.cache.documentType.arr,{value:n.name},!0)[0]:"",r?(n.activity_type_id=r.key,u.push(n)):(s=n.name?c("filter")(i.cache.taskType.arr,{value:n.name},!0)[0]:"",n.activity_type_id=s?s.key:null,d.push(n));t.copy(d,a.taskList),+p.tabEnabled.documents&&t.copy(u,a.documentList)})}return a.__name="ModalAssignmentCtrl",a.$inject=["$timeout","$scope","$uibModalInstance","$rootScope","$q","$log","$filter","AssignmentService","TaskService","DocumentService","ContactService","data","config","settings","HR_settings"],a}),define("tasks-assignments/controllers/modal/modal-dialog.controller",[],function(){"use strict";function e(e,t,n,a,r){r.debug("Controller: ModalDialogCtrl"),e.title=a.title||"CiviHR Tasks & Assignments",e.msg=a.msg||"",e.copyConfirm=a.copyConfirm||"Yes",e.copyCancel=a.copyCancel||"Cancel",e.confirm=function(e){t.close(e||!0)},e.cancel=function(){t.close(!1)}}return e.__name="ModalDialogCtrl",e.$inject=["$scope","$uibModalInstance","$timeout","content","$log"],e}),define("tasks-assignments/controllers/modal/modal-document.controller",["common/angular","common/lodash","common/moment","common/services/file.service","common/services/notification.service"],function(e,t,n){"use strict";function a(a,r,i,s,o,c,l,u,d,m,f,v,p,g,h,y,_,$,b,k,w,C,D,S){function T(e){-1===re.document.assignee_contact_id.indexOf(e.id)&&re.document.assignee_contact_id.push(e.id),re.cacheContact(e)}function E(e,t,n){return e+=(e.split("?")[1]?"&":"?")+t+"="+n}function A(e){var t={};e&&!s.cache.assignment.obj[e.id]&&(t[e.id]={case_type_id:d("filter")(s.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},p.updateCache(t))}function x(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},h.updateCache(t)}function j(){if(re.documentForm.$pristine&&e.equals(b,re.files)&&!re.uploader.queue.length)return void i.dismiss("cancel");f.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(r.$broadcast("ct-spinner-hide"),i.dismiss("cancel"))})}function M(){re.contacts={target:V("target"),assignee:V("assignee")}}function O(){re.assignments=d("filter")(s.cache.assignment.arrSearch,function(e){return+e.extra.contact_id==+re.document.target_contact_id})}function I(){var t=e.copy(re.document);if(te(t)){if(e.equals(_,t)&&e.equals(b,re.files)&&!re.uploader.queue.length)return void i.dismiss("cancel");var n,a=[];if(re.isRole("staff")&&!re.uploader.queue.length&&!re.files.length)return void(re.containsFiles=!1);if(ee(re.uploader.queue)){if(r.$broadcast("ct-spinner-show"),+t.case_id==+_.case_id&&delete t.case_id,t.activity_date_time=re.parseDate(t.activity_date_time)||"",t.expire_date=re.parseDate(t.expire_date),t.status_id=re.getDocumentStatus()||re.document.status_id,re.filesTrash.length)for(var l=0;l<re.filesTrash.length;l++)n=re.filesTrash[l],a.push(y.delete(n.fileID,n.entityID,n.entityTable));c.all({document:g.save(t),files:a.length?c.all(a):[]}).then(function(e){if(re.uploader.queue.length){var t=m.open({appendTo:o.find("div").eq(0),templateUrl:k.path.TPL+"/modal/progress.html?v=1",size:"sm",controller:"ModalProgressCtrl",resolve:{uploader:function(){return re.uploader},entityId:function(){return e.document.id}}});return e.files=t.result,c.all(e)}return e}).then(function(e){re.document.case_id=e.document.case_id,re.document.file_count=re.files.length+re.uploader.queue.length,re.document.id=e.document.id,re.document.status_id=e.document.status_id,p.updateTab(),i.close(re.document),s.$broadcast("document-saved"),r.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),i.dismiss(),r.$broadcast("ta-spinner-hide"),c.reject()})}}}function R(e,t){e.preventDefault(),e.stopPropagation(),re.dpOpened[t]=!0}function L(){v(function(){document.getElementById(s.prefix+"document-files").click()})}function P(e){re.filesTrash.push(re.files[e]),re.files.splice(e,1)}function N(){re.document.activity_date_time=re.document.activity_date_time?n(re.document.activity_date_time).toDate():null,re.document.expire_date=re.document.expire_date?n(re.document.expire_date).toDate():null,re.document.assignee_contact_id=re.document.assignee_contact_id||[],re.document.source_contact_id=re.document.source_contact_id||k.LOGGED_IN_CONTACT_ID,re.document.status_id=re.document.status_id||"1",re.document.target_contact_id=re.document.target_contact_id||[k.CONTACT_ID],re.document.valid_from=re.document.valid_from?n(re.document.valid_from).toDate():null}function F(){$.get(["maxFileSize"]).then(function(e){re.fileSizeLimit=1e6*+e[0].maxFileSize})}function q(){return re.isRole("admin")?re.files.length||re.uploader.queue.length?re.getStatusIdByName("approved"):re.getStatusIdByName("awaiting upload"):re.files.length||re.uploader.queue.length?re.getStatusIdByName("awaiting approval"):re.getStatusIdByName("awaiting upload")}function U(e){return t.findKey(s.cache.documentStatus.obj,function(t){return t===e})}function H(e){var n=t.find(s.cache.documentType.arr,function(t){return t.key===e});return n&&n.value}function V(e){var t=s.cache.contact.arrSearch;return re.document.id||"edit"!==C?t.filter(function(t){return+re.document[e+"_contact_id"][0]==+t.id}):[]}function B(e){return re.role===e}function Y(e){s.$broadcast("ct-spinner-show"),re.document.case_id="",re.cacheContact(e),re.searchContactAssignments(e.id)}function G(e){e instanceof Date&&(e=e.getTime());var t=n(e,[w.DATE_FORMAT.toUpperCase(),"x","YYYY-MM-DD"]);return t.isValid()?t.format("YYYY-MM-DD"):null}function W(e){re.document.assignee_contact_id.splice(e,1)}function z(e){if(e){var t=re.document.target_contact_id;p.search(e,re.document.case_id).then(function(e){re.assignments=d("filter")(e,function(e){return+e.extra.contact_id==+t})})}}function K(e,t){e&&h.search(e,{contact_type:"Individual"}).then(function(e){re.contacts[t]=e})}function X(){CRM.help("Remind me?",re.remindMeMessage,"error")}function J(e){return p.search(null,null,e).then(function(e){re.assignments=e,s.$broadcast("ct-spinner-hide")})}function Q(){re.document.status_id=1}function Z(){return!!re.document.status_id}function ee(e){var n="Files larger than "+re.fileSizeLimit/1e6+"MB are not allowed.",a=!0;return e.length&&t.each(e,function(e){+e._file.size>=re.fileSizeLimit&&(a=!1)}),!a&&D.alert("Large files",n,{expires:5e3}),a}function te(e){var t=[];if(e.target_contact_id[0]||t.push("Contact"),e.activity_type_id||t.push("Document type"),e.status_id||t.push("Document status"),e.status_id||t.push("Status"),t.length){var n=1===t.length?"Required field":"Required fields",a=t.join(", ");return D.alert(n,a,{expires:5e3}),!1}return!0}function ne(e){s.$broadcast("ct-spinner-show"),S.openFile(e).then(function(e){s.$broadcast("ct-spinner-hide")})}function ae(){s.$watch("cache.contact.arrSearch",M)}l.debug("Controller: ModalDocumentController");var re=this;re.document={},re.files=[],re.fileSizeLimit=0,re.filesTrash=[],re.mode=C,re.modalTitle="edit"===re.mode?"Edit Document":"New Document",re.containsFiles=!0,re.remindMeMessage='Checking this box sets a reminder that this document needs to be renewed a set number of days before the Expiry Date. You can set this by going <a target="_blank" href="/civicrm/tasksassignments/settings">here</a> CiviHR will do this by creating a copy of this document with the status awaiting upload, which you will be able to see in your Documents list.',re.role=u||"admin",re.showCId=!k.CONTACT_ID,re.uploader=y.uploader("civicrm_activity"),re.dpOpened={due:!1,exp:!1,form:!1},re.addAssignee=T,re.addQueryParam=E,re.cacheAssignment=A,re.cacheContact=x,re.cancel=j,re.confirm=I,re.dpOpen=R,re.dropzoneClick=L,re.fileMoveToTrash=P,re.getDocumentType=H,re.getDocumentStatus=q,re.getStatusIdByName=U,re.isRole=B,re.onContactChanged=Y,re.parseDate=G,re.removeAssignee=W,re.refreshAssignments=z,re.refreshContacts=K,re.remindMeInfo=X,re.statusFieldVisible=Z,re.showStatusField=Q,re.searchContactAssignments=J,re.viewFile=ne,function(){e.copy(_,re.document),e.copy(b,re.files),O(),N(),M(),ae(),F()}()}return a.__name="ModalDocumentController",a.$inject=["$window","$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","role","$filter","$uibModal","$dialog","$timeout","AssignmentService","DocumentService","ContactService","FileService","data","AppSettingsService","files","config","HR_settings","modalMode","notificationService","fileService"],a}),define("tasks-assignments/controllers/modal/modal-progress.controller",[],function(){"use strict";function e(e,t,n,a,r,i,s,o){o.debug("Controller: ModalProgressCtrl"),e.uploader=r,r.queue.length&&(r.item=r.queue[0].file.name),r.onProgressItem=function(e){this.item=e.file.name},s.upload(r,i).then(function(e){a(function(){t.close(e)},500)}),e.cancel=function(){t.dismiss("File upload canceled")}}return e.__name="ModalProgressCtrl",e.$inject=["$scope","$uibModalInstance","$q","$timeout","uploader","entityId","FileService","$log"],e}),define("tasks-assignments/controllers/modal/modal-reminder.controller",["common/angular"],function(e){"use strict";function t(t,n,a,r,i,s,o,c,l,u,d,m){s.debug("Controller: ModalReminderCtrl"),t.data={},t.type=d,e.copy(u,t.data),t.reminder={},t.data.assignee_contact_id=t.data.assignee_contact_id||[],t.data.target_contact_id=t.data.target_contact_id||[m.CONTACT_ID],t.contacts=r.cache.contact.arrSearch,t.showCId=!m.CONTACT_ID,t.cancel=function(){n.dismiss("cancel")},t.confirm=function(){t.$broadcast("ct-spinner-show"),("task"===d?c:l).sendReminder(t.data.id,t.reminder.notes).then(function(){CRM.alert("Message sent to: "+r.cache.contact.obj[t.data.assignee_contact_id[0]].sort_name,"Reminder sent","success"),n.close(),t.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),n.dismiss(),t.$broadcast("ta-spinner-hide"),i.reject()})}}return t.__name="ModalReminderCtrl",t.$inject=["$scope","$uibModalInstance","$dialog","$rootScope","$q","$log","$filter","TaskService","DocumentService","data","type","config"],t}),define("tasks-assignments/controllers/modal/modal-task-migrate.controller",["common/angular"],function(e){"use strict";function t(t,n,a,r,i,s,o,c,l,u,d,m,f,v,p,g,h){s.debug("Controller: ModalTaskMigrateCtrl"),t.migrate={},t.migrate.dataLoaded=!1,t.migrate.from="",t.migrate.to="",t.migrate.task={list:[],statusList:[],statusListSelected:[]},t.migrate.document={list:[],statusList:[],statusListSelected:[]},t.contacts=a.cache.contact.arrSearch,t.getActivities=function(n){t.$broadcast("ct-spinner-show"),n=n||t.migrate.from,t.migrate.task.statusList=[],t.migrate.task.statusListSelected=[],t.migrate.document.statusList=[],t.migrate.document.statusListSelected=[],t.migrate.dataLoaded=!1;var r=[];f.get({entity:"ActivityContact",json:{component:"",sequential:"1",return:"activity_id",contact_id:n,record_type_id:"1",options:{limit:"0"}}},function(n){n.values&&n.values.length?(e.forEach(n.values,function(e){this.push(e.activity_id)},r),f.get({entity:"Activity",json:{component:"",options:{limit:0},id:{IN:r},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"assignee_contact_id, activity_type_id, assignee_contact_id, id, status_id"}},function(n){function r(e,n){var a=t.migrate[e];a.list.push(n),a.statusList.indexOf(n.status_id)>-1||(s[e].indexOf(n.status_id)>-1?a.statusList.push(n.status_id):(a.statusList.unshift(n.status_id),a.statusListSelected.push(n.status_id)))}var i=a.cache.documentType.obj,s={task:a.cache.taskStatusResolve,document:a.cache.documentStatusResolve};n.values&&n.values.length&&(n.values=o("orderBy")(n.values,"-status_id"),e.forEach(n.values,function(e){i[e.activity_type_id]?r("document",e):r("task",e)})),t.migrate.dataLoaded=!0,t.$broadcast("ct-spinner-hide")})):(t.migrate.dataLoaded=!0,t.$broadcast("ct-spinner-hide"))})},t.refreshContacts=function(e){e&&p.search(e,{contact_type:"Individual"}).then(function(e){t.contacts=e})},t.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},p.updateCache(t)},t.cancel=function(){if(t.taskMigrateForm.$pristine)return void n.dismiss("cancel");l.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(t.$broadcast("ct-spinner-hide"),n.dismiss("cancel"))})},t.confirm=function(){if(t.migrate.task.statusListSelected||t.migrate.document.statusListSelected){var r,s=[],o=[],c=0;e.forEach(t.migrate.task.list,function(e){t.migrate.task.statusListSelected.indexOf(e.status_id)>-1&&this.push(e)},s),+h.tabEnabled.documents&&e.forEach(t.migrate.document.list,function(e){t.migrate.document.statusListSelected.indexOf(e.status_id)>-1&&this.push(e)},s),t.$broadcast("ct-spinner-show"),e.forEach(s,function(n){n.assignee_contact_id[0]=t.migrate.to,this.push(function(){var t=i.defer();return r=c?this[c-1]:{},i.when(r).then(function(){f.save({entity:"Activity",action:"create",json:e.extend({sequential:"1",component:""},n)},null,function(e){g.errorHandler(e,"Unable to save task",t)||t.resolve(1===e.values.length?e.values[0]:null)},function(){t.reject("Unable to save task")})}),t.promise}.bind(this)()),c++},o),i.all(o).then(function(e){e.length?CRM.alert(e.length+" item(s) re-assigned from: "+a.cache.contact.obj[t.migrate.from].sort_name+" to: "+a.cache.contact.obj[t.migrate.to].sort_name,"Migrate Tasks","success"):CRM.alert("0 items re-assigned.","Migrate Tasks","warning"),n.dismiss(),t.$broadcast("ct-spinner-hide")},function(e){CRM.alert(e,"Error","error"),n.dismiss(),t.$broadcast("ct-spinner-hide")})}}}return t.__name="ModalTaskMigrateCtrl",t.$inject=["$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","$filter","$uibModal","$dialog","$timeout","AssignmentService","TaskService","Task","activityType","ContactService","UtilsService","settings"],t}),define("tasks-assignments/controllers/modal/modal-task.controller",["common/angular","common/moment"],function(e,t){"use strict";function n(n,a,r,i,s,o,c,l,u,d,m,f,v,p,g,h){function y(e){a.assignments=[],e[0]&&(n(function(){a.$broadcast("ct-spinner-show")},0),m.search(null,null,e).then(function(e){a.assignments=e,a.$broadcast("ct-spinner-hide")}))}function _(e){var t=[];if(e.target_contact_id[0]||t.push("Task Target"),e.activity_type_id||t.push("Task type"),e.activity_date_time||t.push("Due date"),t.length){var a=CRM.alert(t.join(", "),1===t.length?"Required field":"Required fields","error");return n(function(){a.close(),a=null},5e3),!1}return!0}function $(e){var t=i.cache.contact.arrSearch;return a.task.id?t.filter(function(t){return+a.task[e+"_contact_id"][0]==+t.id}):[]}function b(){a.$watch("task.target_contact_id",function(e,t){e!==t&&(a.task.case_id=null,a.showFieldAssignment=!1,y(e))},!0)}c.debug("Controller: ModalTaskCtrl"),a.format=h.DATE_FORMAT.toLowerCase(),a.data=p,a.task={},e.copy(p,a.task),a.task.activity_date_time=a.task.activity_date_time||t().toDate(),a.task.assignee_contact_id=a.task.assignee_contact_id||[],a.task.source_contact_id=a.task.source_contact_id||g.LOGGED_IN_CONTACT_ID,a.task.target_contact_id=a.task.target_contact_id||[g.CONTACT_ID],a.showCId=!g.CONTACT_ID,a.showFieldAssignment=!1,a.assignments=[],a.contacts={target:$("target"),assignee:$("assignee")},a.cacheAssignment=function(e){if(!i.cache.assignment.obj[e.id]){var t={};t[e.id]={case_type_id:l("filter")(i.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},m.updateCache(t)}},a.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},v.updateCache(t)},a.refreshContacts=function(e,t){e&&v.search(e,{contact_type:"Individual"}).then(function(e){a.contacts[t]=e})},a.dpOpen=function(e){e.preventDefault(),e.stopPropagation(),a.dpOpened=!0},a.cancel=function(){if(a.taskForm.$pristine)return void r.dismiss("cancel");d.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(a.$broadcast("ct-spinner-hide"),r.dismiss("cancel"))})},a.confirm=function(){var t=e.copy(a.task);if(_(t)){if(e.equals(p,t))return void r.dismiss("cancel");a.$broadcast("ct-spinner-show"),+t.case_id==+p.case_id&&delete t.case_id,t.activity_date_time=t.activity_date_time||new Date,f.save(t).then(function(e){a.task.id=e.id,a.task.case_id=e.case_id,m.updateTab(),a.openNew&&(a.task.open=!0,a.openNew=!1),r.close(a.task),a.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),a.$broadcast("ct-spinner-hide"),o.reject()})}},function(){b(),a.task.id&&y(a.task.target_contact_id)}()}return n.__name="ModalTaskCtrl",n.$inject=["$timeout","$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","$filter","$uibModal","$dialog","AssignmentService","TaskService","ContactService","data","config","HR_settings"],n}),define("tasks-assignments/modules/controllers",["common/angular","tasks-assignments/controllers/assignments.controller","tasks-assignments/controllers/calendar.controller","tasks-assignments/controllers/date-list.controller","tasks-assignments/controllers/document-list.controller","tasks-assignments/controllers/document.controller","tasks-assignments/controllers/external-page.controller","tasks-assignments/controllers/main.controller","tasks-assignments/controllers/settings.controller","tasks-assignments/controllers/task-list.controller","tasks-assignments/controllers/task.controller","tasks-assignments/controllers/dashboard/nav-main.controller","tasks-assignments/controllers/dashboard/top-bar.controller","tasks-assignments/controllers/modal/modal-assignment-activity.controller","tasks-assignments/controllers/modal/modal-assignment.controller","tasks-assignments/controllers/modal/modal-dialog.controller","tasks-assignments/controllers/modal/modal-document.controller","tasks-assignments/controllers/modal/modal-progress.controller","tasks-assignments/controllers/modal/modal-reminder.controller","tasks-assignments/controllers/modal/modal-task-migrate.controller","tasks-assignments/controllers/modal/modal-task.controller"],function(e,t,n,a,r,i,s,o,c,l,u,d,m,f,v,p,g,h,y,_,$){"use strict";return e.module("civitasks.controllers",[]).controller(t.__name,t).controller(n.__name,n).controller(a.__name,a).controller(r.__name,r).controller(i.__name,i).controller(s.__name,s).controller(o.__name,o).controller(c.__name,c).controller(l.__name,l).controller(u.__name,u).controller(d.__name,d).controller(m.__name,m).controller(f.__name,f).controller(v.__name,v).controller(p.__name,p).controller(g.__name,g).controller(h.__name,h).controller(y.__name,y).controller(_.__name,_).controller($.__name,$)}),define("tasks-assignments/directives/civi-events.directive",[],function(){"use strict";function e(e,t){return t.debug("Directive: ctCiviEvents"),{link:function(e){CRM.$(document).on("crmFormSuccess",function(n,a){t.debug("crmFormSuccess"),t.debug(a),e.$broadcast("crmFormSuccess",a)}),CRM.$(document).on("crmFormSubmit",function(n,a){t.debug("crmFormSubmit"),t.debug(a),e.$broadcast("crmFormSubmit",a)}),CRM.$(document).on("crmFormCancel",function(n,a){t.debug("crmFormCancel"),t.debug(a),e.$broadcast("crmFormCancel",a)})}}}return e.__name="ctCiviEvents",e.$inject=["$rootScope","$log"],e}),define("tasks-assignments/directives/iframe.directive",[],function(){"use strict";function e(e,t){return t.debug("Directive: taIframe"),{link:function(t,n,a){var r=n[0];r.addEventListener("load",function(){var t,i=window.frames[a.name].document,s=["branding","toolbar","civicrm-menu","civicrm-footer","access"],o=0,c=s.length;for(o;o<c;o++)(t=i.getElementById(s[o]))&&(t.style.display="none");i.body.style.paddingTop="10px",r.height=i.body.scrollHeight+"px",n.addClass("ct-iframe-ready"),e.$broadcast("iframe-ready")})}}}return e.__name="taIframe",e.$inject=["$rootScope","$log"],e}),define("tasks-assignments/directives/sidebar-filters.directive",[],function(){"use strict";function e(e,t){return e.debug("Directive: sidebarFilters"),{restrict:"E",scope:!0,transclude:!0,templateUrl:t.path.TPL+"directives/sidebar-filters.html"}}return e.__name="sidebarFilters",e.$inject=["$log","config"],e}),define("tasks-assignments/directives/spinner.directive",[],function(){"use strict";function e(e,t){return t.debug("Directive: ctSpinner"),{link:function(t,n,a){function r(){var e=window.getComputedStyle(n[0]).position;return"relative"===e||"absolute"===e||"fixed"===e}function i(){r()||(n.css("position","relative"),l=!0),n.append(c),u=!0}function s(){u&&c.parentNode.removeChild(c),u=!1,l&&n.css("position","")}var o,c=document.createElement("div"),l=!1,u=!1;c.className="ct-spinner-cover ct-spinner-img",void 0!==a.ctSpinnerShow&&i(),void 0!==a.ctSpinnerMainView&&(c.className="ct-spinner-cover",o=document.createElement("div"),o.className="ct-spinner ct-spinner-img",e.$on("$stateChangeStart",function(){i(),document.body.appendChild(o)}),e.$on("$stateChangeSuccess",function(){s(),o.parentNode.removeChild(o)}),e.$on("$stateChangeError",function(){s(),o.parentNode.removeChild(o)})),t.$on("ct-spinner-show",function(e,t){(!t||a.ctSpinnerId&&a.ctSpinnerId===t)&&i()}),t.$on("ct-spinner-hide",function(e,t){(!t||a.ctSpinnerId&&a.ctSpinnerId===t)&&s()})}}}return e.__name="ctSpinner",e.$inject=["$rootScope","$log"],e}),define("tasks-assignments/directives/validate.directive",["common/angular"],function(e){"use strict";function t(t){return t.debug("Directive: taValidate"),{restrict:"A",require:"^form",scope:{isWarning:"=?taValidateWarning"},link:function(t,n,a,r){function i(e,t){n.toggleClass("has-success",!e&&!t),m.toggleClass("glyphicon-ok",!e&&!t)}function s(e,t){n.toggleClass("has-warning",!e&&t),m.toggleClass("glyphicon-warning-sign",!e&&t)}function o(e){n.toggleClass("has-error",e),m.toggleClass("glyphicon-remove",e)}var c=n[0].querySelector("[name]"),l=e.element(c),u=l.attr("name"),d=document.createElement("span"),m=e.element(d);u&&(n.addClass("has-feedback"),m.addClass("glyphicon form-control-feedback"),l.after(m),t.$watch(function(){return r[u]&&r[u].$invalid},function(e){r[u].$dirty&&(i(e,t.isWarning),o(e))}),void 0!==t.isWarning&&t.$watch("isWarning",function(e){var t=r[u].$invalid;r[u].$dirty&&(i(t,e),s(t,e))}),l.bind("blur",function(){o(r[u].$invalid)}))}}}return t.__name="taValidate",t.$inject=["$log"],t}),define("tasks-assignments/modules/directives",["common/angular","tasks-assignments/directives/civi-events.directive","tasks-assignments/directives/iframe.directive","tasks-assignments/directives/sidebar-filters.directive","tasks-assignments/directives/spinner.directive","tasks-assignments/directives/validate.directive"],function(e,t,n,a,r,i){"use strict";return e.module("civitasks.directives",[]).directive(t.__name,t).directive(n.__name,n).directive(a.__name,a).directive(r.__name,r).directive(i.__name,i)}),define("tasks-assignments/filters/assignment-type.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByAssignmentType"),function(e,n){var a,r=t.cache.assignment.obj,i=n.length,s=[],o=0,c=e.length;if(!c||!i)return e;for(o;o<c;o++)(a=r[e[o].case_id])&&-1!==n.indexOf(a.case_type_id)&&s.push(e[o]);return s}}return e.__name="filterByAssignmentType",e.$inject=["$filter","$rootScope","$log"],e}),define("tasks-assignments/filters/contact-id.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByContactId"),function(e,t){var n=[],a=0,r=e.length;if(!r||!t||"number"!=typeof+t)return e
;for(a;a<r;a++)+e[a].assignee_contact_id[0]!=+t&&+e[a].source_contact_id!=+t&&+e[a].target_contact_id!=+t||n.push(e[a]);return n}}return e.__name="filterByContactId",e.$inject=["$filter","config","$log"],e}),define("tasks-assignments/filters/date-field.filter",[],function(){"use strict";function e(e,t){function n(e,t,n){return null!==e&&e>=t&&(e<=n||null===n)||null===e&&null===n}return t.debug("Filter: filterByDateField"),function(e,t,a,r){if(!e)return null;var i=new Date,s=[],o=0,c=e.length,l=i.setHours(0,0,0,0);if(!a)throw new Error("Field name to filter a list is required");if(!c||!t)return e;switch(t){case"overdue":var u;for(o;o<c;o++)u=null,e[o][a]&&(u=new Date(e[o][a]).setHours(0,0,0,0)),u<l&&null!==u&&s.push(e[o]);break;case"dateRange":if(!r||"object"!=typeof r)return e;var d,m=r.from?new Date(r.from).setHours(0,0,0,0):null,f=r.until?new Date(r.until).setHours(0,0,0,0):null;for(o;o<c;o++)d=e[o][a]?new Date(e[o][a]).setHours(0,0,0,0):null,n(d,m,f)&&s.push(e[o]);break;case"dueToday":for(o;o<c;o++)new Date(e[o][a]).setHours(0,0,0,0)===l&&s.push(e[o]);break;case"dueThisWeek":var v=new Date,p=v.getDay(),g=v.getDate()-p+(0===p?-6:1),h=new Date(v.setDate(g)),y=new Date(v.setDate(h.getDate()+7));for(o;o<c;o++)(d=new Date(e[o][a]).setHours(0,0,0,0))>l&&d>=h.setHours(0,0,0,0)&&d<y.setHours(0,0,0,0)&&s.push(e[o]);break;case"dueInNextFortnight":var _=i.setDate(i.getDate()+14);for(o;o<c;o++)new Date(e[o][a]).setHours(0,0,0,0)>=l&&new Date(e[o][a]).setHours(0,0,0,0)<=_&&s.push(e[o]);break;case"dueInNinetyDays":var $=i.setDate(i.getDate()+90);for(o;o<c;o++)new Date(e[o][a]).setHours(0,0,0,0)>=l&&new Date(e[o][a]).setHours(0,0,0,0)<=$&&s.push(e[o])}return s}}return e.__name="filterByDateField",e.$inject=["$filter","$log"],e}),define("tasks-assignments/filters/date-parse.filter",["common/moment"],function(e){"use strict";function t(t,n){return n.debug("Filter: dateParse"),function(t){return e(t).toDate()}}return t.__name="dateParse",t.$inject=["$filter","$log"],t}),define("tasks-assignments/filters/date-type.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterBy.dateType"),function(e,t){var n,a,r,i=[],s=0,o=e.length,c=t.length;if(!o||!c)return e;for(s;s<o;s++)for(n=0,a=e[s].dateContactList,r=a.length,n;n<r;n++)if(-1!==t.indexOf(a[n].type)){i.push(e[s]);break}return i}}return e.__name="filterByDateType",e.$inject=["$filter","$rootScope","$log"],e}),define("tasks-assignments/filters/date.filter",["common/moment"],function(e){"use strict";function t(t,n){return n.debug("Filter: filterBy.date"),function(t,n){if(!t||!t.length||!n)return[];var a,r,i,s=[],o=0,c=t.length;for(a=e().startOf(n),r=e().endOf(n);o<c;o++)(i=e(t[o].date))>a&&i<r&&s.push(t[o]);return s}}return t.__name="filterByDate",t.$inject=["$filter","$log"],t}),define("tasks-assignments/filters/offset.filter",[],function(){"use strict";function e(e){return e.debug("Filter: offset"),function(e,t){return t=t||0,e.slice(parseInt(t,10))}}return e.__name="offset",e.$inject=["$log"],e}),define("tasks-assignments/filters/ownership.filter",[],function(){"use strict";function e(e,t){e.debug("Filter: filterByOwnership");var n={assigned:function(e){return~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)},delegated:function(e){return e.source_contact_id===t.LOGGED_IN_CONTACT_ID&&!~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)}};return function(e,t){try{return e.filter(n[t])}catch(t){return e}}}return e.__name="filterByOwnership",e.$inject=["$log","config"],e}),define("tasks-assignments/filters/status.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByStatus"),function(e,t,n){var a=[],r=0,i=e.length,s=t.length;if(n=void 0===n||n,!i||!s)return e;for(r;r<i;r++)-1!==t.indexOf(e[r].status_id)===n&&a.push(e[r]);return a}}return e.__name="filterByStatus",e.$inject=["$filter","$rootScope","$log"],e}),define("tasks-assignments/modules/filters",["common/angular","tasks-assignments/filters/assignment-type.filter","tasks-assignments/filters/contact-id.filter","tasks-assignments/filters/date-field.filter","tasks-assignments/filters/date-parse.filter","tasks-assignments/filters/date-type.filter","tasks-assignments/filters/date.filter","tasks-assignments/filters/offset.filter","tasks-assignments/filters/ownership.filter","tasks-assignments/filters/status.filter"],function(e,t,n,a,r,i,s,o,c,l){"use strict";return e.module("civitasks.filters",[]).filter(t.__name,t).filter(n.__name,n).filter(a.__name,a).filter(r.__name,r).filter(i.__name,i).filter(s.__name,s).filter(o.__name,o).filter(c.__name,c).filter(l.__name,l)}),define("tasks-assignments/resources/app-settings.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"Setting",json:{}})}return e.__name="AppSettings",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment-search.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: AssignmentSearch"),e(t.url.ASSIGNMENTS+"/ajax/unclosed")}return e.__name="AssignmentSearch",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment-type.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: AssignmentType"),e(t.url.REST,{action:"get",entity:"CaseType",json:{is_active:1}})}return e.__name="AssignmentType",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: Assignment"),e(t.url.REST,{action:"get",entity:"Assignment",json:{}})}return e.__name="Assignment",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/contact.resource",[],function(){"use strict";function e(e,t,n,a){return a.debug("Resource: Contact"),e(n.url.REST,{action:"get",entity:"contact",debug:n.DEBUG})}return e.__name="Contact",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/resources/document.resource",[],function(){"use strict";function e(e,t,n,a){return a.debug("Resource: Document"),e(n.url.REST,{action:"get",entity:"Document",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}return e.__name="Document",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/resources/key-date.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: KeyDate"),e(t.url.REST,{action:"get",entity:"KeyDates",json:{}})}return e.__name="KeyDate",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/relationship.resource",["require","exports","module"],function(e,t,n){"use strict";function a(e,t,n){return n.debug("Resource: Relationship"),e(t.url.REST,{action:"get",entity:"Relationship",json:{}})}return a.__name="Relationship",a.$inject=["$resource","config","$log"],a}),define("tasks-assignments/resources/settings.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"TASettings",json:{}})}return e.__name="Settings",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/task.resource",[],function(){"use strict";function e(e,t,n,a){return a.debug("Service: Task"),e(n.url.REST,{action:"get",entity:"Task",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}return e.__name="Task",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/modules/resources",["common/angular","tasks-assignments/resources/app-settings.resource","tasks-assignments/resources/assignment-search.resource","tasks-assignments/resources/assignment-type.resource","tasks-assignments/resources/assignment.resource","tasks-assignments/resources/contact.resource","tasks-assignments/resources/document.resource","tasks-assignments/resources/key-date.resource","tasks-assignments/resources/relationship.resource","tasks-assignments/resources/settings.resource","tasks-assignments/resources/task.resource"],function(e,t,n,a,r,i,s,o,c,l,u){"use strict";return e.module("civitasks.resources",[]).factory(t.__name,t).factory(n.__name,n).factory(a.__name,a).factory(r.__name,r).factory(i.__name,i).factory(s.__name,s).factory(o.__name,o).factory(c.__name,c).factory(l.__name,l).factory(u.__name,u)}),define("tasks-assignments/services/app-settings.service",[],function(){"use strict";function e(e,t,n,a,r){return r.debug("Service: AppSettingsService"),{get:function(a){var r=t.defer();return a=a&&"object"==typeof a?a:[],e.get({sequential:1,debug:n.DEBUG,return:a},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch settings list")}),r.promise}}}return e.__name="AppSettingsService",e.$inject=["AppSettings","$q","config","UtilsService","$log"],e}),define("tasks-assignments/services/dialog.service",[],function(){"use strict";function e(e,t,n,a){return a.debug("Service: $dialog"),{open:function(a){if(!a||"object"==typeof a)return e.open({appendTo:n.find("div").eq(0),templateUrl:t.path.TPL+"modal/dialog.html",size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{copyCancel:a.copyCancel||"",copyConfirm:a.copyConfirm||"",title:a.title||"",msg:a.msg||""}}}}).result}}}return e.__name="$dialog",e.$inject=["$uibModal","config","$rootElement","$log"],e}),define("tasks-assignments/services/file.service",[],function(){"use strict";function e(e,t,n,a,r,i){i.debug("Service: FileService");var s=e(t.url.FILE+"/:action");return r.prototype.queueDelete=[],{delete:function(e,t,r){if(!e||"number"!=typeof+e||!t||"number"!=typeof+t||!r||"string"!=typeof r)return null;var i=n.defer();return s.save({action:"delete",entityTable:r,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1),a.errorHandler(e,"Unable to delete file",i)||i.resolve(e.values[0])},function(){i.reject("Unable to delete file")}),i.promise},get:function(e,t){if(!e||"number"!=typeof+e||!t||"string"!=typeof t)return null;var r=n.defer();return s.get({action:"list",entityTable:t,entityID:e},function(e){a.errorHandler(e,"Unable to fetch files",r)||r.resolve(e.values)},function(){r.reject("Unable to fetch files")}),r.promise},uploader:function(e,n){if(!e||"string"!=typeof e)return null;var a={url:t.url.FILE+"/upload",formData:[{entityTable:e}]};return n&&"number"==typeof n&&(a.queueLimit=n),new r(a)},upload:function(e,t){if(!e||"object"!=typeof e||!t||"number"!=typeof+t)return null;var a=n.defer(),r=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){r.push(t)},e.onErrorItem=function(e,t,n,r){a.reject("Could not upload file: "+e.file.name),i.error(" ===== Item Error: "+n+" ======"),i.error(" =====  - item ======"),i.error(e),i.error(" =====  - response ======"),i.error(t),i.error(" =====  - headers ======"),i.error(r)},e.onCompleteAll=function(){a.resolve(r)},e.uploadAll(),a.promise}}}return e.__name="FileService",e.$inject=["$resource","config","$q","UtilsService","FileUploader","$log"],e}),define("tasks-assignments/services/key-date.service",["common/moment"],function(e){"use strict";function t(t,n,a,r,i){return i.debug("Service: KeyDateService"),{get:function(a,r){var i=n.defer();return a&&r?(a=a?e(a).format("YYYY-MM-DD"):null,r=r?e(r).format("YYYY-MM-DD"):null,t.get({json:{start_date:a,end_date:r}},function(e){i.resolve(e.values)},function(){i.reject("Unable to fetch documents list")}),i.promise):null}}}return t.__name="KeyDateService",t.$inject=["KeyDate","$q","config","UtilsService","$log"],t}),define("tasks-assignments/services/settings.service",[],function(){"use strict";function e(e,t,n,a,r,i){return r.debug("Service: SettingsService"),{get:function(a){var r=t.defer();return a=a&&"object"==typeof a?a:[],e.get({action:"get",json:{sequential:1,debug:n.DEBUG,fields:a}},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch tasks list")}),r.promise},set:function(r){if(!r||"object"!=typeof r)return null;var s=t.defer();return e.save({action:"set",json:{sequential:1,debug:n.DEBUG,fields:r}},null,function(e){a.errorHandler(e,"Unable to save",s)||(i.tabEnabled={documents:r.documents_tab||i.tabEnabled.documents_tab,keyDates:r.keydates_tab||i.tabEnabled.keydates_tab},i.copy.button.assignmentAdd=r.add_assignment_button_title,s.resolve(e.values))},function(){s.reject("Unable to save")}),s.promise}}}return e.__name="SettingsService",e.$inject=["Settings","$q","config","UtilsService","$log","settings"],e}),define("tasks-assignments/services/utils.service",[],function(){"use strict";function e(e,t,n){return n.debug("Service: UtilsService"),{errorHandler:function(e,t,a){var r="",i=t||"Unknown Error";return e.is_error?(r=e.error_code||r,i=e.error_message||i,n.error(r+"\n"+i),a&&a.reject(r+"\n"+i),e.trace&&n.error(e.trace),!0):e.values?void 0:(n.error(i),a&&a.reject(i),!0)}}}return e.__name="UtilsService",e.$inject=["config","$q","$log","$rootScope"],e}),define("tasks-assignments/modules/services",["common/angular","tasks-assignments/services/app-settings.service","tasks-assignments/services/assignment.service","tasks-assignments/services/contact.service","tasks-assignments/services/dialog.service","tasks-assignments/services/document.service","tasks-assignments/services/file.service","tasks-assignments/services/key-date.service","tasks-assignments/services/settings.service","tasks-assignments/services/task.service","tasks-assignments/services/utils.service"],function(e,t,n,a,r,i,s,o,c,l,u){"use strict";return e.module("civitasks.services",[]).factory(t.__name,t).factory(n.__name,n).factory(a.__name,a).factory(r.__name,r).factory(i.__name,i).factory(s.__name,s).factory(o.__name,o).factory(c.__name,c).factory(l.__name,l).factory(u.__name,u)}),define("tasks-assignments/app",["common/angular","tasks-assignments/modules/config","tasks-assignments/modules/settings","tasks-assignments/modules/run.module","tasks-assignments/modules/app-dashboard.module","tasks-assignments/modules/app-documents.module","tasks-assignments/modules/app-tasks","tasks-assignments/modules/app-settings","tasks-assignments/modules/controllers","tasks-assignments/modules/directives","tasks-assignments/modules/filters","tasks-assignments/modules/resources","tasks-assignments/modules/services"],function(e){"use strict";document.addEventListener("taInit",function(t){e.bootstrap(document.getElementById(t.detail.module),["civitasks."+t.detail.app])}),document.dispatchEvent("function"==typeof window.CustomEvent?new window.CustomEvent("taReady"):function(){var e=document.createEvent("Event");return e.initEvent("taReady",!0,!0),e}())}),function(){var e=CRM.tasksAssignments.extensionPath+"js/src/tasks-assignments";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"tasks-assignments":e,"tasks-assignments/vendor/angular-bootstrap-calendar":e+"/vendor/angular/angular-bootstrap-calendar-tpls-custom","tasks-assignments/vendor/angular-checklist-model":e+"/vendor/angular/checklist-model","tasks-assignments/vendor/angular-router":e+"/vendor/angular/angular-ui-router"}}),require(["tasks-assignments/app"])}(require);
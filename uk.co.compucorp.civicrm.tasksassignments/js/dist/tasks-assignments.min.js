/**
 * CiviTasks Dashboard Calendar based on:
 * angular-bootstrap-calendar - A pure AngularJS bootstrap themed responsive calendar that can display events and has views for year, month, week and day
 * @version v0.10.6
 * @link https://github.com/mattlewis92/angular-bootstrap-calendar
 * @license MIT
 */

define("tasks-assignments/modules/tasks-assignments.constants",["common/angular"],function(e){"use strict";e.module("tasks-assignments.constants",[]).constant("config",{DEBUG:!!+CRM.debug,CLASS_NAME_PREFIX:"ct-",CONTACT_ID:CRM.contactId||null,LOGGED_IN_CONTACT_ID:CRM.adminId||null,customFieldIds:CRM.vars.customFieldIds,path:{EXT:CRM.tasksAssignments.extensionPath,TPL:CRM.tasksAssignments.extensionPath+"views/"},permissions:{allowDelete:CRM.tasksAssignments.permissions.delete_tasks_and_documents},url:{REST:CRM.url("civicrm/ajax/rest"),ASSIGNMENTS:CRM.url("civicrm/case"),CIVI_DASHBOARD:CRM.url("civicrm/"),CONTACT:CRM.url("civicrm/contact/view"),FILE:"/civicrm/tasksassignments/file",CSV_EXPORT:CRM.url("civicrm/tasksassignments")},status:{resolve:{DOCUMENT:["3","4"],TASK:["2","3","6","8"]}}})}),define("tasks-assignments/controllers/assignments.controller",[],function(){"use strict";function e(e,t,n,s,a,i,r){e.info("Controller: AssignmentsController")}return e.__name="AssignmentsController",e.$inject=["$log","$rootElement","$rootScope","$scope","$uibModal","$state","config"],e}),define("tasks-assignments/controllers/calendar.controller",["common/angular","common/moment"],function(e,t){"use strict";function n(n,s,a,i,r,o,c,l,d,u){function m(n,s,a){var i=[];return e.forEach(s,function(e){e.activity_date_time=t(e.activity_date_time).toDate(),this.push({id:e.id,title:a[e.activity_type_id],type:n,startsAt:e.activity_date_time,endsAt:e.activity_date_time,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),e.expire_date&&(e.expire_date=t(e.expire_date).toDate(),+e.expire_date!=+e.activity_date_time&&this.push({id:e.id,title:a[e.activity_type_id],type:n,startsAt:e.expire_date,endsAt:e.expire_date,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))},i),i}function f(e){i.calendarDay=t(e).toDate(),i.calendarView="day"}function g(e,n,s,a,i){var r,o,c,l=e.id,d=n.id,u=s.length,m=0;if(d)for(;m<u;m++)+s[m].id==+d&&(s.splice(m,1),m--,u--);l&&(r=t(e.activity_date_time).toDate(),o=a[e.activity_type_id],s.push({id:l,title:o,type:i,startsAt:r,endsAt:r,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),e.expire_date&&+(c=t(e.expire_date).toDate())!=+r&&s.push({id:l,title:o,type:i,startsAt:c,endsAt:c,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))}function v(){i.$on("taskDelete",function(e,t){g({},{id:t},i.calTaskList)}),i.$on("taskFormSuccess",function(e,t,n){g(a.cache.taskStatusResolve.indexOf(t.status_id)>-1?{}:t,n,i.calTaskList,a.cache.taskType.obj,"task")}),i.$on("documentDelete",function(e,t){g({},{id:t},i.calDocList)}),i.$on("documentFormSuccess",function(e,t,n){g(a.cache.documentStatusResolve.indexOf(t.status_id)>-1?{}:t,n,i.calDocList,a.cache.documentType.obj,"document")}),i.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(i.calTaskList,this.createCalEventList("task",t.taskList,a.cache.taskType.obj)),+l.tabEnabled.documents&&Array.prototype.push.apply(i.calDocList,this.createCalEventList("document",t.documentList,a.cache.documentType.obj))}.bind(this))}i.calendarDay=new Date,i.calendarTitle="",i.calendarView=o.params.calendarView||"month",i.calTaskList=[],i.calDocList=[],this.createCalEventList=m.bind(this),i.displayDayView=f,function(){v.call(this),i.calTaskList=this.createCalEventList("task",u,a.cache.taskType.obj),+l.tabEnabled.documents&&(i.calDocList=this.createCalEventList("document",d,a.cache.documentType.obj))}.bind(this)()}return n.__name="CalendarController",n.$inject=["$filter","$log","$rootScope","$scope","$timeout","$state","$stateParams","settings","documentList","taskList"],n}),define("tasks-assignments/controllers/date-list.controller",["common/moment"],function(e){"use strict";function t(t,n,s,a,i,r,o,c,l,d){function u(e){for(var t,n=0,s=e.length,a={},i=[];n<s;n++)a[e[n].keydate]=a[e[n].keydate]||[],a[e[n].keydate].push(e[n]);for(t in a)i.push({date:t,dateContactList:a[t]});return i}function m(){var t,n;"dateRange"===i.filterParams.date?(t=i.filterParams.dateRange.from?e(i.filterParams.dateRange.from).format("YYYY-MM-DD"):"",n=i.filterParams.dateRange.until?e(i.filterParams.dateRange.until).format("YYYY-MM-DD"):""):(t=e().startOf(i.filterParams.date).format("YYYY-MM-DD"),n=e().endOf(i.filterParams.date).format("YYYY-MM-DD")),window.location.href=l.url.CSV_EXPORT+"/keydatescsv?start_date="+t+"&end_date="+n}function f(){i.$watch("filterParams.dateRange.from",function(e){i.datepickerOptions.until.minDate=e}),i.$watch("filterParams.dateRange.until",function(e){i.datepickerOptions.from.maxDate=e})}function g(e,n){var s=t("date")(e,"dd/MM/yyyy")||"",a=t("date")(n,"dd/MM/yyyy")||"";a&&(a=s?" - "+a:"Until: "+a),s&&(s=a?s:"From: "+s),i.label.dateRange=s+a}function v(t,n){i.$broadcast("ct-spinner-show","dateList"),c.get(e(t),e(n)).then(function(e){i.dateListSelected=this.createDateList(e),i.filterParams.date="dateRange",i.$broadcast("ct-spinner-hide","dateList")}.bind(this))}n.debug("Controller: DateListController"),i.dataLoading=!0,i.dateList=[],i.dateListLimit=5,i.dateListSelected=[],i.dpOpened={filterDates:{}},i.filterParams={date:"month",dateType:[],dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()}},i.datepickerOptions={from:{maxDate:i.filterParams.dateRange.until},until:{minDate:i.filterParams.dateRange.from}},i.isCollapsed={filterDates:!0},i.label={isoWeek:"Week",month:"Month",year:"Year",dateRange:""},this.createDateList=u.bind(this),i.csvExport=m,i.labelDateRange=g,i.showDateRange=v.bind(this),function(){i.dateList=this.createDateList(d),a.$broadcast("ct-spinner-hide"),c.get(e().startOf("year"),e().endOf("year")).then(function(e){i.dateList=this.createDateList(e),i.dataLoading=!1}.bind(this)),f()}.bind(this)()}return t.__name="DateListController",t.$inject=["$filter","$log","$rootElement","$rootScope","$scope","$timeout","$uibModal","keyDateService","config","contactList"],t}),define("tasks-assignments/controllers/document-list.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function s(n,s,a,i,r,o,c,l,d,u,m,f,g,v,p,h,_){function y(e,t){var n,s=t.length,i=[];if(e&&s)switch(e){case"delete":l.open({msg:"Are you sure you want to delete "+s+" document(s)?"}).then(function(e){if(e){for(o.$broadcast("ct-spinner-show","documentList"),n=0;n<s;n++)i.push(g.delete(t[n].id));a.all(i).then(function(e){for(n=0;n<s;n++)r.$broadcast("documentDelete",t[n].id),o.list.splice(o.list.indexOf(t[n]),1);o.$broadcast("ct-spinner-hide","documentList"),m.updateTab()})}})}}function k(){R.filterParams.dateRange.from=R.filterParamsHolder.dateRange.from,R.filterParams.dateRange.until=R.filterParamsHolder.dateRange.until,R.filterParams.due="dateRange",R.isDocumentSection=null!==R.filterParamsHolder.dateRange.from||null!==R.filterParamsHolder.dateRange.until,R.labelDateRange()}function b(e,t){if(!t||"number"!=typeof+t)return null;o.$broadcast("ct-spinner-show","documentList"),g.save({id:e.id,status_id:t}).then(function(t){e.id=t.id,e.status_id=t.status_id,o.$broadcast("ct-spinner-hide","documentList"),m.updateTab()})}function C(e){l.open({msg:"Are you sure you want to delete this document?"}).then(function(t){t&&g.delete(e.id).then(function(t){R.list.splice(R.list.indexOf(e),1),r.$broadcast("documentDelete",e.id),m.updateTab()})})}function $(e){var s=n("filterByDateField")(R.list,e,"activity_date_time",R.filterParams.dateRange),a=n("filterByDateField")(R.list,e,"expire_date",R.filterParams.dateRange);return t.uniq(t.union(s,a),"id")}function w(){o.$watch(function(){return R.filterParamsHolder.dateRange.from},function(e){R.datepickerOptions.until.minDate=e}),o.$watch(function(){return R.filterParamsHolder.dateRange.until},function(e){R.datepickerOptions.from.maxDate=e})}function D(){o.$watch(function(){return R.filterParams.due},function(e){var n=r.cache.documentStatus.arr,s=t.includes(["overdue","dueInNextFortnight","dueInNinetyDays"],e);R.filterParams.documentStatus=s?N:[],R.filterParams.allowedStatuses=s?t.filter(n,function(e){return t.includes(N,e.key)}):n,s&&(R.filterParamsHolder.documentStatus=t.intersection(R.filterParamsHolder.documentStatus,N))})}function T(){x(),j(),M()}function S(){w(),D()}function E(){var e=n("date")(R.filterParams.dateRange.from,"dd/MM/yyyy")||"",t=n("date")(R.filterParams.dateRange.until,"dd/MM/yyyy")||"";t&&(t=e?" - "+t:"Until: "+t),e&&(e=t?e:"From: "+e),R.label.dateRange=e+t}function A(e){var n={};return e.length&&t.each(e,function(e){var s=t.find(r.cache.contact.obj,{contact_id:e});s&&(n[e]=s.sort_name.replace(",",""))}),n}function x(){o.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(R.list,t.documentList)})}function M(){o.$on("crmFormSuccess",function(e,t){if("success"===t.status){var n=/case|activity|assignment/i;(n.test(t.title)||O(n,t)||n.test(t.crmMessages[0].text))&&!"activity_type".test(t.userContext)&&(r.cache.assignment={obj:{},arr:[]},u.go(u.current,{},{reload:!0}))}})}function j(){o.$on("documentFormSuccess",function(t,n,s){e.equals({},s)?R.list.push(n):e.extend(s,n)})}function O(e,t){return t.crmMessages&&t.crmMessages.length&&e.test(t.crmMessages[0].title)}function I(e){switch(R.reverse=R.propertyName===e&&!R.reverse,R.propertyName=e,e){case"type":R.list=t.sortBy(R.list,function(e){return r.cache.documentType.obj[e.activity_type_id].toLowerCase()});break;case"status_id":R.list=t.sortBy(R.list,function(e){return r.cache.documentStatus.obj[e.status_id].toLowerCase()});break;case"target_contact":R.list=t.sortBy(R.list,function(e){return r.cache.contact.obj[e.target_contact_id[0]].sort_name.toLowerCase()});break;case"assignee":R.list=t.sortBy(R.list,function(e){var n=e.assignee_contact_id.length&&t.find(r.cache.contact.obj,{id:e.assignee_contact_id[0]});return n?n.sort_name.toLowerCase():""});break;case"case_id":R.list=t.sortBy(R.list,function(e){var t=r.cache.assignment.obj[e.case_id],n=t&&r.cache.assignmentType.obj[t.case_type_id];return n&&n.title.toLowerCase()})}}function L(e){u.go("calendar.mwl."+e)}s.debug("Controller: DocumentListController");var R=this,N=function(e){var n=r.cache.documentStatus.arr;return e.map(function(e){return t.find(n,{value:e}).key})}(["awaiting upload","awaiting approval"]);R.dueThisWeek=0,R.dueToday=0,R.isDocumentSection=!1,R.list=_,R.listFiltered=[],R.listOngoing=[],R.listPaginated=[],R.overdue=0,R.propertyName="activity_date_time",R.reverse=!0,R.documentContactColumns=[{label:"Type",property:"type"},{label:"Document Number",property:"document_number"},{label:"Assigned to",property:"assignee"},{label:"Workflow",property:"case_id",condition:h.extEnabled.assignments},{label:"Valid From",property:"valid_from"},{label:"Expiry Date",property:"expire_date"},{label:"Status",property:"status_id"}],R.documentDashboardColumns=[{label:"Type",property:"type"},{label:"Staff",property:"target_contact"},{label:"Assigned to",property:"assignee"},{label:"Workflow",property:"case_id",condition:h.extEnabled.assignments},{label:"Due Date",property:"activity_date_time"},{label:"Expiry Date",property:"expire_date"},{label:"Status",property:"status_id"}],R.dpOpened={filterDates:{}},R.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue",statuses:N},{badgeClass:"primary",calendarView:"month",value:"dueInNextFortnight",statuses:N},{badgeClass:"primary",calendarView:"month",value:"dueInNinetyDays",statuses:N},{badgeClass:"primary",calendarView:"month",value:"all"}],R.filterParams={allowedStatuses:[],contactId:null,documentStatus:[],ownership:u.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},R.filterParamsHolder={documentStatus:N,dateRange:{from:null,until:null}},R.datepickerOptions={from:{maxDate:R.filterParamsHolder.dateRange.until},until:{minDate:R.filterParamsHolder.dateRange.from}},R.isCollapsed={filterAdvanced:!0,filterDates:!0},R.label={addNew:"Add Document",overdue:"Overdue",dueInNextFortnight:"Next fortnight",dueInNinetyDays:"90 days",all:"All",dateRange:""},R.pagination={currentPage:1,itemsPerPage:10,maxSize:5},R.apply=y,R.applySidebarFilters=k,R.changeStatus=b,R.deleteDocument=C,R.filterByDateField=$,R.labelDateRange=E,R.listAssignees=A,R.sortBy=I,R.viewInCalendar=L,function(){T(),S(),R.applySidebarFilters(),g.cacheContactsAndAssignments(_).then(function(){r.$broadcast("ct-spinner-hide"),s.debug(r.cache)})}()}return s.__name="DocumentListController",s.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$dialog","$uibModal","$state","assignmentService","contactService","documentService","fileServiceTA","config","settings","documentList"],s}),define("tasks-assignments/controllers/document.controller",["common/moment"],function(e){"use strict";function t(t,n,s,a){function i(){s.$watch("document.activity_date_time",function(e){s.document.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)}),s.$watch("document.id",function(){s.fileUrl=a.url.FILE+"/zip?entityID="+s.document.id+"&entityTable=civicrm_activity"})}t.debug("Controller: DocumentController"),s.document.activity_date_time=s.document.activity_date_time?e(s.document.activity_date_time).toDate():null,s.document.expire_date=s.document.expire_date?e(s.document.expire_date).toDate():null,s.document.valid_from=s.document.valid_from?e(s.document.valid_from).toDate():null,s.document.remind_me=1===s.document.remind_me,function(){i()}()}return t.__name="DocumentController",t.$inject=["$log","$rootScope","$scope","config"],t}),define("tasks-assignments/controllers/external-page.controller",[],function(){"use strict";function e(e,t,n,s,a,i,r){function o(){s.$on("assignmentFormSuccess",function(){a.go(a.current,{},{reload:!0})}),s.$on("iframe-ready",function(){n.$broadcast("ct-spinner-hide")})}e.debug("Controller: ExternalPageController"),s.assignmentsUrl=r.url.ASSIGNMENTS+"?reset=1",s.reportsUrl=r.url.CIVI_DASHBOARD+"?reset=1",function(){o()}()}return e.__name="ExternalPageController",e.$inject=["$log","$rootElement","$rootScope","$scope","$state","$uibModal","config"],e}),define("tasks-assignments/controllers/main.controller",["common/lodash"],function(e){"use strict";function t(t,n,s,a,i,r,o,c,l,d,u,m,f){function g(n){var s=a["modal"+e.capitalize(n)];"function"==typeof s?s({case_type_id:C.caseTypeId||null}):t.warn("There is no method available for opening the required "+n+" modal!")}function v(e,t){var n="All tasks in the "+e+" workflow for "+t+" have been completed. Good work!";m.success("Success",n)}function p(e){return f.get({id:e,return:["case_id.case_type_id.title","case_id.status_id.name"]}).then(function(e){var t=e[0];if(t)return{caseTypeTitle:t["case_id.case_type_id.title"],statusName:t["case_id.status_id.name"]}})}function h(){i.$on("taskFormSuccess",function(t,n,s){var i=a.cache.contact.obj[s.target_contact_id[0]];e.isEmpty(s.case_id)||p(s.id).then(function(e){"Closed"===e.statusName&&v(e.caseTypeTitle,i.display_name)})})}function _(e){var n;e=e||{},n=r.open({appendTo:s.find("div").eq(0),templateUrl:c.path.TPL+"modal/assignment.html?v=3",controller:"ModalAssignmentController",size:"lg",resolve:{data:function(){return e},session:function(){return u.get()},defaultAssigneeOptions:function(){return d.valuesOf("activity_default_assignee")}}}),n.result.then(function(t){i.$broadcast("assignmentFormSuccess",t,e)},function(){t.info("Modal dismissed")})}function y(e,n,a){var o;a&&a.preventDefault(),n=n||"new",e=e||{},o=r.open({appendTo:s.find("div").eq(0),templateUrl:c.path.TPL+"modal/document.html?v=3",controller:"ModalDocumentController",controllerAs:"documentModal",resolve:{modalMode:function(){return n},role:function(){return"admin"},data:function(){return e},files:function(){return e.id&&+e.file_count?l.get(e.id,"civicrm_activity"):[]}}}),o.result.then(function(t){i.$broadcast("documentFormSuccess",t,e)},function(){t.info("Modal dismissed")})}function k(e,t){if(!e||"object"!=typeof e||!t||"string"!=typeof t)return null;r.open({appendTo:s.find("div").eq(0),templateUrl:c.path.TPL+"modal/reminder.html?v=1",controller:"ModalReminderController",resolve:{data:function(){return e},type:function(){return t}}})}function b(e){var n;e=e||{},n=r.open({appendTo:s.find("div").eq(0),templateUrl:c.path.TPL+"modal/task.html?v=5",controller:"ModalTaskController",resolve:{data:function(){return e}}}),n.result.then(function(t){i.$broadcast("taskFormSuccess",t,e),t.open&&a.modalTask(e)},function(){t.info("Modal dismissed")})}var C;t.debug("Controller: MainController"),a.modalAssignment=_,a.modalDocument=y,a.modalReminder=k,a.modalTask=b,function(){C=o.parse(),C.openModal&&g(C.openModal),h()}()}return t.__name="MainController",t.$inject=["$log","$q","$rootElement","$rootScope","$scope","$uibModal","beforeHashQueryParams","config","fileServiceTA","OptionGroup","Session","notificationService","taskService"],t}),define("tasks-assignments/controllers/settings.controller",["common/angular"],function(e){"use strict";function t(t,n,s,a,i,r,o,c,l,d,u,m,f){function g(){r.$broadcast("ct-spinner-show"),d.set({documents_tab:r.settings.tabEnabled.documents,keydates_tab:r.settings.tabEnabled.keyDates,add_assignment_button_title:r.settings.copy.button.assignmentAdd,is_task_dashboard_default:r.settings.isTaskDashboardDefault,days_to_create_a_document_clone:r.settings.daysToCreateADocumentClone}).then(function(e){r.$broadcast("ct-spinner-hide"),r.settingsForm.$pristine=!0},function(e){CRM.alert(e,"Error","error"),r.$broadcast("ct-spinner-hide")})}function v(){r.$on("$stateChangeStart",function(e,t,n,s,a){r.settingsForm.$pristine||(e.preventDefault(),o.open({copyCancel:"No",msg:"Are you sure you want to leave this page? Changes will be lost!"}).then(function(e){if(!e)return void i.$broadcast("$stateChangeSuccess");c.go(t.name,n,{notify:!1}).then(function(){i.$broadcast("$stateChangeSuccess",t,n,s,a)})}))})}function p(){l.open({appendTo:a.find("div").eq(0),templateUrl:m.path.TPL+"modal/taskMigrate.html?v=1",controller:"ModalTaskMigrateController",resolve:{activityType:function(){return h}}}).result.then(function(e){r.$broadcast("taskMigrateFormSuccess",e)},function(){n.info("Modal dismissed")})}n.debug("Controller: SettingsController");var h;r.settings=e.copy(f),r.configureAddAssignmentBtn=!!r.settings.copy.button.assignmentAdd,r.modalTaskMigrate=p,r.confirm=g,function(){v(),i.$broadcast("ct-spinner-hide"),h=function(){var e=s.defer();return u.get({entity:"Activity",action:"getoptions",json:{field:"activity_type_id"}},function(t){e.resolve(t.values||[])},function(){e.reject("Unable to get activity types")}),e.promise}()}()}return t.__name="SettingsController",t.$inject=["$location","$log","$q","$rootElement","$rootScope","$scope","$dialog","$state","$uibModal","settingsService","Task","config","settings"],t}),define("tasks-assignments/controllers/task-list.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function s(t,s,a,i,r,o,c,l,d,u,m,f,g,v,p,h){function _(){I.filterParams.dateRange.from=I.filterParamsHolder.dateRange.from,I.filterParams.dateRange.until=I.filterParamsHolder.dateRange.until,I.filterParams.due="dateRange"}function y(e){if(!i.cache.assignment.obj[e.id]){var n={};n[e.id]={case_type_id:t("filter")(i.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},u.updateCache(n)}}function k(e){var t={},n=I.contacts.filter(function(t){return t.id===e})[0];if(n)return t[n.id]={contact_id:n.id,contact_type:n.icon_class,sort_name:n.label,display_name:n.label,email:n.description.length?n.description[0]:""},m.updateCache(t),!0}function b(e,t){r.$broadcast("ct-spinner-show","task"+e.id),f.save({id:e.id,status_id:t||"2"}).then(function(t){i.$broadcast("taskFormSuccess",t,e),r.$broadcast("ct-spinner-hide","task"+e.id),u.updateTab()})}function C(t){function n(e){a.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&a.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&a.push(e.target_contact_id[0])}function s(e){e.case_id&&i.push(e.case_id)}var a=I.contactIds,i=I.assignmentIds;a.push(v.LOGGED_IN_CONTACT_ID),v.CONTACT_ID&&a.push(v.CONTACT_ID),e.forEach(t,function(e){n(e),s(e)})}function $(e){c.open({msg:"Are you sure you want to delete this task?"}).then(function(t){t&&f.delete(e.id).then(function(t){I.list.splice(I.list.indexOf(e),1),i.$broadcast("taskDelete",e.id),u.updateTab()})})}function w(e){return t("filterByDateField")(I.list,e,"activity_date_time",I.filterParams.dateRange)}function D(){r.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(I.list,t.taskList)}),r.$on("taskFormSuccess",function(t,n,s){e.equals({},s)?I.list.push(n):e.extend(s,n)}),r.$on("crmFormSuccess",function(e,t){if("success"===t.status){var n=/case|activity|assignment/i;(n.test(t.title)||E(n,t)||n.test(t.crmMessages[0].text))&&!"activity_type".test(t.userContext)&&(i.cache.assignment={obj:{},arr:[]},l.go(l.current,{},{reload:!0}))}})}function T(){r.$watch("filterParamsHolder.dateRange.from",function(e){I.datepickerOptions.until.minDate=e}),r.$watch("filterParamsHolder.dateRange.until",function(e){I.datepickerOptions.from.maxDate=e})}function S(){I.listResolvedLoaded||(t("filterByStatus")(I.list,i.cache.taskStatusResolve,!1),f.get({target_contact_id:v.CONTACT_ID,status_id:{IN:v.status.resolve.TASK}}).then(function(e){var t=I.contactIds,n=I.assignmentIds;I.collectId(e),t&&t.length&&m.get({IN:t}).then(function(e){m.updateCache(e)}),n&&n.length&&p.extEnabled.assignments&&u.get({IN:n}).then(function(e){u.updateCache(e)}),Array.prototype.push.apply(I.list,e),I.listResolvedLoaded=!0}))}function E(e,t){return t.crmMessages&&t.crmMessages.length&&e.test(t.crmMessages[0].title)}function A(e,n,s){e&&n&&s&&u.search(e,s).then(function(e){I.assignments=t("filter")(e,function(e){return+e.extra.contact_id==+n})})}function x(e){e&&m.search(e,{contact_type:"Individual"}).then(function(e){I.contacts=e})}function M(e){I.contacts=e}function j(t,n){return I.cacheContact(t.assignee_contact_id[0]),f.save(e.extend({},t,n)).catch(function(e){CRM.alert(e,"Error","error")})}function O(e){l.go("calendar.mwl."+e)}s.debug("Controller: TaskListController");var I=this;I.assignmentIds=[],I.assignments=[],I.contactIds=[],I.contacts=[],I.dueThisWeek=0,I.dueToday=0,I.format=g.DATE_FORMAT,I.list=h,I.listFiltered=[],I.listLimit=5,I.listOngoing=[],I.listResolved=[],I.listResolvedLoaded=!1,I.overdue=0,I.dpOpened={filterDates:{}},I.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue"},{badgeClass:"primary",calendarView:"day",value:"dueToday"},{badgeClass:"primary",calendarView:"week",value:"dueThisWeek"}],I.filterParams={contactId:null,ownership:l.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},I.filterParamsHolder={dateRange:{from:n().startOf("day").toDate(),until:n().add(1,"month").startOf("day").toDate()}},I.datepickerOptions={from:{maxDate:I.filterParamsHolder.dateRange.until},until:{minDate:I.filterParamsHolder.dateRange.from}},I.isCollapsed={filterAdvanced:!0,filterDates:!0,taskListResolved:!0},I.label={overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:"Due Tasks"},I.applySidebarFilters=_,I.cacheAssignment=y,I.cacheContact=k,I.changeStatus=b,I.collectId=C,I.deleteTask=$,I.filterByDateField=w,I.loadTasksResolved=S,I.refreshAssignments=A,I.refreshContacts=x,I.updateContacts=M,I.updateTask=j,I.viewInCalendar=O,function(){var e=I.contactIds,t=I.assignmentIds;I.collectId(h),e&&e.length&&m.get({IN:e}).then(function(e){m.updateCache(e)}),t&&t.length&&p.extEnabled.assignments&&u.get({IN:t}).then(function(e){u.updateCache(e)}),D(),T(),i.$broadcast("ct-spinner-hide"),s.info(i.cache)}()}return s.__name="TaskListController",s.$inject=["$filter","$log","$rootElement","$rootScope","$scope","$timeout","$dialog","$state","$uibModal","assignmentService","contactService","taskService","HR_settings","config","settings","taskList"],s}),define("tasks-assignments/controllers/task.controller",["common/moment"],function(e,t){"use strict";function n(t,n,s){function a(e){s.picker.opened=!0}function i(){s.$watch("task.status_id",function(e){var t=n.cache.taskStatusResolve.indexOf(e)>-1;s.task.resolved=t,s.task.completed=t}),s.$watch("task.activity_date_time",function(e){s.task.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}t.debug("Controller: TaskController"),s.isCollapsed=!0,s.picker={opened:!1},s.task.activity_date_time=s.task.activity_date_time?e(s.task.activity_date_time).toDate():null,s.dpOpen=a,function(){i()}()}return n.__name="TaskController",n.$inject=["$log","$rootScope","$scope"],n}),define("tasks-assignments/controllers/dashboard/nav-main.controller",[],function(){"use strict";function e(e,t,n){function s(e){return n.includes(e)}e.debug("Controller: NavMainController"),t.isActive=s}return e.__name="NavMainController",e.$inject=["$log","$scope","$state"],e}),define("tasks-assignments/controllers/dashboard/top-bar.controller",[],function(){"use strict";function e(e,t,n,s){e.debug("Controller: TopBarController"),t.itemAdd={},t.itemAdd.fn=function(){s.includes("documents")?t.modalDocument():t.modalTask()},t.itemAdd.label=function(){return s.includes("documents")?"Add Document":"Add Task"}}return e.__name="TopBarController",e.$inject=["$log","$rootScope","$scope","$state"],e}),define("tasks-assignments/services/contact.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,s,a,i,r,o,c,l){function d(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null;var s=i.defer();return e={IN:t.uniq(e.IN)},n.get({json:{id:e,return:"display_name, sort_name, id, contact_id, contact_type, email"}},function(e){c.errorHandler(e,"Unable to fetch contacts",s)||s.resolve(e.values)},function(){s.reject("Unable to fetch contact")}),s.promise}function u(t,s){if(s&&"object"!=typeof s)return null;var a=i.defer(),r={};return e.extend(r,s),r.display_name=t,r.return="display_name, contact_id, contact_type, email",n.get({action:"get",json:r},function(e){if(!c.errorHandler(e,"Unable to fetch contact list",a)){var t=[];for(var n in e.values)t.push({label:e.values[n].display_name,description:[e.values[n].email],id:e.values[n].contact_id,icon_class:e.values[n].contact_type});a.resolve(t)}},function(){a.reject("Unable to fetch contact list")}),a.promise}function m(t){var n,s,a=o.cache.contact.obj||{},i=[],c=[];e.extend(a,t);for(s in a)n=a[s],i.push(n),c.push({description:n.email?[n.email]:[],label:n.display_name,icon_class:n.contact_type,id:n.contact_id});i=r("orderBy")(i,"sort_name"),c=r("orderBy")(c,"label"),o.cache.contact={arr:i,obj:a,arrSearch:c}}return l.debug("Service: contactService"),{get:d,search:u,updateCache:m}}return n.__name="contactService",n.$inject=["Contact","$resource","config","$q","$filter","$rootScope","utilsService","$log"],n}),define("tasks-assignments/services/document.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,s,a,i,r,o,c,l){function d(t,a){if(!t||!e.isArray(t)||!a||"number"!=typeof+a)return null;if(!t.length)return t;var i=s.defer();return n.save({action:"copy_to_assignment"},{json:{id:t,case_id:a}||{}},function(e){r.errorHandler(e,"Unable to assign documents",i)||i.resolve(e.values)},function(){i.reject("Unable to assign documents")}),i.promise}function u(e,n){var r,l,d=[],u=[];return void 0===n&&(n=["contacts","assignments"]),n=Array.isArray(n)?n:[n],t.contains(n,"contacts")&&(d=m(e),a.CONTACT_ID&&d.push(a.CONTACT_ID),r=d&&d.length?o.get({IN:d}).then(function(e){o.updateCache(e)}):s.resolve()),t.contains(n,"assignments")&&(u=f(e),l=u&&u.length&&i.extEnabled.assignments?c.get({IN:u}).then(function(e){c.updateCache(e)}):s.resolve()),s.all([r,l])}function m(e){return t(e).map(function(e){var t=[];return t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&(t=t.concat(e.assignee_contact_id)),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0]),t}).flatten().value()}function f(e){return e.filter(function(e){return!!e.case_id}).map(function(e){return e.case_id})}function g(e){if(!e||"number"!=typeof+e)return null;var t=s.defer();return n.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete document ID: "+e)}),t.promise}function v(t){var a=s.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviDocument",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id, expire_date"},t),n.get({json:t},function(e){a.resolve(e.values)},function(){a.reject("Unable to fetch documents list")}),a.promise}function p(){var e=s.defer(),a={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"status_id"}},function(n){t.each(n.values,function(e){a.arr.push({key:e.key.toString(),value:e.value}),a.obj[e.key]=e.value}),e.resolve(a)}),e.promise}function h(){var e=s.defer(),a={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(n){t.each(n.values,function(e){a.arr.push({key:e.key,value:e.value}),a.obj[e.key]=e.value}),e.resolve(a)}),e.promise}function _(){return s.all({documentType:this.getDocumentTypes(),documentStatus:this.getDocumentStatus()})}function y(t){if(!t||"object"!=typeof t)return null;var i,o=s.defer(),c=e.extend({sequential:1,debug:a.DEBUG},t);return n.save({action:"create"},{json:c||{}},function(e){r.errorHandler(e,"Unable to save document",o)||(i=e.values,o.resolve(1===i.length?i[0]:null))},function(){o.reject("Unable to save document")}),o.promise}function k(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;var a=s.defer();return n.save({action:"create_multiple"},{json:{document:t}||{}},function(e){r.errorHandler(e,"Unable to save documents",a)||a.resolve(e.values)},function(){a.reject("Unable to save documents")}),a.promise}function b(e,t){if(!e||"number"!=typeof+e)return null;var a=s.defer();return n.save({action:"sendreminder"},{json:{activity_id:e,notes:t||""}||{}},function(e){r.errorHandler(e,"Unable to send a reminder",a)||a.resolve(e)},function(){a.reject("Unable to send a reminder")}),a.promise}return l.debug("Service: documentService"),{assign:d,cacheContactsAndAssignments:u,delete:g,get:v,getOptions:_,getDocumentStatus:p,getDocumentTypes:h,save:y,saveMultiple:k,sendReminder:b}}return n.__name="documentService",n.$inject=["Document","$q","config","settings","utilsService","contactService","assignmentService","$log"],n}),define("tasks-assignments/services/task.service",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function s(s,a,i,r,o){function c(t,n){if(!t||!e.isArray(t)||!n||"number"!=typeof+n)return null;if(!t.length)return t;var i=a.defer();return s.save({action:"copy_to_assignment"},{json:{id:t,case_id:n}||{}},function(e){r.errorHandler(e,"Unable to assign tasks",i)||i.resolve(e.values)},function(){i.reject("Unable to assign tasks")}),i.promise}function l(e){if(!e||"number"!=typeof+e)return null;var t=a.defer();return s.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete task ID: "+e)}),t.promise}function d(t){var n=a.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviTask",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id"},t),s.get({json:t},function(e){n.resolve(e.values)},function(){n.reject("Unable to fetch tasks list")}),n.promise}function u(){var e=a.defer(),n={arr:[],obj:{}};return s.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(s){t.each(s.values,function(e){n.arr.push({key:e.key,value:e.value}),
n.obj[e.key]=e.value}),e.resolve(n)}),e.promise}function m(){return a.all({taskType:this.getActivityTypes(),taskStatus:this.getTaskStatus()})}function f(){var e=a.defer(),n={arr:[],obj:{}};return s.get({action:"getoptions",json:{field:"status_id"}},function(s){t.each(s.values,function(e){n.arr.push({key:e.key,value:e.value}),n.obj[e.key]=e.value}),e.resolve(n)}),e.promise}function g(t){if(!t||"object"!=typeof t)return null;t.activity_date_time instanceof Date&&(t.activity_date_time=n(t.activity_date_time.getTime()).format("YYYY-MM-DD"));var i,o=a.defer(),c=e.extend({},t);return s.save({action:"create"},{json:c||{}},function(e){r.errorHandler(e,"Unable to save task",o)||(i=e.values,o.resolve(1===i.length?i[0]:null))},function(){o.reject("Unable to save task")}),o.promise}function v(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;t.forEach(function(e){e.activity_date_time instanceof Date&&(e.activity_date_time=n(e.activity_date_time.getTime()).format("YYYY-MM-DD"))});var i=a.defer();return s.save({action:"create_multiple"},{json:{task:t}||{}},function(e){r.errorHandler(e,"Unable to save tasks",i)||i.resolve(e.values)},function(){i.reject("Unable to save tasks")}),i.promise}function p(e,t){if(!e||"number"!=typeof+e)return null;var n=a.defer();return s.save({action:"sendreminder"},{json:{activity_id:e,notes:t}},function(e){r.errorHandler(e,"Unable to send a reminder",n)||n.resolve(e)},function(){n.reject("Unable to send a reminder")}),n.promise}return o.debug("Service: taskService"),{assign:c,delete:l,get:d,getActivityTypes:u,getOptions:m,getTaskStatus:f,save:g,saveMultiple:v,sendReminder:p}}return s.__name="taskService",s.$inject=["Task","$q","config","utilsService","$log"],s}),define("tasks-assignments/services/assignment.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(t,n,s,a,i,r,o,c,l,d,u,m,f,g){function v(e,n){if(!e||"number"!=typeof+e||!n||"number"!=typeof+n)return null;var s=r.defer();return t.save({action:"create",json:{sequential:1,contact_id_a:e,contact_id_b:o.LOGGED_IN_CONTACT_ID,relationship_type_id:9,case_id:n}},null,function(e){c.errorHandler(e,"Unable to assign coordinator",s)||s.resolve(e.values)},function(){s.reject("Unable to assign coordinator")}),s.promise}function p(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null;var t=r.defer();return n.get({json:{options:{limit:0},id:e,return:["case_type_id","contacts","client_id","contact_id","id","is_deleted","start_date","status_id","subject"],debug:o.DEBUG}},function(e){c.errorHandler(e,"Unable to fetch assignments",t)||t.resolve(e.values)},function(){t.reject("Unable to fetch assignments")}),t.promise}function h(){var e=r.defer();return a.get({},function(t){c.errorHandler(t,"Unable to fetch assignment types",e)||e.resolve(t.values)},function(){e.reject("Unable to fetch assignment types")}),e.promise}function _(t){if(!t||"object"!=typeof t)return null;var s,a=r.defer(),i=e.extend({sequential:1,debug:o.DEBUG},t);return n.save({action:"create",json:i},null,function(e){c.errorHandler(e,"Unable to save an assignment",a)||(s=e.values,a.resolve(1===s.length?s[0]:null))},function(){a.reject("Unable to save an assignment")}),a.promise}function y(e,t,n){return n=Array.isArray(n)?n.join(","):n,s.query({sortName:e,excludeCaseIds:t,includeContactIds:n}).$promise}function k(e){return document.getElementsByClassName("CRM_Case_Form_Search").length?void CRM.refreshParent(".CRM_Case_Form_Search"):document.getElementById("tab_case")?void CRM.tabHeader.updateCount("#tab_case",CRM.tabHeader.getCount("#tab_case")+(e||0)):void("/assignments"===d.path()&&u.reload(!0))}function b(t){var n,s,a,i=m.cache.assignment.obj||{},r=[],o=[];e.extend(i,t);for(s in i)n=i[s],a=m.cache.assignmentType.obj[n.case_type_id].title,r.push(n),o.push({label:n.contacts[0].sort_name+" - "+a+(n.end_date?" (closed)":""),label_class:+n.is_deleted||n.end_date?"strikethrough":"",id:s,extra:{case_subject:n.subject,case_type:a,contact_id:n.contacts[0].contact_id,end_date:n.end_date,sort_name:n.contacts[0].sort_name,start_date:n.start_date}});r=l("orderBy")(r,"subject"),o=l("orderBy")(o,"label"),m.cache.assignment={arr:r,obj:i,arrSearch:o}}return f.debug("Service: assignmentService"),{get:p,assignCoordinator:v,getTypes:h,save:_,search:y,updateCache:b,updateTab:k}}return n.__name="assignmentService",n.$inject=["Relationship","Assignment","AssignmentSearch","AssignmentType","contactService","$q","config","utilsService","$filter","$location","$state","$rootScope","$log","$timeout"],n}),define("tasks-assignments/controllers/modal/modal-assignment-activity.controller",["common/lodash","common/angular","common/moment","tasks-assignments/services/contact.service","tasks-assignments/services/document.service","tasks-assignments/services/task.service","tasks-assignments/services/assignment.service"],function(e,t,n){"use strict";function s(e,t){function s(){t.$watch("$parent.assignment.dueDate",function(e){t.activity.create&&(t.activity.activity_date_time=e?n(e).add(t.activity.offset,"days").toDate():null)}),t.$watch("$parent.assignment.contact_id",function(e){e&&t.activity.create&&(t.activity.target_contact_id=[e])})}e.debug("Controller: ModalAssignmentTaskController"),t.isDisabled=!t.activity.activity_type_id&&!t.activity.isAdded,t.activity.create=!t.isDisabled,function(){s()}()}return s.__name="ModalAssignmentActivityController",s.$inject=["$log","$scope"],s}),define("tasks-assignments/controllers/modal/modal-assignment.controller",["common/lodash","common/angular","common/moment"],function(e,t,n){"use strict";function s(n,s,a,i,r,o,c,l,d,u,m,f,g,v,p,h,_,y,k){function b(e){e&&e.push(t.extend(t.copy(ee),{isAdded:!0}))}function C(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},v.updateCache(t)}function $(){c.dismiss("cancel")}function w(){if(!n("filter")(r.taskList,{create:!0}).length&&!n("filter")(r.documentList,{create:!0}).length)return r.alert.msg="Please add at least one task.",void(r.alert.show=!0);Q(r.assignment)&&(r.$broadcast("ct-spinner-show"),r.assignment.start_date=new Date,m.save(r.assignment).then(function(n){var s=r.documentList.filter(function(e){return e.create}).map(function(t){return t.assignee_id=e.first(t.assignee_contact_id),t.case_id=n.id,t}),o=r.taskList.filter(function(e){return e.create}).map(function(t){return t.assignee_id=e.first(t.assignee_contact_id),t.case_id=n.id,t});a.all({relationship:m.assignCoordinator(r.assignment.contact_id,n.id),document:g.saveMultiple(s.map(function(e){return t.copy(e)})),task:f.saveMultiple(o.map(function(e){return t.copy(e)}))}).then(function(e){var a,l=[],u=[],f={};for(a=0;a<e.task.length;a++)o[a].id=e.task[a].id,l.push(e.task[a].id);for(a=0;a<e.document.length;a++)s[a].id=e.document[a].id,u.push(e.document[a].id);f[n.id]=t.extend(t.copy(r.assignment),{id:n.id,client_id:{1:r.assignment.client_id},contact_id:{1:r.assignment.contact_id},contacts:[{sort_name:i.cache.contact.obj[r.assignment.contact_id].sort_name,contact_id:r.assignment.contact_id,role:"Client"},{sort_name:i.cache.contact.obj[d.LOGGED_IN_CONTACT_ID].sort_name,contact_id:d.LOGGED_IN_CONTACT_ID,role:"Case Coordinator"}],is_deleted:"0",end_date:"",activities:l.concat(u)}),m.updateCache(f),m.updateTab(1),c.close({documentList:s,taskList:o}),r.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),r.$broadcast("ct-spinner-hide"),a.reject()})},function(e){return CRM.alert(e,"Error","error"),r.$broadcast("ct-spinner-hide"),a.reject()}))}function D(t,n){var s=A(t);t.forEach(function(a,i){var o=r.contacts[n][e.indexOf(t,s)]||[],c=s.assignee_contact_id?[s.assignee_contact_id[0]]:s.assignee_contact_id;a.create&&(r.contacts[n][i]=o.slice(),a.assignee_contact_id=c)})}function T(e){e.forEach(function(t){t.create&&(t.activity_date_time=A(e).activity_date_time)})}function S(){var e=CRM.url("civicrm/contact/view/rel",{action:"add",cid:r.assignment.client_id});CRM.loadForm(e).on("crmFormSuccess",function(){o(function(){F().then(B)})})}function E(e,t){e.preventDefault(),e.stopPropagation(),r.dpOpened[t]=!0}function A(t){return e.find(t,function(e){return e.create})}function x(){var t=e.chain(r.documentList).concat(r.taskList).value(),n=r.activity.activitySet.activityTypes.map(function(n){var s=e.find(t,{name:n.name});if(s)return{activity:s,type:n}});return e.compact(n)}function M(t){return t.filter(function(t){var n=t.type.default_assignee_type===J.BY_RELATIONSHIP,s=e.isEmpty(t.activity.assignee_contact_id);return n&&s})}function j(e){switch(e.default_assignee_type){case J.SPECIFIC_CONTACT:return a.resolve([e.default_assignee_contact]);case J.USER_CREATING_THE_CASE:return a.resolve([_.contactId]);case J.BY_RELATIONSHIP:return I(e);case J.NONE:default:return a.resolve(null)}}function O(e){var t,n;return e.isBidirectional?{relationship_type_id:e.id,contact_id_a:r.assignment.client_id,contact_id_b:r.assignment.client_id,options:{or:[["contact_id_a","contact_id_b"]],limit:1}}:(n=e.sourceContactFieldName,t={relationship_type_id:e.id,options:{limit:1}},t[n]=r.assignment.client_id,t)}function I(e){var t,n;return r.assignment.client_id?(n=L(e.default_assignee_relationship),t=O(n),y.allValid(t,null,null,!1).then(function(e){return e.list.map(function(e){return n.isBidirectional?e.contact_id_a===r.assignment.client_id?e.contact_id_b:e.contact_id_a:e[n.targetContactFieldName]})})):a.resolve(null)}function L(e){var t=e.split("_"),n=t[0],s=t[1],a=Z[n],i=a.label_a_b===a.label_b_a,r=i||"a"===s?a.label_a_b:a.label_b_a;return{id:a.id,isBidirectional:i,sourceContactFieldName:"contact_id_"+t[1],targetContactFieldName:"contact_id_"+t[2],label:r}}function R(){return e.values(r.relationshipMissingWarnings).length>0}function N(){var n=!!u.tabEnabled.documents,s=e.indexBy(i.cache.documentType.arr,"value"),a=e.indexBy(i.cache.taskType.arr,"value");r.$watch("activity.activitySet",function(e){if(!e||!e.activityTypes)return void(r.taskList=[]);r.documentList=[],r.taskList=[],e.activityTypes.forEach(function(e){var i=t.copy(ee),o=s[e.name],c=a[e.name];i.name=e.name,i.offset=e.reference_offset,o&&n?(i.activity_type_id=o.key,r.documentList.push(i)):o||(i.activity_type_id=c?c.key:null,r.taskList.push(i))}),F().then(B)})}function P(){var t=i.$watch("cache.assignmentType.obj",function(n){e.isEmpty(n)||(W(),t())},!0)}function F(){return r.activity.activitySet.activityTypes?(r.relationshipMissingWarnings={},a.resolve(x()).then(z).then(K)):a.resolve()}function H(){J={},e.forEach(h,function(e){J[e.name]=e.value})}function U(){return k.all({options:{limit:0}}).then(function(t){Z=e.indexBy(t.list,"id")})}function q(){N(),P()}function B(){var t=e.chain(r.taskList).concat(r.documentList).map(function(e){return e.assignee_contact_id}).flatten().compact().uniq().value();if(0!==t.length)return v.get({IN:t}).then(function(t){var n=e.map(t,function(e){return{id:e.contact_id,label:e.display_name}});r.contacts.task=r.taskList.map(function(){return n}),r.contacts.document=r.documentList.map(function(){return n})})}function V(){r.assignment.client_id=r.assignment.contact_id,F().then(B)}function Y(e,t,n){e&&v.search(e,{contact_type:"Individual"}).then(function(e){"target"===t?r.contacts[t]=e:r.contacts[t][n]=e})}function G(e,t){e&&e.splice(t,1)}function W(){var e=i.cache.assignmentType.obj[r.assignment.case_type_id];if(!e)return r.activity.activitySet={},void(r.assignment.subject="");r.activity.activitySet=e.definition.activitySets[0],r.assignment.subject=i.cache.assignmentType.obj[r.assignment.case_type_id].title,r.assignment.dueDate=r.assignment.dueDate||new Date((new Date).setHours(0,0,0,0))}function z(e){var t=e.map(function(e){return j(e.type).then(function(t){return e.activity.assignee_contact_id=t,e})});return a.all(t)}function K(t){var n;r.assignment.client_id&&(n=M(t),r.relationshipMissingWarnings=e.chain(n).map(function(e){var t=L(e.type.default_assignee_relationship);return{activity_type_id:e.activity.activity_type_id,relationshipLabel:t.label}}).indexBy("activity_type_id").mapValues("relationshipLabel").value())}function X(e){r.activity.activitySet=e}function Q(t){var n=[];if(!t.contact_id&&n.push("Target Contact"),!t.case_type_id&&n.push("Assignment type"),!t.dueDate&&n.push("Key date"),r.taskList.filter(function(e){return e.create}).forEach(function(t){e.includes(n,"Activity type")||!t.activity_type_id&&n.push("Activity type"),e.includes(n,"Activity Due Date")||!t.activity_date_time&&n.push("Activity Due Date")}),n.length){var s=CRM.alert(n.join(", "),1===n.length?"Required field":"Required fields","error");return o(function(){s.close(),s=null},5e3),!1}return!0}s.debug("Controller: ModalAssignmentController");var J,Z={},ee={activity_type_id:null,assignee_contact_id:[],case_id:null,create:!0,isAdded:!1,name:null,source_contact_id:d.LOGGED_IN_CONTACT_ID,status_id:"1",offset:0};r.assignment=t.copy(p),r.assignment.status_id="1",r.assignment.contact_id=d.CONTACT_ID,r.assignment.client_id=r.assignment.contact_id,r.assignment.subject="",r.assignment.dueDate=null,r.copyMessage="Click here to copy the value in row one to all rows.",r.documentList=[],r.dpOpened={},r.format=l.DATE_FORMAT.toLowerCase(),r.loading={component:!1},r.relationshipMissingWarnings={},r.showCId=!d.CONTACT_ID,r.taskList=[],r.workflowActivityTypes=function(){var e="custom_"+d.customFieldIds["caseType.category"];return i.cache.assignmentType.arr.filter(function(t){return"Workflow"===t[e]})}(),r.activity={activitySet:{}},r.alert={show:!1,msg:"",type:"danger"},r.contacts={target:[],document:[],task:[]},r.addActivity=b,r.cacheContact=C,r.cancel=$,r.confirm=w,r.copyAssignee=D,r.copyDate=T,r.createRelationshipForTargetContact=S,r.dpOpen=E,r.hasRelationshipWarnings=R,r.onTargetContactChange=V,r.refreshContacts=Y,r.removeActivity=G,r.setData=W,r.updateTimeline=X,function(){r.loading.component=!0,U().then(H).then(q).finally(function(){r.loading.component=!1})}()}return s.__name="ModalAssignmentController",s.$inject=["$filter","$log","$q","$rootScope","$scope","$timeout","$uibModalInstance","HR_settings","config","settings","assignmentService","taskService","documentService","contactService","data","defaultAssigneeOptions","session","RelationshipModel","RelationshipType"],s}),define("tasks-assignments/controllers/modal/modal-dialog.controller",[],function(){"use strict";function e(e,t,n,s,a){function i(){s.close(!1)}function r(e){s.close(e||!0)}e.debug("Controller: ModalDialogController"),t.copyCancel=a.copyCancel||"Cancel",t.copyConfirm=a.copyConfirm||"Yes",t.msg=a.msg||"",t.title=a.title||"CiviHR Tasks & Workflows",t.confirm=r,t.cancel=i}return e.__name="ModalDialogController",e.$inject=["$log","$scope","$timeout","$uibModalInstance","content"],e}),define("tasks-assignments/controllers/modal/modal-document.controller",["common/angular","common/lodash","common/moment","common/services/file.service","common/services/notification.service"],function(e,t,n){"use strict";function s(s,a,i,r,o,c,l,d,u,m,f,g,v,p,h,_,y,k,b,C,$,w,D,T,S){function E(e){-1===re.document.assignee_contact_id.indexOf(e.id)&&re.document.assignee_contact_id.push(e.id),re.cacheContact(e)}function A(e,t,n){return e+=(e.split("?")[1]?"&":"?")+t+"="+n}function x(e){var t={};e&&!o.cache.assignment.obj[e.id]&&(t[e.id]={case_type_id:s("filter")(o.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},_.updateCache(t))}function M(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},y.updateCache(t)}function j(){if(re.documentForm.$pristine&&e.equals(S,re.files)&&!re.uploader.queue.length)return void f.dismiss("cancel");u.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(c.$broadcast("ct-spinner-hide"),f.dismiss("cancel"))})}function O(){re.contacts={target:V("target"),assignee:V("assignee")}}function I(){re.assignments=s("filter")(o.cache.assignment.arrSearch,function(e){return+e.extra.contact_id==+re.document.target_contact_id})}function L(){var t=e.copy(re.document);if(ne(t)){if(e.equals(T,t)&&e.equals(S,re.files)&&!re.uploader.queue.length)return void f.dismiss("cancel");var n,s=[];if(re.isRole("staff")&&!re.uploader.queue.length&&!re.files.length)return void(re.containsFiles=!1);if(te(re.uploader.queue)){if(c.$broadcast("ct-spinner-show"),+t.case_id==+T.case_id&&delete t.case_id,t.activity_date_time=re.parseDate(t.activity_date_time)||"",t.expire_date=re.parseDate(t.expire_date),t.status_id=re.getDocumentStatus()||re.document.status_id,re.filesTrash.length)for(var a=0;a<re.filesTrash.length;a++)n=re.filesTrash[a],s.push(b.delete(n.fileID,n.entityID,n.entityTable));i.all({document:k.save(t),files:s.length?i.all(s):[]}).then(function(e){if(re.uploader.queue.length){var t=m.open({appendTo:r.find("div").eq(0),templateUrl:p.path.TPL+"/modal/progress.html?v=1",size:"sm",controller:"ModalProgressController",resolve:{uploader:function(){return re.uploader},entityId:function(){return e.document.id}}});return e.files=t.result,i.all(e)}return e}).then(function(e){re.document.case_id=e.document.case_id,re.document.file_count=re.files.length+re.uploader.queue.length,re.document.id=e.document.id,re.document.status_id=e.document.status_id,_.updateTab(),f.close(re.document),o.$broadcast("document-saved"),c.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),f.dismiss(),c.$broadcast("ta-spinner-hide"),i.reject()})}}}function R(e,t){e.preventDefault(),e.stopPropagation(),re.dpOpened[t]=!0}function N(){l(function(){document.getElementById(o.prefix+"document-files").click()})}function P(e){re.filesTrash.push(re.files[e]),re.files.splice(e,1)}function F(){re.document.activity_date_time=re.document.activity_date_time?n(re.document.activity_date_time).toDate():null,re.document.expire_date=re.document.expire_date?n(re.document.expire_date).toDate():null,re.document.assignee_contact_id=re.document.assignee_contact_id||[],re.document.source_contact_id=re.document.source_contact_id||p.LOGGED_IN_CONTACT_ID,re.document.status_id=re.document.status_id||"1",re.document.target_contact_id=re.document.target_contact_id||[p.CONTACT_ID],re.document.valid_from=re.document.valid_from?n(re.document.valid_from).toDate():null}function H(){h.get(["maxFileSize"]).then(function(e){re.fileSizeLimit=1e6*+e[0].maxFileSize})}function U(){return re.isRole("admin")?re.files.length||re.uploader.queue.length?re.getStatusIdByName("approved"):re.getStatusIdByName("awaiting upload"):re.files.length||re.uploader.queue.length?re.getStatusIdByName("awaiting approval"):re.getStatusIdByName("awaiting upload")}function q(e){return t.findKey(o.cache.documentStatus.obj,function(t){return t===e})}function B(e){var n=t.find(o.cache.documentType.arr,function(t){return t.key===e});return n&&n.value}function V(e){var t=o.cache.contact.arrSearch;return re.document.id||"edit"!==w?t.filter(function(t){return+re.document[e+"_contact_id"][0]==+t.id}):[]}function Y(e){return re.role===e}function G(e){o.$broadcast("ct-spinner-show"),re.document.case_id="",re.cacheContact(e),re.searchContactAssignments(e.id)}function W(e){e instanceof Date&&(e=e.getTime());var t=n(e,[v.DATE_FORMAT.toUpperCase(),"x","YYYY-MM-DD"]);return t.isValid()?t.format("YYYY-MM-DD"):null}function z(e){re.document.assignee_contact_id.splice(e,1)}function K(e){if(e){var t=re.document.target_contact_id;_.search(e,re.document.case_id).then(function(e){re.assignments=s("filter")(e,function(e){return+e.extra.contact_id==+t})})}}function X(e,t){e&&y.search(e,{contact_type:"Individual"}).then(function(e){re.contacts[t]=e})}function Q(){CRM.help("Remind me?",re.remindMeMessage,"error")}function J(e){return _.search(null,null,e).then(function(e){re.assignments=e,o.$broadcast("ct-spinner-hide")})}function Z(){re.document.status_id=1}function ee(){return!!re.document.status_id}function te(e){var n="Files larger than "+re.fileSizeLimit/1e6+"MB are not allowed.",s=!0;return e.length&&t.each(e,function(e){+e._file.size>=re.fileSizeLimit&&(s=!1)}),!s&&$.alert("Large files",n,{expires:5e3}),s}function ne(e){var t=[];if(e.target_contact_id[0]||t.push("Contact"),e.activity_type_id||t.push("Document type"),e.status_id||t.push("Document status"),e.status_id||t.push("Status"),t.length){var n=1===t.length?"Required field":"Required fields",s=t.join(", ");return $.alert(n,s,{expires:5e3}),!1}return!0}function se(e){o.$broadcast("ct-spinner-show"),C.openFile(e).then(function(e){o.$broadcast("ct-spinner-hide")})}function ae(){o.$watch("cache.contact.arrSearch",O)}function ie(){g.loadForm("/civicrm/admin/options/activity_type?reset=1").on("crmUnload",function(){k.getOptions().then(function(t){e.extend(o.cache,t)})})}a.debug("Controller: ModalDocumentController");var re=this;re.document={},re.files=[],re.fileSizeLimit=0,re.filesTrash=[],re.mode=w,re.modalTitle="edit"===re.mode?"Edit Document":"New Document",re.containsFiles=!0,re.remindMeMessage='Checking this box sets a reminder that this document needs to be renewed a set number of days before the Expiry Date. You can set this by going <a target="_blank" href="/civicrm/tasksassignments/settings">here</a> CiviHR will do this by creating a copy of this document with the status ‘awaiting upload’, which you will be able to see in your Documents list.',re.role=D||"admin",re.showCId=!p.CONTACT_ID,re.uploader=b.uploader("civicrm_activity"),re.dpOpened={due:!1,exp:!1,form:!1},re.addAssignee=E,re.addQueryParam=A,re.cacheAssignment=x,re.cacheContact=M,re.cancel=j,re.confirm=L,re.dpOpen=R,re.dropzoneClick=N,re.fileMoveToTrash=P,re.getDocumentType=B,re.getDocumentStatus=U,re.getStatusIdByName=q,re.isRole=Y,re.onContactChanged=G,re.parseDate=W,re.removeAssignee=z,re.refreshAssignments=K,re.refreshContacts=X,re.remindMeInfo=Q,re.statusFieldVisible=ee,re.showStatusField=Z,re.searchContactAssignments=J,re.viewFile=se,re.openActivityTypeOptionsEditor=ie,function(){e.copy(T,re.document),e.copy(S,re.files),I(),F(),O(),ae(),H()}()}return s.__name="ModalDocumentController",s.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$window","$dialog","$uibModal","$uibModalInstance","crmAngService","HR_settings","config","appSettingsService","assignmentService","contactService","documentService","fileServiceTA","fileService","notificationService","modalMode","role","data","files"],s}),define("tasks-assignments/controllers/modal/modal-progress.controller",[],function(){"use strict";function e(e,t,n,s,a,i,r,o){function c(){a.dismiss("File upload canceled")}e.debug("Controller: ModalProgressController"),n.uploader=r,n.cancel=c,function(){r.queue.length&&(r.item=r.queue[0].file.name),r.onProgressItem=function(e){this.item=e.file.name},i.upload(r,o).then(function(e){s(function(){a.close(e)},500)})}()}return e.__name="ModalProgressController",e.$inject=["$log","$q","$scope","$timeout","$uibModalInstance","fileServiceTA","uploader","entityId"],e}),define("tasks-assignments/controllers/modal/modal-reminder.controller",["common/angular"],function(e){"use strict";function t(t,n,s,a,i,r,o,c,l,d,u,m){function f(){o.dismiss("cancel")}function g(){i.$broadcast("ct-spinner-show"),("task"===m?l:c).sendReminder(i.data.id,i.reminder.notes).then(function(){CRM.alert("Message sent to: "+a.cache.contact.obj[i.data.assignee_contact_id[0]].sort_name,"Reminder sent","success"),o.close(),i.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),o.dismiss(),i.$broadcast("ta-spinner-hide"),s.reject()})}n.debug("Controller: ModalReminderController"),i.data={},i.type=m,e.copy(u,i.data),i.reminder={},i.data.assignee_contact_id=i.data.assignee_contact_id||[],i.data.target_contact_id=i.data.target_contact_id||[d.CONTACT_ID],i.contacts=a.cache.contact.arrSearch,i.showCId=!d.CONTACT_ID,i.cancel=f,i.confirm=g}return t.__name="ModalReminderController",t.$inject=["$filter","$log","$q","$rootScope","$scope","$dialog","$uibModalInstance","documentService","taskService","config","data","type"],t}),define("tasks-assignments/controllers/modal/modal-task-migrate.controller",["common/angular"],function(e){"use strict";function t(t,n,s,a,i,r,o,c,l,d,u,m,f,g,v,p,h){function _(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},m.updateCache(t)}function y(){if(r.taskMigrateForm.$pristine)return void l.dismiss("cancel");d.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(r.$broadcast("ct-spinner-hide"),l.dismiss("cancel"))})}function k(){if(r.migrate.task.statusListSelected||r.migrate.document.statusListSelected){var t,n=[],a=[],o=0;e.forEach(r.migrate.task.list,function(e){r.migrate.task.statusListSelected.indexOf(e.status_id)>-1&&this.push(e)},n),+h.tabEnabled.documents&&e.forEach(r.migrate.document.list,function(e){r.migrate.document.statusListSelected.indexOf(e.status_id)>-1&&this.push(e)},n),r.$broadcast("ct-spinner-show"),e.forEach(n,function(n){n.assignee_contact_id[0]=r.migrate.to,this.push(function(){var a=s.defer();return t=o?this[o-1]:{},s.when(t).then(function(){v.save({entity:"Activity",action:"create",json:e.extend({sequential:"1",component:""},n)},null,function(e){g.errorHandler(e,"Unable to save task",a)||a.resolve(1===e.values.length?e.values[0]:null)},function(){a.reject("Unable to save task")})}),a.promise}.bind(this)()),o++},a),s.all(a).then(function(e){e.length?CRM.alert(e.length+" item(s) re-assigned from: "+i.cache.contact.obj[r.migrate.from].sort_name+" to: "+i.cache.contact.obj[r.migrate.to].sort_name,"Migrate Tasks","success"):CRM.alert("0 items re-assigned.","Migrate Tasks","warning"),l.dismiss(),r.$broadcast("ct-spinner-hide")},function(e){CRM.alert(e,"Error","error"),l.dismiss(),r.$broadcast("ct-spinner-hide")})}}function b(n){r.$broadcast("ct-spinner-show"),n=n||r.migrate.from,r.migrate.task.statusList=[],r.migrate.task.statusListSelected=[],r.migrate.document.statusList=[],r.migrate.document.statusListSelected=[],r.migrate.dataLoaded=!1;var s=[];v.get({entity:"ActivityContact",json:{component:"",sequential:"1",return:"activity_id",contact_id:n,record_type_id:"1",options:{limit:"0"}}},function(n){n.values&&n.values.length?(e.forEach(n.values,function(e){this.push(e.activity_id)},s),v.get({entity:"Activity",json:{component:"",options:{limit:0},id:{IN:s},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"assignee_contact_id, activity_type_id, assignee_contact_id, id, status_id"}},function(n){function s(e,t){var n=r.migrate[e];n.list.push(t),n.statusList.indexOf(t.status_id)>-1||(o[e].indexOf(t.status_id)>-1?n.statusList.push(t.status_id):(n.statusList.unshift(t.status_id),n.statusListSelected.push(t.status_id)))}var a=i.cache.documentType.obj,o={task:i.cache.taskStatusResolve,document:i.cache.documentStatusResolve};n.values&&n.values.length&&(n.values=t("orderBy")(n.values,"-status_id"),e.forEach(n.values,function(e){a[e.activity_type_id]?s("document",e):s("task",e)})),r.migrate.dataLoaded=!0,r.$broadcast("ct-spinner-hide")})):(r.migrate.dataLoaded=!0,r.$broadcast("ct-spinner-hide"))})}function C(e){e&&m.search(e,{contact_type:"Individual"}).then(function(e){r.contacts=e})}n.debug("Controller: ModalTaskMigrateController"),r.contacts=i.cache.contact.arrSearch,r.migrate={},r.migrate.dataLoaded=!1,r.migrate.from="",r.migrate.to="",r.migrate.document={list:[],statusList:[],statusListSelected:[]},r.migrate.task={list:[],statusList:[],statusListSelected:[]},r.cacheContact=_,r.cancel=y,r.confirm=k,r.getActivities=b,r.refreshContacts=C}return t.__name="ModalTaskMigrateController",t.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$uibModal","$uibModalInstance","$dialog","assignmentService","contactService","taskService","utilsService","Task","activityType","settings"],t}),define("tasks-assignments/controllers/modal/modal-task.controller",["common/angular","common/moment"],function(e,t){"use strict";function n(n,s,a,i,r,o,c,l,d,u,m,f,g,v,p,h,_){function y(e){if(!r.cache.assignment.obj[e.id]){var t={};t[e.id]={case_type_id:n("filter")(r.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},f.updateCache(t)}}function k(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},g.updateCache(t)}function b(){if(o.taskForm.$pristine)return void d.dismiss("cancel");u.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(o.$broadcast("ct-spinner-hide"),d.dismiss("cancel"))})}function C(){var t=e.copy(o.task);if(E(t)){if(e.equals(h,t))return void d.dismiss("cancel");o.$broadcast("ct-spinner-show"),+t.case_id==+h.case_id&&delete t.case_id,t.activity_date_time=t.activity_date_time||new Date,v.save(t).then(function(e){o.task.id=e.id,o.task.case_id=e.case_id,f.updateTab(),o.openNew&&(o.task.open=!0,o.openNew=!1),d.close(o.task),o.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),o.$broadcast("ct-spinner-hide"),a.reject()})}}function $(e){e.preventDefault(),e.stopPropagation(),o.dpOpened=!0}function w(e){var t=r.cache.contact.arrSearch;return o.task.id?t.filter(function(t){return+o.task[e+"_contact_id"][0]==+t.id}):[]}function D(){o.$watch("task.target_contact_id",function(e,t){e!==t&&(o.task.case_id=null,o.showFieldAssignment=!1,T(e))},!0)}function T(e){o.assignments=[],e[0]&&(c(function(){o.$broadcast("ct-spinner-show")},0),f.search(null,null,e).then(function(e){o.assignments=e,o.$broadcast("ct-spinner-hide")}))}function S(e,t){e&&g.search(e,{contact_type:"Individual"}).then(function(e){o.contacts[t]=e})}function E(e){var t=[];if(e.target_contact_id[0]||t.push("Task Target"),e.activity_type_id||t.push("Task type"),e.activity_date_time||t.push("Due date"),t.length){var n=CRM.alert(t.join(", "),1===t.length?"Required field":"Required fields","error");return c(function(){n.close(),n=null},5e3),!1}return!0}function A(){m.loadForm("/civicrm/admin/options/activity_type?reset=1").on("crmUnload",function(){v.getOptions().then(function(t){e.extend(r.cache,t)})})}s.debug("Controller: ModalTaskController"),o.assignments=[],o.format=p.DATE_FORMAT.toLowerCase(),o.data=h,o.showCId=!_.CONTACT_ID,o.showFieldAssignment=!1,o.task={},e.copy(h,o.task),o.modalTitle=o.task.id?"Edit Task":"New Task",o.task.activity_date_time=o.task.activity_date_time||t().toDate(),o.task.assignee_contact_id=o.task.assignee_contact_id||[],o.task.source_contact_id=o.task.source_contact_id||_.LOGGED_IN_CONTACT_ID,o.task.target_contact_id=o.task.target_contact_id||[_.CONTACT_ID],o.contacts={target:w("target"),assignee:w("assignee")},o.cacheAssignment=y,o.cacheContact=k,o.cancel=b,o.confirm=C,o.dpOpen=$,o.refreshContacts=S,o.task.openActivityTypeOptionsEditor=A,function(){D(),o.task.id&&T(o.task.target_contact_id)}()}return n.__name="ModalTaskController",n.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$uibModal","$uibModalInstance","$dialog","crmAngService","assignmentService","contactService","taskService","HR_settings","data","config"],n}),
define("tasks-assignments/modules/tasks-assignments.controllers",["common/angular","tasks-assignments/controllers/assignments.controller","tasks-assignments/controllers/calendar.controller","tasks-assignments/controllers/date-list.controller","tasks-assignments/controllers/document-list.controller","tasks-assignments/controllers/document.controller","tasks-assignments/controllers/external-page.controller","tasks-assignments/controllers/main.controller","tasks-assignments/controllers/settings.controller","tasks-assignments/controllers/task-list.controller","tasks-assignments/controllers/task.controller","tasks-assignments/controllers/dashboard/nav-main.controller","tasks-assignments/controllers/dashboard/top-bar.controller","tasks-assignments/controllers/modal/modal-assignment-activity.controller","tasks-assignments/controllers/modal/modal-assignment.controller","tasks-assignments/controllers/modal/modal-dialog.controller","tasks-assignments/controllers/modal/modal-document.controller","tasks-assignments/controllers/modal/modal-progress.controller","tasks-assignments/controllers/modal/modal-reminder.controller","tasks-assignments/controllers/modal/modal-task-migrate.controller","tasks-assignments/controllers/modal/modal-task.controller"],function(e,t,n,s,a,i,r,o,c,l,d,u,m,f,g,v,p,h,_,y,k){"use strict";return e.module("tasks-assignments.controllers",[]).controller(t.__name,t).controller(n.__name,n).controller(s.__name,s).controller(a.__name,a).controller(i.__name,i).controller(r.__name,r).controller(o.__name,o).controller(c.__name,c).controller(l.__name,l).controller(d.__name,d).controller(u.__name,u).controller(m.__name,m).controller(f.__name,f).controller(g.__name,g).controller(v.__name,v).controller(p.__name,p).controller(h.__name,h).controller(_.__name,_).controller(y.__name,y).controller(k.__name,k)}),define("tasks-assignments/vendor/angular-bootstrap-calendar",["common/moment"],function(e){"use strict";angular.module("mwl.calendar",[]),angular.module("mwl.calendar").run(["$templateCache",function(e){e.put("src/templates/calendar.html",'<div class="cal-context" ng-switch="view"><div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div><div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div><mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year"></mwl-calendar-year><mwl-calendar-month events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month"></mwl-calendar-month><mwl-calendar-week events="events" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week"></mwl-calendar-week><mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day"></mwl-calendar-day></div>'),e.put("src/templates/calendarCustom.html",'<div class="cal-context" ng-switch="view"> <div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div> <div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div> <mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year" ></mwl-calendar-year> <mwl-calendar-month events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month" ></mwl-calendar-month> <mwl-calendar-week events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week" ></mwl-calendar-week> <mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day" ></mwl-calendar-day></div>'),e.put("src/templates/calendarDayView.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.timeLabel"></div><div class="span11 col-xs-11 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.eventsLabel"></div></div><div class="cal-day-panel clearfix" ng-style="{height: (vm.hours.length * vm.hourHeight) + \'px\'}"><div class="cal-day-panel-hour"><div class="cal-day-hour" ng-repeat="hour in vm.hours track by $index"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><strong ng-bind="hour.label"></strong></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight" ng-class="\'dh-event-\' + event.type" ng-repeat="event in vm.view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title | calendarTruncateEventTitle:20:event.height"></span></a></div></div></div>'),e.put("src/templates/calendarMonthDay.html",'<div class="cal-month-day" ng-class="{\n            \'cal-day-outmonth\': !day.inMonth,\n            \'cal-day-inmonth\': day.inMonth,\n            \'cal-day-weekend\': day.isWeekend,\n            \'cal-day-past\': day.isPast,\n            \'cal-day-today\': day.isToday,\n            \'cal-day-future\': day.isFuture\n          }"><small class="cal-events-num badge badge-important pull-left" ng-show="day.badgeTotal > 0" ng-bind="day.badgeTotal"></small> <span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" ng-bind="day.label"></span><div class="cal-day-tick" ng-show="dayIndex === vm.openDayIndex && vm.view[vm.openDayIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div ng-include="\'src/templates/calendarMonthEventsList.html\'"></div></div>'),e.put("src/templates/calendarMonthDayCustom.html",'<div class="cal-month-day" ng-class="{ \'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture }"> <ul class="cal-list-events-num"> <li ng-show="day.badgeEventsTotal > 0"> <small class="badge badge-danger-light" ng-bind="day.badgeEventsTotal"></small> Tasks </li> <li ng-show="day.badgeDocumentsTotal > 0"> <small class="badge badge-dark" ng-bind="day.badgeDocumentsTotal"></small> Documents </li> </ul> <span class="pull-right" data-cal-date ng-bind="day.label"> </span></div>'),e.put("src/templates/calendarMonthEventsList.html",'<div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" ng-repeat="event in day.events track by $index" class="pull-left event" ng-class="\'event-\' + event.type" ng-mouseenter="vm.highlightEvent(event, true)" ng-mouseleave="vm.highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div>'),e.put("src/templates/calendarMonthView.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"><div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"><div class="cal-row-fluid cal-before-eventlist"><div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.dayClicked(day)" ng-class="{pointer: day.events.length > 0}"><div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openDayIndex].events.length > 0" events="vm.view[vm.openDayIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>'),e.put("src/templates/calendarMonthViewCustom.html",'<div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"> <div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"> <div class="cal-row-fluid cal-before-eventlist"> <div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="pointer cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.calendarCtrl.drillDown(day.date)"> <div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div> </div> </div> </div></div>'),e.put("src/templates/calendarSlideBox.html",'<div class="cal-slide-box" collapse="vm.shouldCollapse" mwl-collapse-fallback="vm.shouldCollapse"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in events track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title"></span> <span ng-show="isMonthView">(<span ng-bind="event.startsAt | date:\'shortTime\'"></span>)</span> <span ng-show="isYearView">(<span ng-bind="event.startsAt | date:\'MMM d, h:mm a\'"></span>)</span></a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="vm.$sce.trustAsHtml(editEventHtml)" ng-click="onEditEventClick({calendarEvent: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="vm.$sce.trustAsHtml(deleteEventHtml)" ng-click="onDeleteEventClick({calendarEvent: event})"></a></li></ul></div></div>'),e.put("src/templates/calendarWeekView.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{\n        \'cal-day-weekend\': day.isWeekend,\n        \'cal-day-past\': day.isPast,\n        \'cal-day-today\': day.isToday,\n        \'cal-day-future\': day.isFuture}"><span ng-bind="day.weekDayLabel"></span><br><small><span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"></span></small></div></div><div class="cal-row-fluid" ng-repeat="event in vm.view.events track by $index"><div ng-class="\'cal-cell\' + event.daySpan + \' cal-offset\' + event.dayOffset + \' day-highlight dh-event-\' + event.type" data-event-class><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"></a></div></div></div>'),e.put("src/templates/calendarWeekViewCustom.html",'<div class="cal-week-box"> <div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{ \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture}"> <span ng-bind="day.weekDayLabel"></span> <br> <small> <span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"> </span> </small> </div> </div> <div class="cal-col-fluid" ng-repeat="col in vm.view.cols track by $index"> <div class="cal-row-fluid" ng-repeat="event in col track by $index"> <div ng-if="event.title" ng-class="\'day-highlight dh-event-\' + event.type + \' dh-event-overdue-\' + event.overdue" data-event-class> <a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"> </a> </div> </div> </div></div>'),e.put("src/templates/calendarYearView.html",'<div class="cal-year-box"><div ng-repeat="rowOffset in [0, 4, 8] track by rowOffset"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in vm.view | calendarLimitTo:4:rowOffset track by $index" ng-init="monthIndex = vm.view.indexOf(month)" ng-click="vm.monthClicked(month)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(month.date)" ng-bind="month.label"></span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.badgeTotal > 0" ng-bind="month.badgeTotal"></small><div class="cal-day-tick" ng-show="monthIndex === vm.openMonthIndex && vm.view[vm.openMonthIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openMonthIndex].events.length > 0" events="vm.view[vm.openMonthIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>')}]),angular.module("mwl.calendar").constant("moment",e),angular.module("mwl.calendar").factory("calendarTitle",["moment","calendarConfig",function(e,t){function n(n){return e(n).format(t.titleFormats.day)}function s(n){return t.titleFormats.week.replace("{week}",e(n).week()).replace("{year}",e(n).format("YYYY"))}function a(n){return e(n).format(t.titleFormats.month)}function i(n){return e(n).format(t.titleFormats.year)}return{day:n,week:s,month:a,year:i}}]),angular.module("mwl.calendar").factory("calendarHelper",["moment","calendarConfig",function(e,t){function n(t,n,s,a){return t=e(t),n=e(n),s=e(s),a=e(a),t.isAfter(s)&&t.isBefore(a)||n.isAfter(s)&&n.isBefore(a)||t.isBefore(s)&&n.isAfter(a)||t.isSame(s)||n.isSame(a)}function s(t,s,a){var i=e(t).startOf(s),r=e(t).endOf(s);return a.filter(function(e){return n(e.startsAt,e.endsAt,i,r)})}function a(e){return e.filter(function(e){return!1!==e.incrementsBadgeTotal}).length}function i(){for(var n=[],s=0;s<7;)n.push(e().weekday(s++).format(t.dateFormats.weekDay));return n}function r(e,t,s){return e.filter(function(e){return n(e.startsAt,e.endsAt,t,s)})}function o(n,i){for(var o=[],c=s(i,"year",n),l=e(i).startOf("year"),d=0;d<12;){var u=l.clone(),m=u.clone().endOf("month"),f=r(c,u,m);o.push({label:u.format(t.dateFormats.month),isToday:u.isSame(e().startOf("month")),events:f,date:u,badgeTotal:a(f)}),l.add(1,"month"),d++}return o}function c(t,n,i){for(var o=s(i,"month",t),c=s(i,"month",n),l=e(i).startOf("month"),d=l.clone().startOf("week"),u=e(i).endOf("month").endOf("week"),m=[],f=e().startOf("day");d.isBefore(u);){var g=d.month()===e(i).month(),v=[],p=[];g&&(v=r(o,d,d.clone().endOf("day")),p=r(c,d,d.clone().endOf("day"))),m.push({label:d.date(),date:d.clone(),inMonth:g,isPast:f.isAfter(d),isToday:f.isSame(d),isFuture:f.isBefore(d),isWeekend:[0,6].indexOf(d.day())>-1,events:v,documents:p,badgeEventsTotal:a(v),badgeDocumentsTotal:a(p)}),d.add(1,"day")}return m}function l(n,s,a){for(var i=e(a).startOf("week"),o=e(a).endOf("week"),c=i.clone(),l=[],d=[],u=10,m=e().startOf("day");l.length<7;)d.push([]),l.push({weekDayLabel:c.format(t.dateFormats.weekDay),date:c.clone(),dayLabel:c.format(t.dateFormats.day),isPast:c.isBefore(m),isToday:c.isSame(m),isFuture:c.isAfter(m),isWeekend:[0,6].indexOf(c.day())>-1}),c.add(1,"day");var f=r(n.concat(s),i,o).map(function(t){var n,s,a=e(t.startsAt).startOf("day"),r=e(t.endsAt).startOf("day"),c=e(i).startOf("day"),l=e(o).startOf("day");return n=a.isBefore(c)||a.isSame(c)?0:a.diff(c,"days"),r.isAfter(l)&&(r=l),a.isBefore(c)&&(a=c),s=e(r).diff(a,"days")+1,t.daySpan=s,t.dayOffset=n,t.overdue=a.isBefore(m),d[n].push(t),t});return d.map(function(e){u=e.length>u?e.length:u}),d.map(function(e){if(e.length<u)for(var t=e.length;t<u;t++)e.push({})}),{days:l,events:f,cols:d,rowsMax:u}}function d(t,s,a,i,o){var c=e(s).startOf("day").add(a,"hours"),l=e(s).startOf("day").add(i,"hours"),d=(i-a+1)*o,u=o/60,m=[];return r(t,e(s).startOf("day").toDate(),e(s).endOf("day").toDate()).map(function(t){if(e(t.startsAt).isBefore(c)?t.top=0:t.top=e(t.startsAt).startOf("minute").diff(c.startOf("minute"),"minutes")*u-2,e(t.endsAt).isAfter(l))t.height=d-t.top;else{var n=t.startsAt;e(t.startsAt).isBefore(c)&&(n=c.toDate()),t.height=e(t.endsAt).diff(n,"minutes")*u}return t.top-t.height>d&&(t.height=0),t.left=0,t}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return m.forEach(function(s,a){var i=!0;s.forEach(function(t){(n(e.startsAt,e.endsAt,t.startsAt,t.endsAt)||n(t.startsAt,t.endsAt,e.startsAt,e.endsAt))&&(i=!1)}),i&&t&&(t=!1,e.left=150*a,m[a].push(e))}),t&&(e.left=150*m.length,m.push([e])),e})}return{getWeekDayNames:i,getYearView:o,getMonthView:c,getWeekView:l,getDayView:d}}]),angular.module("mwl.calendar").service("calendarDebounce",["$timeout",function(e){function t(t,n,s){var a;return function(){function i(){a=null,s||t.apply(r,o)}var r=this,o=arguments,c=s&&!a;e.cancel(a),a=e(i,n),c&&t.apply(r,o)}}return t}]),angular.module("mwl.calendar").provider("calendarConfig",function(){var e={hour:"ha",day:"D MMM",month:"MMMM",weekDay:"dddd"},t={day:"dddd D MMMM, YYYY",week:"Week {week} of {year}",month:"MMMM YYYY",year:"YYYY"},n={eventsLabel:"Events",timeLabel:"Time"},s=this;s.setDateFormats=function(t){return angular.extend(e,t),s},s.setTitleFormats=function(e){return angular.extend(t,e),s},s.setI18nStrings=function(e){return angular.extend(n,e),s},s.$get=function(){return{dateFormats:e,titleFormats:t,i18nStrings:n}}}),angular.module("mwl.calendar").filter("calendarTruncateEventTitle",function(){return function(e,t,n){return e?e.length>=t&&e.length/20>n/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").filter("calendarLimitTo",function(){return function(e,t,n){return t=Math.abs(Number(t))===1/0?Number(t):parseInt(t),isNaN(t)?e:(angular.isNumber(e)&&(e=e.toString()),angular.isArray(e)||angular.isString(e)?(n=!n||isNaN(n)?0:parseInt(n),n=n<0&&n>=-e.length?e.length+n:n,t>=0?e.slice(n,n+t):0===n?e.slice(t,e.length):e.slice(Math.max(0,n+t),n)):e)}}),angular.module("mwl.calendar").directive("mwlDateModifier",function(){return{restrict:"A",controller:["$element","$attrs","$scope","moment",function(e,t,n,s){function a(){angular.isDefined(t.setToToday)?n.date=new Date:angular.isDefined(t.increment)?n.date=s(n.date).add(1,n.increment).toDate():angular.isDefined(t.decrement)&&(n.date=s(n.date).subtract(1,n.decrement).toDate()),n.$apply()}e.bind("click",a),n.$on("$destroy",function(){e.unbind("click",a)})}],scope:{date:"=",increment:"=",decrement:"="}}}),angular.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,n){var s=e.$watch(t.mwlCollapseFallback,function(e){e?n.addClass("ng-hide"):n.removeClass("ng-hide")}),a=e.$on("$destroy",function(){a(),s()})}]}}]),angular.module("mwl.calendar").directive("mwlCalendarYear",function(){return{templateUrl:"src/templates/calendarYearView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var s=this,a=!0;e.$on("calendar.refreshView",function(){s.view=n.getYearView(e.events,e.currentDay),e.autoOpen&&a&&(a=!1,s.view.forEach(function(n){t(e.currentDay).startOf("month").isSame(n.date)&&s.monthClicked(n,!0)}))}),s.monthClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),s.openRowIndex=null;var a=s.view.indexOf(t);a===s.openMonthIndex?s.openMonthIndex=null:(s.openMonthIndex=a,s.openRowIndex=Math.floor(a/4))}}],controllerAs:"vm",link:function(e,t,n,s){e.vm.calendarCtrl=s}}}),angular.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"src/templates/calendarWeekViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{documents:"=",events:"=",currentDay:"=",onEventClick:"="},controller:["$scope","calendarHelper",function(e,t){var n=this;e.$on("calendar.refreshView",function(){n.view=t.getWeekView(e.events,e.documents,e.currentDay)})}],controllerAs:"vm",link:function(e,t,n,s){e.vm.calendarCtrl=s}}}),angular.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"src/templates/calendarSlideBox.html",replace:!0,controller:["$scope","$sce",function(e,t){var n=this;n.$sce=t;var s=e.$watch("isOpen",function(e){n.shouldCollapse=!e}),a=e.$on("$destroy",function(){a(),s()})}],controllerAs:"vm",require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,n,s){e.isMonthView=!!s[0],e.isYearView=!!s[1]},scope:{isOpen:"=",events:"=",onEventClick:"=",editEventHtml:"=",onEditEventClick:"=",deleteEventHtml:"=",onDeleteEventClick:"="}}}),angular.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"src/templates/calendarMonthViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",documents:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var s=this,a=!0;e.$on("calendar.refreshView",function(){s.weekDays=n.getWeekDayNames(),s.view=n.getMonthView(e.events,e.documents,e.currentDay);var i=Math.floor(s.view.length/7);s.monthOffsets=[];for(var r=0;r<i;r++)s.monthOffsets.push(7*r);e.autoOpen&&a&&(a=!1,s.view.forEach(function(n){n.inMonth&&t(e.currentDay).startOf("day").isSame(n.date)&&s.dayClicked(n,!0)}))}),s.dayClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),s.openRowIndex=null;var a=s.view.indexOf(t);a===s.openDayIndex?s.openDayIndex=null:(s.openDayIndex=a,s.openRowIndex=Math.floor(a/7))},s.highlightEvent=function(e,t){s.view.forEach(function(n){if(delete n.highlightClass,t){n.events.indexOf(e)>-1&&(n.highlightClass="day-highlight dh-event-"+e.type)}})}}],controllerAs:"vm",link:function(e,t,n,s){e.vm.calendarCtrl=s}}}),angular.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"src/templates/calendarDayView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",dayViewStart:"=",dayViewEnd:"=",dayViewSplit:"="},controller:["$scope","$timeout","moment","calendarHelper","calendarConfig",function(e,t,n,s,a){function i(){r=n(e.dayViewStart||"00:00","HH:mm"),o=n(e.dayViewEnd||"23:00","HH:mm"),c.dayViewSplit=parseInt(e.dayViewSplit),c.hourHeight=60/e.dayViewSplit*30,c.hours=[];for(var t=n(r),s=0;s<=o.diff(r,"hours");s++)c.hours.push({label:t.format(a.dateFormats.hour)}),t.add(1,"hour")}var r,o,c=this;c.calendarConfig=a;var l=n.locale();e.$on("calendar.refreshView",function(){l!==n.locale()&&(l=n.locale(),i()),c.view=s.getDayView(e.events,e.currentDay,r.hours(),o.hours(),c.hourHeight)}),i()}],controllerAs:"vm"}}),angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"src/templates/calendarCustom.html",restrict:"EA",scope:{events:"=",documents:"=",view:"=",viewTitle:"=",currentDay:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onEventClick:"&",onEditEventClick:"&",onDeleteEventClick:"&",onTimespanClick:"&",onDrillDownClick:"&",dayViewStart:"@",dayViewEnd:"@",dayViewSplit:"@"},controller:["$scope","$timeout","moment","calendarTitle","calendarDebounce",function(e,t,n,s,a){var i=this;e.events=e.events||[],e.documents=e.documents||[],i.changeView=function(t,n){e.view=t,e.currentDay=n},i.drillDown=function(t){var s=n(t).toDate(),a={year:"month",month:"day",week:"day"};!1!==e.onDrillDownClick({calendarDate:s,calendarNextView:a[e.view]})&&i.changeView(a[e.view],s)};var r=n(e.currentDay),o=angular.copy(e.view),c=a(function(){s[e.view]&&(e.viewTitle=s[e.view](e.currentDay));var t=n(e.currentDay),a=!0;r.clone().startOf(e.view).isSame(t.clone().startOf(e.view))&&!r.isSame(t)&&e.view===o&&(a=!1),r=t,o=angular.copy(e.view),a&&e.$broadcast("calendar.refreshView")},50),l=e.$watch(function(){return n.locale()},c),d=[];d.push(l),d.push(e.$watch("currentDay",c)),d.push(e.$watch("view",c)),d.push(e.$watch("events",c,!0)),d.push(e.$watch("documents",c,!0));var u=e.$on("$destroy",function(){d.forEach(function(e){e()})});d.push(u)}]}})}),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,t){function n(e,t,n){if(angular.isArray(e))for(var s=e.length;s--;)if(n(e[s],t))return!0;return!1}function s(e,t,s){return e=angular.isArray(e)?e:[],n(e,t,s)||e.push(t),e}function a(e,t,n){if(angular.isArray(e))for(var s=e.length;s--;)if(n(e[s],t)){e.splice(s,1);break}return e}function i(i,r,o){function c(e,t){i.checked=n(e,m,f)}t(r)(i);var l=e(o.checklistModel),d=l.assign,u=e(o.checklistChange),m=e(o.checklistValue)(i.$parent),f=angular.equals;o.hasOwnProperty("checklistComparator")&&(f=e(o.checklistComparator)(i.$parent)),i.$watch("checked",function(e,t){if(e!==t){var n=l(i.$parent);!0===e?d(i.$parent,s(n,m,f)):d(i.$parent,a(n,m,f)),u&&u(i)}}),angular.isFunction(i.$parent.$watchCollection)?i.$parent.$watchCollection(o.checklistModel,c):i.$parent.$watch(o.checklistModel,c,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if("INPUT"!==e[0].tagName||"checkbox"!==t.type)throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!t.checklistValue)throw"You should provide `checklist-value`.";return e.removeAttr("checklist-model"),e.attr("ng-model","checked"),i}}}]),define("tasks-assignments/modules/tasks-assignments.values",["common/angular"],function(e){"use strict";e.module("tasks-assignments.values",[]).value("settings",{tabEnabled:{documents:CRM.tasksAssignments.settings.documents_tab,keyDates:CRM.tasksAssignments.settings.keydates_tab},extEnabled:{assignments:CRM.tasksAssignments.case_extension},copy:{button:{assignmentAdd:CRM.tasksAssignments.settings.add_assignment_button_title}},isTaskDashboardDefault:CRM.tasksAssignments.settings.is_task_dashboard_default,daysToCreateADocumentClone:parseInt(CRM.tasksAssignments.settings.days_to_create_a_document_clone)})}),define("tasks-assignments/modules/tasks-assignments.core",["common/angular","common/angulartics","common/angulartics-google-tag-manager","common/ui-select","common/models/option-group","common/models/relationship.model","common/models/relationship-type.model","common/models/session.model","common/modules/xeditable-civi","common/modules/routers/compu-ui-router","common/directives/angular-date/date-input","common/directives/help-text.directive","common/directives/prevent-animations","common/directives/loading","common/filters/angular-date/format-date","common/services/angular-date/date-format","common/services/before-hash-query-params.service","common/services/crm-ang.service","tasks-assignments/vendor/angular-bootstrap-calendar","tasks-assignments/vendor/angular-checklist-model","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.values"],function(e){"use strict";e.module("tasks-assignments.core",["ngAnimate","ngResource","ngSanitize","angularFileUpload","angulartics","angulartics.google.tagmanager","mwl.calendar","textAngular","ui.select","xeditable","xeditable-civi","checklist-model","common.angularDate","common.directives","common.models","compu.ui.router"])}),define("tasks-assignments/directives/civi-events.directive",[],function(){"use strict";function e(e,t){function n(t){CRM.$(document).on("crmFormSuccess",function(n,s){e.debug("crmFormSuccess"),e.debug(s),t.$broadcast("crmFormSuccess",s)}),CRM.$(document).on("crmFormSubmit",function(n,s){e.debug("crmFormSubmit"),e.debug(s),t.$broadcast("crmFormSubmit",s)}),CRM.$(document).on("crmFormCancel",function(n,s){e.debug("crmFormCancel"),e.debug(s),t.$broadcast("crmFormCancel",s)})}return e.debug("Directive: ctCiviEvents"),{link:n}}return e.__name="ctCiviEvents",e.$inject=["$log","$rootScope"],e}),define("tasks-assignments/directives/iframe.directive",[],function(){"use strict";function e(e,t){function n(e,n,s){var a=n[0];a.addEventListener("load",function(){var e,i=window.frames[s.name].document,r=["branding","toolbar","civicrm-menu","civicrm-footer","access"],o=0,c=r.length;for(o;o<c;o++)(e=i.getElementById(r[o]))&&(e.style.display="none");i.body.style.paddingTop="10px",a.height=i.body.scrollHeight+"px",n.addClass("ct-iframe-ready"),t.$broadcast("iframe-ready")})}return e.debug("Directive: taIframe"),{link:n}}return e.__name="taIframe",e.$inject=["$log","$rootScope"],e}),define("tasks-assignments/directives/sidebar-filters.directive",[],function(){"use strict";function e(e,t){return e.debug("Directive: sidebarFilters"),{restrict:"E",scope:!0,transclude:!0,templateUrl:t.path.TPL+"directives/sidebar-filters.html"}}return e.__name="sidebarFilters",e.$inject=["$log","config"],e}),define("tasks-assignments/directives/spinner.directive",[],function(){"use strict";function e(e,t){function n(e,n,s){function a(){i()||(n.css("position","relative"),l=!0),n.append(c),d=!0}function i(){var e=window.getComputedStyle(n[0]).position;return"relative"===e||"absolute"===e||"fixed"===e}function r(){d&&c.parentNode.removeChild(c),d=!1,l&&n.css("position","")}var o,c=document.createElement("div"),l=!1,d=!1;c.className="ct-spinner-cover spinner",void 0!==s.ctSpinnerShow&&a(),void 0!==s.ctSpinnerMainView&&(c.className="ct-spinner-cover",o=document.createElement("div"),o.className="ct-spinner spinner",t.$on("$stateChangeStart",function(){a(),document.body.appendChild(o)}),t.$on("$stateChangeSuccess",function(){r(),o.parentNode.removeChild(o)}),t.$on("$stateChangeError",function(){r(),o.parentNode.removeChild(o)})),e.$on("ct-spinner-show",function(e,t){(!t||s.ctSpinnerId&&s.ctSpinnerId===t)&&a()}),e.$on("ct-spinner-hide",function(e,t){(!t||s.ctSpinnerId&&s.ctSpinnerId===t)&&r()})}return e.debug("Directive: ctSpinner"),{link:n}}return e.__name="ctSpinner",e.$inject=["$log","$rootScope"],e}),define("tasks-assignments/directives/validate.directive",["common/angular"],function(e){"use strict";function t(t){function n(t,n,s,a){function i(e){n.toggleClass("has-error",e),m.toggleClass("glyphicon-remove",e)}function r(e,t){n.toggleClass("has-success",!e&&!t),m.toggleClass("glyphicon-ok",!e&&!t)}function o(e,t){n.toggleClass("has-warning",!e&&t),m.toggleClass("glyphicon-warning-sign",!e&&t)}
var c=n[0].querySelector("[name]"),l=e.element(c),d=l.attr("name"),u=document.createElement("span"),m=e.element(u);d&&(n.addClass("has-feedback"),m.addClass("glyphicon form-control-feedback"),l.after(m),t.$watch(function(){return a[d]&&a[d].$invalid},function(e){a[d].$dirty&&(r(e,t.isWarning),i(e))}),void 0!==t.isWarning&&t.$watch("isWarning",function(e){var t=a[d].$invalid;a[d].$dirty&&(r(t,e),o(t,e))}),l.bind("blur",function(){i(a[d].$invalid)}))}return t.debug("Directive: taValidate"),{restrict:"A",require:"^form",link:n,scope:{isWarning:"=?taValidateWarning"}}}return t.__name="taValidate",t.$inject=["$log"],t}),define("tasks-assignments/modules/tasks-assignments.directives",["common/angular","tasks-assignments/directives/civi-events.directive","tasks-assignments/directives/iframe.directive","tasks-assignments/directives/sidebar-filters.directive","tasks-assignments/directives/spinner.directive","tasks-assignments/directives/validate.directive"],function(e,t,n,s,a,i){"use strict";return e.module("tasks-assignments.directives",[]).directive(t.__name,t).directive(n.__name,n).directive(s.__name,s).directive(a.__name,a).directive(i.__name,i)}),define("tasks-assignments/filters/assignment-type.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByAssignmentType"),function(e,n){var s,a=t.cache.assignment.obj,i=n.length,r=[],o=0,c=e.length;if(!c||!i)return e;for(o;o<c;o++)(s=a[e[o].case_id])&&-1!==n.indexOf(s.case_type_id)&&r.push(e[o]);return r}}return e.__name="filterByAssignmentType",e.$inject=["$filter","$rootScope","$log"],e}),define("tasks-assignments/filters/contact-id.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByContactId"),function(e,t){var n=[],s=0,a=e.length;if(!a||!t||"number"!=typeof+t)return e;for(s;s<a;s++)+e[s].assignee_contact_id[0]!=+t&&+e[s].source_contact_id!=+t&&+e[s].target_contact_id!=+t||n.push(e[s]);return n}}return e.__name="filterByContactId",e.$inject=["$filter","config","$log"],e}),define("tasks-assignments/filters/date-field.filter",[],function(){"use strict";function e(e,t){function n(e,t,n){return null!==e&&e>=t&&(e<=n||null===n)||null===e&&null===n}return t.debug("Filter: filterByDateField"),function(e,t,s,a){if(!e)return null;var i=new Date,r=[],o=0,c=e.length,l=i.setHours(0,0,0,0);if(!s)throw new Error("Field name to filter a list is required");if(!c||!t)return e;switch(t){case"overdue":var d;for(o;o<c;o++)d=null,e[o][s]&&(d=new Date(e[o][s]).setHours(0,0,0,0)),d<l&&null!==d&&r.push(e[o]);break;case"dateRange":if(!a||"object"!=typeof a)return e;var u,m=a.from?new Date(a.from).setHours(0,0,0,0):null,f=a.until?new Date(a.until).setHours(0,0,0,0):null;for(o;o<c;o++)u=e[o][s]?new Date(e[o][s]).setHours(0,0,0,0):null,n(u,m,f)&&r.push(e[o]);break;case"dueToday":for(o;o<c;o++)new Date(e[o][s]).setHours(0,0,0,0)===l&&r.push(e[o]);break;case"dueThisWeek":var g=new Date,v=g.getDay(),p=g.getDate()-v+(0===v?-6:1),h=new Date(g.setDate(p)),_=new Date(g.setDate(h.getDate()+7));for(o;o<c;o++)(u=new Date(e[o][s]).setHours(0,0,0,0))>l&&u>=h.setHours(0,0,0,0)&&u<_.setHours(0,0,0,0)&&r.push(e[o]);break;case"dueInNextFortnight":var y=i.setDate(i.getDate()+14);for(o;o<c;o++)new Date(e[o][s]).setHours(0,0,0,0)>=l&&new Date(e[o][s]).setHours(0,0,0,0)<=y&&r.push(e[o]);break;case"dueInNinetyDays":var k=i.setDate(i.getDate()+90);for(o;o<c;o++)new Date(e[o][s]).setHours(0,0,0,0)>=l&&new Date(e[o][s]).setHours(0,0,0,0)<=k&&r.push(e[o])}return r}}return e.__name="filterByDateField",e.$inject=["$filter","$log"],e}),define("tasks-assignments/filters/date-parse.filter",["common/moment"],function(e){"use strict";function t(t,n){return n.debug("Filter: dateParse"),function(t){return e(t).toDate()}}return t.__name="dateParse",t.$inject=["$filter","$log"],t}),define("tasks-assignments/filters/date-type.filter",["common/lodash"],function(e){"use strict";function t(t,n,s){return s.debug("Filter: filterBy.dateType"),function(t,n){var s=[];return t.length&&n.length?(e.forEach(t,function(t){var a=t.dateContactList;a?e.forEach(a,function(e){if(-1!==n.indexOf(e.type))return s.push(t),!1}):-1!==n.indexOf(t.type)&&s.push(t)}),s):t}}return t.__name="filterByDateType",t.$inject=["$filter","$rootScope","$log"],t}),define("tasks-assignments/filters/date.filter",["common/moment"],function(e){"use strict";function t(t,n){return n.debug("Filter: filterBy.date"),function(t,n){if(!t||!t.length||!n)return[];var s,a,i,r=[],o=0,c=t.length;for(s=e().startOf(n),a=e().endOf(n);o<c;o++)(i=e(t[o].date))>s&&i<a&&r.push(t[o]);return r}}return t.__name="filterByDate",t.$inject=["$filter","$log"],t}),define("tasks-assignments/filters/offset.filter",[],function(){"use strict";function e(e){return e.debug("Filter: offset"),function(e,t){return t=t||0,e.slice(parseInt(t,10))}}return e.__name="offset",e.$inject=["$log"],e}),define("tasks-assignments/filters/ownership.filter",[],function(){"use strict";function e(e,t){e.debug("Filter: filterByOwnership");var n={assigned:function(e){return~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)},delegated:function(e){return e.source_contact_id===t.LOGGED_IN_CONTACT_ID&&!~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)}};return function(e,t){try{return e.filter(n[t])}catch(t){return e}}}return e.__name="filterByOwnership",e.$inject=["$log","config"],e}),define("tasks-assignments/filters/status.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByStatus"),function(e,t,n){var s=[],a=0,i=e.length,r=t.length;if(n=void 0===n||n,!i||!r)return e;for(a;a<i;a++)-1!==t.indexOf(e[a].status_id)===n&&s.push(e[a]);return s}}return e.__name="filterByStatus",e.$inject=["$filter","$rootScope","$log"],e}),define("tasks-assignments/modules/tasks-assignments.filters",["common/angular","tasks-assignments/filters/assignment-type.filter","tasks-assignments/filters/contact-id.filter","tasks-assignments/filters/date-field.filter","tasks-assignments/filters/date-parse.filter","tasks-assignments/filters/date-type.filter","tasks-assignments/filters/date.filter","tasks-assignments/filters/offset.filter","tasks-assignments/filters/ownership.filter","tasks-assignments/filters/status.filter"],function(e,t,n,s,a,i,r,o,c,l){"use strict";return e.module("tasks-assignments.filters",[]).filter(t.__name,t).filter(n.__name,n).filter(s.__name,s).filter(a.__name,a).filter(i.__name,i).filter(r.__name,r).filter(o.__name,o).filter(c.__name,c).filter(l.__name,l)}),define("tasks-assignments/resources/app-settings.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"Setting",json:{}})}return e.__name="AppSettings",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment-search.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: AssignmentSearch"),e(t.url.ASSIGNMENTS+"/ajax/unclosed")}return e.__name="AssignmentSearch",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment-type.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: AssignmentType"),e(t.url.REST,{action:"get",entity:"CaseType",json:{is_active:1}})}return e.__name="AssignmentType",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: Assignment"),e(t.url.REST,{action:"get",entity:"Assignment",json:{}})}return e.__name="Assignment",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/contact.resource",[],function(){"use strict";function e(e,t,n,s){return s.debug("Resource: Contact"),e(n.url.REST,{action:"get",entity:"contact",debug:n.DEBUG})}return e.__name="Contact",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/resources/document.resource",[],function(){"use strict";function e(e,t,n,s){return s.debug("Resource: Document"),e(n.url.REST,{action:"get",entity:"Document",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}return e.__name="Document",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/resources/key-date.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: KeyDate"),e(t.url.REST,{action:"get",entity:"KeyDates",json:{}})}return e.__name="KeyDate",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/relationship.resource",["require","exports","module"],function(e,t,n){"use strict";function s(e,t,n){return n.debug("Resource: Relationship"),e(t.url.REST,{action:"get",entity:"Relationship",json:{}})}return s.__name="Relationship",s.$inject=["$resource","config","$log"],s}),define("tasks-assignments/resources/settings.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"TASettings",json:{}})}return e.__name="Settings",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/task.resource",[],function(){"use strict";function e(e,t,n,s){return s.debug("Service: Task"),e(n.url.REST,{action:"get",entity:"Task",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}return e.__name="Task",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/modules/tasks-assignments.resources",["common/angular","tasks-assignments/resources/app-settings.resource","tasks-assignments/resources/assignment-search.resource","tasks-assignments/resources/assignment-type.resource","tasks-assignments/resources/assignment.resource","tasks-assignments/resources/contact.resource","tasks-assignments/resources/document.resource","tasks-assignments/resources/key-date.resource","tasks-assignments/resources/relationship.resource","tasks-assignments/resources/settings.resource","tasks-assignments/resources/task.resource"],function(e,t,n,s,a,i,r,o,c,l,d){"use strict";return e.module("tasks-assignments.resources",[]).factory(t.__name,t).factory(n.__name,n).factory(s.__name,s).factory(a.__name,a).factory(i.__name,i).factory(r.__name,r).factory(o.__name,o).factory(c.__name,c).factory(l.__name,l).factory(d.__name,d)}),define("tasks-assignments/modules/tasks-assignments.run",["common/angular"],function(e){"use strict";function t(t,n,s,a,i,r,o,c,l,d,u,m,f){i.debug("tasks-assignments.run");var g=[r.LOGGED_IN_CONTACT_ID];t.cache={contact:{obj:{},arr:[],arrSearch:[]},assignment:{obj:{},arr:[],arrSearch:[]},assignmentType:{obj:{},arr:[]},dateType:{obj:{period_start_date:"Contract Start Date",period_end_date:"Contract End Date",birth_date:"Birthday"},arr:[]},documentType:{obj:{},arr:[]},documentStatus:{obj:{},arr:[]},documentStatusResolve:r.status.resolve.DOCUMENT,taskType:{obj:{},arr:[]},taskStatus:{obj:{},arr:[]},taskStatusResolve:r.status.resolve.TASK},t.location=a,t.pathTpl=r.path.TPL,t.permissions=r.permissions,t.prefix=r.CLASS_NAME_PREFIX,t.settings=o,t.url=r.url,r.CONTACT_ID&&g.push(r.CONTACT_ID),l.getOptions().then(function(n){e.extend(t.cache,n)}),c.getOptions().then(function(n){e.extend(t.cache,n)}),d.getTypes().then(function(n){e.extend(t.cache.assignmentType.obj,n),e.forEach(n,function(e){this.push(e)},t.cache.assignmentType.arr)}),m.get({IN:g}).then(function(e){m.updateCache(e)}),e.forEach(t.cache.dateType.obj,function(e,t){this.push({key:t,value:e})},t.cache.dateType.arr),t.$on("$stateChangeSuccess",function(){n.removeClass("ct-page-loading")}),f.theme="bs3"}e.module("tasks-assignments.run",["tasks-assignments.constants","tasks-assignments.values"]).run(t),t.$inject=["$rootScope","$rootElement","$q","$location","$log","config","settings","documentService","taskService","assignmentService","keyDateService","contactService","editableOptions"]}),define("tasks-assignments/services/app-settings.service",[],function(){"use strict";function e(e,t,n,s,a){function i(s){var a=t.defer();return s=s&&"object"==typeof s?s:[],e.get({sequential:1,debug:n.DEBUG,return:s},function(e){a.resolve(e.values)},function(){a.reject("Unable to fetch settings list")}),a.promise}return a.debug("Service: appSettingsService"),{get:i}}return e.__name="appSettingsService",e.$inject=["AppSettings","$q","config","utilsService","$log"],e}),define("tasks-assignments/services/dialog.service",[],function(){"use strict";function e(e,t,n,s){function a(s){if(!s||"object"==typeof s)return e.open({appendTo:n.find("div").eq(0),templateUrl:t.path.TPL+"modal/dialog.html",size:"sm",controller:"ModalDialogController",resolve:{content:function(){return{copyCancel:s.copyCancel||"",copyConfirm:s.copyConfirm||"",title:s.title||"",msg:s.msg||""}}}}).result}return s.debug("Service: $dialog"),{open:a}}return e.__name="$dialog",e.$inject=["$uibModal","config","$rootElement","$log"],e}),define("tasks-assignments/services/file.service",[],function(){"use strict";function e(e,t,n,s,a,i){function r(e,t,a){if(!e||"number"!=typeof+e||!t||"number"!=typeof+t||!a||"string"!=typeof a)return null;var i=n.defer();return d.save({action:"delete",entityTable:a,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1),s.errorHandler(e,"Unable to delete file",i)||i.resolve(e.values[0])},function(){i.reject("Unable to delete file")}),i.promise}function o(e,t){if(!e||"number"!=typeof+e||!t||"string"!=typeof t)return null;var a=n.defer();return d.get({action:"list",entityTable:t,entityID:e},function(e){s.errorHandler(e,"Unable to fetch files",a)||a.resolve(e.values)},function(){a.reject("Unable to fetch files")}),a.promise}function c(e,t){if(!e||"object"!=typeof e||!t||"number"!=typeof+t)return null;var s=n.defer(),a=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){a.push(t)},e.onErrorItem=function(e,t,n,a){s.reject("Could not upload file: "+e.file.name),i.error(" ===== Item Error: "+n+" ======"),i.error(" =====  - item ======"),i.error(e),i.error(" =====  - response ======"),i.error(t),i.error(" =====  - headers ======"),i.error(a)},e.onCompleteAll=function(){s.resolve(a)},e.uploadAll(),s.promise}function l(e,n){if(!e||"string"!=typeof e)return null;var s={url:t.url.FILE+"/upload",formData:[{entityTable:e}]};return n&&"number"==typeof n&&(s.queueLimit=n),new a(s)}i.debug("Service: fileServiceTA");var d=e(t.url.FILE+"/:action");return a.prototype.queueDelete=[],{delete:r,get:o,upload:c,uploader:l}}return e.__name="fileServiceTA",e.$inject=["$resource","config","$q","utilsService","FileUploader","$log"],e}),define("tasks-assignments/services/key-date.service",["common/moment"],function(e){"use strict";function t(t,n,s,a,i){function r(s,a){var i=n.defer();return s&&a?(s=s?e(s).format("YYYY-MM-DD"):null,a=a?e(a).format("YYYY-MM-DD"):null,t.get({json:{start_date:s,end_date:a}},function(e){i.resolve(e.values)},function(){i.reject("Unable to fetch documents list")}),i.promise):null}return i.debug("Service: keyDateService"),{get:r}}return t.__name="keyDateService",t.$inject=["KeyDate","$q","config","utilsService","$log"],t}),define("tasks-assignments/services/settings.service",[],function(){"use strict";function e(e,t,n,s,a,i){function r(s){var a=t.defer();return s=s&&"object"==typeof s?s:[],e.get({action:"get",json:{sequential:1,debug:n.DEBUG,fields:s}},function(e){a.resolve(e.values)},function(){a.reject("Unable to fetch tasks list")}),a.promise}function o(a){if(!a||"object"!=typeof a)return null;var r=t.defer();return e.save({action:"set",json:{sequential:1,debug:n.DEBUG,fields:a}},null,function(e){s.errorHandler(e,"Unable to save",r)||(i.tabEnabled={documents:a.documents_tab||i.tabEnabled.documents_tab,keyDates:a.keydates_tab||i.tabEnabled.keydates_tab},i.copy.button.assignmentAdd=a.add_assignment_button_title,r.resolve(e.values))},function(){r.reject("Unable to save")}),r.promise}return a.debug("Service: settingsService"),{get:r,set:o}}return e.__name="settingsService",e.$inject=["Settings","$q","config","utilsService","$log","settings"],e}),define("tasks-assignments/services/utils.service",[],function(){"use strict";function e(e,t,n){function s(e,t,s){var a="",i=t||"Unknown Error";return e.is_error?(a=e.error_code||a,i=e.error_message||i,n.error(a+"\n"+i),s&&s.reject(a+"\n"+i),e.trace&&n.error(e.trace),!0):e.values?void 0:(n.error(i),s&&s.reject(i),!0)}return n.debug("Service: utilsService"),{errorHandler:s}}return e.__name="utilsService",e.$inject=["config","$q","$log","$rootScope"],e}),define("tasks-assignments/modules/tasks-assignments.services",["common/angular","tasks-assignments/services/app-settings.service","tasks-assignments/services/assignment.service","tasks-assignments/services/contact.service","tasks-assignments/services/dialog.service","tasks-assignments/services/document.service","tasks-assignments/services/file.service","tasks-assignments/services/key-date.service","tasks-assignments/services/settings.service","tasks-assignments/services/task.service","tasks-assignments/services/utils.service"],function(e,t,n,s,a,i,r,o,c,l,d){"use strict";return e.module("tasks-assignments.services",[]).factory(t.__name,t).factory(n.__name,n).factory(s.__name,s).factory(a.__name,a).factory(i.__name,i).factory(r.__name,r).factory(o.__name,o).factory(c.__name,c).factory(l.__name,l).factory(d.__name,d)}),define("tasks-assignments/modules/tasks-assignments.dashboard.config",["common/angular","common/moment","common/lodash"],function(e,t,n){"use strict";function s(e){e.withAutoBase(!0),e.settings.ga={userId:n.get(CRM,"vars.session.contact_id")}}function a(a,i,r,o,c,l,d,u,m,f){s(d),o.debugEnabled(a.DEBUG),c.otherwise("/tasks"),r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.defaults.stripTrailingSlashes=!1,m.showWeeks=!1,f.theme="bootstrap",u.setDateFormats({weekDay:"ddd"}),l.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("tasks",{url:"/tasks",controller:"TaskListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/tasks.html?v="+(new Date).getTime(),resolve:{taskList:["taskService",function(e){return e.get({status_id:{"NOT IN":a.status.resolve.TASK}})}]}}).state("tasks.my",{url:"/my",params:{ownership:"assigned"}}).state("tasks.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("tasks.all",{url:"/all",params:{ownership:null}}).state("documents",{url:"/documents",controller:"DocumentListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/documents.html?v=8",resolve:{documentList:["documentService",function(e){return e.get({})}]}}).state("documents.my",{url:"/my",params:{ownership:"assigned"}}).state("documents.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("documents.all",{url:"/all",params:{ownership:null}}).state("assignments",{url:"/assignments",controller:"ExternalPageController",templateUrl:a.path.TPL+"dashboard/assignments.html?v=5"}).state("calendar",{abstract:!0,controller:"CalendarController",templateUrl:a.path.TPL+"dashboard/calendar.html?v=3",resolve:{documentList:["$q","documentService","settings",function(t,n,s){var i=t.defer();return+s.tabEnabled.documents||i.resolve([]),t.all([n.get({sequential:0,assignee_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.DOCUMENT}}),n.get({sequential:0,source_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.DOCUMENT}})]).then(function(t){var n,s=[];e.extend(t[0],t[1]);for(n in t[0])s.push(t[0][n]);i.resolve(s)}),i.promise}],taskList:["$q","taskService",function(e,t){var s=e.defer();return e.all([t.get({sequential:1,assignee_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.TASK}}),t.get({sequential:1,source_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.TASK}})]).then(function(e){var t=n(e[0]).assign(e[1]);s.resolve(t.values().value())}),s.promise}]}}).state("calendar.mwl",{url:"/calendar",views:{documentList:{controller:"DocumentListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/calendar.documentList.html?v=6"},taskList:{controller:"TaskListController",controllerAs:"list",templateUrl:a.path.TPL+"dashboard/calendar.taskList.html?v=5"}}}).state("calendar.mwl.day",{params:{calendarView:"day"}}).state("calendar.mwl.month",{params:{calendarView:"month"}}).state("calendar.mwl.week",{params:{calendarView:"week"}}).state("reports",{url:"/reports",controller:"ExternalPageController",templateUrl:a.path.TPL+"dashboard/reports.html?v=4"}).state("keyDates",{url:"/key-dates",controller:"DateListController",templateUrl:a.path.TPL+"dashboard/key-dates.html?v=4",resolve:{contactList:["keyDateService",function(e){return e.get(t().startOf("month"),t().endOf("month"))}]}})}e.module("tasks-assignments.dashboard.config",["tasks-assignments.constants"]).config(a),a.$inject=["config","$resourceProvider","$httpProvider","$logProvider","$urlRouterProvider","$stateProvider","$analyticsProvider","calendarConfigProvider","uibDatepickerConfig","uiSelectConfig"]}),define("tasks-assignments/modules/tasks-assignments.dashboard.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.dashboard.config"],function(e){"use strict";e.module("tasks-assignments.dashboard",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.constants","tasks-assignments.values","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.dashboard.config"])}),define("tasks-assignments/modules/tasks-assignments.documents.config",["common/angular"],function(e){"use strict";function t(e,t,n,s,a,i,r,o,c){c.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"DocumentListController",controllerAs:"list",templateUrl:e.path.TPL+"contact/documents.html?v=4",resolve:{documentList:["documentService",function(t){return t.get({target_contact_id:e.CONTACT_ID})}]}}),i.virtualPageviews(!1),s.defaults.stripTrailingSlashes=!1,a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.showWeeks=!1,o.theme="bootstrap"}e.module("tasks-assignments.documents.config",["tasks-assignments.constants"]).config(t),t.$inject=["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","$analyticsProvider","uibDatepickerConfig","uiSelectConfig","$logProvider"]}),define("tasks-assignments/modules/tasks-assignments.documents.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.documents.config"],function(e){"use strict";e.module("tasks-assignments.documents",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.constants","tasks-assignments.values","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.documents.config"])}),define("tasks-assignments/modules/tasks-assignments.settings.config",["common/angular","common/lodash"],function(e,t){"use strict";function n(e){e.settings.ga={userId:t.get(CRM,"vars.session.contact_id")},e.withAutoBase(!0)}function s(e,t,s,a,i,r,o,c,l){i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",a.defaults.stripTrailingSlashes=!1,o.showWeeks=!1,c.theme="bootstrap",n(r),l.debugEnabled(e.DEBUG),s.otherwise("/"),t.state("settings",{url:"/",controller:"SettingsController",templateUrl:e.path.TPL+"settings.html?v=5"})}e.module("tasks-assignments.settings.config",["tasks-assignments.constants"]).config(s),s.$inject=["config","$stateProvider","$urlRouterProvider","$resourceProvider","$httpProvider","$analyticsProvider","uibDatepickerConfig","uiSelectConfig","$logProvider"]}),define("tasks-assignments/modules/tasks-assignments.settings.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.settings.config"],function(e){"use strict";e.module("tasks-assignments.settings",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.constants","tasks-assignments.values","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.settings.config"])}),define("tasks-assignments/modules/tasks-assignments.tasks.config",["common/angular"],function(e){"use strict";function t(e,t,n,s,a,i,r,o,c){c.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"TaskListController",controllerAs:"list",templateUrl:e.path.TPL+"contact/tasks.html?v=222",resolve:{taskList:["taskService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.TASK}})}]}}),i.virtualPageviews(!1),s.defaults.stripTrailingSlashes=!1,a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.showWeeks=!1,o.theme="bootstrap"}e.module("tasks-assignments.tasks.config",["tasks-assignments.constants"]).config(t),t.$inject=["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","$analyticsProvider","uibDatepickerConfig","uiSelectConfig","$logProvider"]}),define("tasks-assignments/modules/tasks-assignments.tasks.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.tasks.config"],function(e){"use strict";e.module("tasks-assignments.tasks",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.values","tasks-assignments.constants","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.tasks.config"])}),function(){var e=CRM.tasksAssignments.extensionPath+"js/src/tasks-assignments";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"tasks-assignments":e,"tasks-assignments/vendor/angular-bootstrap-calendar":e+"/vendor/angular/angular-bootstrap-calendar-tpls-custom","tasks-assignments/vendor/angular-checklist-model":e+"/vendor/angular/checklist-model","tasks-assignments/vendor/angular-router":e+"/vendor/angular/angular-ui-router"}}),require(["common/angular","tasks-assignments/modules/tasks-assignments.dashboard.module","tasks-assignments/modules/tasks-assignments.documents.module","tasks-assignments/modules/tasks-assignments.settings.module","tasks-assignments/modules/tasks-assignments.tasks.module"],function(e){"use strict";document.addEventListener("taInit",function(t){var n=e.element(document.getElementById(t.detail.module));!!n.injector()||e.bootstrap(n,["tasks-assignments."+t.detail.app])}),document.dispatchEvent("function"==typeof window.CustomEvent?new window.CustomEvent("taReady"):function(){var e=document.createEvent("Event");return e.initEvent("taReady",!0,!0),e}())})}(require);
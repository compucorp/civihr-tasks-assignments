/**
 * CiviTasks Dashboard Calendar based on:
 * angular-bootstrap-calendar - A pure AngularJS bootstrap themed responsive calendar that can display events and has views for year, month, week and day
 * @version v0.10.6
 * @link https://github.com/mattlewis92/angular-bootstrap-calendar
 * @license MIT
 */

/**
 * State-based routing for AngularJS
 * @version v0.2.15
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

define("tasks-assignments/modules/tasks-assignments.constants",["common/angular"],function(e){"use strict";e.module("tasks-assignments.constants",[]).constant("config",{DEBUG:!!+CRM.debug,CLASS_NAME_PREFIX:"ct-",CONTACT_ID:CRM.contactId||null,LOGGED_IN_CONTACT_ID:CRM.adminId||null,path:{EXT:CRM.tasksAssignments.extensionPath,TPL:CRM.tasksAssignments.extensionPath+"views/"},permissions:{allowDelete:CRM.tasksAssignments.permissions.delete_tasks_and_documents},url:{REST:CRM.url("civicrm/ajax/rest"),ASSIGNMENTS:CRM.url("civicrm/case"),CIVI_DASHBOARD:CRM.url("civicrm/"),CONTACT:CRM.url("civicrm/contact/view"),FILE:"/civicrm/tasksassignments/file",CSV_EXPORT:CRM.url("civicrm/tasksassignments")},status:{resolve:{DOCUMENT:["3","4"],TASK:["2","3","6","8"]}}})}),define("tasks-assignments/controllers/assignments.controller",[],function(){"use strict";function e(e,t,n,a,s,r,i){e.info("Controller: AssignmentsController")}return e.__name="AssignmentsController",e.$inject=["$log","$rootElement","$rootScope","$scope","$uibModal","$state","config"],e}),define("tasks-assignments/controllers/calendar.controller",["common/angular","common/moment"],function(e,t){"use strict";function n(n,a,s,r,i,o,c,l,u,d){function m(n,a,s){var r=[];return e.forEach(a,function(e){e.activity_date_time=t(e.activity_date_time).toDate(),this.push({id:e.id,title:s[e.activity_type_id],type:n,startsAt:e.activity_date_time,endsAt:e.activity_date_time,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),e.expire_date&&(e.expire_date=t(e.expire_date).toDate(),+e.expire_date!=+e.activity_date_time&&this.push({id:e.id,title:s[e.activity_type_id],type:n,startsAt:e.expire_date,endsAt:e.expire_date,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))},r),r}function f(e){r.calendarDay=t(e).toDate(),r.calendarView="day"}function g(e,n,a,s,r){var i,o,c,l=e.id,u=n.id,d=a.length,m=0;if(u)for(;m<d;m++)+a[m].id==+u&&(a.splice(m,1),m--,d--);l&&(i=t(e.activity_date_time).toDate(),o=s[e.activity_type_id],a.push({id:l,title:o,type:r,startsAt:i,endsAt:i,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),e.expire_date&&+(c=t(e.expire_date).toDate())!=+i&&a.push({id:l,title:o,type:r,startsAt:c,endsAt:c,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))}function v(){r.$on("taskDelete",function(e,t){g({},{id:t},r.calTaskList)}),r.$on("taskFormSuccess",function(e,t,n){g(s.cache.taskStatusResolve.indexOf(t.status_id)>-1?{}:t,n,r.calTaskList,s.cache.taskType.obj,"task")}),r.$on("documentDelete",function(e,t){g({},{id:t},r.calDocList)}),r.$on("documentFormSuccess",function(e,t,n){g(s.cache.documentStatusResolve.indexOf(t.status_id)>-1?{}:t,n,r.calDocList,s.cache.documentType.obj,"document")}),r.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(r.calTaskList,this.createCalEventList("task",t.taskList,s.cache.taskType.obj)),+l.tabEnabled.documents&&Array.prototype.push.apply(r.calDocList,this.createCalEventList("document",t.documentList,s.cache.documentType.obj))}.bind(this))}r.calendarDay=new Date,r.calendarTitle="",r.calendarView=o.params.calendarView||"month",r.calTaskList=[],r.calDocList=[],this.createCalEventList=m.bind(this),r.displayDayView=f,function(){v.call(this),r.calTaskList=this.createCalEventList("task",d,s.cache.taskType.obj),+l.tabEnabled.documents&&(r.calDocList=this.createCalEventList("document",u,s.cache.documentType.obj))}.bind(this)()}return n.__name="CalendarController",n.$inject=["$filter","$log","$rootScope","$scope","$timeout","$state","$stateParams","settings","documentList","taskList"],n}),define("tasks-assignments/controllers/date-list.controller",["common/moment"],function(e){"use strict";function t(t,n,a,s,r,i,o,c,l,u){function d(e){for(var t,n=0,a=e.length,s={},r=[];n<a;n++)s[e[n].keydate]=s[e[n].keydate]||[],s[e[n].keydate].push(e[n]);for(t in s)r.push({date:t,dateContactList:s[t]});return r}function m(){var t,n;"dateRange"===r.filterParams.date?(t=r.filterParams.dateRange.from?e(r.filterParams.dateRange.from).format("YYYY-MM-DD"):"",n=r.filterParams.dateRange.until?e(r.filterParams.dateRange.until).format("YYYY-MM-DD"):""):(t=e().startOf(r.filterParams.date).format("YYYY-MM-DD"),n=e().endOf(r.filterParams.date).format("YYYY-MM-DD")),window.location.href=l.url.CSV_EXPORT+"/keydatescsv?start_date="+t+"&end_date="+n}function f(){r.$watch("filterParams.dateRange.from",function(e){r.datepickerOptions.until.minDate=e}),r.$watch("filterParams.dateRange.until",function(e){r.datepickerOptions.from.maxDate=e})}function g(e,n){var a=t("date")(e,"dd/MM/yyyy")||"",s=t("date")(n,"dd/MM/yyyy")||"";s&&(s=a?" - "+s:"Until: "+s),a&&(a=s?a:"From: "+a),r.label.dateRange=a+s}function v(t,n){r.$broadcast("ct-spinner-show","dateList"),c.get(e(t),e(n)).then(function(e){r.dateListSelected=this.createDateList(e),r.filterParams.date="dateRange",r.$broadcast("ct-spinner-hide","dateList")}.bind(this))}n.debug("Controller: DateListController"),r.dataLoading=!0,r.dateList=[],r.dateListLimit=5,r.dateListSelected=[],r.dpOpened={filterDates:{}},r.filterParams={date:"month",dateType:[],dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()}},r.datepickerOptions={from:{maxDate:r.filterParams.dateRange.until},until:{minDate:r.filterParams.dateRange.from}},r.isCollapsed={filterDates:!0},r.label={isoWeek:"Week",month:"Month",year:"Year",dateRange:""},this.createDateList=d.bind(this),r.csvExport=m,r.labelDateRange=g,r.showDateRange=v.bind(this),function(){r.dateList=this.createDateList(u),s.$broadcast("ct-spinner-hide"),c.get(e().startOf("year"),e().endOf("year")).then(function(e){r.dateList=this.createDateList(e),r.dataLoading=!1}.bind(this)),f()}.bind(this)()}return t.__name="DateListController",t.$inject=["$filter","$log","$rootElement","$rootScope","$scope","$timeout","$uibModal","keyDateService","config","contactList"],t}),define("tasks-assignments/controllers/document-list.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function a(n,a,s,r,i,o,c,l,u,d,m,f,g,v,p,h,y){function _(e,t){var n,a=t.length,r=[];if(e&&a)switch(e){case"delete":l.open({msg:"Are you sure you want to delete "+a+" document(s)?"}).then(function(e){if(e){for(o.$broadcast("ct-spinner-show","documentList"),n=0;n<a;n++)r.push(g.delete(t[n].id));s.all(r).then(function(e){for(n=0;n<a;n++)i.$broadcast("documentDelete",t[n].id),o.list.splice(o.list.indexOf(t[n]),1);o.$broadcast("ct-spinner-hide","documentList"),m.updateTab()})}})}}function k(){j.filterParams.dateRange.from=j.filterParamsHolder.dateRange.from,j.filterParams.dateRange.until=j.filterParamsHolder.dateRange.until,j.filterParams.due="dateRange",j.isDocumentSection=null!==j.filterParamsHolder.dateRange.from||null!==j.filterParamsHolder.dateRange.until,j.labelDateRange()}function $(e,t){if(!t||"number"!=typeof+t)return null;o.$broadcast("ct-spinner-show","documentList"),g.save({id:e.id,status_id:t}).then(function(t){e.id=t.id,e.status_id=t.status_id,o.$broadcast("ct-spinner-hide","documentList"),m.updateTab()})}function b(e){l.open({msg:"Are you sure you want to delete this document?"}).then(function(t){t&&g.delete(e.id).then(function(t){j.list.splice(j.list.indexOf(e),1),i.$broadcast("documentDelete",e.id),m.updateTab()})})}function w(e){var a=n("filterByDateField")(j.list,e,"activity_date_time",j.filterParams.dateRange),s=n("filterByDateField")(j.list,e,"expire_date",j.filterParams.dateRange);return t.uniq(t.union(a,s),"id")}function C(){o.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(j.list,t.documentList)}),o.$on("documentFormSuccess",function(t,n,a){e.equals({},a)?j.list.push(n):e.extend(a,n)}),o.$on("crmFormSuccess",function(e,t){if("success"===t.status){var n=/case|activity|assignment/i;(n.test(t.title)||E(n,t)||n.test(t.crmMessages[0].text))&&!"activity_type".test(t.userContext)&&(i.cache.assignment={obj:{},arr:[]},d.go(d.current,{},{reload:!0}))}})}function D(){o.$watch("filterParamsHolder.dateRange.from",function(e){j.datepickerOptions.until.minDate=e}),o.$watch("filterParamsHolder.dateRange.until",function(e){j.datepickerOptions.from.maxDate=e})}function S(){var e=n("date")(j.filterParams.dateRange.from,"dd/MM/yyyy")||"",t=n("date")(j.filterParams.dateRange.until,"dd/MM/yyyy")||"";t&&(t=e?" - "+t:"Until: "+t),e&&(e=t?e:"From: "+e),j.label.dateRange=e+t}function T(e){var n={};return e.length&&t.each(e,function(e){var a=t.find(i.cache.contact.obj,{contact_id:e});a&&(n[e]=a.sort_name.replace(",",""))}),n}function E(e,t){return t.crmMessages&&t.crmMessages.length&&e.test(t.crmMessages[0].title)}function A(e){switch(j.reverse=j.propertyName===e&&!j.reverse,j.propertyName=e,e){case"type":j.list=t.sortBy(j.list,function(e){return i.cache.documentType.obj[e.activity_type_id].toLowerCase()});break;case"status_id":j.list=t.sortBy(j.list,function(e){return i.cache.documentStatus.obj[e.status_id].toLowerCase()});break;case"target_contact":j.list=t.sortBy(j.list,function(e){return i.cache.contact.obj[e.target_contact_id[0]].sort_name.toLowerCase()});break;case"assignee":j.list=t.sortBy(j.list,function(e){var n=e.assignee_contact_id.length&&t.find(i.cache.contact.obj,{id:e.assignee_contact_id[0]});return n?n.sort_name.toLowerCase():""});break;case"case_id":j.list=t.sortBy(j.list,function(e){var t=i.cache.assignment.obj[e.case_id],n=t&&i.cache.assignmentType.obj[t.case_type_id];return n&&n.title.toLowerCase()})}}function x(e){d.go("calendar.mwl."+e)}a.debug("Controller: DocumentListController");var j=this,M=["1","2"];j.dueThisWeek=0,j.dueToday=0,j.isDocumentSection=!1,j.list=y,j.listFiltered=[],j.listOngoing=[],j.listPaginated=[],j.overdue=0,j.propertyName="activity_date_time",j.reverse=!0,j.documentContactColumns=[{label:"Type",property:"type"},{label:"Document Number",property:"document_number"},{label:"Assigned to",property:"assignee"},{label:"Workflow",property:"case_id",condition:h.extEnabled.assignments},{label:"Valid From",property:"valid_from"},{label:"Expiry Date",property:"expire_date"},{label:"Status",property:"status_id"}],j.documentDashboardColumns=[{label:"Type",property:"type"},{label:"Staff",property:"target_contact"},{label:"Assigned to",property:"assignee"},{label:"Workflow",property:"case_id",condition:h.extEnabled.assignments},{label:"Due Date",property:"activity_date_time"},{label:"Expiry Date",property:"expire_date"},{label:"Status",property:"status_id"}],j.dpOpened={filterDates:{}},j.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue"},{badgeClass:"primary",calendarView:"month",value:"dueInNextFortnight"},{badgeClass:"primary",calendarView:"month",value:"dueInNinetyDays"},{badgeClass:"primary",calendarView:"month",value:"all"}],j.filterParams={contactId:null,documentStatus:[],ownership:d.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},j.filterParamsHolder={documentStatus:M,dateRange:{from:null,until:null}},j.datepickerOptions={from:{maxDate:j.filterParamsHolder.dateRange.until},until:{minDate:j.filterParamsHolder.dateRange.from}},j.isCollapsed={filterAdvanced:!0,filterDates:!0},j.label={addNew:"Add Document",overdue:"Overdue",dueInNextFortnight:"Next fortnight",dueInNinetyDays:"90 days",all:"All",dateRange:""},j.pagination={currentPage:1,itemsPerPage:10,maxSize:5},j.apply=_,j.applySidebarFilters=k,j.changeStatus=$,j.deleteDocument=b,j.filterByDateField=w,j.labelDateRange=S,j.listAssignees=T,j.sortBy=A,j.viewInCalendar=x,function(){C(),D(),j.applySidebarFilters(),g.cacheContactsAndAssignments(y).then(function(){i.$broadcast("ct-spinner-hide"),a.debug(i.cache)})}()}return a.__name="DocumentListController",a.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$dialog","$uibModal","$state","assignmentService","contactService","documentService","fileServiceTA","config","settings","documentList"],a}),define("tasks-assignments/controllers/document.controller",["common/moment"],function(e){"use strict";function t(t,n,a,s){function r(){a.$watch("document.activity_date_time",function(e){a.document.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)}),a.$watch("document.id",function(){a.fileUrl=s.url.FILE+"/zip?entityID="+a.document.id+"&entityTable=civicrm_activity"})}t.debug("Controller: DocumentController"),a.document.activity_date_time=a.document.activity_date_time?e(a.document.activity_date_time).toDate():null,a.document.expire_date=a.document.expire_date?e(a.document.expire_date).toDate():null,a.document.valid_from=a.document.valid_from?e(a.document.valid_from).toDate():null,a.document.remind_me=1===a.document.remind_me,function(){r()}()}return t.__name="DocumentController",t.$inject=["$log","$rootScope","$scope","config"],t}),define("tasks-assignments/controllers/external-page.controller",[],function(){"use strict";function e(e,t,n,a,s,r,i){function o(){a.$on("assignmentFormSuccess",function(){s.go(s.current,{},{reload:!0})}),a.$on("iframe-ready",function(){n.$broadcast("ct-spinner-hide")})}e.debug("Controller: ExternalPageController"),a.assignmentsUrl=i.url.ASSIGNMENTS+"?reset=1",a.reportsUrl=i.url.CIVI_DASHBOARD+"?reset=1",function(){o()}()}return e.__name="ExternalPageController",e.$inject=["$log","$rootElement","$rootScope","$scope","$state","$uibModal","config"],e}),define("tasks-assignments/controllers/main.controller",["common/lodash"],function(e){"use strict";function t(t,n,a,s,r,i,o,c,l,u,d,m,f){function g(n){var a=s["modal"+e.capitalize(n)];"function"==typeof a?a({case_type_id:b.caseTypeId||null}):t.warn("There is no method available for opening the required "+n+" modal!")}function v(e,t){var n="All tasks in the "+e+" workflow for "+t+" have been completed. Good work!";m.success("Success",n)}function p(e){return f.get({id:e,return:["case_id.case_type_id.title","case_id.status_id.name"]}).then(function(e){var t=e[0];if(t)return{caseTypeTitle:t["case_id.case_type_id.title"],statusName:t["case_id.status_id.name"]}})}function h(){r.$on("taskFormSuccess",function(t,n,a){var r=s.cache.contact.obj[a.target_contact_id[0]];e.isEmpty(a.case_id)||p(a.id).then(function(e){"Closed"===e.statusName&&v(e.caseTypeTitle,r.display_name)})})}function y(e){var n;e=e||{},n=i.open({appendTo:a.find("div").eq(0),templateUrl:c.path.TPL+"modal/assignment.html?v=3",controller:"ModalAssignmentController",size:"lg",resolve:{data:function(){return e},session:function(){return d.get()},defaultAssigneeOptions:function(){return u.valuesOf("activity_default_assignee")}}}),n.result.then(function(t){r.$broadcast("assignmentFormSuccess",t,e)},function(){t.info("Modal dismissed")})}function _(e,n,s){var o;s&&s.preventDefault(),n=n||"new",e=e||{},o=i.open({appendTo:a.find("div").eq(0),templateUrl:c.path.TPL+"modal/document.html?v=3",controller:"ModalDocumentController",controllerAs:"documentModal",resolve:{modalMode:function(){return n},role:function(){return"admin"},data:function(){return e},files:function(){return e.id&&+e.file_count?l.get(e.id,"civicrm_activity"):[]}}}),o.result.then(function(t){r.$broadcast("documentFormSuccess",t,e)},function(){t.info("Modal dismissed")})}function k(e,t){if(!e||"object"!=typeof e||!t||"string"!=typeof t)return null;i.open({appendTo:a.find("div").eq(0),templateUrl:c.path.TPL+"modal/reminder.html?v=1",controller:"ModalReminderController",resolve:{data:function(){return e},type:function(){return t}}})}function $(e){var n;e=e||{},n=i.open({appendTo:a.find("div").eq(0),templateUrl:c.path.TPL+"modal/task.html?v=5",controller:"ModalTaskController",resolve:{data:function(){return e}}}),n.result.then(function(t){r.$broadcast("taskFormSuccess",t,e),t.open&&s.modalTask(e)},function(){t.info("Modal dismissed")})}var b;t.debug("Controller: MainController"),s.modalAssignment=y,s.modalDocument=_,s.modalReminder=k,s.modalTask=$,function(){b=o.parse(),b.openModal&&g(b.openModal),h()}()}return t.__name="MainController",t.$inject=["$log","$q","$rootElement","$rootScope","$scope","$uibModal","beforeHashQueryParams","config","fileServiceTA","OptionGroup","Session","notificationService","taskService"],t}),define("tasks-assignments/controllers/settings.controller",["common/angular"],function(e){"use strict";function t(t,n,a,s,r,i,o,c,l,u,d,m,f){function g(){i.$broadcast("ct-spinner-show"),u.set({documents_tab:i.settings.tabEnabled.documents,keydates_tab:i.settings.tabEnabled.keyDates,add_assignment_button_title:i.settings.copy.button.assignmentAdd,is_task_dashboard_default:i.settings.isTaskDashboardDefault,days_to_create_a_document_clone:i.settings.daysToCreateADocumentClone}).then(function(e){i.$broadcast("ct-spinner-hide"),i.settingsForm.$pristine=!0},function(e){CRM.alert(e,"Error","error"),i.$broadcast("ct-spinner-hide")})}function v(){i.$on("$stateChangeStart",function(e,t,n,a,s){i.settingsForm.$pristine||(e.preventDefault(),o.open({copyCancel:"No",msg:"Are you sure you want to leave this page? Changes will be lost!"}).then(function(e){if(!e)return void r.$broadcast("$stateChangeSuccess");c.go(t.name,n,{notify:!1}).then(function(){r.$broadcast("$stateChangeSuccess",t,n,a,s)})}))})}function p(){l.open({appendTo:s.find("div").eq(0),templateUrl:m.path.TPL+"modal/taskMigrate.html?v=1",controller:"ModalTaskMigrateController",resolve:{activityType:function(){return h}}}).result.then(function(e){i.$broadcast("taskMigrateFormSuccess",e)},function(){n.info("Modal dismissed")})}n.debug("Controller: SettingsController");var h;i.settings=e.copy(f),i.configureAddAssignmentBtn=!!i.settings.copy.button.assignmentAdd,i.modalTaskMigrate=p,i.confirm=g,function(){v(),r.$broadcast("ct-spinner-hide"),h=function(){var e=a.defer();return d.get({entity:"Activity",action:"getoptions",json:{field:"activity_type_id"}},function(t){e.resolve(t.values||[])},function(){e.reject("Unable to get activity types")}),e.promise}()}()}return t.__name="SettingsController",t.$inject=["$location","$log","$q","$rootElement","$rootScope","$scope","$dialog","$state","$uibModal","settingsService","Task","config","settings"],t}),define("tasks-assignments/controllers/task-list.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function a(t,a,s,r,i,o,c,l,u,d,m,f,g,v,p,h){function y(){I.filterParams.dateRange.from=I.filterParamsHolder.dateRange.from,I.filterParams.dateRange.until=I.filterParamsHolder.dateRange.until,I.filterParams.due="dateRange"}function _(e){if(!r.cache.assignment.obj[e.id]){var n={};n[e.id]={case_type_id:t("filter")(r.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},d.updateCache(n)}}function k(e){var t={},n=I.contacts.filter(function(t){return t.id===e})[0];if(n)return t[n.id]={contact_id:n.id,contact_type:n.icon_class,sort_name:n.label,display_name:n.label,email:n.description.length?n.description[0]:""},m.updateCache(t),!0}function $(e,t){i.$broadcast("ct-spinner-show","task"+e.id),f.save({id:e.id,status_id:t||"2"}).then(function(t){r.$broadcast("taskFormSuccess",t,e),i.$broadcast("ct-spinner-hide","task"+e.id),d.updateTab()})}function b(t){function n(e){s.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&s.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&s.push(e.target_contact_id[0])}function a(e){e.case_id&&r.push(e.case_id)}var s=I.contactIds,r=I.assignmentIds;s.push(v.LOGGED_IN_CONTACT_ID),v.CONTACT_ID&&s.push(v.CONTACT_ID),e.forEach(t,function(e){n(e),a(e)})}function w(e){c.open({msg:"Are you sure you want to delete this task?"}).then(function(t){t&&f.delete(e.id).then(function(t){I.list.splice(I.list.indexOf(e),1),r.$broadcast("taskDelete",e.id),d.updateTab()})})}function C(e){return t("filterByDateField")(I.list,e,"activity_date_time",I.filterParams.dateRange)}function D(){i.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(I.list,t.taskList)}),i.$on("taskFormSuccess",function(t,n,a){e.equals({},a)?I.list.push(n):e.extend(a,n)}),i.$on("crmFormSuccess",function(e,t){if("success"===t.status){var n=/case|activity|assignment/i;(n.test(t.title)||E(n,t)||n.test(t.crmMessages[0].text))&&!"activity_type".test(t.userContext)&&(r.cache.assignment={obj:{},arr:[]},l.go(l.current,{},{reload:!0}))}})}function S(){i.$watch("filterParamsHolder.dateRange.from",function(e){I.datepickerOptions.until.minDate=e}),i.$watch("filterParamsHolder.dateRange.until",function(e){I.datepickerOptions.from.maxDate=e})}function T(){I.listResolvedLoaded||(t("filterByStatus")(I.list,r.cache.taskStatusResolve,!1),f.get({target_contact_id:v.CONTACT_ID,status_id:{IN:v.status.resolve.TASK}}).then(function(e){var t=I.contactIds,n=I.assignmentIds;I.collectId(e),t&&t.length&&m.get({IN:t}).then(function(e){m.updateCache(e)}),n&&n.length&&p.extEnabled.assignments&&d.get({IN:n}).then(function(e){d.updateCache(e)}),Array.prototype.push.apply(I.list,e),I.listResolvedLoaded=!0}))}function E(e,t){return t.crmMessages&&t.crmMessages.length&&e.test(t.crmMessages[0].title)}function A(e,n,a){e&&n&&a&&d.search(e,a).then(function(e){I.assignments=t("filter")(e,function(e){return+e.extra.contact_id==+n})})}function x(e){e&&m.search(e,{contact_type:"Individual"}).then(function(e){I.contacts=e})}function j(e){I.contacts=e}function M(t,n){return I.cacheContact(t.assignee_contact_id[0]),f.save(e.extend({},t,n)).catch(function(e){CRM.alert(e,"Error","error")})}function O(e){l.go("calendar.mwl."+e)}a.debug("Controller: TaskListController");var I=this;I.assignmentIds=[],I.assignments=[],I.contactIds=[],I.contacts=[],I.dueThisWeek=0,I.dueToday=0,I.format=g.DATE_FORMAT,I.list=h,I.listFiltered=[],I.listLimit=5,I.listOngoing=[],I.listResolved=[],I.listResolvedLoaded=!1,I.overdue=0,I.dpOpened={filterDates:{}},I.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue"},{badgeClass:"primary",calendarView:"day",value:"dueToday"},{badgeClass:"primary",calendarView:"week",value:"dueThisWeek"}],I.filterParams={contactId:null,ownership:l.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},I.filterParamsHolder={dateRange:{from:n().startOf("day").toDate(),until:n().add(1,"month").startOf("day").toDate()}},I.datepickerOptions={from:{maxDate:I.filterParamsHolder.dateRange.until},until:{minDate:I.filterParamsHolder.dateRange.from}},I.isCollapsed={filterAdvanced:!0,filterDates:!0,taskListResolved:!0},I.label={overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:"Due Tasks"},I.applySidebarFilters=y,I.cacheAssignment=_,I.cacheContact=k,I.changeStatus=$,I.collectId=b,I.deleteTask=w,I.filterByDateField=C,I.loadTasksResolved=T,I.refreshAssignments=A,I.refreshContacts=x,I.updateContacts=j,I.updateTask=M,I.viewInCalendar=O,function(){var e=I.contactIds,t=I.assignmentIds;I.collectId(h),e&&e.length&&m.get({IN:e}).then(function(e){m.updateCache(e)}),t&&t.length&&p.extEnabled.assignments&&d.get({IN:t}).then(function(e){d.updateCache(e)}),D(),S(),r.$broadcast("ct-spinner-hide"),a.info(r.cache)}()}return a.__name="TaskListController",a.$inject=["$filter","$log","$rootElement","$rootScope","$scope","$timeout","$dialog","$state","$uibModal","assignmentService","contactService","taskService","HR_settings","config","settings","taskList"],a}),define("tasks-assignments/controllers/task.controller",["common/moment"],function(e,t){"use strict";function n(t,n,a){function s(e){a.picker.opened=!0}function r(){a.$watch("task.status_id",function(e){var t=n.cache.taskStatusResolve.indexOf(e)>-1;a.task.resolved=t,a.task.completed=t}),a.$watch("task.activity_date_time",function(e){a.task.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}t.debug("Controller: TaskController"),a.isCollapsed=!0,a.picker={opened:!1},a.task.activity_date_time=a.task.activity_date_time?e(a.task.activity_date_time).toDate():null,a.dpOpen=s,function(){r()}()}return n.__name="TaskController",n.$inject=["$log","$rootScope","$scope"],n}),define("tasks-assignments/controllers/dashboard/nav-main.controller",[],function(){"use strict";function e(e,t,n){function a(e){return n.includes(e)}e.debug("Controller: NavMainController"),t.isActive=a}return e.__name="NavMainController",e.$inject=["$log","$scope","$state"],e}),define("tasks-assignments/controllers/dashboard/top-bar.controller",[],function(){"use strict";function e(e,t,n,a){e.debug("Controller: TopBarController"),t.itemAdd={},t.itemAdd.fn=function(){a.includes("documents")?t.modalDocument():t.modalTask()},t.itemAdd.label=function(){return a.includes("documents")?"Add Document":"Add Task"}}return e.__name="TopBarController",e.$inject=["$log","$rootScope","$scope","$state"],e}),define("tasks-assignments/services/contact.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,a,s,r,i,o,c,l){function u(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null;var a=r.defer();return e={IN:t.uniq(e.IN)},n.get({json:{id:e,return:"display_name, sort_name, id, contact_id, contact_type, email"}},function(e){c.errorHandler(e,"Unable to fetch contacts",a)||a.resolve(e.values)},function(){a.reject("Unable to fetch contact")}),a.promise}function d(t,a){if(a&&"object"!=typeof a)return null;var s=r.defer(),i={};return e.extend(i,a),i.display_name=t,i.return="display_name, contact_id, contact_type, email",n.get({action:"get",json:i},function(e){if(!c.errorHandler(e,"Unable to fetch contact list",s)){var t=[];for(var n in e.values)t.push({label:e.values[n].display_name,description:[e.values[n].email],id:e.values[n].contact_id,icon_class:e.values[n].contact_type});s.resolve(t)}},function(){s.reject("Unable to fetch contact list")}),s.promise}function m(t){var n,a,s=o.cache.contact.obj||{},r=[],c=[];e.extend(s,t);for(a in s)n=s[a],r.push(n),c.push({description:n.email?[n.email]:[],label:n.display_name,icon_class:n.contact_type,id:n.contact_id});r=i("orderBy")(r,"sort_name"),c=i("orderBy")(c,"label"),o.cache.contact={arr:r,obj:s,arrSearch:c}}return l.debug("Service: contactService"),{get:u,search:d,updateCache:m}}return n.__name="contactService",n.$inject=["Contact","$resource","config","$q","$filter","$rootScope","utilsService","$log"],n}),define("tasks-assignments/services/document.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,a,s,r,i,o,c,l){function u(t,s){if(!t||!e.isArray(t)||!s||"number"!=typeof+s)return null;if(!t.length)return t;var r=a.defer();return n.save({action:"copy_to_assignment"},{json:{id:t,case_id:s}||{}},function(e){i.errorHandler(e,"Unable to assign documents",r)||r.resolve(e.values)},function(){r.reject("Unable to assign documents")}),r.promise}function d(e,n){var i,l,u=[],d=[];return void 0===n&&(n=["contacts","assignments"]),n=Array.isArray(n)?n:[n],t.contains(n,"contacts")&&(u=m(e),s.CONTACT_ID&&u.push(s.CONTACT_ID),i=u&&u.length?o.get({IN:u}).then(function(e){o.updateCache(e)}):a.resolve()),t.contains(n,"assignments")&&(d=f(e),l=d&&d.length&&r.extEnabled.assignments?c.get({IN:d}).then(function(e){c.updateCache(e)}):a.resolve()),a.all([i,l])}function m(e){return t(e).map(function(e){var t=[];return t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&(t=t.concat(e.assignee_contact_id)),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0]),t}).flatten().value()}function f(e){return e.filter(function(e){return!!e.case_id}).map(function(e){return e.case_id})}function g(e){if(!e||"number"!=typeof+e)return null;var t=a.defer();return n.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete document ID: "+e)}),t.promise}function v(t){var s=a.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviDocument",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id, expire_date"},t),n.get({json:t},function(e){s.resolve(e.values)},function(){s.reject("Unable to fetch documents list")}),s.promise}function p(){var e=a.defer(),s={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"status_id"}},function(n){t.each(n.values,function(e){s.arr.push({key:e.key.toString(),value:e.value}),s.obj[e.key]=e.value}),e.resolve(s)}),e.promise}function h(){var e=a.defer(),s={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(n){t.each(n.values,function(e){s.arr.push({key:e.key,value:e.value}),s.obj[e.key]=e.value}),e.resolve(s)}),e.promise}function y(){return a.all({documentType:this.getDocumentTypes(),documentStatus:this.getDocumentStatus()})}function _(t){if(!t||"object"!=typeof t)return null;var r,o=a.defer(),c=e.extend({sequential:1,debug:s.DEBUG},t);return n.save({action:"create"},{json:c||{}},function(e){i.errorHandler(e,"Unable to save document",o)||(r=e.values,o.resolve(1===r.length?r[0]:null))},function(){o.reject("Unable to save document")}),o.promise}function k(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;var s=a.defer();return n.save({action:"create_multiple"},{json:{document:t}||{}},function(e){i.errorHandler(e,"Unable to save documents",s)||s.resolve(e.values)},function(){s.reject("Unable to save documents")}),s.promise}function $(e,t){if(!e||"number"!=typeof+e)return null;var s=a.defer();return n.save({action:"sendreminder"},{json:{activity_id:e,notes:t||""}||{}},function(e){i.errorHandler(e,"Unable to send a reminder",s)||s.resolve(e)},function(){s.reject("Unable to send a reminder")}),s.promise}return l.debug("Service: documentService"),{assign:u,cacheContactsAndAssignments:d,delete:g,get:v,getOptions:y,getDocumentStatus:p,getDocumentTypes:h,save:_,saveMultiple:k,sendReminder:$}}return n.__name="documentService",n.$inject=["Document","$q","config","settings","utilsService","contactService","assignmentService","$log"],n}),define("tasks-assignments/services/task.service",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function a(a,s,r,i,o){function c(t,n){if(!t||!e.isArray(t)||!n||"number"!=typeof+n)return null;if(!t.length)return t;var r=s.defer();return a.save({action:"copy_to_assignment"},{json:{id:t,case_id:n}||{}},function(e){i.errorHandler(e,"Unable to assign tasks",r)||r.resolve(e.values)},function(){r.reject("Unable to assign tasks")}),r.promise}function l(e){if(!e||"number"!=typeof+e)return null;var t=s.defer();return a.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete task ID: "+e)}),t.promise}function u(t){var n=s.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviTask",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id"},t),a.get({json:t},function(e){n.resolve(e.values)},function(){n.reject("Unable to fetch tasks list")}),n.promise}function d(){var e=s.defer(),n={arr:[],obj:{}};return a.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(a){t.each(a.values,function(e){n.arr.push({key:e.key,value:e.value}),n.obj[e.key]=e.value}),e.resolve(n)}),e.promise}function m(){return s.all({taskType:this.getActivityTypes(),taskStatus:this.getTaskStatus()})}function f(){var e=s.defer(),n={arr:[],obj:{}};return a.get({action:"getoptions",json:{field:"status_id"}},function(a){t.each(a.values,function(e){n.arr.push({key:e.key,value:e.value}),n.obj[e.key]=e.value}),e.resolve(n)}),e.promise}function g(t){if(!t||"object"!=typeof t)return null;t.activity_date_time instanceof Date&&(t.activity_date_time=n(t.activity_date_time.getTime()).format("YYYY-MM-DD"));var r,o=s.defer(),c=e.extend({},t);return a.save({action:"create"},{json:c||{}},function(e){i.errorHandler(e,"Unable to save task",o)||(r=e.values,o.resolve(1===r.length?r[0]:null))},function(){
o.reject("Unable to save task")}),o.promise}function v(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;t.forEach(function(e){e.activity_date_time instanceof Date&&(e.activity_date_time=n(e.activity_date_time.getTime()).format("YYYY-MM-DD"))});var r=s.defer();return a.save({action:"create_multiple"},{json:{task:t}||{}},function(e){i.errorHandler(e,"Unable to save tasks",r)||r.resolve(e.values)},function(){r.reject("Unable to save tasks")}),r.promise}function p(e,t){if(!e||"number"!=typeof+e)return null;var n=s.defer();return a.save({action:"sendreminder"},{json:{activity_id:e,notes:t}},function(e){i.errorHandler(e,"Unable to send a reminder",n)||n.resolve(e)},function(){n.reject("Unable to send a reminder")}),n.promise}return o.debug("Service: taskService"),{assign:c,delete:l,get:u,getActivityTypes:d,getOptions:m,getTaskStatus:f,save:g,saveMultiple:v,sendReminder:p}}return a.__name="taskService",a.$inject=["Task","$q","config","utilsService","$log"],a}),define("tasks-assignments/services/assignment.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(t,n,a,s,r,i,o,c,l,u,d,m,f,g){function v(e,n){if(!e||"number"!=typeof+e||!n||"number"!=typeof+n)return null;var a=i.defer();return t.save({action:"create",json:{sequential:1,contact_id_a:e,contact_id_b:o.LOGGED_IN_CONTACT_ID,relationship_type_id:9,case_id:n}},null,function(e){c.errorHandler(e,"Unable to assign coordinator",a)||a.resolve(e.values)},function(){a.reject("Unable to assign coordinator")}),a.promise}function p(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null;var t=i.defer();return n.get({json:{options:{limit:0},id:e,return:["case_type_id","contacts","client_id","contact_id","id","is_deleted","start_date","status_id","subject"],debug:o.DEBUG}},function(e){c.errorHandler(e,"Unable to fetch assignments",t)||t.resolve(e.values)},function(){t.reject("Unable to fetch assignments")}),t.promise}function h(){var e=i.defer();return s.get({},function(t){c.errorHandler(t,"Unable to fetch assignment types",e)||e.resolve(t.values)},function(){e.reject("Unable to fetch assignment types")}),e.promise}function y(t){if(!t||"object"!=typeof t)return null;var a,s=i.defer(),r=e.extend({sequential:1,debug:o.DEBUG},t);return n.save({action:"create",json:r},null,function(e){c.errorHandler(e,"Unable to save an assignment",s)||(a=e.values,s.resolve(1===a.length?a[0]:null))},function(){s.reject("Unable to save an assignment")}),s.promise}function _(e,t,n){return n=Array.isArray(n)?n.join(","):n,a.query({sortName:e,excludeCaseIds:t,includeContactIds:n}).$promise}function k(e){return document.getElementsByClassName("CRM_Case_Form_Search").length?void CRM.refreshParent(".CRM_Case_Form_Search"):document.getElementById("tab_case")?void CRM.tabHeader.updateCount("#tab_case",CRM.tabHeader.getCount("#tab_case")+(e||0)):void("/assignments"===u.path()&&d.reload(!0))}function $(t){var n,a,s,r=m.cache.assignment.obj||{},i=[],o=[];e.extend(r,t);for(a in r)n=r[a],s=m.cache.assignmentType.obj[n.case_type_id].title,i.push(n),o.push({label:n.contacts[0].sort_name+" - "+s+(n.end_date?" (closed)":""),label_class:+n.is_deleted||n.end_date?"strikethrough":"",id:a,extra:{case_subject:n.subject,case_type:s,contact_id:n.contacts[0].contact_id,end_date:n.end_date,sort_name:n.contacts[0].sort_name,start_date:n.start_date}});i=l("orderBy")(i,"subject"),o=l("orderBy")(o,"label"),m.cache.assignment={arr:i,obj:r,arrSearch:o}}return f.debug("Service: assignmentService"),{get:p,assignCoordinator:v,getTypes:h,save:y,search:_,updateCache:$,updateTab:k}}return n.__name="assignmentService",n.$inject=["Relationship","Assignment","AssignmentSearch","AssignmentType","contactService","$q","config","utilsService","$filter","$location","$state","$rootScope","$log","$timeout"],n}),define("tasks-assignments/controllers/modal/modal-assignment-activity.controller",["common/lodash","common/angular","common/moment","tasks-assignments/services/contact.service","tasks-assignments/services/document.service","tasks-assignments/services/task.service","tasks-assignments/services/assignment.service"],function(e,t,n){"use strict";function a(e,t){function a(){t.$watch("$parent.assignment.dueDate",function(e){t.activity.create&&(t.activity.activity_date_time=e?n(e).add(t.activity.offset,"days").toDate():null)}),t.$watch("$parent.assignment.contact_id",function(e){e&&t.activity.create&&(t.activity.target_contact_id=[e])})}e.debug("Controller: ModalAssignmentTaskController"),t.isDisabled=!t.activity.activity_type_id&&!t.activity.isAdded,t.activity.create=!t.isDisabled,function(){a()}()}return a.__name="ModalAssignmentActivityController",a.$inject=["$log","$scope"],a}),define("tasks-assignments/controllers/modal/modal-assignment.controller",["common/lodash","common/angular","common/moment"],function(e,t,n){"use strict";function a(n,a,s,r,i,o,c,l,u,d,m,f,g,v,p,h,y,_){function k(e){e&&e.push(t.extend(t.copy(V),{isAdded:!0}))}function $(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},v.updateCache(t)}function b(){c.dismiss("cancel")}function w(){if(!n("filter")(i.taskList,{create:!0}).length&&!n("filter")(i.documentList,{create:!0}).length)return i.alert.msg="Please add at least one task.",void(i.alert.show=!0);U(i.assignment)&&(i.$broadcast("ct-spinner-show"),i.assignment.start_date=new Date,m.save(i.assignment).then(function(e){var n=i.documentList.filter(function(e){return e.create}).map(function(t){return t.case_id=e.id,t}),a=i.taskList.filter(function(e){return e.create}).map(function(t){return t.case_id=e.id,t});s.all({relationship:m.assignCoordinator(i.assignment.contact_id,e.id),document:g.saveMultiple(n.map(function(e){return t.copy(e)})),task:f.saveMultiple(a.map(function(e){return t.copy(e)}))}).then(function(s){var o,l=[],d=[],f={};for(o=0;o<s.task.length;o++)a[o].id=s.task[o].id,l.push(s.task[o].id);for(o=0;o<s.document.length;o++)n[o].id=s.document[o].id,d.push(s.document[o].id);f[e.id]=t.extend(t.copy(i.assignment),{id:e.id,client_id:{1:i.assignment.client_id},contact_id:{1:i.assignment.contact_id},contacts:[{sort_name:r.cache.contact.obj[i.assignment.contact_id].sort_name,contact_id:i.assignment.contact_id,role:"Client"},{sort_name:r.cache.contact.obj[u.LOGGED_IN_CONTACT_ID].sort_name,contact_id:u.LOGGED_IN_CONTACT_ID,role:"Case Coordinator"}],is_deleted:"0",end_date:"",activities:l.concat(d)}),m.updateCache(f),m.updateTab(1),c.close({documentList:n,taskList:a}),i.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),i.$broadcast("ct-spinner-hide"),s.reject()})},function(e){return CRM.alert(e,"Error","error"),i.$broadcast("ct-spinner-hide"),s.reject()}))}function C(t,n){var a=T(t);t.forEach(function(s,r){var o=i.contacts[n][e.indexOf(t,a)]||[],c=a.assignee_contact_id?[a.assignee_contact_id[0]]:a.assignee_contact_id;s.create&&(i.contacts[n][r]=o.slice(),s.assignee_contact_id=c)})}function D(e){e.forEach(function(t){t.create&&(t.activity_date_time=T(e).activity_date_time)})}function S(e,t){e.preventDefault(),e.stopPropagation(),i.dpOpened[t]=!0}function T(t){return e.find(t,function(e){return e.create})}function E(e){switch(e.default_assignee_type){case H.SPECIFIC_CONTACT:return s.resolve([e.default_assignee_contact]);case H.USER_CREATING_THE_CASE:return s.resolve([y.contactId]);case H.BY_RELATIONSHIP:return A(e);case H.NONE:default:return s.resolve(null)}}function A(e){return i.assignment.client_id?_.allValid({contact_id_a:i.assignment.client_id,"relationship_type_id.name_b_a":e.default_assignee_relationship,options:{limit:1}}).then(function(e){return e.list.map(function(e){return e.contact_id_b})}):s.resolve(null)}function x(){var n=!!d.tabEnabled.documents,a=e.indexBy(r.cache.documentType.arr,"value"),s=e.indexBy(r.cache.taskType.arr,"value");i.$watch("activity.activitySet",function(e){if(!e||!e.activityTypes)return void(i.taskList=[]);i.documentList=[],i.taskList=[],e.activityTypes.forEach(function(e){var r=t.copy(V),o=a[e.name],c=s[e.name];r.name=e.name,r.offset=e.reference_offset,o&&n?(r.activity_type_id=o.key,i.documentList.push(r)):o||(r.activity_type_id=c?c.key:null,i.taskList.push(r))}),M().then(R)})}function j(){var t=r.$watch("cache.assignmentType.obj",function(n){e.isEmpty(n)||(F(),t())},!0)}function M(){var t;return i.activity.activitySet.activityTypes?(t=i.activity.activitySet.activityTypes.map(function(t){var n=e.chain(i.documentList).concat(i.taskList).find({name:t.name}).value();if(n)return E(t).then(function(e){n.assignee_contact_id=e})}),s.all(t)):s.resolve()}function O(){H={},e.forEach(h,function(e){H[e.name]=e.value})}function I(){x(),j()}function R(){var t=e.chain(i.taskList).concat(i.documentList).map(function(e){return e.assignee_contact_id}).flatten().compact().uniq().value();if(0!==t.length)return v.get({IN:t}).then(function(t){var n=e.map(t,function(e){return{id:e.id,label:e.display_name}});i.contacts.task=i.taskList.map(function(){return n}),i.contacts.document=i.documentList.map(function(){return n})})}function L(){i.assignment.client_id=i.assignment.contact_id,M().then(R)}function P(e,t,n){e&&v.search(e,{contact_type:"Individual"}).then(function(e){"target"===t?i.contacts[t]=e:i.contacts[t][n]=e})}function N(e,t){e&&e.splice(t,1)}function F(){var e=r.cache.assignmentType.obj[i.assignment.case_type_id];if(!e)return i.activity.activitySet={},void(i.assignment.subject="");i.activity.activitySet=e.definition.activitySets[0],i.assignment.subject=r.cache.assignmentType.obj[i.assignment.case_type_id].title,i.assignment.dueDate=i.assignment.dueDate||new Date((new Date).setHours(0,0,0,0))}function q(e){i.activity.activitySet=e}function U(t){var n=[];if(!t.contact_id&&n.push("Target Contact"),!t.case_type_id&&n.push("Assignment type"),!t.dueDate&&n.push("Key date"),i.taskList.filter(function(e){return e.create}).forEach(function(t){e.includes(n,"Activity type")||!t.activity_type_id&&n.push("Activity type"),e.includes(n,"Activity Due Date")||!t.activity_date_time&&n.push("Activity Due Date")}),n.length){var a=CRM.alert(n.join(", "),1===n.length?"Required field":"Required fields","error");return o(function(){a.close(),a=null},5e3),!1}return!0}a.debug("Controller: ModalAssignmentController");var H,V={activity_type_id:null,assignee_contact_id:[],case_id:null,create:!0,isAdded:!1,name:null,source_contact_id:u.LOGGED_IN_CONTACT_ID,status_id:"1",offset:0};i.assignment=t.copy(p),i.assignment.status_id="1",i.assignment.contact_id=u.CONTACT_ID,i.assignment.client_id=i.assignment.contact_id,i.assignment.subject="",i.assignment.dueDate=null,i.copyMessage="Click here to copy the value in row one to all rows.",i.documentList=[],i.dpOpened={},i.format=l.DATE_FORMAT.toLowerCase(),i.showCId=!u.CONTACT_ID,i.taskList=[],i.activity={activitySet:{}},i.alert={show:!1,msg:"",type:"danger"},i.contacts={target:[],document:[],task:[]},i.addActivity=k,i.cacheContact=$,i.cancel=b,i.confirm=w,i.copyAssignee=C,i.copyDate=D,i.dpOpen=S,i.onTargetContactChange=L,i.refreshContacts=P,i.removeActivity=N,i.setData=F,i.updateTimeline=q,function(){O(),I()}()}return a.__name="ModalAssignmentController",a.$inject=["$filter","$log","$q","$rootScope","$scope","$timeout","$uibModalInstance","HR_settings","config","settings","assignmentService","taskService","documentService","contactService","data","defaultAssigneeOptions","session","RelationshipModel"],a}),define("tasks-assignments/controllers/modal/modal-dialog.controller",[],function(){"use strict";function e(e,t,n,a,s){function r(){a.close(!1)}function i(e){a.close(e||!0)}e.debug("Controller: ModalDialogController"),t.copyCancel=s.copyCancel||"Cancel",t.copyConfirm=s.copyConfirm||"Yes",t.msg=s.msg||"",t.title=s.title||"CiviHR Tasks & Workflows",t.confirm=i,t.cancel=r}return e.__name="ModalDialogController",e.$inject=["$log","$scope","$timeout","$uibModalInstance","content"],e}),define("tasks-assignments/controllers/modal/modal-document.controller",["common/angular","common/lodash","common/moment","common/services/file.service","common/services/notification.service"],function(e,t,n){"use strict";function a(a,s,r,i,o,c,l,u,d,m,f,g,v,p,h,y,_,k,$,b,w,C,D,S,T){function E(e){-1===ie.document.assignee_contact_id.indexOf(e.id)&&ie.document.assignee_contact_id.push(e.id),ie.cacheContact(e)}function A(e,t,n){return e+=(e.split("?")[1]?"&":"?")+t+"="+n}function x(e){var t={};e&&!o.cache.assignment.obj[e.id]&&(t[e.id]={case_type_id:a("filter")(o.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},y.updateCache(t))}function j(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},_.updateCache(t)}function M(){if(ie.documentForm.$pristine&&e.equals(T,ie.files)&&!ie.uploader.queue.length)return void f.dismiss("cancel");d.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(c.$broadcast("ct-spinner-hide"),f.dismiss("cancel"))})}function O(){ie.contacts={target:B("target"),assignee:B("assignee")}}function I(){ie.assignments=a("filter")(o.cache.assignment.arrSearch,function(e){return+e.extra.contact_id==+ie.document.target_contact_id})}function R(){var t=e.copy(ie.document);if(ne(t)){if(e.equals(S,t)&&e.equals(T,ie.files)&&!ie.uploader.queue.length)return void f.dismiss("cancel");var n,a=[];if(ie.isRole("staff")&&!ie.uploader.queue.length&&!ie.files.length)return void(ie.containsFiles=!1);if(te(ie.uploader.queue)){if(c.$broadcast("ct-spinner-show"),+t.case_id==+S.case_id&&delete t.case_id,t.activity_date_time=ie.parseDate(t.activity_date_time)||"",t.expire_date=ie.parseDate(t.expire_date),t.status_id=ie.getDocumentStatus()||ie.document.status_id,ie.filesTrash.length)for(var s=0;s<ie.filesTrash.length;s++)n=ie.filesTrash[s],a.push($.delete(n.fileID,n.entityID,n.entityTable));r.all({document:k.save(t),files:a.length?r.all(a):[]}).then(function(e){if(ie.uploader.queue.length){var t=m.open({appendTo:i.find("div").eq(0),templateUrl:p.path.TPL+"/modal/progress.html?v=1",size:"sm",controller:"ModalProgressController",resolve:{uploader:function(){return ie.uploader},entityId:function(){return e.document.id}}});return e.files=t.result,r.all(e)}return e}).then(function(e){ie.document.case_id=e.document.case_id,ie.document.file_count=ie.files.length+ie.uploader.queue.length,ie.document.id=e.document.id,ie.document.status_id=e.document.status_id,y.updateTab(),f.close(ie.document),o.$broadcast("document-saved"),c.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),f.dismiss(),c.$broadcast("ta-spinner-hide"),r.reject()})}}}function L(e,t){e.preventDefault(),e.stopPropagation(),ie.dpOpened[t]=!0}function P(){l(function(){document.getElementById(o.prefix+"document-files").click()})}function N(e){ie.filesTrash.push(ie.files[e]),ie.files.splice(e,1)}function F(){ie.document.activity_date_time=ie.document.activity_date_time?n(ie.document.activity_date_time).toDate():null,ie.document.expire_date=ie.document.expire_date?n(ie.document.expire_date).toDate():null,ie.document.assignee_contact_id=ie.document.assignee_contact_id||[],ie.document.source_contact_id=ie.document.source_contact_id||p.LOGGED_IN_CONTACT_ID,ie.document.status_id=ie.document.status_id||"1",ie.document.target_contact_id=ie.document.target_contact_id||[p.CONTACT_ID],ie.document.valid_from=ie.document.valid_from?n(ie.document.valid_from).toDate():null}function q(){h.get(["maxFileSize"]).then(function(e){ie.fileSizeLimit=1e6*+e[0].maxFileSize})}function U(){return ie.isRole("admin")?ie.files.length||ie.uploader.queue.length?ie.getStatusIdByName("approved"):ie.getStatusIdByName("awaiting upload"):ie.files.length||ie.uploader.queue.length?ie.getStatusIdByName("awaiting approval"):ie.getStatusIdByName("awaiting upload")}function H(e){return t.findKey(o.cache.documentStatus.obj,function(t){return t===e})}function V(e){var n=t.find(o.cache.documentType.arr,function(t){return t.key===e});return n&&n.value}function B(e){var t=o.cache.contact.arrSearch;return ie.document.id||"edit"!==C?t.filter(function(t){return+ie.document[e+"_contact_id"][0]==+t.id}):[]}function Y(e){return ie.role===e}function G(e){o.$broadcast("ct-spinner-show"),ie.document.case_id="",ie.cacheContact(e),ie.searchContactAssignments(e.id)}function W(e){e instanceof Date&&(e=e.getTime());var t=n(e,[v.DATE_FORMAT.toUpperCase(),"x","YYYY-MM-DD"]);return t.isValid()?t.format("YYYY-MM-DD"):null}function z(e){ie.document.assignee_contact_id.splice(e,1)}function K(e){if(e){var t=ie.document.target_contact_id;y.search(e,ie.document.case_id).then(function(e){ie.assignments=a("filter")(e,function(e){return+e.extra.contact_id==+t})})}}function X(e,t){e&&_.search(e,{contact_type:"Individual"}).then(function(e){ie.contacts[t]=e})}function J(){CRM.help("Remind me?",ie.remindMeMessage,"error")}function Q(e){return y.search(null,null,e).then(function(e){ie.assignments=e,o.$broadcast("ct-spinner-hide")})}function Z(){ie.document.status_id=1}function ee(){return!!ie.document.status_id}function te(e){var n="Files larger than "+ie.fileSizeLimit/1e6+"MB are not allowed.",a=!0;return e.length&&t.each(e,function(e){+e._file.size>=ie.fileSizeLimit&&(a=!1)}),!a&&w.alert("Large files",n,{expires:5e3}),a}function ne(e){var t=[];if(e.target_contact_id[0]||t.push("Contact"),e.activity_type_id||t.push("Document type"),e.status_id||t.push("Document status"),e.status_id||t.push("Status"),t.length){var n=1===t.length?"Required field":"Required fields",a=t.join(", ");return w.alert(n,a,{expires:5e3}),!1}return!0}function ae(e){o.$broadcast("ct-spinner-show"),b.openFile(e).then(function(e){o.$broadcast("ct-spinner-hide")})}function se(){o.$watch("cache.contact.arrSearch",O)}function re(){g.loadForm("/civicrm/admin/options/activity_type?reset=1").on("crmUnload",function(){k.getOptions().then(function(t){e.extend(o.cache,t)})})}s.debug("Controller: ModalDocumentController");var ie=this;ie.document={},ie.files=[],ie.fileSizeLimit=0,ie.filesTrash=[],ie.mode=C,ie.modalTitle="edit"===ie.mode?"Edit Document":"New Document",ie.containsFiles=!0,ie.remindMeMessage='Checking this box sets a reminder that this document needs to be renewed a set number of days before the Expiry Date. You can set this by going <a target="_blank" href="/civicrm/tasksassignments/settings">here</a> CiviHR will do this by creating a copy of this document with the status awaiting upload, which you will be able to see in your Documents list.',ie.role=D||"admin",ie.showCId=!p.CONTACT_ID,ie.uploader=$.uploader("civicrm_activity"),ie.dpOpened={due:!1,exp:!1,form:!1},ie.addAssignee=E,ie.addQueryParam=A,ie.cacheAssignment=x,ie.cacheContact=j,ie.cancel=M,ie.confirm=R,ie.dpOpen=L,ie.dropzoneClick=P,ie.fileMoveToTrash=N,ie.getDocumentType=V,ie.getDocumentStatus=U,ie.getStatusIdByName=H,ie.isRole=Y,ie.onContactChanged=G,ie.parseDate=W,ie.removeAssignee=z,ie.refreshAssignments=K,ie.refreshContacts=X,ie.remindMeInfo=J,ie.statusFieldVisible=ee,ie.showStatusField=Z,ie.searchContactAssignments=Q,ie.viewFile=ae,ie.openActivityTypeOptionsEditor=re,function(){e.copy(S,ie.document),e.copy(T,ie.files),I(),F(),O(),se(),q()}()}return a.__name="ModalDocumentController",a.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$window","$dialog","$uibModal","$uibModalInstance","crmAngService","HR_settings","config","appSettingsService","assignmentService","contactService","documentService","fileServiceTA","fileService","notificationService","modalMode","role","data","files"],a}),define("tasks-assignments/controllers/modal/modal-progress.controller",[],function(){"use strict";function e(e,t,n,a,s,r,i,o){function c(){s.dismiss("File upload canceled")}e.debug("Controller: ModalProgressController"),n.uploader=i,n.cancel=c,function(){i.queue.length&&(i.item=i.queue[0].file.name),i.onProgressItem=function(e){this.item=e.file.name},r.upload(i,o).then(function(e){a(function(){s.close(e)},500)})}()}return e.__name="ModalProgressController",e.$inject=["$log","$q","$scope","$timeout","$uibModalInstance","fileServiceTA","uploader","entityId"],e}),define("tasks-assignments/controllers/modal/modal-reminder.controller",["common/angular"],function(e){"use strict";function t(t,n,a,s,r,i,o,c,l,u,d,m){function f(){o.dismiss("cancel")}function g(){r.$broadcast("ct-spinner-show"),("task"===m?l:c).sendReminder(r.data.id,r.reminder.notes).then(function(){CRM.alert("Message sent to: "+s.cache.contact.obj[r.data.assignee_contact_id[0]].sort_name,"Reminder sent","success"),o.close(),r.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),o.dismiss(),r.$broadcast("ta-spinner-hide"),a.reject()})}n.debug("Controller: ModalReminderController"),r.data={},r.type=m,e.copy(d,r.data),r.reminder={},r.data.assignee_contact_id=r.data.assignee_contact_id||[],r.data.target_contact_id=r.data.target_contact_id||[u.CONTACT_ID],r.contacts=s.cache.contact.arrSearch,r.showCId=!u.CONTACT_ID,r.cancel=f,r.confirm=g}return t.__name="ModalReminderController",t.$inject=["$filter","$log","$q","$rootScope","$scope","$dialog","$uibModalInstance","documentService","taskService","config","data","type"],t}),define("tasks-assignments/controllers/modal/modal-task-migrate.controller",["common/angular"],function(e){"use strict";function t(t,n,a,s,r,i,o,c,l,u,d,m,f,g,v,p,h){function y(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},m.updateCache(t)}function _(){if(i.taskMigrateForm.$pristine)return void l.dismiss("cancel");u.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(i.$broadcast("ct-spinner-hide"),l.dismiss("cancel"))})}function k(){if(i.migrate.task.statusListSelected||i.migrate.document.statusListSelected){var t,n=[],s=[],o=0;e.forEach(i.migrate.task.list,function(e){i.migrate.task.statusListSelected.indexOf(e.status_id)>-1&&this.push(e)},n),+h.tabEnabled.documents&&e.forEach(i.migrate.document.list,function(e){i.migrate.document.statusListSelected.indexOf(e.status_id)>-1&&this.push(e)},n),i.$broadcast("ct-spinner-show"),e.forEach(n,function(n){n.assignee_contact_id[0]=i.migrate.to,this.push(function(){var s=a.defer();return t=o?this[o-1]:{},a.when(t).then(function(){v.save({entity:"Activity",action:"create",json:e.extend({sequential:"1",component:""},n)},null,function(e){g.errorHandler(e,"Unable to save task",s)||s.resolve(1===e.values.length?e.values[0]:null)},function(){s.reject("Unable to save task")})}),s.promise}.bind(this)()),o++},s),a.all(s).then(function(e){e.length?CRM.alert(e.length+" item(s) re-assigned from: "+r.cache.contact.obj[i.migrate.from].sort_name+" to: "+r.cache.contact.obj[i.migrate.to].sort_name,"Migrate Tasks","success"):CRM.alert("0 items re-assigned.","Migrate Tasks","warning"),l.dismiss(),i.$broadcast("ct-spinner-hide")},function(e){CRM.alert(e,"Error","error"),l.dismiss(),i.$broadcast("ct-spinner-hide")})}}function $(n){i.$broadcast("ct-spinner-show"),n=n||i.migrate.from,i.migrate.task.statusList=[],i.migrate.task.statusListSelected=[],i.migrate.document.statusList=[],i.migrate.document.statusListSelected=[],i.migrate.dataLoaded=!1;var a=[];v.get({entity:"ActivityContact",json:{component:"",sequential:"1",return:"activity_id",contact_id:n,record_type_id:"1",options:{limit:"0"}}},function(n){n.values&&n.values.length?(e.forEach(n.values,function(e){this.push(e.activity_id)},a),v.get({entity:"Activity",json:{component:"",options:{limit:0},id:{IN:a},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"assignee_contact_id, activity_type_id, assignee_contact_id, id, status_id"}},function(n){function a(e,t){var n=i.migrate[e];n.list.push(t),n.statusList.indexOf(t.status_id)>-1||(o[e].indexOf(t.status_id)>-1?n.statusList.push(t.status_id):(n.statusList.unshift(t.status_id),n.statusListSelected.push(t.status_id)))}var s=r.cache.documentType.obj,o={task:r.cache.taskStatusResolve,document:r.cache.documentStatusResolve};n.values&&n.values.length&&(n.values=t("orderBy")(n.values,"-status_id"),e.forEach(n.values,function(e){s[e.activity_type_id]?a("document",e):a("task",e)})),i.migrate.dataLoaded=!0,i.$broadcast("ct-spinner-hide")})):(i.migrate.dataLoaded=!0,i.$broadcast("ct-spinner-hide"))})}function b(e){e&&m.search(e,{contact_type:"Individual"}).then(function(e){i.contacts=e})}n.debug("Controller: ModalTaskMigrateController"),i.contacts=r.cache.contact.arrSearch,i.migrate={},i.migrate.dataLoaded=!1,i.migrate.from="",i.migrate.to="",i.migrate.document={list:[],statusList:[],statusListSelected:[]},i.migrate.task={list:[],statusList:[],statusListSelected:[]},i.cacheContact=y,i.cancel=_,i.confirm=k,i.getActivities=$,i.refreshContacts=b}return t.__name="ModalTaskMigrateController",t.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$uibModal","$uibModalInstance","$dialog","assignmentService","contactService","taskService","utilsService","Task","activityType","settings"],t}),define("tasks-assignments/controllers/modal/modal-task.controller",["common/angular","common/moment"],function(e,t){"use strict";function n(n,a,s,r,i,o,c,l,u,d,m,f,g,v,p,h,y){function _(e){if(!i.cache.assignment.obj[e.id]){var t={};t[e.id]={case_type_id:n("filter")(i.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},f.updateCache(t)}}function k(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},g.updateCache(t)}function $(){if(o.taskForm.$pristine)return void u.dismiss("cancel");d.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(o.$broadcast("ct-spinner-hide"),u.dismiss("cancel"))})}function b(){var t=e.copy(o.task);if(E(t)){if(e.equals(h,t))return void u.dismiss("cancel");o.$broadcast("ct-spinner-show"),+t.case_id==+h.case_id&&delete t.case_id,t.activity_date_time=t.activity_date_time||new Date,v.save(t).then(function(e){o.task.id=e.id,o.task.case_id=e.case_id,f.updateTab(),o.openNew&&(o.task.open=!0,o.openNew=!1),u.close(o.task),o.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),o.$broadcast("ct-spinner-hide"),s.reject()})}}function w(e){e.preventDefault(),e.stopPropagation(),o.dpOpened=!0}function C(e){var t=i.cache.contact.arrSearch;return o.task.id?t.filter(function(t){return+o.task[e+"_contact_id"][0]==+t.id}):[]}function D(){o.$watch("task.target_contact_id",function(e,t){e!==t&&(o.task.case_id=null,o.showFieldAssignment=!1,S(e))},!0)}function S(e){o.assignments=[],e[0]&&(c(function(){o.$broadcast("ct-spinner-show")},0),f.search(null,null,e).then(function(e){o.assignments=e,o.$broadcast("ct-spinner-hide")}))}function T(e,t){e&&g.search(e,{contact_type:"Individual"}).then(function(e){o.contacts[t]=e})}function E(e){var t=[];if(e.target_contact_id[0]||t.push("Task Target"),e.activity_type_id||t.push("Task type"),e.activity_date_time||t.push("Due date"),t.length){var n=CRM.alert(t.join(", "),1===t.length?"Required field":"Required fields","error");return c(function(){n.close(),n=null},5e3),!1}return!0}function A(){m.loadForm("/civicrm/admin/options/activity_type?reset=1").on("crmUnload",function(){v.getOptions().then(function(t){e.extend(i.cache,t)})})}a.debug("Controller: ModalTaskController"),o.assignments=[],o.format=p.DATE_FORMAT.toLowerCase(),o.data=h,o.showCId=!y.CONTACT_ID,o.showFieldAssignment=!1,o.task={},e.copy(h,o.task),o.modalTitle=o.task.id?"Edit Task":"New Task",o.task.activity_date_time=o.task.activity_date_time||t().toDate(),o.task.assignee_contact_id=o.task.assignee_contact_id||[],o.task.source_contact_id=o.task.source_contact_id||y.LOGGED_IN_CONTACT_ID,o.task.target_contact_id=o.task.target_contact_id||[y.CONTACT_ID],o.contacts={target:C("target"),assignee:C("assignee")},o.cacheAssignment=_,o.cacheContact=k,o.cancel=$,o.confirm=b,o.dpOpen=w,o.refreshContacts=T,o.task.openActivityTypeOptionsEditor=A,function(){D(),o.task.id&&S(o.task.target_contact_id)}()}return n.__name="ModalTaskController",n.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$timeout","$uibModal","$uibModalInstance","$dialog","crmAngService","assignmentService","contactService","taskService","HR_settings","data","config"],n}),define("tasks-assignments/modules/tasks-assignments.controllers",["common/angular","tasks-assignments/controllers/assignments.controller","tasks-assignments/controllers/calendar.controller","tasks-assignments/controllers/date-list.controller","tasks-assignments/controllers/document-list.controller","tasks-assignments/controllers/document.controller","tasks-assignments/controllers/external-page.controller","tasks-assignments/controllers/main.controller","tasks-assignments/controllers/settings.controller","tasks-assignments/controllers/task-list.controller","tasks-assignments/controllers/task.controller","tasks-assignments/controllers/dashboard/nav-main.controller","tasks-assignments/controllers/dashboard/top-bar.controller","tasks-assignments/controllers/modal/modal-assignment-activity.controller","tasks-assignments/controllers/modal/modal-assignment.controller","tasks-assignments/controllers/modal/modal-dialog.controller","tasks-assignments/controllers/modal/modal-document.controller","tasks-assignments/controllers/modal/modal-progress.controller","tasks-assignments/controllers/modal/modal-reminder.controller","tasks-assignments/controllers/modal/modal-task-migrate.controller","tasks-assignments/controllers/modal/modal-task.controller"],function(e,t,n,a,s,r,i,o,c,l,u,d,m,f,g,v,p,h,y,_,k){"use strict";return e.module("tasks-assignments.controllers",[]).controller(t.__name,t).controller(n.__name,n).controller(a.__name,a).controller(s.__name,s).controller(r.__name,r).controller(i.__name,i).controller(o.__name,o).controller(c.__name,c).controller(l.__name,l).controller(u.__name,u).controller(d.__name,d).controller(m.__name,m).controller(f.__name,f).controller(g.__name,g).controller(v.__name,v).controller(p.__name,p).controller(h.__name,h).controller(y.__name,y).controller(_.__name,_).controller(k.__name,k)}),define("tasks-assignments/vendor/angular-bootstrap-calendar",["common/moment"],function(e){"use strict";angular.module("mwl.calendar",[]),angular.module("mwl.calendar").run(["$templateCache",function(e){
e.put("src/templates/calendar.html",'<div class="cal-context" ng-switch="view"><div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div><div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div><mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year"></mwl-calendar-year><mwl-calendar-month events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month"></mwl-calendar-month><mwl-calendar-week events="events" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week"></mwl-calendar-week><mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day"></mwl-calendar-day></div>'),e.put("src/templates/calendarCustom.html",'<div class="cal-context" ng-switch="view"> <div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div> <div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div> <mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year" ></mwl-calendar-year> <mwl-calendar-month events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month" ></mwl-calendar-month> <mwl-calendar-week events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week" ></mwl-calendar-week> <mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day" ></mwl-calendar-day></div>'),e.put("src/templates/calendarDayView.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.timeLabel"></div><div class="span11 col-xs-11 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.eventsLabel"></div></div><div class="cal-day-panel clearfix" ng-style="{height: (vm.hours.length * vm.hourHeight) + \'px\'}"><div class="cal-day-panel-hour"><div class="cal-day-hour" ng-repeat="hour in vm.hours track by $index"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><strong ng-bind="hour.label"></strong></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight" ng-class="\'dh-event-\' + event.type" ng-repeat="event in vm.view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title | calendarTruncateEventTitle:20:event.height"></span></a></div></div></div>'),e.put("src/templates/calendarMonthDay.html",'<div class="cal-month-day" ng-class="{\n            \'cal-day-outmonth\': !day.inMonth,\n            \'cal-day-inmonth\': day.inMonth,\n            \'cal-day-weekend\': day.isWeekend,\n            \'cal-day-past\': day.isPast,\n            \'cal-day-today\': day.isToday,\n            \'cal-day-future\': day.isFuture\n          }"><small class="cal-events-num badge badge-important pull-left" ng-show="day.badgeTotal > 0" ng-bind="day.badgeTotal"></small> <span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" ng-bind="day.label"></span><div class="cal-day-tick" ng-show="dayIndex === vm.openDayIndex && vm.view[vm.openDayIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div ng-include="\'src/templates/calendarMonthEventsList.html\'"></div></div>'),e.put("src/templates/calendarMonthDayCustom.html",'<div class="cal-month-day" ng-class="{ \'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture }"> <ul class="cal-list-events-num"> <li ng-show="day.badgeEventsTotal > 0"> <small class="badge badge-danger-light" ng-bind="day.badgeEventsTotal"></small> Tasks </li> <li ng-show="day.badgeDocumentsTotal > 0"> <small class="badge badge-dark" ng-bind="day.badgeDocumentsTotal"></small> Documents </li> </ul> <span class="pull-right" data-cal-date ng-bind="day.label"> </span></div>'),e.put("src/templates/calendarMonthEventsList.html",'<div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" ng-repeat="event in day.events track by $index" class="pull-left event" ng-class="\'event-\' + event.type" ng-mouseenter="vm.highlightEvent(event, true)" ng-mouseleave="vm.highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div>'),e.put("src/templates/calendarMonthView.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"><div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"><div class="cal-row-fluid cal-before-eventlist"><div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.dayClicked(day)" ng-class="{pointer: day.events.length > 0}"><div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openDayIndex].events.length > 0" events="vm.view[vm.openDayIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>'),e.put("src/templates/calendarMonthViewCustom.html",'<div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"> <div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"> <div class="cal-row-fluid cal-before-eventlist"> <div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="pointer cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.calendarCtrl.drillDown(day.date)"> <div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div> </div> </div> </div></div>'),e.put("src/templates/calendarSlideBox.html",'<div class="cal-slide-box" collapse="vm.shouldCollapse" mwl-collapse-fallback="vm.shouldCollapse"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in events track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title"></span> <span ng-show="isMonthView">(<span ng-bind="event.startsAt | date:\'shortTime\'"></span>)</span> <span ng-show="isYearView">(<span ng-bind="event.startsAt | date:\'MMM d, h:mm a\'"></span>)</span></a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="vm.$sce.trustAsHtml(editEventHtml)" ng-click="onEditEventClick({calendarEvent: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="vm.$sce.trustAsHtml(deleteEventHtml)" ng-click="onDeleteEventClick({calendarEvent: event})"></a></li></ul></div></div>'),e.put("src/templates/calendarWeekView.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{\n        \'cal-day-weekend\': day.isWeekend,\n        \'cal-day-past\': day.isPast,\n        \'cal-day-today\': day.isToday,\n        \'cal-day-future\': day.isFuture}"><span ng-bind="day.weekDayLabel"></span><br><small><span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"></span></small></div></div><div class="cal-row-fluid" ng-repeat="event in vm.view.events track by $index"><div ng-class="\'cal-cell\' + event.daySpan + \' cal-offset\' + event.dayOffset + \' day-highlight dh-event-\' + event.type" data-event-class><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"></a></div></div></div>'),e.put("src/templates/calendarWeekViewCustom.html",'<div class="cal-week-box"> <div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{ \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture}"> <span ng-bind="day.weekDayLabel"></span> <br> <small> <span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"> </span> </small> </div> </div> <div class="cal-col-fluid" ng-repeat="col in vm.view.cols track by $index"> <div class="cal-row-fluid" ng-repeat="event in col track by $index"> <div ng-if="event.title" ng-class="\'day-highlight dh-event-\' + event.type + \' dh-event-overdue-\' + event.overdue" data-event-class> <a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"> </a> </div> </div> </div></div>'),e.put("src/templates/calendarYearView.html",'<div class="cal-year-box"><div ng-repeat="rowOffset in [0, 4, 8] track by rowOffset"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in vm.view | calendarLimitTo:4:rowOffset track by $index" ng-init="monthIndex = vm.view.indexOf(month)" ng-click="vm.monthClicked(month)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(month.date)" ng-bind="month.label"></span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.badgeTotal > 0" ng-bind="month.badgeTotal"></small><div class="cal-day-tick" ng-show="monthIndex === vm.openMonthIndex && vm.view[vm.openMonthIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openMonthIndex].events.length > 0" events="vm.view[vm.openMonthIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>')}]),angular.module("mwl.calendar").constant("moment",e),angular.module("mwl.calendar").factory("calendarTitle",["moment","calendarConfig",function(e,t){function n(n){return e(n).format(t.titleFormats.day)}function a(n){return t.titleFormats.week.replace("{week}",e(n).week()).replace("{year}",e(n).format("YYYY"))}function s(n){return e(n).format(t.titleFormats.month)}function r(n){return e(n).format(t.titleFormats.year)}return{day:n,week:a,month:s,year:r}}]),angular.module("mwl.calendar").factory("calendarHelper",["moment","calendarConfig",function(e,t){function n(t,n,a,s){return t=e(t),n=e(n),a=e(a),s=e(s),t.isAfter(a)&&t.isBefore(s)||n.isAfter(a)&&n.isBefore(s)||t.isBefore(a)&&n.isAfter(s)||t.isSame(a)||n.isSame(s)}function a(t,a,s){var r=e(t).startOf(a),i=e(t).endOf(a);return s.filter(function(e){return n(e.startsAt,e.endsAt,r,i)})}function s(e){return e.filter(function(e){return!1!==e.incrementsBadgeTotal}).length}function r(){for(var n=[],a=0;a<7;)n.push(e().weekday(a++).format(t.dateFormats.weekDay));return n}function i(e,t,a){return e.filter(function(e){return n(e.startsAt,e.endsAt,t,a)})}function o(n,r){for(var o=[],c=a(r,"year",n),l=e(r).startOf("year"),u=0;u<12;){var d=l.clone(),m=d.clone().endOf("month"),f=i(c,d,m);o.push({label:d.format(t.dateFormats.month),isToday:d.isSame(e().startOf("month")),events:f,date:d,badgeTotal:s(f)}),l.add(1,"month"),u++}return o}function c(t,n,r){for(var o=a(r,"month",t),c=a(r,"month",n),l=e(r).startOf("month"),u=l.clone().startOf("week"),d=e(r).endOf("month").endOf("week"),m=[],f=e().startOf("day");u.isBefore(d);){var g=u.month()===e(r).month(),v=[],p=[];g&&(v=i(o,u,u.clone().endOf("day")),p=i(c,u,u.clone().endOf("day"))),m.push({label:u.date(),date:u.clone(),inMonth:g,isPast:f.isAfter(u),isToday:f.isSame(u),isFuture:f.isBefore(u),isWeekend:[0,6].indexOf(u.day())>-1,events:v,documents:p,badgeEventsTotal:s(v),badgeDocumentsTotal:s(p)}),u.add(1,"day")}return m}function l(n,a,s){for(var r=e(s).startOf("week"),o=e(s).endOf("week"),c=r.clone(),l=[],u=[],d=10,m=e().startOf("day");l.length<7;)u.push([]),l.push({weekDayLabel:c.format(t.dateFormats.weekDay),date:c.clone(),dayLabel:c.format(t.dateFormats.day),isPast:c.isBefore(m),isToday:c.isSame(m),isFuture:c.isAfter(m),isWeekend:[0,6].indexOf(c.day())>-1}),c.add(1,"day");var f=i(n.concat(a),r,o).map(function(t){var n,a,s=e(t.startsAt).startOf("day"),i=e(t.endsAt).startOf("day"),c=e(r).startOf("day"),l=e(o).startOf("day");return n=s.isBefore(c)||s.isSame(c)?0:s.diff(c,"days"),i.isAfter(l)&&(i=l),s.isBefore(c)&&(s=c),a=e(i).diff(s,"days")+1,t.daySpan=a,t.dayOffset=n,t.overdue=s.isBefore(m),u[n].push(t),t});return u.map(function(e){d=e.length>d?e.length:d}),u.map(function(e){if(e.length<d)for(var t=e.length;t<d;t++)e.push({})}),{days:l,events:f,cols:u,rowsMax:d}}function u(t,a,s,r,o){var c=e(a).startOf("day").add(s,"hours"),l=e(a).startOf("day").add(r,"hours"),u=(r-s+1)*o,d=o/60,m=[];return i(t,e(a).startOf("day").toDate(),e(a).endOf("day").toDate()).map(function(t){if(e(t.startsAt).isBefore(c)?t.top=0:t.top=e(t.startsAt).startOf("minute").diff(c.startOf("minute"),"minutes")*d-2,e(t.endsAt).isAfter(l))t.height=u-t.top;else{var n=t.startsAt;e(t.startsAt).isBefore(c)&&(n=c.toDate()),t.height=e(t.endsAt).diff(n,"minutes")*d}return t.top-t.height>u&&(t.height=0),t.left=0,t}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return m.forEach(function(a,s){var r=!0;a.forEach(function(t){(n(e.startsAt,e.endsAt,t.startsAt,t.endsAt)||n(t.startsAt,t.endsAt,e.startsAt,e.endsAt))&&(r=!1)}),r&&t&&(t=!1,e.left=150*s,m[s].push(e))}),t&&(e.left=150*m.length,m.push([e])),e})}return{getWeekDayNames:r,getYearView:o,getMonthView:c,getWeekView:l,getDayView:u}}]),angular.module("mwl.calendar").service("calendarDebounce",["$timeout",function(e){function t(t,n,a){var s;return function(){function r(){s=null,a||t.apply(i,o)}var i=this,o=arguments,c=a&&!s;e.cancel(s),s=e(r,n),c&&t.apply(i,o)}}return t}]),angular.module("mwl.calendar").provider("calendarConfig",function(){var e={hour:"ha",day:"D MMM",month:"MMMM",weekDay:"dddd"},t={day:"dddd D MMMM, YYYY",week:"Week {week} of {year}",month:"MMMM YYYY",year:"YYYY"},n={eventsLabel:"Events",timeLabel:"Time"},a=this;a.setDateFormats=function(t){return angular.extend(e,t),a},a.setTitleFormats=function(e){return angular.extend(t,e),a},a.setI18nStrings=function(e){return angular.extend(n,e),a},a.$get=function(){return{dateFormats:e,titleFormats:t,i18nStrings:n}}}),angular.module("mwl.calendar").filter("calendarTruncateEventTitle",function(){return function(e,t,n){return e?e.length>=t&&e.length/20>n/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").filter("calendarLimitTo",function(){return function(e,t,n){return t=Math.abs(Number(t))===1/0?Number(t):parseInt(t),isNaN(t)?e:(angular.isNumber(e)&&(e=e.toString()),angular.isArray(e)||angular.isString(e)?(n=!n||isNaN(n)?0:parseInt(n),n=n<0&&n>=-e.length?e.length+n:n,t>=0?e.slice(n,n+t):0===n?e.slice(t,e.length):e.slice(Math.max(0,n+t),n)):e)}}),angular.module("mwl.calendar").directive("mwlDateModifier",function(){return{restrict:"A",controller:["$element","$attrs","$scope","moment",function(e,t,n,a){function s(){angular.isDefined(t.setToToday)?n.date=new Date:angular.isDefined(t.increment)?n.date=a(n.date).add(1,n.increment).toDate():angular.isDefined(t.decrement)&&(n.date=a(n.date).subtract(1,n.decrement).toDate()),n.$apply()}e.bind("click",s),n.$on("$destroy",function(){e.unbind("click",s)})}],scope:{date:"=",increment:"=",decrement:"="}}}),angular.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,n){var a=e.$watch(t.mwlCollapseFallback,function(e){e?n.addClass("ng-hide"):n.removeClass("ng-hide")}),s=e.$on("$destroy",function(){s(),a()})}]}}]),angular.module("mwl.calendar").directive("mwlCalendarYear",function(){return{templateUrl:"src/templates/calendarYearView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var a=this,s=!0;e.$on("calendar.refreshView",function(){a.view=n.getYearView(e.events,e.currentDay),e.autoOpen&&s&&(s=!1,a.view.forEach(function(n){t(e.currentDay).startOf("month").isSame(n.date)&&a.monthClicked(n,!0)}))}),a.monthClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),a.openRowIndex=null;var s=a.view.indexOf(t);s===a.openMonthIndex?a.openMonthIndex=null:(a.openMonthIndex=s,a.openRowIndex=Math.floor(s/4))}}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"src/templates/calendarWeekViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{documents:"=",events:"=",currentDay:"=",onEventClick:"="},controller:["$scope","calendarHelper",function(e,t){var n=this;e.$on("calendar.refreshView",function(){n.view=t.getWeekView(e.events,e.documents,e.currentDay)})}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"src/templates/calendarSlideBox.html",replace:!0,controller:["$scope","$sce",function(e,t){var n=this;n.$sce=t;var a=e.$watch("isOpen",function(e){n.shouldCollapse=!e}),s=e.$on("$destroy",function(){s(),a()})}],controllerAs:"vm",require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,n,a){e.isMonthView=!!a[0],e.isYearView=!!a[1]},scope:{isOpen:"=",events:"=",onEventClick:"=",editEventHtml:"=",onEditEventClick:"=",deleteEventHtml:"=",onDeleteEventClick:"="}}}),angular.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"src/templates/calendarMonthViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",documents:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var a=this,s=!0;e.$on("calendar.refreshView",function(){a.weekDays=n.getWeekDayNames(),a.view=n.getMonthView(e.events,e.documents,e.currentDay);var r=Math.floor(a.view.length/7);a.monthOffsets=[];for(var i=0;i<r;i++)a.monthOffsets.push(7*i);e.autoOpen&&s&&(s=!1,a.view.forEach(function(n){n.inMonth&&t(e.currentDay).startOf("day").isSame(n.date)&&a.dayClicked(n,!0)}))}),a.dayClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),a.openRowIndex=null;var s=a.view.indexOf(t);s===a.openDayIndex?a.openDayIndex=null:(a.openDayIndex=s,a.openRowIndex=Math.floor(s/7))},a.highlightEvent=function(e,t){a.view.forEach(function(n){if(delete n.highlightClass,t){n.events.indexOf(e)>-1&&(n.highlightClass="day-highlight dh-event-"+e.type)}})}}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"src/templates/calendarDayView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",dayViewStart:"=",dayViewEnd:"=",dayViewSplit:"="},controller:["$scope","$timeout","moment","calendarHelper","calendarConfig",function(e,t,n,a,s){function r(){i=n(e.dayViewStart||"00:00","HH:mm"),o=n(e.dayViewEnd||"23:00","HH:mm"),c.dayViewSplit=parseInt(e.dayViewSplit),c.hourHeight=60/e.dayViewSplit*30,c.hours=[];for(var t=n(i),a=0;a<=o.diff(i,"hours");a++)c.hours.push({label:t.format(s.dateFormats.hour)}),t.add(1,"hour")}var i,o,c=this;c.calendarConfig=s;var l=n.locale();e.$on("calendar.refreshView",function(){l!==n.locale()&&(l=n.locale(),r()),c.view=a.getDayView(e.events,e.currentDay,i.hours(),o.hours(),c.hourHeight)}),r()}],controllerAs:"vm"}}),angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"src/templates/calendarCustom.html",restrict:"EA",scope:{events:"=",documents:"=",view:"=",viewTitle:"=",currentDay:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onEventClick:"&",onEditEventClick:"&",onDeleteEventClick:"&",onTimespanClick:"&",onDrillDownClick:"&",dayViewStart:"@",dayViewEnd:"@",dayViewSplit:"@"},controller:["$scope","$timeout","moment","calendarTitle","calendarDebounce",function(e,t,n,a,s){var r=this;e.events=e.events||[],e.documents=e.documents||[],r.changeView=function(t,n){e.view=t,e.currentDay=n},r.drillDown=function(t){var a=n(t).toDate(),s={year:"month",month:"day",week:"day"};!1!==e.onDrillDownClick({calendarDate:a,calendarNextView:s[e.view]})&&r.changeView(s[e.view],a)};var i=n(e.currentDay),o=angular.copy(e.view),c=s(function(){a[e.view]&&(e.viewTitle=a[e.view](e.currentDay));var t=n(e.currentDay),s=!0;i.clone().startOf(e.view).isSame(t.clone().startOf(e.view))&&!i.isSame(t)&&e.view===o&&(s=!1),i=t,o=angular.copy(e.view),s&&e.$broadcast("calendar.refreshView")},50),l=e.$watch(function(){return n.locale()},c),u=[];u.push(l),u.push(e.$watch("currentDay",c)),u.push(e.$watch("view",c)),u.push(e.$watch("events",c,!0)),u.push(e.$watch("documents",c,!0));var d=e.$on("$destroy",function(){u.forEach(function(e){e()})});u.push(d)}]}})}),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,t){function n(e,t,n){if(angular.isArray(e))for(var a=e.length;a--;)if(n(e[a],t))return!0;return!1}function a(e,t,a){return e=angular.isArray(e)?e:[],n(e,t,a)||e.push(t),e}function s(e,t,n){if(angular.isArray(e))for(var a=e.length;a--;)if(n(e[a],t)){e.splice(a,1);break}return e}function r(r,i,o){function c(e,t){r.checked=n(e,m,f)}t(i)(r);var l=e(o.checklistModel),u=l.assign,d=e(o.checklistChange),m=e(o.checklistValue)(r.$parent),f=angular.equals;o.hasOwnProperty("checklistComparator")&&(f=e(o.checklistComparator)(r.$parent)),r.$watch("checked",function(e,t){if(e!==t){var n=l(r.$parent);!0===e?u(r.$parent,a(n,m,f)):u(r.$parent,s(n,m,f)),d&&d(r)}}),angular.isFunction(r.$parent.$watchCollection)?r.$parent.$watchCollection(o.checklistModel,c):r.$parent.$watch(o.checklistModel,c,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if("INPUT"!==e[0].tagName||"checkbox"!==t.type)throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!t.checklistValue)throw"You should provide `checklist-value`.";return e.removeAttr("checklist-model"),e.attr("ng-model","checked"),r}}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(e,t,n){function a(e,t){return F(new(F(function(){},{prototype:e})),t)}function s(e){return N(arguments,function(t){t!==e&&N(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function r(e,t){var n=[];for(var a in e.path){if(e.path[a]!==t.path[a])break;n.push(e.path[a])}return n}function i(e){if(Object.keys)return Object.keys(e);var t=[];return N(e,function(e,n){t.push(n)}),t}function o(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,a=Number(arguments[2])||0;for(a=a<0?Math.ceil(a):Math.floor(a),a<0&&(a+=n);a<n;a++)if(a in e&&e[a]===t)return a;return-1}function c(e,t,n,a){var s,c=r(n,a),l={},u=[];for(var d in c)if(c[d].params&&(s=i(c[d].params),s.length))for(var m in s)o(u,s[m])>=0||(u.push(s[m]),l[s[m]]=e[s[m]]);return F({},l,t)}function l(e,t,n){if(!n){n=[];for(var a in e)n.push(a)}for(var s=0;s<n.length;s++){var r=n[s];if(e[r]!=t[r])return!1}return!0}function u(e,t){var n={};return N(e,function(e){n[e]=t[e]}),n}function d(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t}function m(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var a in e)-1==o(n,a)&&(t[a]=e[a]);return t}function f(e,t){var n=P(e),a=n?[]:{};return N(e,function(e,s){t(e,s)&&(a[n?a.length:s]=e)}),a}function g(e,t){var n=P(e)?[]:{};return N(e,function(e,a){n[a]=t(e,a)}),n}function v(e,t){var a=1,r=2,c={},l=[],u=c,d=F(e.when(c),{$$promises:c,$$values:c});this.study=function(c){function f(e,n){if(y[n]!==r){if(h.push(n),y[n]===a)throw h.splice(0,o(h,n)),new Error("Cyclic dependency: "+h.join(" -> "));if(y[n]=a,R(e))p.push(n,[function(){return t.get(e)}],l);else{var s=t.annotate(e);N(s,function(e){e!==n&&c.hasOwnProperty(e)&&f(c[e],e)}),p.push(n,e,s)}h.pop(),y[n]=r}}function g(e){return L(e)&&e.then&&e.$$promises}if(!L(c))throw new Error("'invocables' must be an object");var v=i(c||{}),p=[],h=[],y={};return N(c,f),c=h=y=null,function(a,r,i){function o(){--_||(k||s(y,r.$$values),f.$$values=y,f.$$promises=f.$$promises||!0,delete f.$$inheritedValues,l.resolve(y))}function c(e){f.$$failure=e,l.reject(e)}if(g(a)&&i===n&&(i=r,r=a,a=null),a){if(!L(a))throw new Error("'locals' must be an object")}else a=u;if(r){if(!g(r))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else r=d;var l=e.defer(),f=l.promise,h=f.$$promises={},y=F({},a),_=1+p.length/3,k=!1;if(O(r.$$failure))return c(r.$$failure),f;r.$$inheritedValues&&s(y,m(r.$$inheritedValues,v)),F(h,r.$$promises),r.$$values?(k=s(y,m(r.$$values,v)),f.$$inheritedValues=m(r.$$values,v),o()):(r.$$inheritedValues&&(f.$$inheritedValues=m(r.$$inheritedValues,v)),r.then(o,c));for(var $=0,b=p.length;$<b;$+=3)a.hasOwnProperty(p[$])?o():function(n,s,r){function l(e){d.reject(e),c(e)}function u(){if(!O(f.$$failure))try{d.resolve(t.invoke(s,i,y)),d.promise.then(function(e){y[n]=e,o()},l)}catch(e){l(e)}}var d=e.defer(),m=0;N(r,function(e){h.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(m++,h[e].then(function(t){y[e]=t,--m||u()},l))}),m||u(),h[n]=d.promise}(p[$],p[$+1],p[$+2]);return f}},this.resolve=function(e,t,n,a){return this.study(e)(t,n,a)}}function p(e,t,n){this.fromConfig=function(e,t,n){return O(e.template)?this.fromString(e.template,t):O(e.templateUrl)?this.fromUrl(e.templateUrl,t):O(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return I(e)?e(t):e},this.fromUrl=function(n,a){return I(n)&&(n=n(a)),null==n?null:e.get(n,{cache:t,headers:{Accept:"text/html"}}).then(function(e){return e.data})},this.fromProvider=function(e,t,a){return n.invoke(e,null,a||{params:t})}}function h(e,t,s){function r(t,n,a,s){if(p.push(t),g[t])return g[t];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(v[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");return v[t]=new U.Param(t,n,a,s),v[t]}function i(e,t,n,a){var s=["",""],r=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return r;switch(n){case!1:s=["(",")"+(a?"?":"")];break;case!0:s=["?(",")?"];break;default:s=["("+n+"|",")?"]}return r+s[0]+t+s[1]}function o(s,r){var i,o,c,l,u;return i=s[2]||s[3],u=t.params[i],c=e.substring(m,s.index),o=r?s[4]:s[4]||("*"==s[1]?".*":null),l=U.type(o||"string")||a(U.type("string"),{pattern:new RegExp(o,t.caseInsensitive?"i":n)}),{id:i,regexp:o,segment:c,type:l,cfg:u}}t=F({params:{}},L(t)?t:{});var c,l=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,u=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,d="^",m=0,f=this.segments=[],g=s?s.params:{},v=this.params=s?s.params.$$new():new U.ParamSet,p=[];this.source=e;for(var h,y,_;(c=l.exec(e))&&(h=o(c,!1),!(h.segment.indexOf("?")>=0));)y=r(h.id,h.type,h.cfg,"path"),d+=i(h.segment,y.type.pattern.source,y.squash,y.isOptional),f.push(h.segment),m=l.lastIndex;_=e.substring(m);var k=_.indexOf("?");if(k>=0){var $=this.sourceSearch=_.substring(k);if(_=_.substring(0,k),this.sourcePath=e.substring(0,m+k),$.length>0)for(m=0;c=u.exec($);)h=o(c,!0),y=r(h.id,h.type,h.cfg,"search"),m=l.lastIndex}else this.sourcePath=e,this.sourceSearch="";d+=i(_)+(!1===t.strict?"/?":"")+"$",f.push(_),this.regexp=new RegExp(d,t.caseInsensitive?"i":n),this.prefix=f[0],this.$$paramNames=p}function y(e){F(this,e)}function _(){function e(e){return null!=e?e.toString().replace(/\//g,"%2F"):e}function s(e){return null!=e?e.toString().replace(/%2F/g,"/"):e}function r(){return{strict:v,caseInsensitive:m}}function c(e){return I(e)||P(e)&&I(e[e.length-1])}function l(){for(;b.length;){var e=b.shift();if(e.pattern)throw new Error("You cannot override a type's .pattern at runtime.");t.extend(k[e.name],d.invoke(e.def))}}function u(e){F(this,e||{})}U=this;var d,m=!1,v=!0,p=!1,k={},$=!0,b=[],w={string:{encode:e,decode:s,is:function(e){return null==e||!O(e)||"string"==typeof e},pattern:/[^\/]*/},int:{encode:e,decode:function(e){return parseInt(e,10)},is:function(e){return O(e)&&this.decode(e.toString())===e},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return 0!==parseInt(e,10)},is:function(e){return!0===e||!1===e},pattern:/0|1/},date:{encode:function(e){return this.is(e)?[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-"):n},decode:function(e){if(this.is(e))return e;var t=this.capture.exec(e);return t?new Date(t[1],t[2]-1,t[3]):n},is:function(e){return e instanceof Date&&!isNaN(e.valueOf())},equals:function(e,t){return this.is(e)&&this.is(t)&&e.toISOString()===t.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:t.toJson,
decode:t.fromJson,is:t.isObject,equals:t.equals,pattern:/[^\/]*/},any:{encode:t.identity,decode:t.identity,equals:t.equals,pattern:/.*/}};_.$$getDefaultValue=function(e){if(!c(e.value))return e.value;if(!d)throw new Error("Injectable functions cannot be called at configuration time");return d.invoke(e.value)},this.caseInsensitive=function(e){return O(e)&&(m=e),m},this.strictMode=function(e){return O(e)&&(v=e),v},this.defaultSquashPolicy=function(e){if(!O(e))return p;if(!0!==e&&!1!==e&&!R(e))throw new Error("Invalid squash policy: "+e+". Valid policies: false, true, arbitrary-string");return p=e,e},this.compile=function(e,t){return new h(e,F(r(),t))},this.isMatcher=function(e){if(!L(e))return!1;var t=!0;return N(h.prototype,function(n,a){I(n)&&(t=t&&O(e[a])&&I(e[a]))}),t},this.type=function(e,t,n){if(!O(t))return k[e];if(k.hasOwnProperty(e))throw new Error("A type named '"+e+"' has already been defined.");return k[e]=new y(F({name:e},t)),n&&(b.push({name:e,def:n}),$||l()),this},N(w,function(e,t){k[t]=new y(F({name:t},e))}),k=a(k,{}),this.$get=["$injector",function(e){return d=e,$=!1,l(),N(w,function(e,t){k[t]||(k[t]=new y(e))}),this}],this.Param=function(e,t,a,s){function r(){if(!d)throw new Error("Injectable functions cannot be called at configuration time");var e=d.invoke(a.$$fn);if(null!==e&&e!==n&&!m.type.is(e))throw new Error("Default value ("+e+") for parameter '"+m.id+"' is not an instance of Type ("+m.type.name+")");return e}function l(e){function t(e){return function(t){return t.from===e}}return e=function(e){var n=g(f(m.replace,t(e)),function(e){return e.to});return n.length?n[0]:e}(e),O(e)?m.type.$normalize(e):r()}function u(){return"{Param:"+e+" "+t+" squash: '"+_+"' optional: "+h+"}"}var m=this;a=function(e){var t=L(e)?i(e):[];return-1===o(t,"value")&&-1===o(t,"type")&&-1===o(t,"squash")&&-1===o(t,"array")&&(e={value:e}),e.$$fn=c(e.value)?e.value:function(){return e.value},e}(a),t=function(t,n,a){if(t.type&&n)throw new Error("Param '"+e+"' has two type configurations.");return n||(t.type?t.type instanceof y?t.type:new y(t.type):"config"===a?k.any:k.string)}(a,t,s);var v=function(){var t={array:"search"===s&&"auto"},n=e.match(/\[\]$/)?{array:!0}:{};return F(t,n,a).array}();t=v?t.$asArray(v,"search"===s):t,"string"!==t.name||v||"path"!==s||a.value!==n||(a.value="");var h=a.value!==n,_=function(e,t){var n=e.squash;if(!t||!1===n)return!1;if(!O(n)||null==n)return p;if(!0===n||R(n))return n;throw new Error("Invalid squash policy: '"+n+"'. Valid policies: false, true, or arbitrary string")}(a,h),$=function(e,t,a,s){var r,i,c=[{from:"",to:a||t?n:""},{from:null,to:a||t?n:""}];return r=P(e.replace)?e.replace:[],R(s)&&r.push({from:s,to:n}),i=g(r,function(e){return e.from}),f(c,function(e){return-1===o(i,e.from)}).concat(r)}(a,v,h,_);F(this,{id:e,type:t,location:s,array:v,squash:_,replace:$,isOptional:h,value:l,dynamic:n,config:a,toString:u})},u.prototype={$$new:function(){return a(this,F(new u,{$$parent:this}))},$$keys:function(){for(var e=[],t=[],n=this,a=i(u.prototype);n;)t.push(n),n=n.$$parent;return t.reverse(),N(t,function(t){N(i(t),function(t){-1===o(e,t)&&-1===o(a,t)&&e.push(t)})}),e},$$values:function(e){var t={},n=this;return N(n.$$keys(),function(a){t[a]=n[a].value(e&&e[a])}),t},$$equals:function(e,t){var n=!0,a=this;return N(a.$$keys(),function(s){var r=e&&e[s],i=t&&t[s];a[s].type.equals(r,i)||(n=!1)}),n},$$validates:function(e){var a,s,r,i,o,c=this.$$keys();for(a=0;a<c.length&&(s=this[c[a]],(r=e[c[a]])!==n&&null!==r||!s.isOptional);a++){if(i=s.type.$normalize(r),!s.type.is(i))return!1;if(o=s.type.encode(i),t.isString(o)&&!s.type.pattern.exec(o))return!1}return!0},$$parent:n},this.ParamSet=u}function k(e,a){function s(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return null!=t?t[1].replace(/\\(.)/g,"$1"):""}function r(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t["$"===n?0:Number(n)]})}function i(e,t,n){if(!n)return!1;var a=e.invoke(t,t,{$match:n});return!O(a)||a}function o(a,s,r,i){function o(e,t,n){return"/"===v?e:t?v.slice(0,-1)+e:n?v.slice(1)+e:e}function m(e){function t(e){var t=e(r,a);return!!t&&(R(t)&&a.replace().url(t),!0)}if(!e||!e.defaultPrevented){g&&a.url();g=n;var s,i=l.length;for(s=0;s<i;s++)if(t(l[s]))return;u&&t(u)}}function f(){return c=c||s.$on("$locationChangeSuccess",m)}var g,v=i.baseHref(),p=a.url();return d||f(),{sync:function(){m()},listen:function(){return f()},update:function(e){if(e)return void(p=a.url());a.url()!==p&&(a.url(p),a.replace())},push:function(e,t,s){var r=e.format(t||{});null!==r&&t&&t["#"]&&(r+="#"+t["#"]),a.url(r),g=s&&s.$$avoidResync?a.url():n,s&&s.replace&&a.replace()},href:function(n,s,r){if(!n.validates(s))return null;var i=e.html5Mode();t.isObject(i)&&(i=i.enabled);var c=n.format(s);if(r=r||{},i||null===c||(c="#"+e.hashPrefix()+c),null!==c&&s&&s["#"]&&(c+="#"+s["#"]),c=o(c,i,r.absolute),!r.absolute||!c)return c;var l=!i&&c?"/":"",u=a.port();return u=80===u||443===u?"":":"+u,[a.protocol(),"://",a.host(),u,l,c].join("")}}}var c,l=[],u=null,d=!1;this.rule=function(e){if(!I(e))throw new Error("'rule' must be a function");return l.push(e),this},this.otherwise=function(e){if(R(e)){var t=e;e=function(){return t}}else if(!I(e))throw new Error("'rule' must be a function");return u=e,this},this.when=function(e,t){var n,o=R(t);if(R(e)&&(e=a.compile(e)),!o&&!I(t)&&!P(t))throw new Error("invalid 'handler' in when()");var c={matcher:function(e,t){return o&&(n=a.compile(t),t=["$match",function(e){return n.format(e)}]),F(function(n,a){return i(n,t,e.exec(a.path(),a.search()))},{prefix:R(e.prefix)?e.prefix:""})},regex:function(e,t){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return o&&(n=t,t=["$match",function(e){return r(n,e)}]),F(function(n,a){return i(n,t,e.exec(a.path()))},{prefix:s(e)})}},l={matcher:a.isMatcher(e),regex:e instanceof RegExp};for(var u in l)if(l[u])return this.rule(c[u](e,t));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(e){e===n&&(e=!0),d=e},this.$get=o,o.$inject=["$location","$rootScope","$injector","$browser"]}function $(e,s){function r(e){return 0===e.indexOf(".")||0===e.indexOf("^")}function m(e,t){if(!e)return n;var a=R(e),s=a?e:e.name;if(r(s)){if(!t)throw new Error("No reference point given for path '"+s+"'");t=m(t);for(var i=s.split("."),o=0,c=i.length,l=t;o<c;o++)if(""!==i[o]||0!==o){if("^"!==i[o])break;if(!l.parent)throw new Error("Path '"+s+"' not valid for state '"+t.name+"'");l=l.parent}else l=t;i=i.slice(o).join("."),s=l.name+(l.name&&i?".":"")+i}var u=D[s];return!u||!a&&(a||u!==e&&u.self!==e)?n:u}function f(e,t){S[e]||(S[e]=[]),S[e].push(t)}function v(e){for(var t=S[e]||[];t.length;)p(t.shift())}function p(t){t=a(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}});var n=t.name;if(!R(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(D.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var s=-1!==n.indexOf(".")?n.substring(0,n.lastIndexOf(".")):R(t.parent)?t.parent:L(t.parent)&&R(t.parent.name)?t.parent.name:"";if(s&&!D[s])return f(s,t.self);for(var r in E)I(E[r])&&(t[r]=E[r](t,E.$delegates[r]));return D[n]=t,!t[T]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){C.$current.navigable==t&&l(e,n)||C.transitionTo(t,e,{inherit:!0,location:!1})}]),v(n),t}function h(e){return e.indexOf("*")>-1}function y(e){for(var t=e.split("."),n=C.$current.name.split("."),a=0,s=t.length;a<s;a++)"*"===t[a]&&(n[a]="*");return"**"===t[0]&&(n=n.slice(o(n,t[1])),n.unshift("**")),"**"===t[t.length-1]&&(n.splice(o(n,t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length==n.length&&n.join("")===t.join("")}function _(e,t){return R(e)&&!O(t)?E[e]:I(t)&&R(e)?(E[e]&&!E.$delegates[e]&&(E.$delegates[e]=E[e]),E[e]=t,this):this}function k(e,t){return L(e)?t=e:t.name=e,p(t),this}function $(e,s,r,o,d,f,v,p,_){function k(t,n,a,r){var i=e.$broadcast("$stateNotFound",t,n,a);if(i.defaultPrevented)return v.update(),A;if(!i.retry)return null;if(r.$retry)return v.update(),x;var o=C.transition=s.when(i.retry);return o.then(function(){return o!==C.transition?S:(t.options.$retry=!0,C.transitionTo(t.to,t.toParams,t.options))},function(){return A}),v.update(),o}function $(e,n,a,i,c,l){function m(){var n=[];return N(e.views,function(a,s){var i=a.resolve&&a.resolve!==e.resolve?a.resolve:{};i.$template=[function(){return r.load(s,{view:a,locals:c.globals,params:f,notify:l.notify})||""}],n.push(d.resolve(i,c.globals,c.resolve,e).then(function(n){if(I(a.controllerProvider)||P(a.controllerProvider)){var r=t.extend({},i,c.globals);n.$$controller=o.invoke(a.controllerProvider,null,r)}else n.$$controller=a.controller;n.$$state=e,n.$$controllerAs=a.controllerAs,c[s]=n}))}),s.all(n).then(function(){return c.globals})}var f=a?n:u(e.params.$$keys(),n),g={$stateParams:f};c.resolve=d.resolve(e.resolve,g,c.resolve,e);var v=[c.resolve.then(function(e){c.globals=e})];return i&&v.push(i),s.all(v).then(m).then(function(e){return c})}var S=s.reject(new Error("transition superseded")),E=s.reject(new Error("transition prevented")),A=s.reject(new Error("transition aborted")),x=s.reject(new Error("transition failed"));return w.locals={resolve:null,globals:{$stateParams:{}}},C={params:{},current:w.self,$current:w,transition:null},C.reload=function(e){return C.transitionTo(C.current,f,{reload:e||!0,inherit:!1,notify:!0})},C.go=function(e,t,n){return C.transitionTo(e,t,F({inherit:!0,relative:C.$current},n))},C.transitionTo=function(t,n,r){n=n||{},r=F({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},r||{});var i,l=C.$current,d=C.params,g=l.path,p=m(t,r.relative),h=n["#"];if(!O(p)){var y={to:t,toParams:n,options:r},_=k(y,l.self,d,r);if(_)return _;if(t=y.to,n=y.toParams,r=y.options,p=m(t,r.relative),!O(p)){if(!r.relative)throw new Error("No such state '"+t+"'");throw new Error("Could not resolve '"+t+"' from state '"+r.relative+"'")}}if(p[T])throw new Error("Cannot transition to abstract state '"+t+"'");if(r.inherit&&(n=c(f,n||{},C.$current,p)),!p.params.$$validates(n))return x;n=p.params.$$values(n),t=p;var D=t.path,A=0,j=D[A],M=w.locals,I=[];if(r.reload){if(R(r.reload)||L(r.reload)){if(L(r.reload)&&!r.reload.name)throw new Error("Invalid reload state object");var P=!0===r.reload?g[0]:m(r.reload);if(r.reload&&!P)throw new Error("No such reload state '"+(R(r.reload)?r.reload:r.reload.name)+"'");for(;j&&j===g[A]&&j!==P;)M=I[A]=j.locals,A++,j=D[A]}}else for(;j&&j===g[A]&&j.ownParams.$$equals(n,d);)M=I[A]=j.locals,A++,j=D[A];if(b(t,n,l,d,M,r))return h&&(n["#"]=h),C.params=n,q(C.params,f),r.location&&t.navigable&&t.navigable.url&&(v.push(t.navigable.url,n,{$$avoidResync:!0,replace:"replace"===r.location}),v.update(!0)),C.transition=null,s.when(C.current);if(n=u(t.params.$$keys(),n||{}),r.notify&&e.$broadcast("$stateChangeStart",t.self,n,l.self,d).defaultPrevented)return e.$broadcast("$stateChangeCancel",t.self,n,l.self,d),v.update(),E;for(var N=s.when(M),U=A;U<D.length;U++,j=D[U])M=I[U]=a(M),N=$(j,n,j===t,N,M,r);var H=C.transition=N.then(function(){var a,s,i;if(C.transition!==H)return S;for(a=g.length-1;a>=A;a--)i=g[a],i.self.onExit&&o.invoke(i.self.onExit,i.self,i.locals.globals),i.locals=null;for(a=A;a<D.length;a++)s=D[a],s.locals=I[a],s.self.onEnter&&o.invoke(s.self.onEnter,s.self,s.locals.globals);return h&&(n["#"]=h),C.transition!==H?S:(C.$current=t,C.current=t.self,C.params=n,q(C.params,f),C.transition=null,r.location&&t.navigable&&v.push(t.navigable.url,t.navigable.locals.globals.$stateParams,{$$avoidResync:!0,replace:"replace"===r.location}),r.notify&&e.$broadcast("$stateChangeSuccess",t.self,n,l.self,d),v.update(!0),C.current)},function(a){return C.transition!==H?S:(C.transition=null,i=e.$broadcast("$stateChangeError",t.self,n,l.self,d,a),i.defaultPrevented||v.update(),s.reject(a))});return H},C.is=function(e,t,a){a=F({relative:C.$current},a||{});var s=m(e,a.relative);return O(s)?C.$current===s&&(!t||l(s.params.$$values(t),f)):n},C.includes=function(e,t,a){if(a=F({relative:C.$current},a||{}),R(e)&&h(e)){if(!y(e))return!1;e=C.$current.name}var s=m(e,a.relative);return O(s)?!!O(C.$current.includes[s.name])&&(!t||l(s.params.$$values(t),f,i(t))):n},C.href=function(e,t,a){a=F({lossy:!0,inherit:!0,absolute:!1,relative:C.$current},a||{});var s=m(e,a.relative);if(!O(s))return null;a.inherit&&(t=c(f,t||{},C.$current,s));var r=s&&a.lossy?s.navigable:s;return r&&r.url!==n&&null!==r.url?v.href(r.url,u(s.params.$$keys().concat("#"),t||{}),{absolute:a.absolute}):null},C.get=function(e,t){if(0===arguments.length)return g(i(D),function(e){return D[e].self});var n=m(e,t||C.$current);return n&&n.self?n.self:null},C}function b(e,t,n,a,s,r){if(!r.reload&&e===n&&(s===n.locals||!1===e.self.reloadOnSearch&&function(e,t,n){function a(t){return"search"!=e.params[t].location}var s=e.params.$$keys().filter(a),r=d.apply({},[e.params].concat(s));return new U.ParamSet(r).$$equals(t,n)}(n,a,t)))return!0}var w,C,D={},S={},T="abstract",E={parent:function(e){if(O(e.parent)&&e.parent)return m(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?m(t[1]):w},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=F({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url,n={params:e.params||{}};if(R(t))return"^"==t.charAt(0)?s.compile(t.substring(1),n):(e.parent.navigable||w).url.concat(t,n);if(!t||s.isMatcher(t))return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},ownParams:function(e){var t=e.url&&e.url.params||new U.ParamSet;return N(e.params||{},function(e,n){t[n]||(t[n]=new U.Param(n,null,e,"config"))}),t},params:function(e){return e.parent&&e.parent.params?F(e.parent.params.$$new(),e.ownParams):new U.ParamSet},views:function(e){var t={};return N(O(e.views)?e.views:{"":e},function(n,a){a.indexOf("@")<0&&(a+="@"+e.parent.name),t[a]=n}),t},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?F({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};w=p({name:"",url:"^",views:null,abstract:!0}),w.navigable=null,this.decorator=_,this.state=k,this.$get=$,$.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter","$location","$urlMatcherFactory"]}function b(){function e(e,t){return{load:function(n,a){var s;return a=F({template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}},a),a.view&&(s=t.fromConfig(a.view,a.params,a.locals)),s&&a.notify&&e.$broadcast("$viewContentLoading",a),s}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function w(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){return n(function(){e[0].scrollIntoView()},0,!1)}}]}function C(e,n,a,s){function r(e,t){if(c)return{enter:function(e,t,n){var a=c.enter(e,null,t,n);a&&a.then&&a.then(n)},leave:function(e,t){var n=c.leave(e,t);n&&n.then&&n.then(t)}};if(o){var n=o&&o(t,e);return{enter:function(e,t,a){n.enter(e,null,t),a()},leave:function(e,t){n.leave(e),t()}}}return function(){return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}}()}var i=function(){return n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(e){return null}}}(),o=i("$animator"),c=i("$animate");return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,i,o){return function(n,i,c){function l(){d&&(d.remove(),d=null),f&&(f.$destroy(),f=null),m&&(h.leave(m,function(){d=null}),d=m,m=null)}function u(r){var u,d=S(n,c,i,s),y=d&&e.$current&&e.$current.locals[d];if(r||y!==g){u=n.$new(),g=e.$current.locals[d];var _=o(u,function(e){h.enter(e,i,function(){f&&f.$emit("$viewContentAnimationEnded"),(t.isDefined(p)&&!p||n.$eval(p))&&a(e)}),l()});m=_,f=u,f.$emit("$viewContentLoaded"),f.$eval(v)}}var d,m,f,g,v=c.onload||"",p=c.autoscroll,h=r(c,n);n.$on("$stateChangeSuccess",function(){u(!1)}),n.$on("$viewContentLoading",function(){u(!1)}),u(!0)}}}}function D(e,t,n,a){return{restrict:"ECA",priority:-400,compile:function(s){var r=s.html();return function(s,i,o){var c=n.$current,l=S(s,o,i,a),u=c&&c.locals[l];if(u){i.data("$uiView",{name:l,state:u.$$state}),i.html(u.$template?u.$template:r);var d=e(i.contents());if(u.$$controller){u.$scope=s,u.$element=i;var m=t(u.$$controller,u);u.$$controllerAs&&(s[u.$$controllerAs]=m),i.data("$ngControllerController",m),i.children().data("$ngControllerController",m)}d(s)}}}}}function S(e,t,n,a){var s=a(t.uiView||t.name||"")(e),r=n.inheritedData("$uiView");return s.indexOf("@")>=0?s:s+"@"+(r?r.state.name:"")}function T(e,t){var n,a=e.match(/^\s*({[^}]*})\s*$/);if(a&&(e=t+"("+a[1]+")"),!(n=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/))||4!==n.length)throw new Error("Invalid state ref '"+e+"'");return{state:n[1],paramExpr:n[3]||null}}function E(e){var t=e.parent().inheritedData("$uiView");if(t&&t.state&&t.state.name)return t.state}function A(e,n){var a=["location","inherit","reload","absolute"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(s,r,i,o){var c=T(i.uiSref,e.current.name),l=null,u=E(r)||e.$current,d="[object SVGAnimatedString]"===Object.prototype.toString.call(r.prop("href"))?"xlink:href":"href",m=null,f="A"===r.prop("tagName").toUpperCase(),g="FORM"===r[0].nodeName,v=g?"action":d,p=!0,h={relative:u,inherit:!0},y=s.$eval(i.uiSrefOpts)||{};t.forEach(a,function(e){e in y&&(h[e]=y[e])});var _=function(n){if(n&&(l=t.copy(n)),p){m=e.href(c.state,l,h);var a=o[1]||o[0];if(a&&a.$$addStateInfo(c.state,l),null===m)return p=!1,!1;i.$set(v,m)}};c.paramExpr&&(s.$watch(c.paramExpr,function(e,t){e!==l&&_(e)},!0),l=t.copy(s.$eval(c.paramExpr))),_(),g||r.bind("click",function(t){if(!((t.which||t.button)>1||t.ctrlKey||t.metaKey||t.shiftKey||r.attr("target"))){var a=n(function(){e.go(c.state,l,h)});t.preventDefault();var s=f&&!m?1:0;t.preventDefault=function(){s--<=0&&n.cancel(a)}}})}}}function x(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,a,s){function r(){i()?a.addClass(c):a.removeClass(c)}function i(){for(var e=0;e<l.length;e++)if(o(l[e].state,l[e].params))return!0;return!1}function o(t,n){return void 0!==s.uiSrefActiveEq?e.is(t.name,n):e.includes(t.name,n)}var c,l=[];c=n(s.uiSrefActiveEq||s.uiSrefActive||"",!1)(t),this.$$addStateInfo=function(t,n){var s=e.get(t,E(a));l.push({state:s||{name:t},params:n}),r()},t.$on("$stateChangeSuccess",r)}]}}function j(e){var t=function(t){return e.is(t)};return t.$stateful=!0,t}function M(e){var t=function(t){return e.includes(t)};return t.$stateful=!0,t}var O=t.isDefined,I=t.isFunction,R=t.isString,L=t.isObject,P=t.isArray,N=t.forEach,F=t.extend,q=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),v.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",v),p.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",p);var U;h.prototype.concat=function(e,t){var n={caseInsensitive:U.caseInsensitive(),strict:U.strictMode(),squash:U.defaultSquashPolicy()};return new h(this.sourcePath+e+this.sourceSearch,F(n,t),this)},h.prototype.toString=function(){return this.source},h.prototype.exec=function(e,t){var n=this.regexp.exec(e);if(!n)return null;t=t||{};var a,s,r,i=this.parameters(),o=i.length,c=this.segments.length-1,l={};if(c!==n.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(a=0;a<c;a++){r=i[a];var u=this.params[r],d=n[a+1];for(s=0;s<u.replace;s++)u.replace[s].from===d&&(d=u.replace[s].to);d&&!0===u.array&&(d=function(e){function t(e){return e.split("").reverse().join("")}function n(e){return e.replace(/\\-/g,"-")}return g(g(t(e).split(/-(?!\\)/),t),n).reverse()}(d)),l[r]=u.value(d)}for(;a<o;a++)r=i[a],l[r]=this.params[r].value(t[r]);return l},h.prototype.parameters=function(e){return O(e)?this.params[e]||null:this.$$paramNames},h.prototype.validates=function(e){return this.params.$$validates(e)},h.prototype.format=function(e){function t(e){return encodeURIComponent(e).replace(/-/g,function(e){return"%5C%"+e.charCodeAt(0).toString(16).toUpperCase()})}e=e||{};var n=this.segments,a=this.parameters(),s=this.params;if(!this.validates(e))return null;var r,i=!1,o=n.length-1,c=a.length,l=n[0];for(r=0;r<c;r++){var u=r<o,d=a[r],m=s[d],f=m.value(e[d]),v=m.isOptional&&m.type.equals(m.value(),f),p=!!v&&m.squash,h=m.type.encode(f);if(u){var y=n[r+1];if(!1===p)null!=h&&(P(h)?l+=g(h,t).join("-"):l+=encodeURIComponent(h)),l+=y;else if(!0===p){var _=l.match(/\/$/)?/\/?(.*)/:/(.*)/;l+=y.match(_)[1]}else R(p)&&(l+=p+y)}else{if(null==h||v&&!1!==p)continue;P(h)||(h=[h]),h=g(h,encodeURIComponent).join("&"+d+"="),l+=(i?"&":"?")+d+"="+h,i=!0}}return l},y.prototype.is=function(e,t){return!0},y.prototype.encode=function(e,t){return e},y.prototype.decode=function(e,t){return e},y.prototype.equals=function(e,t){return e==t},y.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)},y.prototype.pattern=/.*/,y.prototype.toString=function(){return"{Type:"+this.name+"}"},y.prototype.$normalize=function(e){return this.is(e)?e:this.decode(e)},y.prototype.$asArray=function(e,t){function a(e,t){function a(e,t){return function(){return e[t].apply(e,arguments)}}function s(e){return P(e)?e:O(e)?[e]:[]}function r(e){switch(e.length){case 0:return n;case 1:return"auto"===t?e[0]:e;default:return e}}function i(e){return!e}function o(e,t){return function(n){n=s(n);var a=g(n,e);return!0===t?0===f(a,i).length:r(a)}}this.encode=o(a(e,"encode")),this.decode=o(a(e,"decode")),this.is=o(a(e,"is"),!0),this.equals=function(e){return function(t,n){var a=s(t),r=s(n);if(a.length!==r.length)return!1;for(var i=0;i<a.length;i++)if(!e(a[i],r[i]))return!1;return!0}}(a(e,"equals")),this.pattern=e.pattern,this.$normalize=o(a(e,"$normalize")),this.name=e.name,this.$arrayMode=t}if(!e)return this;if("auto"===e&&!t)throw new Error("'auto' array mode is for query parameters only");return new a(this,e)},t.module("ui.router.util").provider("$urlMatcherFactory",_),t.module("ui.router.util").run(["$urlMatcherFactory",function(e){}]),k.$inject=["$locationProvider","$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",k),$.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",$),b.$inject=[],t.module("ui.router.state").provider("$view",b),t.module("ui.router.state").provider("$uiViewScroll",w),C.$inject=["$state","$injector","$uiViewScroll","$interpolate"],D.$inject=["$compile","$controller","$state","$interpolate"],t.module("ui.router.state").directive("uiView",C),t.module("ui.router.state").directive("uiView",D),A.$inject=["$state","$timeout"],x.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",A).directive("uiSrefActive",x).directive("uiSrefActiveEq",x),j.$inject=["$state"],M.$inject=["$state"],t.module("ui.router.state").filter("isState",j).filter("includedByState",M)}(window,window.angular),define("tasks-assignments/modules/tasks-assignments.values",["common/angular"],function(e){"use strict";e.module("tasks-assignments.values",[]).value("settings",{tabEnabled:{documents:CRM.tasksAssignments.settings.documents_tab,keyDates:CRM.tasksAssignments.settings.keydates_tab},extEnabled:{assignments:CRM.tasksAssignments.case_extension},copy:{button:{assignmentAdd:CRM.tasksAssignments.settings.add_assignment_button_title}},isTaskDashboardDefault:CRM.tasksAssignments.settings.is_task_dashboard_default,daysToCreateADocumentClone:parseInt(CRM.tasksAssignments.settings.days_to_create_a_document_clone)})}),define("tasks-assignments/modules/tasks-assignments.core",["common/angular","common/angulartics","common/angulartics-google-tag-manager","common/ui-select","common/models/option-group","common/models/relationship.model","common/models/session.model","common/modules/xeditable-civi","common/modules/routers/compu-ui-router","common/directives/angular-date/date-input","common/directives/help-text.directive","common/directives/prevent-animations","common/directives/loading","common/filters/angular-date/format-date","common/services/angular-date/date-format","common/services/before-hash-query-params.service","common/services/crm-ang.service","tasks-assignments/vendor/angular-bootstrap-calendar","tasks-assignments/vendor/angular-checklist-model","tasks-assignments/vendor/angular-router","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.values"],function(e){"use strict";e.module("tasks-assignments.core",["ngAnimate","ngResource","ngSanitize","angularFileUpload","angulartics","angulartics.google.tagmanager","mwl.calendar","textAngular","ui.select","xeditable","xeditable-civi","checklist-model","common.angularDate","common.directives","common.models","compu.ui.router"])}),define("tasks-assignments/directives/civi-events.directive",[],function(){"use strict";function e(e,t){function n(t){CRM.$(document).on("crmFormSuccess",function(n,a){e.debug("crmFormSuccess"),e.debug(a),t.$broadcast("crmFormSuccess",a)}),CRM.$(document).on("crmFormSubmit",function(n,a){e.debug("crmFormSubmit"),e.debug(a),t.$broadcast("crmFormSubmit",a)}),CRM.$(document).on("crmFormCancel",function(n,a){e.debug("crmFormCancel"),e.debug(a),t.$broadcast("crmFormCancel",a)})}return e.debug("Directive: ctCiviEvents"),{link:n}}return e.__name="ctCiviEvents",e.$inject=["$log","$rootScope"],e}),define("tasks-assignments/directives/iframe.directive",[],function(){"use strict";function e(e,t){function n(e,n,a){var s=n[0];s.addEventListener("load",function(){var e,r=window.frames[a.name].document,i=["branding","toolbar","civicrm-menu","civicrm-footer","access"],o=0,c=i.length;for(o;o<c;o++)(e=r.getElementById(i[o]))&&(e.style.display="none");r.body.style.paddingTop="10px",s.height=r.body.scrollHeight+"px",n.addClass("ct-iframe-ready"),t.$broadcast("iframe-ready")})}return e.debug("Directive: taIframe"),{link:n}}return e.__name="taIframe",e.$inject=["$log","$rootScope"],e}),define("tasks-assignments/directives/sidebar-filters.directive",[],function(){"use strict";function e(e,t){return e.debug("Directive: sidebarFilters"),{restrict:"E",scope:!0,transclude:!0,templateUrl:t.path.TPL+"directives/sidebar-filters.html"}}return e.__name="sidebarFilters",e.$inject=["$log","config"],e}),define("tasks-assignments/directives/spinner.directive",[],function(){"use strict";function e(e,t){function n(e,n,a){function s(){r()||(n.css("position","relative"),l=!0),n.append(c),u=!0}function r(){var e=window.getComputedStyle(n[0]).position;return"relative"===e||"absolute"===e||"fixed"===e}function i(){u&&c.parentNode.removeChild(c),u=!1,l&&n.css("position","")}var o,c=document.createElement("div"),l=!1,u=!1;c.className="ct-spinner-cover spinner",void 0!==a.ctSpinnerShow&&s(),void 0!==a.ctSpinnerMainView&&(c.className="ct-spinner-cover",o=document.createElement("div"),o.className="ct-spinner spinner",t.$on("$stateChangeStart",function(){s(),document.body.appendChild(o)}),t.$on("$stateChangeSuccess",function(){i(),o.parentNode.removeChild(o)}),t.$on("$stateChangeError",function(){i(),o.parentNode.removeChild(o)})),e.$on("ct-spinner-show",function(e,t){(!t||a.ctSpinnerId&&a.ctSpinnerId===t)&&s()}),e.$on("ct-spinner-hide",function(e,t){(!t||a.ctSpinnerId&&a.ctSpinnerId===t)&&i()})}return e.debug("Directive: ctSpinner"),{link:n}}return e.__name="ctSpinner",e.$inject=["$log","$rootScope"],e}),define("tasks-assignments/directives/validate.directive",["common/angular"],function(e){"use strict";function t(t){function n(t,n,a,s){function r(e){n.toggleClass("has-error",e),m.toggleClass("glyphicon-remove",e)}function i(e,t){n.toggleClass("has-success",!e&&!t),m.toggleClass("glyphicon-ok",!e&&!t)}function o(e,t){n.toggleClass("has-warning",!e&&t),m.toggleClass("glyphicon-warning-sign",!e&&t)}var c=n[0].querySelector("[name]"),l=e.element(c),u=l.attr("name"),d=document.createElement("span"),m=e.element(d);u&&(n.addClass("has-feedback"),m.addClass("glyphicon form-control-feedback"),l.after(m),t.$watch(function(){return s[u]&&s[u].$invalid},function(e){s[u].$dirty&&(i(e,t.isWarning),r(e))}),void 0!==t.isWarning&&t.$watch("isWarning",function(e){var t=s[u].$invalid;s[u].$dirty&&(i(t,e),o(t,e))}),l.bind("blur",function(){r(s[u].$invalid)}))}return t.debug("Directive: taValidate"),{restrict:"A",require:"^form",link:n,scope:{isWarning:"=?taValidateWarning"}}}return t.__name="taValidate",t.$inject=["$log"],t}),define("tasks-assignments/modules/tasks-assignments.directives",["common/angular","tasks-assignments/directives/civi-events.directive","tasks-assignments/directives/iframe.directive","tasks-assignments/directives/sidebar-filters.directive","tasks-assignments/directives/spinner.directive","tasks-assignments/directives/validate.directive"],function(e,t,n,a,s,r){"use strict";return e.module("tasks-assignments.directives",[]).directive(t.__name,t).directive(n.__name,n).directive(a.__name,a).directive(s.__name,s).directive(r.__name,r)}),define("tasks-assignments/filters/assignment-type.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByAssignmentType"),function(e,n){var a,s=t.cache.assignment.obj,r=n.length,i=[],o=0,c=e.length;if(!c||!r)return e;for(o;o<c;o++)(a=s[e[o].case_id])&&-1!==n.indexOf(a.case_type_id)&&i.push(e[o]);return i}}return e.__name="filterByAssignmentType",e.$inject=["$filter","$rootScope","$log"],e}),define("tasks-assignments/filters/contact-id.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByContactId"),function(e,t){var n=[],a=0,s=e.length;if(!s||!t||"number"!=typeof+t)return e;for(a;a<s;a++)+e[a].assignee_contact_id[0]!=+t&&+e[a].source_contact_id!=+t&&+e[a].target_contact_id!=+t||n.push(e[a]);return n}}return e.__name="filterByContactId",e.$inject=["$filter","config","$log"],e}),define("tasks-assignments/filters/date-field.filter",[],function(){"use strict";function e(e,t){function n(e,t,n){return null!==e&&e>=t&&(e<=n||null===n)||null===e&&null===n}return t.debug("Filter: filterByDateField"),function(e,t,a,s){if(!e)return null;var r=new Date,i=[],o=0,c=e.length,l=r.setHours(0,0,0,0);if(!a)throw new Error("Field name to filter a list is required");if(!c||!t)return e;switch(t){case"overdue":var u;for(o;o<c;o++)u=null,e[o][a]&&(u=new Date(e[o][a]).setHours(0,0,0,0)),u<l&&null!==u&&i.push(e[o]);break;case"dateRange":if(!s||"object"!=typeof s)return e;var d,m=s.from?new Date(s.from).setHours(0,0,0,0):null,f=s.until?new Date(s.until).setHours(0,0,0,0):null;for(o;o<c;o++)d=e[o][a]?new Date(e[o][a]).setHours(0,0,0,0):null,n(d,m,f)&&i.push(e[o]);break;case"dueToday":for(o;o<c;o++)new Date(e[o][a]).setHours(0,0,0,0)===l&&i.push(e[o]);break;case"dueThisWeek":var g=new Date,v=g.getDay(),p=g.getDate()-v+(0===v?-6:1),h=new Date(g.setDate(p)),y=new Date(g.setDate(h.getDate()+7));for(o;o<c;o++)(d=new Date(e[o][a]).setHours(0,0,0,0))>l&&d>=h.setHours(0,0,0,0)&&d<y.setHours(0,0,0,0)&&i.push(e[o]);break;case"dueInNextFortnight":var _=r.setDate(r.getDate()+14);for(o;o<c;o++)new Date(e[o][a]).setHours(0,0,0,0)>=l&&new Date(e[o][a]).setHours(0,0,0,0)<=_&&i.push(e[o]);break;case"dueInNinetyDays":var k=r.setDate(r.getDate()+90);for(o;o<c;o++)new Date(e[o][a]).setHours(0,0,0,0)>=l&&new Date(e[o][a]).setHours(0,0,0,0)<=k&&i.push(e[o])}return i}}return e.__name="filterByDateField",e.$inject=["$filter","$log"],e}),define("tasks-assignments/filters/date-parse.filter",["common/moment"],function(e){"use strict";function t(t,n){return n.debug("Filter: dateParse"),function(t){return e(t).toDate()}}return t.__name="dateParse",t.$inject=["$filter","$log"],t}),define("tasks-assignments/filters/date-type.filter",["common/lodash"],function(e){"use strict";function t(t,n,a){
return a.debug("Filter: filterBy.dateType"),function(t,n){var a=[];return t.length&&n.length?(e.forEach(t,function(t){var s=t.dateContactList;s?e.forEach(s,function(e){if(-1!==n.indexOf(e.type))return a.push(t),!1}):-1!==n.indexOf(t.type)&&a.push(t)}),a):t}}return t.__name="filterByDateType",t.$inject=["$filter","$rootScope","$log"],t}),define("tasks-assignments/filters/date.filter",["common/moment"],function(e){"use strict";function t(t,n){return n.debug("Filter: filterBy.date"),function(t,n){if(!t||!t.length||!n)return[];var a,s,r,i=[],o=0,c=t.length;for(a=e().startOf(n),s=e().endOf(n);o<c;o++)(r=e(t[o].date))>a&&r<s&&i.push(t[o]);return i}}return t.__name="filterByDate",t.$inject=["$filter","$log"],t}),define("tasks-assignments/filters/offset.filter",[],function(){"use strict";function e(e){return e.debug("Filter: offset"),function(e,t){return t=t||0,e.slice(parseInt(t,10))}}return e.__name="offset",e.$inject=["$log"],e}),define("tasks-assignments/filters/ownership.filter",[],function(){"use strict";function e(e,t){e.debug("Filter: filterByOwnership");var n={assigned:function(e){return~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)},delegated:function(e){return e.source_contact_id===t.LOGGED_IN_CONTACT_ID&&!~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)}};return function(e,t){try{return e.filter(n[t])}catch(t){return e}}}return e.__name="filterByOwnership",e.$inject=["$log","config"],e}),define("tasks-assignments/filters/status.filter",[],function(){"use strict";function e(e,t,n){return n.debug("Filter: filterByStatus"),function(e,t,n){var a=[],s=0,r=e.length,i=t.length;if(n=void 0===n||n,!r||!i)return e;for(s;s<r;s++)-1!==t.indexOf(e[s].status_id)===n&&a.push(e[s]);return a}}return e.__name="filterByStatus",e.$inject=["$filter","$rootScope","$log"],e}),define("tasks-assignments/modules/tasks-assignments.filters",["common/angular","tasks-assignments/filters/assignment-type.filter","tasks-assignments/filters/contact-id.filter","tasks-assignments/filters/date-field.filter","tasks-assignments/filters/date-parse.filter","tasks-assignments/filters/date-type.filter","tasks-assignments/filters/date.filter","tasks-assignments/filters/offset.filter","tasks-assignments/filters/ownership.filter","tasks-assignments/filters/status.filter"],function(e,t,n,a,s,r,i,o,c,l){"use strict";return e.module("tasks-assignments.filters",[]).filter(t.__name,t).filter(n.__name,n).filter(a.__name,a).filter(s.__name,s).filter(r.__name,r).filter(i.__name,i).filter(o.__name,o).filter(c.__name,c).filter(l.__name,l)}),define("tasks-assignments/resources/app-settings.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"Setting",json:{}})}return e.__name="AppSettings",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment-search.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: AssignmentSearch"),e(t.url.ASSIGNMENTS+"/ajax/unclosed")}return e.__name="AssignmentSearch",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment-type.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: AssignmentType"),e(t.url.REST,{action:"get",entity:"CaseType",json:{is_active:1}})}return e.__name="AssignmentType",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/assignment.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: Assignment"),e(t.url.REST,{action:"get",entity:"Assignment",json:{}})}return e.__name="Assignment",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/contact.resource",[],function(){"use strict";function e(e,t,n,a){return a.debug("Resource: Contact"),e(n.url.REST,{action:"get",entity:"contact",debug:n.DEBUG})}return e.__name="Contact",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/resources/document.resource",[],function(){"use strict";function e(e,t,n,a){return a.debug("Resource: Document"),e(n.url.REST,{action:"get",entity:"Document",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}return e.__name="Document",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/resources/key-date.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Resource: KeyDate"),e(t.url.REST,{action:"get",entity:"KeyDates",json:{}})}return e.__name="KeyDate",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/relationship.resource",["require","exports","module"],function(e,t,n){"use strict";function a(e,t,n){return n.debug("Resource: Relationship"),e(t.url.REST,{action:"get",entity:"Relationship",json:{}})}return a.__name="Relationship",a.$inject=["$resource","config","$log"],a}),define("tasks-assignments/resources/settings.resource",[],function(){"use strict";function e(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"TASettings",json:{}})}return e.__name="Settings",e.$inject=["$resource","config","$log"],e}),define("tasks-assignments/resources/task.resource",[],function(){"use strict";function e(e,t,n,a){return a.debug("Service: Task"),e(n.url.REST,{action:"get",entity:"Task",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}return e.__name="Task",e.$inject=["$resource","$httpParamSerializer","config","$log"],e}),define("tasks-assignments/modules/tasks-assignments.resources",["common/angular","tasks-assignments/resources/app-settings.resource","tasks-assignments/resources/assignment-search.resource","tasks-assignments/resources/assignment-type.resource","tasks-assignments/resources/assignment.resource","tasks-assignments/resources/contact.resource","tasks-assignments/resources/document.resource","tasks-assignments/resources/key-date.resource","tasks-assignments/resources/relationship.resource","tasks-assignments/resources/settings.resource","tasks-assignments/resources/task.resource"],function(e,t,n,a,s,r,i,o,c,l,u){"use strict";return e.module("tasks-assignments.resources",[]).factory(t.__name,t).factory(n.__name,n).factory(a.__name,a).factory(s.__name,s).factory(r.__name,r).factory(i.__name,i).factory(o.__name,o).factory(c.__name,c).factory(l.__name,l).factory(u.__name,u)}),define("tasks-assignments/modules/tasks-assignments.run",["common/angular"],function(e){"use strict";function t(t,n,a,s,r,i,o,c,l,u,d,m,f){r.debug("tasks-assignments.run");var g=[i.LOGGED_IN_CONTACT_ID];t.cache={contact:{obj:{},arr:[],arrSearch:[]},assignment:{obj:{},arr:[],arrSearch:[]},assignmentType:{obj:{},arr:[]},dateType:{obj:{period_start_date:"Contract Start Date",period_end_date:"Contract End Date",birth_date:"Birthday",probation_end_date:"Probation End Date"},arr:[]},documentType:{obj:{},arr:[]},documentStatus:{obj:{},arr:[]},documentStatusResolve:i.status.resolve.DOCUMENT,taskType:{obj:{},arr:[]},taskStatus:{obj:{},arr:[]},taskStatusResolve:i.status.resolve.TASK},t.location=s,t.pathTpl=i.path.TPL,t.permissions=i.permissions,t.prefix=i.CLASS_NAME_PREFIX,t.settings=o,t.url=i.url,i.CONTACT_ID&&g.push(i.CONTACT_ID),l.getOptions().then(function(n){e.extend(t.cache,n)}),c.getOptions().then(function(n){e.extend(t.cache,n)}),u.getTypes().then(function(n){e.extend(t.cache.assignmentType.obj,n),e.forEach(n,function(e){this.push(e)},t.cache.assignmentType.arr)}),m.get({IN:g}).then(function(e){m.updateCache(e)}),e.forEach(t.cache.dateType.obj,function(e,t){this.push({key:t,value:e})},t.cache.dateType.arr),t.$on("$stateChangeSuccess",function(){n.removeClass("ct-page-loading")}),f.theme="bs3"}e.module("tasks-assignments.run",["tasks-assignments.constants","tasks-assignments.values"]).run(t),t.$inject=["$rootScope","$rootElement","$q","$location","$log","config","settings","documentService","taskService","assignmentService","keyDateService","contactService","editableOptions"]}),define("tasks-assignments/services/app-settings.service",[],function(){"use strict";function e(e,t,n,a,s){function r(a){var s=t.defer();return a=a&&"object"==typeof a?a:[],e.get({sequential:1,debug:n.DEBUG,return:a},function(e){s.resolve(e.values)},function(){s.reject("Unable to fetch settings list")}),s.promise}return s.debug("Service: appSettingsService"),{get:r}}return e.__name="appSettingsService",e.$inject=["AppSettings","$q","config","utilsService","$log"],e}),define("tasks-assignments/services/dialog.service",[],function(){"use strict";function e(e,t,n,a){function s(a){if(!a||"object"==typeof a)return e.open({appendTo:n.find("div").eq(0),templateUrl:t.path.TPL+"modal/dialog.html",size:"sm",controller:"ModalDialogController",resolve:{content:function(){return{copyCancel:a.copyCancel||"",copyConfirm:a.copyConfirm||"",title:a.title||"",msg:a.msg||""}}}}).result}return a.debug("Service: $dialog"),{open:s}}return e.__name="$dialog",e.$inject=["$uibModal","config","$rootElement","$log"],e}),define("tasks-assignments/services/file.service",[],function(){"use strict";function e(e,t,n,a,s,r){function i(e,t,s){if(!e||"number"!=typeof+e||!t||"number"!=typeof+t||!s||"string"!=typeof s)return null;var r=n.defer();return u.save({action:"delete",entityTable:s,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1),a.errorHandler(e,"Unable to delete file",r)||r.resolve(e.values[0])},function(){r.reject("Unable to delete file")}),r.promise}function o(e,t){if(!e||"number"!=typeof+e||!t||"string"!=typeof t)return null;var s=n.defer();return u.get({action:"list",entityTable:t,entityID:e},function(e){a.errorHandler(e,"Unable to fetch files",s)||s.resolve(e.values)},function(){s.reject("Unable to fetch files")}),s.promise}function c(e,t){if(!e||"object"!=typeof e||!t||"number"!=typeof+t)return null;var a=n.defer(),s=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){s.push(t)},e.onErrorItem=function(e,t,n,s){a.reject("Could not upload file: "+e.file.name),r.error(" ===== Item Error: "+n+" ======"),r.error(" =====  - item ======"),r.error(e),r.error(" =====  - response ======"),r.error(t),r.error(" =====  - headers ======"),r.error(s)},e.onCompleteAll=function(){a.resolve(s)},e.uploadAll(),a.promise}function l(e,n){if(!e||"string"!=typeof e)return null;var a={url:t.url.FILE+"/upload",formData:[{entityTable:e}]};return n&&"number"==typeof n&&(a.queueLimit=n),new s(a)}r.debug("Service: fileServiceTA");var u=e(t.url.FILE+"/:action");return s.prototype.queueDelete=[],{delete:i,get:o,upload:c,uploader:l}}return e.__name="fileServiceTA",e.$inject=["$resource","config","$q","utilsService","FileUploader","$log"],e}),define("tasks-assignments/services/key-date.service",["common/moment"],function(e){"use strict";function t(t,n,a,s,r){function i(a,s){var r=n.defer();return a&&s?(a=a?e(a).format("YYYY-MM-DD"):null,s=s?e(s).format("YYYY-MM-DD"):null,t.get({json:{start_date:a,end_date:s}},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch documents list")}),r.promise):null}return r.debug("Service: keyDateService"),{get:i}}return t.__name="keyDateService",t.$inject=["KeyDate","$q","config","utilsService","$log"],t}),define("tasks-assignments/services/settings.service",[],function(){"use strict";function e(e,t,n,a,s,r){function i(a){var s=t.defer();return a=a&&"object"==typeof a?a:[],e.get({action:"get",json:{sequential:1,debug:n.DEBUG,fields:a}},function(e){s.resolve(e.values)},function(){s.reject("Unable to fetch tasks list")}),s.promise}function o(s){if(!s||"object"!=typeof s)return null;var i=t.defer();return e.save({action:"set",json:{sequential:1,debug:n.DEBUG,fields:s}},null,function(e){a.errorHandler(e,"Unable to save",i)||(r.tabEnabled={documents:s.documents_tab||r.tabEnabled.documents_tab,keyDates:s.keydates_tab||r.tabEnabled.keydates_tab},r.copy.button.assignmentAdd=s.add_assignment_button_title,i.resolve(e.values))},function(){i.reject("Unable to save")}),i.promise}return s.debug("Service: settingsService"),{get:i,set:o}}return e.__name="settingsService",e.$inject=["Settings","$q","config","utilsService","$log","settings"],e}),define("tasks-assignments/services/utils.service",[],function(){"use strict";function e(e,t,n){function a(e,t,a){var s="",r=t||"Unknown Error";return e.is_error?(s=e.error_code||s,r=e.error_message||r,n.error(s+"\n"+r),a&&a.reject(s+"\n"+r),e.trace&&n.error(e.trace),!0):e.values?void 0:(n.error(r),a&&a.reject(r),!0)}return n.debug("Service: utilsService"),{errorHandler:a}}return e.__name="utilsService",e.$inject=["config","$q","$log","$rootScope"],e}),define("tasks-assignments/modules/tasks-assignments.services",["common/angular","tasks-assignments/services/app-settings.service","tasks-assignments/services/assignment.service","tasks-assignments/services/contact.service","tasks-assignments/services/dialog.service","tasks-assignments/services/document.service","tasks-assignments/services/file.service","tasks-assignments/services/key-date.service","tasks-assignments/services/settings.service","tasks-assignments/services/task.service","tasks-assignments/services/utils.service"],function(e,t,n,a,s,r,i,o,c,l,u){"use strict";return e.module("tasks-assignments.services",[]).factory(t.__name,t).factory(n.__name,n).factory(a.__name,a).factory(s.__name,s).factory(r.__name,r).factory(i.__name,i).factory(o.__name,o).factory(c.__name,c).factory(l.__name,l).factory(u.__name,u)}),define("tasks-assignments/modules/tasks-assignments.dashboard.config",["common/angular","common/moment","common/lodash"],function(e,t,n){"use strict";function a(e){e.withAutoBase(!0),e.settings.ga={userId:n.get(CRM,"vars.session.contact_id")}}function s(s,r,i,o,c,l,u,d,m,f){a(u),o.debugEnabled(s.DEBUG),c.otherwise("/tasks"),i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.defaults.stripTrailingSlashes=!1,m.showWeeks=!1,f.theme="bootstrap",d.setDateFormats({weekDay:"ddd"}),l.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("tasks",{url:"/tasks",controller:"TaskListController",controllerAs:"list",templateUrl:s.path.TPL+"dashboard/tasks.html?v="+(new Date).getTime(),resolve:{taskList:["taskService",function(e){return e.get({status_id:{"NOT IN":s.status.resolve.TASK}})}]}}).state("tasks.my",{url:"/my",params:{ownership:"assigned"}}).state("tasks.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("tasks.all",{url:"/all",params:{ownership:null}}).state("documents",{url:"/documents",controller:"DocumentListController",controllerAs:"list",templateUrl:s.path.TPL+"dashboard/documents.html?v=8",resolve:{documentList:["documentService",function(e){return e.get({})}]}}).state("documents.my",{url:"/my",params:{ownership:"assigned"}}).state("documents.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("documents.all",{url:"/all",params:{ownership:null}}).state("assignments",{url:"/assignments",controller:"ExternalPageController",templateUrl:s.path.TPL+"dashboard/assignments.html?v=5"}).state("calendar",{abstract:!0,controller:"CalendarController",templateUrl:s.path.TPL+"dashboard/calendar.html?v=3",resolve:{documentList:["$q","documentService","settings",function(t,n,a){var r=t.defer();return+a.tabEnabled.documents||r.resolve([]),t.all([n.get({sequential:0,assignee_contact_id:s.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":s.status.resolve.DOCUMENT}}),n.get({sequential:0,source_contact_id:s.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":s.status.resolve.DOCUMENT}})]).then(function(t){var n,a=[];e.extend(t[0],t[1]);for(n in t[0])a.push(t[0][n]);r.resolve(a)}),r.promise}],taskList:["$q","taskService",function(e,t){var a=e.defer();return e.all([t.get({sequential:1,assignee_contact_id:s.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":s.status.resolve.TASK}}),t.get({sequential:1,source_contact_id:s.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":s.status.resolve.TASK}})]).then(function(e){var t=n(e[0]).assign(e[1]);a.resolve(t.values().value())}),a.promise}]}}).state("calendar.mwl",{url:"/calendar",views:{documentList:{controller:"DocumentListController",controllerAs:"list",templateUrl:s.path.TPL+"dashboard/calendar.documentList.html?v=6"},taskList:{controller:"TaskListController",controllerAs:"list",templateUrl:s.path.TPL+"dashboard/calendar.taskList.html?v=5"}}}).state("calendar.mwl.day",{params:{calendarView:"day"}}).state("calendar.mwl.month",{params:{calendarView:"month"}}).state("calendar.mwl.week",{params:{calendarView:"week"}}).state("reports",{url:"/reports",controller:"ExternalPageController",templateUrl:s.path.TPL+"dashboard/reports.html?v=4"}).state("keyDates",{url:"/key-dates",controller:"DateListController",templateUrl:s.path.TPL+"dashboard/key-dates.html?v=4",resolve:{contactList:["keyDateService",function(e){return e.get(t().startOf("month"),t().endOf("month"))}]}})}e.module("tasks-assignments.dashboard.config",["tasks-assignments.constants"]).config(s),s.$inject=["config","$resourceProvider","$httpProvider","$logProvider","$urlRouterProvider","$stateProvider","$analyticsProvider","calendarConfigProvider","uibDatepickerConfig","uiSelectConfig"]}),define("tasks-assignments/modules/tasks-assignments.dashboard.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.dashboard.config"],function(e){"use strict";e.module("tasks-assignments.dashboard",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.constants","tasks-assignments.values","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.dashboard.config"])}),define("tasks-assignments/modules/tasks-assignments.documents.config",["common/angular"],function(e){"use strict";function t(e,t,n,a,s,r,i,o,c){c.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"DocumentListController",controllerAs:"list",templateUrl:e.path.TPL+"contact/documents.html?v=4",resolve:{documentList:["documentService",function(t){return t.get({target_contact_id:e.CONTACT_ID})}]}}),r.virtualPageviews(!1),a.defaults.stripTrailingSlashes=!1,s.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.showWeeks=!1,o.theme="bootstrap"}e.module("tasks-assignments.documents.config",["tasks-assignments.constants"]).config(t),t.$inject=["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","$analyticsProvider","uibDatepickerConfig","uiSelectConfig","$logProvider"]}),define("tasks-assignments/modules/tasks-assignments.documents.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.documents.config"],function(e){"use strict";e.module("tasks-assignments.documents",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.constants","tasks-assignments.values","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.documents.config"])}),define("tasks-assignments/modules/tasks-assignments.settings.config",["common/angular","common/lodash"],function(e,t){"use strict";function n(e){e.settings.ga={userId:t.get(CRM,"vars.session.contact_id")},e.withAutoBase(!0)}function a(e,t,a,s,r,i,o,c,l){r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",s.defaults.stripTrailingSlashes=!1,o.showWeeks=!1,c.theme="bootstrap",n(i),l.debugEnabled(e.DEBUG),a.otherwise("/"),t.state("settings",{url:"/",controller:"SettingsController",templateUrl:e.path.TPL+"settings.html?v=5"})}e.module("tasks-assignments.settings.config",["tasks-assignments.constants"]).config(a),a.$inject=["config","$stateProvider","$urlRouterProvider","$resourceProvider","$httpProvider","$analyticsProvider","uibDatepickerConfig","uiSelectConfig","$logProvider"]}),define("tasks-assignments/modules/tasks-assignments.settings.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.settings.config"],function(e){"use strict";e.module("tasks-assignments.settings",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.constants","tasks-assignments.values","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.settings.config"])}),define("tasks-assignments/modules/tasks-assignments.tasks.config",["common/angular"],function(e){"use strict";function t(e,t,n,a,s,r,i,o,c){c.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"TaskListController",controllerAs:"list",templateUrl:e.path.TPL+"contact/tasks.html?v=222",resolve:{taskList:["taskService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.TASK}})}]}}),r.virtualPageviews(!1),a.defaults.stripTrailingSlashes=!1,s.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.showWeeks=!1,o.theme="bootstrap"}e.module("tasks-assignments.tasks.config",["tasks-assignments.constants"]).config(t),t.$inject=["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","$analyticsProvider","uibDatepickerConfig","uiSelectConfig","$logProvider"]}),define("tasks-assignments/modules/tasks-assignments.tasks.module",["common/angular","tasks-assignments/modules/tasks-assignments.constants","tasks-assignments/modules/tasks-assignments.controllers","tasks-assignments/modules/tasks-assignments.core","tasks-assignments/modules/tasks-assignments.directives","tasks-assignments/modules/tasks-assignments.filters","tasks-assignments/modules/tasks-assignments.resources","tasks-assignments/modules/tasks-assignments.run","tasks-assignments/modules/tasks-assignments.services","tasks-assignments/modules/tasks-assignments.values","tasks-assignments/modules/tasks-assignments.tasks.config"],function(e){"use strict";e.module("tasks-assignments.tasks",["tasks-assignments.core","tasks-assignments.run","tasks-assignments.values","tasks-assignments.constants","tasks-assignments.controllers","tasks-assignments.directives","tasks-assignments.filters","tasks-assignments.resources","tasks-assignments.services","tasks-assignments.tasks.config"])}),function(){var e=CRM.tasksAssignments.extensionPath+"js/src/tasks-assignments";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"tasks-assignments":e,"tasks-assignments/vendor/angular-bootstrap-calendar":e+"/vendor/angular/angular-bootstrap-calendar-tpls-custom","tasks-assignments/vendor/angular-checklist-model":e+"/vendor/angular/checklist-model","tasks-assignments/vendor/angular-router":e+"/vendor/angular/angular-ui-router"}}),require(["common/angular","tasks-assignments/modules/tasks-assignments.dashboard.module","tasks-assignments/modules/tasks-assignments.documents.module","tasks-assignments/modules/tasks-assignments.settings.module","tasks-assignments/modules/tasks-assignments.tasks.module"],function(e){"use strict";document.addEventListener("taInit",function(t){var n=e.element(document.getElementById(t.detail.module));!!n.injector()||e.bootstrap(n,["tasks-assignments."+t.detail.app])}),document.dispatchEvent("function"==typeof window.CustomEvent?new window.CustomEvent("taReady"):function(){var e=document.createEvent("Event");return e.initEvent("taReady",!0,!0),e}())})}(require);
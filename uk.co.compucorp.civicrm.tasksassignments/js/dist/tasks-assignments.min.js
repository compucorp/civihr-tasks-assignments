/**
 * CiviTasks Dashboard Calendar based on:
 * angular-bootstrap-calendar - A pure AngularJS bootstrap themed responsive calendar that can display events and has views for year, month, week and day
 * @version v0.10.6
 * @link https://github.com/mattlewis92/angular-bootstrap-calendar
 * @license MIT
 */

/**
 * State-based routing for AngularJS
 * @version v0.2.15
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

define("tasks-assignments/modules/config",["common/angular"],function(e){"use strict";e.module("civitasks.config",[]).constant("config",{DEBUG:!!+CRM.debug,CLASS_NAME_PREFIX:"ct-",CONTACT_ID:CRM.contactId||null,LOGGED_IN_CONTACT_ID:CRM.adminId||null,path:{EXT:CRM.tasksAssignments.extensionPath,TPL:CRM.tasksAssignments.extensionPath+"views/"},permissions:{allowDelete:CRM.tasksAssignments.permissions.delete_tasks_and_documents},url:{REST:CRM.url("civicrm/ajax/rest"),ASSIGNMENTS:CRM.url("civicrm/case"),CIVI_DASHBOARD:CRM.url("civicrm/"),CONTACT:CRM.url("civicrm/contact/view"),FILE:"/civicrm/tasksassignments/file",CSV_EXPORT:CRM.url("civicrm/tasksassignments")},status:{resolve:{DOCUMENT:["3","4"],TASK:["2","3","6","8"]}}})}),define("tasks-assignments/modules/settings",["common/angular"],function(e){"use strict";e.module("civitasks.settings",[]).value("settings",{tabEnabled:{documents:CRM.tasksAssignments.settings.documents_tab,keyDates:CRM.tasksAssignments.settings.keydates_tab},extEnabled:{assignments:CRM.tasksAssignments.case_extension},copy:{button:{assignmentAdd:CRM.tasksAssignments.settings.add_assignment_button_title}},isTaskDashboardDefault:CRM.tasksAssignments.settings.is_task_dashboard_default,daysToCreateADocumentClone:CRM.tasksAssignments.settings.days_to_create_a_document_clone})}),define("tasks-assignments/vendor/angular-bootstrap-calendar",["common/moment"],function(e){"use strict";angular.module("mwl.calendar",[]),angular.module("mwl.calendar").run(["$templateCache",function(e){e.put("src/templates/calendar.html",'<div class="cal-context" ng-switch="view"><div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div><div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div><mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year"></mwl-calendar-year><mwl-calendar-month events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month"></mwl-calendar-month><mwl-calendar-week events="events" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week"></mwl-calendar-week><mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day"></mwl-calendar-day></div>'),e.put("src/templates/calendarCustom.html",'<div class="cal-context" ng-switch="view"> <div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div> <div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div> <mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year" ></mwl-calendar-year> <mwl-calendar-month events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month" ></mwl-calendar-month> <mwl-calendar-week events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week" ></mwl-calendar-week> <mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day" ></mwl-calendar-day></div>'),e.put("src/templates/calendarDayView.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.timeLabel"></div><div class="span11 col-xs-11 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.eventsLabel"></div></div><div class="cal-day-panel clearfix" ng-style="{height: (vm.hours.length * vm.hourHeight) + \'px\'}"><div class="cal-day-panel-hour"><div class="cal-day-hour" ng-repeat="hour in vm.hours track by $index"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><strong ng-bind="hour.label"></strong></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight" ng-class="\'dh-event-\' + event.type" ng-repeat="event in vm.view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title | calendarTruncateEventTitle:20:event.height"></span></a></div></div></div>'),e.put("src/templates/calendarMonthDay.html",'<div class="cal-month-day" ng-class="{\n            \'cal-day-outmonth\': !day.inMonth,\n            \'cal-day-inmonth\': day.inMonth,\n            \'cal-day-weekend\': day.isWeekend,\n            \'cal-day-past\': day.isPast,\n            \'cal-day-today\': day.isToday,\n            \'cal-day-future\': day.isFuture\n          }"><small class="cal-events-num badge badge-important pull-left" ng-show="day.badgeTotal > 0" ng-bind="day.badgeTotal"></small> <span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" ng-bind="day.label"></span><div class="cal-day-tick" ng-show="dayIndex === vm.openDayIndex && vm.view[vm.openDayIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div ng-include="\'src/templates/calendarMonthEventsList.html\'"></div></div>'),e.put("src/templates/calendarMonthDayCustom.html",'<div class="cal-month-day" ng-class="{ \'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture }"> <ul class="cal-list-events-num"> <li ng-show="day.badgeEventsTotal > 0"> <small class="badge badge-danger-light" ng-bind="day.badgeEventsTotal"></small> Tasks </li> <li ng-show="day.badgeDocumentsTotal > 0"> <small class="badge badge-dark" ng-bind="day.badgeDocumentsTotal"></small> Documents </li> </ul> <span class="pull-right" data-cal-date ng-bind="day.label"> </span></div>'),e.put("src/templates/calendarMonthEventsList.html",'<div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" ng-repeat="event in day.events track by $index" class="pull-left event" ng-class="\'event-\' + event.type" ng-mouseenter="vm.highlightEvent(event, true)" ng-mouseleave="vm.highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div>'),e.put("src/templates/calendarMonthView.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"><div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"><div class="cal-row-fluid cal-before-eventlist"><div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.dayClicked(day)" ng-class="{pointer: day.events.length > 0}"><div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openDayIndex].events.length > 0" events="vm.view[vm.openDayIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>'),e.put("src/templates/calendarMonthViewCustom.html",'<div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"> <div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"> <div class="cal-row-fluid cal-before-eventlist"> <div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="pointer cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.calendarCtrl.drillDown(day.date)"> <div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div> </div> </div> </div></div>'),e.put("src/templates/calendarSlideBox.html",'<div class="cal-slide-box" collapse="vm.shouldCollapse" mwl-collapse-fallback="vm.shouldCollapse"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in events track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title"></span> <span ng-show="isMonthView">(<span ng-bind="event.startsAt | date:\'shortTime\'"></span>)</span> <span ng-show="isYearView">(<span ng-bind="event.startsAt | date:\'MMM d, h:mm a\'"></span>)</span></a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="vm.$sce.trustAsHtml(editEventHtml)" ng-click="onEditEventClick({calendarEvent: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="vm.$sce.trustAsHtml(deleteEventHtml)" ng-click="onDeleteEventClick({calendarEvent: event})"></a></li></ul></div></div>'),e.put("src/templates/calendarWeekView.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{\n        \'cal-day-weekend\': day.isWeekend,\n        \'cal-day-past\': day.isPast,\n        \'cal-day-today\': day.isToday,\n        \'cal-day-future\': day.isFuture}"><span ng-bind="day.weekDayLabel"></span><br><small><span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"></span></small></div></div><div class="cal-row-fluid" ng-repeat="event in vm.view.events track by $index"><div ng-class="\'cal-cell\' + event.daySpan + \' cal-offset\' + event.dayOffset + \' day-highlight dh-event-\' + event.type" data-event-class><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"></a></div></div></div>'),e.put("src/templates/calendarWeekViewCustom.html",'<div class="cal-week-box"> <div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{ \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture}"> <span ng-bind="day.weekDayLabel"></span> <br> <small> <span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"> </span> </small> </div> </div> <div class="cal-col-fluid" ng-repeat="col in vm.view.cols track by $index"> <div class="cal-row-fluid" ng-repeat="event in col track by $index"> <div ng-if="event.title" ng-class="\'day-highlight dh-event-\' + event.type + \' dh-event-overdue-\' + event.overdue" data-event-class> <a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"> </a> </div> </div> </div></div>'),e.put("src/templates/calendarYearView.html",'<div class="cal-year-box"><div ng-repeat="rowOffset in [0, 4, 8] track by rowOffset"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in vm.view | calendarLimitTo:4:rowOffset track by $index" ng-init="monthIndex = vm.view.indexOf(month)" ng-click="vm.monthClicked(month)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(month.date)" ng-bind="month.label"></span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.badgeTotal > 0" ng-bind="month.badgeTotal"></small><div class="cal-day-tick" ng-show="monthIndex === vm.openMonthIndex && vm.view[vm.openMonthIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openMonthIndex].events.length > 0" events="vm.view[vm.openMonthIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>')}]),angular.module("mwl.calendar").constant("moment",e),angular.module("mwl.calendar").factory("calendarTitle",["moment","calendarConfig",function(e,t){function n(n){return e(n).format(t.titleFormats.day)}function a(n){var a=t.titleFormats.week;return a.replace("{week}",e(n).week()).replace("{year}",e(n).format("YYYY"))}function s(n){return e(n).format(t.titleFormats.month)}function r(n){return e(n).format(t.titleFormats.year)}return{day:n,week:a,month:s,year:r}}]),angular.module("mwl.calendar").factory("calendarHelper",["moment","calendarConfig",function(e,t){function n(t,n,a,s){return t=e(t),n=e(n),a=e(a),s=e(s),t.isAfter(a)&&t.isBefore(s)||n.isAfter(a)&&n.isBefore(s)||t.isBefore(a)&&n.isAfter(s)||t.isSame(a)||n.isSame(s)}function a(t,a,s){var r=e(t).startOf(a),i=e(t).endOf(a);return s.filter(function(e){return n(e.startsAt,e.endsAt,r,i)})}function s(e){return e.filter(function(e){return e.incrementsBadgeTotal!==!1}).length}function r(){for(var n=[],a=0;a<7;)n.push(e().weekday(a++).format(t.dateFormats.weekDay));return n}function i(e,t,a){return e.filter(function(e){return n(e.startsAt,e.endsAt,t,a)})}function o(n,r){for(var o=[],c=a(r,"year",n),l=e(r).startOf("year"),u=0;u<12;){var d=l.clone(),m=d.clone().endOf("month"),f=i(c,d,m);o.push({label:d.format(t.dateFormats.month),isToday:d.isSame(e().startOf("month")),events:f,date:d,badgeTotal:s(f)}),l.add(1,"month"),u++}return o}function c(t,n,r){for(var o=a(r,"month",t),c=a(r,"month",n),l=e(r).startOf("month"),u=l.clone().startOf("week"),d=e(r).endOf("month").endOf("week"),m=[],f=e().startOf("day");u.isBefore(d);){var v=u.month()===e(r).month(),p=[],g=[];v&&(p=i(o,u,u.clone().endOf("day")),g=i(c,u,u.clone().endOf("day"))),m.push({label:u.date(),date:u.clone(),inMonth:v,isPast:f.isAfter(u),isToday:f.isSame(u),isFuture:f.isBefore(u),isWeekend:[0,6].indexOf(u.day())>-1,events:p,documents:g,badgeEventsTotal:s(p),badgeDocumentsTotal:s(g)}),u.add(1,"day")}return m}function l(n,a,s){for(var r=e(s).startOf("week"),o=e(s).endOf("week"),c=r.clone(),l=[],u=[],d=10,m=e().startOf("day");l.length<7;)u.push([]),l.push({weekDayLabel:c.format(t.dateFormats.weekDay),date:c.clone(),dayLabel:c.format(t.dateFormats.day),isPast:c.isBefore(m),isToday:c.isSame(m),isFuture:c.isAfter(m),isWeekend:[0,6].indexOf(c.day())>-1}),c.add(1,"day");var f=i(n.concat(a),r,o).map(function(t){var n,a,s=e(t.startsAt).startOf("day"),i=e(t.endsAt).startOf("day"),c=e(r).startOf("day"),l=e(o).startOf("day");return n=s.isBefore(c)||s.isSame(c)?0:s.diff(c,"days"),i.isAfter(l)&&(i=l),s.isBefore(c)&&(s=c),a=e(i).diff(s,"days")+1,t.daySpan=a,t.dayOffset=n,t.overdue=s.isBefore(m),u[n].push(t),t});return u.map(function(e){d=e.length>d?e.length:d}),u.map(function(e){if(e.length<d)for(var t=e.length;t<d;t++)e.push({})}),{days:l,events:f,cols:u,rowsMax:d}}function u(t,a,s,r,o){var c=e(a).startOf("day").add(s,"hours"),l=e(a).startOf("day").add(r,"hours"),u=(r-s+1)*o,d=o/60,m=[],f=i(t,e(a).startOf("day").toDate(),e(a).endOf("day").toDate());return f.map(function(t){if(e(t.startsAt).isBefore(c)?t.top=0:t.top=e(t.startsAt).startOf("minute").diff(c.startOf("minute"),"minutes")*d-2,e(t.endsAt).isAfter(l))t.height=u-t.top;else{var n=t.startsAt;e(t.startsAt).isBefore(c)&&(n=c.toDate()),t.height=e(t.endsAt).diff(n,"minutes")*d}return t.top-t.height>u&&(t.height=0),t.left=0,t}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return m.forEach(function(a,s){var r=!0;a.forEach(function(t){(n(e.startsAt,e.endsAt,t.startsAt,t.endsAt)||n(t.startsAt,t.endsAt,e.startsAt,e.endsAt))&&(r=!1)}),r&&t&&(t=!1,e.left=150*s,m[s].push(e))}),t&&(e.left=150*m.length,m.push([e])),e})}return{getWeekDayNames:r,getYearView:o,getMonthView:c,getWeekView:l,getDayView:u}}]),angular.module("mwl.calendar").service("calendarDebounce",["$timeout",function(e){function t(t,n,a){var s;return function(){function r(){s=null,a||t.apply(i,o)}var i=this,o=arguments,c=a&&!s;e.cancel(s),s=e(r,n),c&&t.apply(i,o)}}return t}]),angular.module("mwl.calendar").provider("calendarConfig",function(){var e={hour:"ha",day:"D MMM",month:"MMMM",weekDay:"dddd"},t={day:"dddd D MMMM, YYYY",week:"Week {week} of {year}",month:"MMMM YYYY",year:"YYYY"},n={eventsLabel:"Events",timeLabel:"Time"},a=this;a.setDateFormats=function(t){return angular.extend(e,t),a},a.setTitleFormats=function(e){return angular.extend(t,e),a},a.setI18nStrings=function(e){return angular.extend(n,e),a},a.$get=function(){return{dateFormats:e,titleFormats:t,i18nStrings:n}}}),angular.module("mwl.calendar").filter("calendarTruncateEventTitle",function(){return function(e,t,n){return e?e.length>=t&&e.length/20>n/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").filter("calendarLimitTo",function(){return function(e,t,n){return t=Math.abs(Number(t))===1/0?Number(t):parseInt(t),isNaN(t)?e:(angular.isNumber(e)&&(e=e.toString()),angular.isArray(e)||angular.isString(e)?(n=!n||isNaN(n)?0:parseInt(n),n=n<0&&n>=-e.length?e.length+n:n,t>=0?e.slice(n,n+t):0===n?e.slice(t,e.length):e.slice(Math.max(0,n+t),n)):e)}}),angular.module("mwl.calendar").directive("mwlDateModifier",function(){return{restrict:"A",controller:["$element","$attrs","$scope","moment",function(e,t,n,a){function s(){angular.isDefined(t.setToToday)?n.date=new Date:angular.isDefined(t.increment)?n.date=a(n.date).add(1,n.increment).toDate():angular.isDefined(t.decrement)&&(n.date=a(n.date).subtract(1,n.decrement).toDate()),n.$apply()}e.bind("click",s),n.$on("$destroy",function(){e.unbind("click",s)})}],scope:{date:"=",increment:"=",decrement:"="}}}),angular.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,n){var a=e.$watch(t.mwlCollapseFallback,function(e){e?n.addClass("ng-hide"):n.removeClass("ng-hide")}),s=e.$on("$destroy",function(){s(),a()})}]}}]),angular.module("mwl.calendar").directive("mwlCalendarYear",function(){return{templateUrl:"src/templates/calendarYearView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var a=this,s=!0;e.$on("calendar.refreshView",function(){a.view=n.getYearView(e.events,e.currentDay),e.autoOpen&&s&&(s=!1,a.view.forEach(function(n){t(e.currentDay).startOf("month").isSame(n.date)&&a.monthClicked(n,!0)}))}),a.monthClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),a.openRowIndex=null;var s=a.view.indexOf(t);s===a.openMonthIndex?a.openMonthIndex=null:(a.openMonthIndex=s,a.openRowIndex=Math.floor(s/4))}}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"src/templates/calendarWeekViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{documents:"=",events:"=",currentDay:"=",onEventClick:"="},controller:["$scope","calendarHelper",function(e,t){var n=this;e.$on("calendar.refreshView",function(){n.view=t.getWeekView(e.events,e.documents,e.currentDay)})}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"src/templates/calendarSlideBox.html",replace:!0,controller:["$scope","$sce",function(e,t){var n=this;n.$sce=t;var a=e.$watch("isOpen",function(e){n.shouldCollapse=!e}),s=e.$on("$destroy",function(){s(),a()})}],controllerAs:"vm",require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,n,a){e.isMonthView=!!a[0],e.isYearView=!!a[1]},scope:{isOpen:"=",events:"=",onEventClick:"=",editEventHtml:"=",onEditEventClick:"=",deleteEventHtml:"=",onDeleteEventClick:"="}}}),angular.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"src/templates/calendarMonthViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",documents:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var a=this,s=!0;e.$on("calendar.refreshView",function(){a.weekDays=n.getWeekDayNames(),a.view=n.getMonthView(e.events,e.documents,e.currentDay);var r=Math.floor(a.view.length/7);a.monthOffsets=[];for(var i=0;i<r;i++)a.monthOffsets.push(7*i);e.autoOpen&&s&&(s=!1,a.view.forEach(function(n){n.inMonth&&t(e.currentDay).startOf("day").isSame(n.date)&&a.dayClicked(n,!0)}))}),a.dayClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),a.openRowIndex=null;var s=a.view.indexOf(t);s===a.openDayIndex?a.openDayIndex=null:(a.openDayIndex=s,a.openRowIndex=Math.floor(s/7))},a.highlightEvent=function(e,t){a.view.forEach(function(n){if(delete n.highlightClass,t){var a=n.events.indexOf(e)>-1;a&&(n.highlightClass="day-highlight dh-event-"+e.type)}})}}],controllerAs:"vm",link:function(e,t,n,a){e.vm.calendarCtrl=a}}}),angular.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"src/templates/calendarDayView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",dayViewStart:"=",dayViewEnd:"=",dayViewSplit:"="},controller:["$scope","$timeout","moment","calendarHelper","calendarConfig",function(e,t,n,a,s){function r(){i=n(e.dayViewStart||"00:00","HH:mm"),o=n(e.dayViewEnd||"23:00","HH:mm"),c.dayViewSplit=parseInt(e.dayViewSplit),c.hourHeight=60/e.dayViewSplit*30,c.hours=[];for(var t=n(i),a=0;a<=o.diff(i,"hours");a++)c.hours.push({label:t.format(s.dateFormats.hour)}),t.add(1,"hour")}var i,o,c=this;c.calendarConfig=s;var l=n.locale();e.$on("calendar.refreshView",function(){l!==n.locale()&&(l=n.locale(),r()),c.view=a.getDayView(e.events,e.currentDay,i.hours(),o.hours(),c.hourHeight)}),r()}],controllerAs:"vm"}}),angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"src/templates/calendarCustom.html",restrict:"EA",scope:{events:"=",documents:"=",view:"=",viewTitle:"=",currentDay:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onEventClick:"&",onEditEventClick:"&",onDeleteEventClick:"&",onTimespanClick:"&",onDrillDownClick:"&",dayViewStart:"@",dayViewEnd:"@",dayViewSplit:"@"},controller:["$scope","$timeout","moment","calendarTitle","calendarDebounce",function(e,t,n,a,s){var r=this;e.events=e.events||[],e.documents=e.documents||[],r.changeView=function(t,n){e.view=t,e.currentDay=n},r.drillDown=function(t){var a=n(t).toDate(),s={year:"month",month:"day",week:"day"};e.onDrillDownClick({calendarDate:a,calendarNextView:s[e.view]})!==!1&&r.changeView(s[e.view],a)};var i=n(e.currentDay),o=angular.copy(e.view),c=s(function(){a[e.view]&&(e.viewTitle=a[e.view](e.currentDay));var t=n(e.currentDay),s=!0;i.clone().startOf(e.view).isSame(t.clone().startOf(e.view))&&!i.isSame(t)&&e.view===o&&(s=!1),i=t,o=angular.copy(e.view),s&&e.$broadcast("calendar.refreshView")},50),l=e.$watch(function(){return n.locale()},c),u=[];u.push(l),u.push(e.$watch("currentDay",c)),u.push(e.$watch("view",c)),u.push(e.$watch("events",c,!0)),u.push(e.$watch("documents",c,!0));var d=e.$on("$destroy",function(){u.forEach(function(e){e()})});u.push(d)}]}})}),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,t){function n(e,t,n){if(angular.isArray(e))for(var a=e.length;a--;)if(n(e[a],t))return!0;return!1}function a(e,t,a){return e=angular.isArray(e)?e:[],n(e,t,a)||e.push(t),e}function s(e,t,n){if(angular.isArray(e))for(var a=e.length;a--;)if(n(e[a],t)){e.splice(a,1);break}return e}function r(r,i,o){function c(e,t){r.checked=n(e,m,f)}t(i)(r);var l=e(o.checklistModel),u=l.assign,d=e(o.checklistChange),m=e(o.checklistValue)(r.$parent),f=angular.equals;o.hasOwnProperty("checklistComparator")&&(f=e(o.checklistComparator)(r.$parent)),r.$watch("checked",function(e,t){if(e!==t){var n=l(r.$parent);e===!0?u(r.$parent,a(n,m,f)):u(r.$parent,s(n,m,f)),d&&d(r)}}),angular.isFunction(r.$parent.$watchCollection)?r.$parent.$watchCollection(o.checklistModel,c):r.$parent.$watch(o.checklistModel,c,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if("INPUT"!==e[0].tagName||"checkbox"!==t.type)throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!t.checklistValue)throw"You should provide `checklist-value`.";return e.removeAttr("checklist-model"),e.attr("ng-model","checked"),r}}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(e,t,n){function a(e,t){return F(new(F(function(){},{prototype:e})),t)}function s(e){return N(arguments,function(t){t!==e&&N(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function r(e,t){var n=[];for(var a in e.path){if(e.path[a]!==t.path[a])break;n.push(e.path[a])}return n}function i(e){if(Object.keys)return Object.keys(e);var t=[];return N(e,function(e,n){t.push(n)}),t}function o(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,a=Number(arguments[2])||0;for(a=a<0?Math.ceil(a):Math.floor(a),a<0&&(a+=n);a<n;a++)if(a in e&&e[a]===t)return a;return-1}function c(e,t,n,a){var s,c=r(n,a),l={},u=[];for(var d in c)if(c[d].params&&(s=i(c[d].params),s.length))for(var m in s)o(u,s[m])>=0||(u.push(s[m]),l[s[m]]=e[s[m]]);return F({},l,t)}function l(e,t,n){if(!n){n=[];for(var a in e)n.push(a)}for(var s=0;s<n.length;s++){var r=n[s];if(e[r]!=t[r])return!1}return!0}function u(e,t){var n={};return N(e,function(e){n[e]=t[e]}),n}function d(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t}function m(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var a in e)o(n,a)==-1&&(t[a]=e[a]);return t}function f(e,t){var n=P(e),a=n?[]:{};return N(e,function(e,s){t(e,s)&&(a[n?a.length:s]=e)}),a}function v(e,t){var n=P(e)?[]:{};return N(e,function(e,a){n[a]=t(e,a)}),n}function p(e,t){var a=1,r=2,c={},l=[],u=c,d=F(e.when(c),{$$promises:c,$$values:c});this.study=function(c){function f(e,n){if(y[n]!==r){if(h.push(n),y[n]===a)throw h.splice(0,o(h,n)),new Error("Cyclic dependency: "+h.join(" -> "));if(y[n]=a,R(e))g.push(n,[function(){return t.get(e)}],l);else{var s=t.annotate(e);N(s,function(e){e!==n&&c.hasOwnProperty(e)&&f(c[e],e)}),g.push(n,e,s)}h.pop(),y[n]=r}}function v(e){return L(e)&&e.then&&e.$$promises}if(!L(c))throw new Error("'invocables' must be an object");var p=i(c||{}),g=[],h=[],y={};return N(c,f),c=h=y=null,function(a,r,i){function o(){--$||(_||s(k,r.$$values),h.$$values=k,h.$$promises=h.$$promises||!0,delete h.$$inheritedValues,f.resolve(k))}function c(e){h.$$failure=e,f.reject(e)}function l(n,s,r){function l(e){d.reject(e),c(e)}function u(){if(!I(h.$$failure))try{d.resolve(t.invoke(s,i,k)),d.promise.then(function(e){k[n]=e,o()},l)}catch(e){l(e)}}var d=e.defer(),m=0;N(r,function(e){y.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(m++,y[e].then(function(t){k[e]=t,--m||u()},l))}),m||u(),y[n]=d.promise}if(v(a)&&i===n&&(i=r,r=a,a=null),a){if(!L(a))throw new Error("'locals' must be an object")}else a=u;if(r){if(!v(r))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else r=d;var f=e.defer(),h=f.promise,y=h.$$promises={},k=F({},a),$=1+g.length/3,_=!1;if(I(r.$$failure))return c(r.$$failure),h;r.$$inheritedValues&&s(k,m(r.$$inheritedValues,p)),F(y,r.$$promises),r.$$values?(_=s(k,m(r.$$values,p)),h.$$inheritedValues=m(r.$$values,p),o()):(r.$$inheritedValues&&(h.$$inheritedValues=m(r.$$inheritedValues,p)),r.then(o,c));for(var b=0,w=g.length;b<w;b+=3)a.hasOwnProperty(g[b])?o():l(g[b],g[b+1],g[b+2]);return h}},this.resolve=function(e,t,n,a){return this.study(e)(t,n,a)}}function g(e,t,n){this.fromConfig=function(e,t,n){return I(e.template)?this.fromString(e.template,t):I(e.templateUrl)?this.fromUrl(e.templateUrl,t):I(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return j(e)?e(t):e},this.fromUrl=function(n,a){return j(n)&&(n=n(a)),null==n?null:e.get(n,{cache:t,headers:{Accept:"text/html"}}).then(function(e){return e.data})},this.fromProvider=function(e,t,a){return n.invoke(e,null,a||{params:t})}}function h(e,t,s){function r(t,n,a,s){if(g.push(t),v[t])return v[t];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(p[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");return p[t]=new U.Param(t,n,a,s),p[t]}function i(e,t,n,a){var s=["",""],r=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return r;switch(n){case!1:s=["(",")"+(a?"?":"")];break;case!0:s=["?(",")?"];break;default:s=["("+n+"|",")?"]}return r+s[0]+t+s[1]}function o(s,r){var i,o,c,l,u;return i=s[2]||s[3],u=t.params[i],c=e.substring(m,s.index),o=r?s[4]:s[4]||("*"==s[1]?".*":null),l=U.type(o||"string")||a(U.type("string"),{pattern:new RegExp(o,t.caseInsensitive?"i":n)}),{id:i,regexp:o,segment:c,type:l,cfg:u}}t=F({params:{}},L(t)?t:{});var c,l=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,u=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,d="^",m=0,f=this.segments=[],v=s?s.params:{},p=this.params=s?s.params.$$new():new U.ParamSet,g=[];this.source=e;for(var h,y,k;(c=l.exec(e))&&(h=o(c,!1),!(h.segment.indexOf("?")>=0));)y=r(h.id,h.type,h.cfg,"path"),d+=i(h.segment,y.type.pattern.source,y.squash,y.isOptional),f.push(h.segment),m=l.lastIndex;k=e.substring(m);var $=k.indexOf("?");if($>=0){var _=this.sourceSearch=k.substring($);if(k=k.substring(0,$),this.sourcePath=e.substring(0,m+$),_.length>0)for(m=0;c=u.exec(_);)h=o(c,!0),y=r(h.id,h.type,h.cfg,"search"),m=l.lastIndex}else this.sourcePath=e,this.sourceSearch="";d+=i(k)+(t.strict===!1?"/?":"")+"$",
f.push(k),this.regexp=new RegExp(d,t.caseInsensitive?"i":n),this.prefix=f[0],this.$$paramNames=g}function y(e){F(this,e)}function k(){function e(e){return null!=e?e.toString().replace(/\//g,"%2F"):e}function s(e){return null!=e?e.toString().replace(/%2F/g,"/"):e}function r(){return{strict:p,caseInsensitive:m}}function c(e){return j(e)||P(e)&&j(e[e.length-1])}function l(){for(;b.length;){var e=b.shift();if(e.pattern)throw new Error("You cannot override a type's .pattern at runtime.");t.extend($[e.name],d.invoke(e.def))}}function u(e){F(this,e||{})}U=this;var d,m=!1,p=!0,g=!1,$={},_=!0,b=[],w={string:{encode:e,decode:s,is:function(e){return null==e||!I(e)||"string"==typeof e},pattern:/[^\/]*/},int:{encode:e,decode:function(e){return parseInt(e,10)},is:function(e){return I(e)&&this.decode(e.toString())===e},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return 0!==parseInt(e,10)},is:function(e){return e===!0||e===!1},pattern:/0|1/},date:{encode:function(e){return this.is(e)?[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-"):n},decode:function(e){if(this.is(e))return e;var t=this.capture.exec(e);return t?new Date(t[1],t[2]-1,t[3]):n},is:function(e){return e instanceof Date&&!isNaN(e.valueOf())},equals:function(e,t){return this.is(e)&&this.is(t)&&e.toISOString()===t.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:t.toJson,decode:t.fromJson,is:t.isObject,equals:t.equals,pattern:/[^\/]*/},any:{encode:t.identity,decode:t.identity,equals:t.equals,pattern:/.*/}};k.$$getDefaultValue=function(e){if(!c(e.value))return e.value;if(!d)throw new Error("Injectable functions cannot be called at configuration time");return d.invoke(e.value)},this.caseInsensitive=function(e){return I(e)&&(m=e),m},this.strictMode=function(e){return I(e)&&(p=e),p},this.defaultSquashPolicy=function(e){if(!I(e))return g;if(e!==!0&&e!==!1&&!R(e))throw new Error("Invalid squash policy: "+e+". Valid policies: false, true, arbitrary-string");return g=e,e},this.compile=function(e,t){return new h(e,F(r(),t))},this.isMatcher=function(e){if(!L(e))return!1;var t=!0;return N(h.prototype,function(n,a){j(n)&&(t=t&&I(e[a])&&j(e[a]))}),t},this.type=function(e,t,n){if(!I(t))return $[e];if($.hasOwnProperty(e))throw new Error("A type named '"+e+"' has already been defined.");return $[e]=new y(F({name:e},t)),n&&(b.push({name:e,def:n}),_||l()),this},N(w,function(e,t){$[t]=new y(F({name:t},e))}),$=a($,{}),this.$get=["$injector",function(e){return d=e,_=!1,l(),N(w,function(e,t){$[t]||($[t]=new y(e))}),this}],this.Param=function(e,t,a,s){function r(e){var t=L(e)?i(e):[],n=o(t,"value")===-1&&o(t,"type")===-1&&o(t,"squash")===-1&&o(t,"array")===-1;return n&&(e={value:e}),e.$$fn=c(e.value)?e.value:function(){return e.value},e}function l(t,n,a){if(t.type&&n)throw new Error("Param '"+e+"' has two type configurations.");return n?n:t.type?t.type instanceof y?t.type:new y(t.type):"config"===a?$.any:$.string}function u(){var t={array:"search"===s&&"auto"},n=e.match(/\[\]$/)?{array:!0}:{};return F(t,n,a).array}function m(e,t){var n=e.squash;if(!t||n===!1)return!1;if(!I(n)||null==n)return g;if(n===!0||R(n))return n;throw new Error("Invalid squash policy: '"+n+"'. Valid policies: false, true, or arbitrary string")}function p(e,t,a,s){var r,i,c=[{from:"",to:a||t?n:""},{from:null,to:a||t?n:""}];return r=P(e.replace)?e.replace:[],R(s)&&r.push({from:s,to:n}),i=v(r,function(e){return e.from}),f(c,function(e){return o(i,e.from)===-1}).concat(r)}function h(){if(!d)throw new Error("Injectable functions cannot be called at configuration time");var e=d.invoke(a.$$fn);if(null!==e&&e!==n&&!b.type.is(e))throw new Error("Default value ("+e+") for parameter '"+b.id+"' is not an instance of Type ("+b.type.name+")");return e}function k(e){function t(e){return function(t){return t.from===e}}function n(e){var n=v(f(b.replace,t(e)),function(e){return e.to});return n.length?n[0]:e}return e=n(e),I(e)?b.type.$normalize(e):h()}function _(){return"{Param:"+e+" "+t+" squash: '"+D+"' optional: "+C+"}"}var b=this;a=r(a),t=l(a,t,s);var w=u();t=w?t.$asArray(w,"search"===s):t,"string"!==t.name||w||"path"!==s||a.value!==n||(a.value="");var C=a.value!==n,D=m(a,C),S=p(a,w,C,D);F(this,{id:e,type:t,location:s,array:w,squash:D,replace:S,isOptional:C,value:k,dynamic:n,config:a,toString:_})},u.prototype={$$new:function(){return a(this,F(new u,{$$parent:this}))},$$keys:function(){for(var e=[],t=[],n=this,a=i(u.prototype);n;)t.push(n),n=n.$$parent;return t.reverse(),N(t,function(t){N(i(t),function(t){o(e,t)===-1&&o(a,t)===-1&&e.push(t)})}),e},$$values:function(e){var t={},n=this;return N(n.$$keys(),function(a){t[a]=n[a].value(e&&e[a])}),t},$$equals:function(e,t){var n=!0,a=this;return N(a.$$keys(),function(s){var r=e&&e[s],i=t&&t[s];a[s].type.equals(r,i)||(n=!1)}),n},$$validates:function(e){var a,s,r,i,o,c=this.$$keys();for(a=0;a<c.length&&(s=this[c[a]],r=e[c[a]],r!==n&&null!==r||!s.isOptional);a++){if(i=s.type.$normalize(r),!s.type.is(i))return!1;if(o=s.type.encode(i),t.isString(o)&&!s.type.pattern.exec(o))return!1}return!0},$$parent:n},this.ParamSet=u}function $(e,a){function s(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return null!=t?t[1].replace(/\\(.)/g,"$1"):""}function r(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t["$"===n?0:Number(n)]})}function i(e,t,n){if(!n)return!1;var a=e.invoke(t,t,{$match:n});return!I(a)||a}function o(a,s,r,i){function o(e,t,n){return"/"===p?e:t?p.slice(0,-1)+e:n?p.slice(1)+e:e}function m(e){function t(e){var t=e(r,a);return!!t&&(R(t)&&a.replace().url(t),!0)}if(!e||!e.defaultPrevented){v&&a.url()===v;v=n;var s,i=l.length;for(s=0;s<i;s++)if(t(l[s]))return;u&&t(u)}}function f(){return c=c||s.$on("$locationChangeSuccess",m)}var v,p=i.baseHref(),g=a.url();return d||f(),{sync:function(){m()},listen:function(){return f()},update:function(e){return e?void(g=a.url()):void(a.url()!==g&&(a.url(g),a.replace()))},push:function(e,t,s){var r=e.format(t||{});null!==r&&t&&t["#"]&&(r+="#"+t["#"]),a.url(r),v=s&&s.$$avoidResync?a.url():n,s&&s.replace&&a.replace()},href:function(n,s,r){if(!n.validates(s))return null;var i=e.html5Mode();t.isObject(i)&&(i=i.enabled);var c=n.format(s);if(r=r||{},i||null===c||(c="#"+e.hashPrefix()+c),null!==c&&s&&s["#"]&&(c+="#"+s["#"]),c=o(c,i,r.absolute),!r.absolute||!c)return c;var l=!i&&c?"/":"",u=a.port();return u=80===u||443===u?"":":"+u,[a.protocol(),"://",a.host(),u,l,c].join("")}}}var c,l=[],u=null,d=!1;this.rule=function(e){if(!j(e))throw new Error("'rule' must be a function");return l.push(e),this},this.otherwise=function(e){if(R(e)){var t=e;e=function(){return t}}else if(!j(e))throw new Error("'rule' must be a function");return u=e,this},this.when=function(e,t){var n,o=R(t);if(R(e)&&(e=a.compile(e)),!o&&!j(t)&&!P(t))throw new Error("invalid 'handler' in when()");var c={matcher:function(e,t){return o&&(n=a.compile(t),t=["$match",function(e){return n.format(e)}]),F(function(n,a){return i(n,t,e.exec(a.path(),a.search()))},{prefix:R(e.prefix)?e.prefix:""})},regex:function(e,t){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return o&&(n=t,t=["$match",function(e){return r(n,e)}]),F(function(n,a){return i(n,t,e.exec(a.path()))},{prefix:s(e)})}},l={matcher:a.isMatcher(e),regex:e instanceof RegExp};for(var u in l)if(l[u])return this.rule(c[u](e,t));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(e){e===n&&(e=!0),d=e},this.$get=o,o.$inject=["$location","$rootScope","$injector","$browser"]}function _(e,s){function r(e){return 0===e.indexOf(".")||0===e.indexOf("^")}function m(e,t){if(!e)return n;var a=R(e),s=a?e:e.name,i=r(s);if(i){if(!t)throw new Error("No reference point given for path '"+s+"'");t=m(t);for(var o=s.split("."),c=0,l=o.length,u=t;c<l;c++)if(""!==o[c]||0!==c){if("^"!==o[c])break;if(!u.parent)throw new Error("Path '"+s+"' not valid for state '"+t.name+"'");u=u.parent}else u=t;o=o.slice(c).join("."),s=u.name+(u.name&&o?".":"")+o}var d=D[s];return!d||!a&&(a||d!==e&&d.self!==e)?n:d}function f(e,t){S[e]||(S[e]=[]),S[e].push(t)}function p(e){for(var t=S[e]||[];t.length;)g(t.shift())}function g(t){t=a(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}});var n=t.name;if(!R(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(D.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var s=n.indexOf(".")!==-1?n.substring(0,n.lastIndexOf(".")):R(t.parent)?t.parent:L(t.parent)&&R(t.parent.name)?t.parent.name:"";if(s&&!D[s])return f(s,t.self);for(var r in E)j(E[r])&&(t[r]=E[r](t,E.$delegates[r]));return D[n]=t,!t[T]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){C.$current.navigable==t&&l(e,n)||C.transitionTo(t,e,{inherit:!0,location:!1})}]),p(n),t}function h(e){return e.indexOf("*")>-1}function y(e){for(var t=e.split("."),n=C.$current.name.split("."),a=0,s=t.length;a<s;a++)"*"===t[a]&&(n[a]="*");return"**"===t[0]&&(n=n.slice(o(n,t[1])),n.unshift("**")),"**"===t[t.length-1]&&(n.splice(o(n,t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length==n.length&&n.join("")===t.join("")}function k(e,t){return R(e)&&!I(t)?E[e]:j(t)&&R(e)?(E[e]&&!E.$delegates[e]&&(E.$delegates[e]=E[e]),E[e]=t,this):this}function $(e,t){return L(e)?t=e:t.name=e,g(t),this}function _(e,s,r,o,d,f,p,g,k){function $(t,n,a,r){var i=e.$broadcast("$stateNotFound",t,n,a);if(i.defaultPrevented)return p.update(),A;if(!i.retry)return null;if(r.$retry)return p.update(),x;var o=C.transition=s.when(i.retry);return o.then(function(){return o!==C.transition?S:(t.options.$retry=!0,C.transitionTo(t.to,t.toParams,t.options))},function(){return A}),p.update(),o}function _(e,n,a,i,c,l){function m(){var n=[];return N(e.views,function(a,s){var i=a.resolve&&a.resolve!==e.resolve?a.resolve:{};i.$template=[function(){return r.load(s,{view:a,locals:c.globals,params:f,notify:l.notify})||""}],n.push(d.resolve(i,c.globals,c.resolve,e).then(function(n){if(j(a.controllerProvider)||P(a.controllerProvider)){var r=t.extend({},i,c.globals);n.$$controller=o.invoke(a.controllerProvider,null,r)}else n.$$controller=a.controller;n.$$state=e,n.$$controllerAs=a.controllerAs,c[s]=n}))}),s.all(n).then(function(){return c.globals})}var f=a?n:u(e.params.$$keys(),n),v={$stateParams:f};c.resolve=d.resolve(e.resolve,v,c.resolve,e);var p=[c.resolve.then(function(e){c.globals=e})];return i&&p.push(i),s.all(p).then(m).then(function(e){return c})}var S=s.reject(new Error("transition superseded")),E=s.reject(new Error("transition prevented")),A=s.reject(new Error("transition aborted")),x=s.reject(new Error("transition failed"));return w.locals={resolve:null,globals:{$stateParams:{}}},C={params:{},current:w.self,$current:w,transition:null},C.reload=function(e){return C.transitionTo(C.current,f,{reload:e||!0,inherit:!1,notify:!0})},C.go=function(e,t,n){return C.transitionTo(e,t,F({inherit:!0,relative:C.$current},n))},C.transitionTo=function(t,n,r){n=n||{},r=F({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},r||{});var i,l=C.$current,d=C.params,v=l.path,g=m(t,r.relative),h=n["#"];if(!I(g)){var y={to:t,toParams:n,options:r},k=$(y,l.self,d,r);if(k)return k;if(t=y.to,n=y.toParams,r=y.options,g=m(t,r.relative),!I(g)){if(!r.relative)throw new Error("No such state '"+t+"'");throw new Error("Could not resolve '"+t+"' from state '"+r.relative+"'")}}if(g[T])throw new Error("Cannot transition to abstract state '"+t+"'");if(r.inherit&&(n=c(f,n||{},C.$current,g)),!g.params.$$validates(n))return x;n=g.params.$$values(n),t=g;var D=t.path,A=0,M=D[A],O=w.locals,j=[];if(r.reload){if(R(r.reload)||L(r.reload)){if(L(r.reload)&&!r.reload.name)throw new Error("Invalid reload state object");var P=r.reload===!0?v[0]:m(r.reload);if(r.reload&&!P)throw new Error("No such reload state '"+(R(r.reload)?r.reload:r.reload.name)+"'");for(;M&&M===v[A]&&M!==P;)O=j[A]=M.locals,A++,M=D[A]}}else for(;M&&M===v[A]&&M.ownParams.$$equals(n,d);)O=j[A]=M.locals,A++,M=D[A];if(b(t,n,l,d,O,r))return h&&(n["#"]=h),C.params=n,q(C.params,f),r.location&&t.navigable&&t.navigable.url&&(p.push(t.navigable.url,n,{$$avoidResync:!0,replace:"replace"===r.location}),p.update(!0)),C.transition=null,s.when(C.current);if(n=u(t.params.$$keys(),n||{}),r.notify&&e.$broadcast("$stateChangeStart",t.self,n,l.self,d).defaultPrevented)return e.$broadcast("$stateChangeCancel",t.self,n,l.self,d),p.update(),E;for(var N=s.when(O),U=A;U<D.length;U++,M=D[U])O=j[U]=a(O),N=_(M,n,M===t,N,O,r);var H=C.transition=N.then(function(){var a,s,i;if(C.transition!==H)return S;for(a=v.length-1;a>=A;a--)i=v[a],i.self.onExit&&o.invoke(i.self.onExit,i.self,i.locals.globals),i.locals=null;for(a=A;a<D.length;a++)s=D[a],s.locals=j[a],s.self.onEnter&&o.invoke(s.self.onEnter,s.self,s.locals.globals);return h&&(n["#"]=h),C.transition!==H?S:(C.$current=t,C.current=t.self,C.params=n,q(C.params,f),C.transition=null,r.location&&t.navigable&&p.push(t.navigable.url,t.navigable.locals.globals.$stateParams,{$$avoidResync:!0,replace:"replace"===r.location}),r.notify&&e.$broadcast("$stateChangeSuccess",t.self,n,l.self,d),p.update(!0),C.current)},function(a){return C.transition!==H?S:(C.transition=null,i=e.$broadcast("$stateChangeError",t.self,n,l.self,d,a),i.defaultPrevented||p.update(),s.reject(a))});return H},C.is=function(e,t,a){a=F({relative:C.$current},a||{});var s=m(e,a.relative);return I(s)?C.$current===s&&(!t||l(s.params.$$values(t),f)):n},C.includes=function(e,t,a){if(a=F({relative:C.$current},a||{}),R(e)&&h(e)){if(!y(e))return!1;e=C.$current.name}var s=m(e,a.relative);return I(s)?!!I(C.$current.includes[s.name])&&(!t||l(s.params.$$values(t),f,i(t))):n},C.href=function(e,t,a){a=F({lossy:!0,inherit:!0,absolute:!1,relative:C.$current},a||{});var s=m(e,a.relative);if(!I(s))return null;a.inherit&&(t=c(f,t||{},C.$current,s));var r=s&&a.lossy?s.navigable:s;return r&&r.url!==n&&null!==r.url?p.href(r.url,u(s.params.$$keys().concat("#"),t||{}),{absolute:a.absolute}):null},C.get=function(e,t){if(0===arguments.length)return v(i(D),function(e){return D[e].self});var n=m(e,t||C.$current);return n&&n.self?n.self:null},C}function b(e,t,n,a,s,r){function i(e,t,n){function a(t){return"search"!=e.params[t].location}var s=e.params.$$keys().filter(a),r=d.apply({},[e.params].concat(s)),i=new U.ParamSet(r);return i.$$equals(t,n)}if(!r.reload&&e===n&&(s===n.locals||e.self.reloadOnSearch===!1&&i(n,a,t)))return!0}var w,C,D={},S={},T="abstract",E={parent:function(e){if(I(e.parent)&&e.parent)return m(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?m(t[1]):w},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=F({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url,n={params:e.params||{}};if(R(t))return"^"==t.charAt(0)?s.compile(t.substring(1),n):(e.parent.navigable||w).url.concat(t,n);if(!t||s.isMatcher(t))return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},ownParams:function(e){var t=e.url&&e.url.params||new U.ParamSet;return N(e.params||{},function(e,n){t[n]||(t[n]=new U.Param(n,null,e,"config"))}),t},params:function(e){return e.parent&&e.parent.params?F(e.parent.params.$$new(),e.ownParams):new U.ParamSet},views:function(e){var t={};return N(I(e.views)?e.views:{"":e},function(n,a){a.indexOf("@")<0&&(a+="@"+e.parent.name),t[a]=n}),t},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?F({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};w=g({name:"",url:"^",views:null,abstract:!0}),w.navigable=null,this.decorator=k,this.state=$,this.$get=_,_.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter","$location","$urlMatcherFactory"]}function b(){function e(e,t){return{load:function(n,a){var s,r={template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}};return a=F(r,a),a.view&&(s=t.fromConfig(a.view,a.params,a.locals)),s&&a.notify&&e.$broadcast("$viewContentLoading",a),s}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function w(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){return n(function(){e[0].scrollIntoView()},0,!1)}}]}function C(e,n,a,s){function r(){return n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(e){return null}}}function i(e,t){var n=function(){return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}};if(l)return{enter:function(e,t,n){var a=l.enter(e,null,t,n);a&&a.then&&a.then(n)},leave:function(e,t){var n=l.leave(e,t);n&&n.then&&n.then(t)}};if(c){var a=c&&c(t,e);return{enter:function(e,t,n){a.enter(e,null,t),n()},leave:function(e,t){a.leave(e),t()}}}return n()}var o=r(),c=o("$animator"),l=o("$animate"),u={restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,r,o){return function(n,r,c){function l(){d&&(d.remove(),d=null),f&&(f.$destroy(),f=null),m&&(h.leave(m,function(){d=null}),d=m,m=null)}function u(i){var u,d=S(n,c,r,s),y=d&&e.$current&&e.$current.locals[d];if(i||y!==v){u=n.$new(),v=e.$current.locals[d];var k=o(u,function(e){h.enter(e,r,function(){f&&f.$emit("$viewContentAnimationEnded"),(t.isDefined(g)&&!g||n.$eval(g))&&a(e)}),l()});m=k,f=u,f.$emit("$viewContentLoaded"),f.$eval(p)}}var d,m,f,v,p=c.onload||"",g=c.autoscroll,h=i(c,n);n.$on("$stateChangeSuccess",function(){u(!1)}),n.$on("$viewContentLoading",function(){u(!1)}),u(!0)}}};return u}function D(e,t,n,a){return{restrict:"ECA",priority:-400,compile:function(s){var r=s.html();return function(s,i,o){var c=n.$current,l=S(s,o,i,a),u=c&&c.locals[l];if(u){i.data("$uiView",{name:l,state:u.$$state}),i.html(u.$template?u.$template:r);var d=e(i.contents());if(u.$$controller){u.$scope=s,u.$element=i;var m=t(u.$$controller,u);u.$$controllerAs&&(s[u.$$controllerAs]=m),i.data("$ngControllerController",m),i.children().data("$ngControllerController",m)}d(s)}}}}}function S(e,t,n,a){var s=a(t.uiView||t.name||"")(e),r=n.inheritedData("$uiView");return s.indexOf("@")>=0?s:s+"@"+(r?r.state.name:"")}function T(e,t){var n,a=e.match(/^\s*({[^}]*})\s*$/);if(a&&(e=t+"("+a[1]+")"),n=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/),!n||4!==n.length)throw new Error("Invalid state ref '"+e+"'");return{state:n[1],paramExpr:n[3]||null}}function E(e){var t=e.parent().inheritedData("$uiView");if(t&&t.state&&t.state.name)return t.state}function A(e,n){var a=["location","inherit","reload","absolute"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(s,r,i,o){var c=T(i.uiSref,e.current.name),l=null,u=E(r)||e.$current,d="[object SVGAnimatedString]"===Object.prototype.toString.call(r.prop("href"))?"xlink:href":"href",m=null,f="A"===r.prop("tagName").toUpperCase(),v="FORM"===r[0].nodeName,p=v?"action":d,g=!0,h={relative:u,inherit:!0},y=s.$eval(i.uiSrefOpts)||{};t.forEach(a,function(e){e in y&&(h[e]=y[e])});var k=function(n){if(n&&(l=t.copy(n)),g){m=e.href(c.state,l,h);var a=o[1]||o[0];return a&&a.$$addStateInfo(c.state,l),null===m?(g=!1,!1):void i.$set(p,m)}};c.paramExpr&&(s.$watch(c.paramExpr,function(e,t){e!==l&&k(e)},!0),l=t.copy(s.$eval(c.paramExpr))),k(),v||r.bind("click",function(t){var a=t.which||t.button;if(!(a>1||t.ctrlKey||t.metaKey||t.shiftKey||r.attr("target"))){var s=n(function(){e.go(c.state,l,h)});t.preventDefault();var i=f&&!m?1:0;t.preventDefault=function(){i--<=0&&n.cancel(s)}}})}}}function x(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,a,s){function r(){i()?a.addClass(c):a.removeClass(c)}function i(){for(var e=0;e<l.length;e++)if(o(l[e].state,l[e].params))return!0;return!1}function o(t,n){return"undefined"!=typeof s.uiSrefActiveEq?e.is(t.name,n):e.includes(t.name,n)}var c,l=[];c=n(s.uiSrefActiveEq||s.uiSrefActive||"",!1)(t),this.$$addStateInfo=function(t,n){var s=e.get(t,E(a));l.push({state:s||{name:t},params:n}),r()},t.$on("$stateChangeSuccess",r)}]}}function M(e){var t=function(t){return e.is(t)};return t.$stateful=!0,t}function O(e){var t=function(t){return e.includes(t)};return t.$stateful=!0,t}var I=t.isDefined,j=t.isFunction,R=t.isString,L=t.isObject,P=t.isArray,N=t.forEach,F=t.extend,q=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),p.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",p),g.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",g);var U;h.prototype.concat=function(e,t){var n={caseInsensitive:U.caseInsensitive(),strict:U.strictMode(),squash:U.defaultSquashPolicy()};return new h(this.sourcePath+e+this.sourceSearch,F(n,t),this)},h.prototype.toString=function(){return this.source},h.prototype.exec=function(e,t){function n(e){function t(e){return e.split("").reverse().join("")}function n(e){return e.replace(/\\-/g,"-")}var a=t(e).split(/-(?!\\)/),s=v(a,t);return v(s,n).reverse()}var a=this.regexp.exec(e);if(!a)return null;t=t||{};var s,r,i,o=this.parameters(),c=o.length,l=this.segments.length-1,u={};if(l!==a.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(s=0;s<l;s++){i=o[s];var d=this.params[i],m=a[s+1];for(r=0;r<d.replace;r++)d.replace[r].from===m&&(m=d.replace[r].to);m&&d.array===!0&&(m=n(m)),u[i]=d.value(m)}for(;s<c;s++)i=o[s],u[i]=this.params[i].value(t[i]);return u},h.prototype.parameters=function(e){return I(e)?this.params[e]||null:this.$$paramNames},h.prototype.validates=function(e){return this.params.$$validates(e)},h.prototype.format=function(e){function t(e){return encodeURIComponent(e).replace(/-/g,function(e){return"%5C%"+e.charCodeAt(0).toString(16).toUpperCase()})}e=e||{};var n=this.segments,a=this.parameters(),s=this.params;if(!this.validates(e))return null;var r,i=!1,o=n.length-1,c=a.length,l=n[0];for(r=0;r<c;r++){var u=r<o,d=a[r],m=s[d],f=m.value(e[d]),p=m.isOptional&&m.type.equals(m.value(),f),g=!!p&&m.squash,h=m.type.encode(f);if(u){var y=n[r+1];if(g===!1)null!=h&&(l+=P(h)?v(h,t).join("-"):encodeURIComponent(h)),l+=y;else if(g===!0){var k=l.match(/\/$/)?/\/?(.*)/:/(.*)/;l+=y.match(k)[1]}else R(g)&&(l+=g+y)}else{if(null==h||p&&g!==!1)continue;P(h)||(h=[h]),h=v(h,encodeURIComponent).join("&"+d+"="),l+=(i?"&":"?")+(d+"="+h),i=!0}}return l},y.prototype.is=function(e,t){return!0},y.prototype.encode=function(e,t){return e},y.prototype.decode=function(e,t){return e},y.prototype.equals=function(e,t){return e==t},y.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)},y.prototype.pattern=/.*/,y.prototype.toString=function(){return"{Type:"+this.name+"}"},y.prototype.$normalize=function(e){return this.is(e)?e:this.decode(e)},y.prototype.$asArray=function(e,t){function a(e,t){function a(e,t){return function(){return e[t].apply(e,arguments)}}function s(e){return P(e)?e:I(e)?[e]:[]}function r(e){switch(e.length){case 0:return n;case 1:return"auto"===t?e[0]:e;default:return e}}function i(e){return!e}function o(e,t){return function(n){n=s(n);var a=v(n,e);return t===!0?0===f(a,i).length:r(a)}}function c(e){return function(t,n){var a=s(t),r=s(n);if(a.length!==r.length)return!1;for(var i=0;i<a.length;i++)if(!e(a[i],r[i]))return!1;return!0}}this.encode=o(a(e,"encode")),this.decode=o(a(e,"decode")),this.is=o(a(e,"is"),!0),this.equals=c(a(e,"equals")),this.pattern=e.pattern,this.$normalize=o(a(e,"$normalize")),this.name=e.name,this.$arrayMode=t}if(!e)return this;if("auto"===e&&!t)throw new Error("'auto' array mode is for query parameters only");return new a(this,e)},t.module("ui.router.util").provider("$urlMatcherFactory",k),t.module("ui.router.util").run(["$urlMatcherFactory",function(e){}]),$.$inject=["$locationProvider","$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",$),_.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",_),b.$inject=[],t.module("ui.router.state").provider("$view",b),t.module("ui.router.state").provider("$uiViewScroll",w),C.$inject=["$state","$injector","$uiViewScroll","$interpolate"],D.$inject=["$compile","$controller","$state","$interpolate"],t.module("ui.router.state").directive("uiView",C),t.module("ui.router.state").directive("uiView",D),A.$inject=["$state","$timeout"],x.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",A).directive("uiSrefActive",x).directive("uiSrefActiveEq",x),M.$inject=["$state"],O.$inject=["$state"],t.module("ui.router.state").filter("isState",M).filter("includedByState",O)}(window,window.angular),define("tasks-assignments/modules/run",["common/angular","common/ui-select","common/modules/xeditable-civi","tasks-assignments/vendor/angular-bootstrap-calendar","tasks-assignments/vendor/angular-checklist-model","tasks-assignments/vendor/angular-router","tasks-assignments/modules/config","tasks-assignments/modules/settings","common/modules/routers/compu-ui-router","common/filters/angular-date/format-date","common/directives/angular-date/date-input","common/directives/prevent-animations"],function(e){"use strict";e.module("civitasks.run",["angularFileUpload","ngResource","ngAnimate","ngSanitize","compu.ui.router","ui.select","mwl.calendar","textAngular","checklist-model","civitasks.config","civitasks.controllers","civitasks.directives","civitasks.filters","civitasks.services","civitasks.settings","xeditable","xeditable-civi","common.angularDate","common.directives"]).run(["config","settings","$rootScope","$rootElement","$q","$location","DocumentService","TaskService","AssignmentService","KeyDateService","ContactService","editableOptions","$log",function(t,n,a,s,r,i,o,c,l,u,d,m,f){f.debug("civitasks.run"),a.pathTpl=t.path.TPL,a.permissions=t.permissions,a.prefix=t.CLASS_NAME_PREFIX,a.url=t.url,a.location=i,a.settings=n,a.cache={contact:{obj:{},arr:[],arrSearch:[]},assignment:{obj:{},arr:[],arrSearch:[]},assignmentType:{obj:{},arr:[]},dateType:{obj:{period_start_date:"Contract Start Date",period_end_date:"Contract End Date",birth_date:"Birthday",probation_end_date:"Probation End Date"},arr:[]},documentType:{obj:{},arr:[]},documentStatus:{obj:{},arr:[]},documentStatusResolve:t.status.resolve.DOCUMENT,taskType:{obj:{},arr:[]},taskStatus:{obj:{},arr:[]},taskStatusResolve:t.status.resolve.TASK},c.getOptions().then(function(t){e.extend(a.cache,t)}),o.getOptions().then(function(t){e.extend(a.cache,t)}),l.getTypes().then(function(t){e.extend(a.cache.assignmentType.obj,t),e.forEach(t,function(e){this.push(e)},a.cache.assignmentType.arr)}),d.get({IN:[t.LOGGED_IN_CONTACT_ID]}).then(function(e){d.updateCache(e)}),e.forEach(a.cache.dateType.obj,function(e,t){this.push({key:t,value:e})},a.cache.dateType.arr),a.$on("$stateChangeSuccess",function(){s.removeClass("ct-page-loading")}),m.theme="bs3"}])}),define("tasks-assignments/modules/app-dashboard",["common/angular","common/moment","common/lodash","common/services/angular-date/date-format","tasks-assignments/modules/run"],function(e,t,n){"use strict";e.module("civitasks.appDashboard",["civitasks.run"]).config(["config","$resourceProvider","$httpProvider","$logProvider","$urlRouterProvider","$stateProvider","calendarConfigProvider","uibDatepickerConfig","uiSelectConfig",function(a,s,r,i,o,c,l,u,d){i.debugEnabled(a.DEBUG),o.otherwise("/tasks"),c.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("tasks",{url:"/tasks",controller:"TaskListCtrl",templateUrl:a.path.TPL+"dashboard/tasks.html?v="+(new Date).getTime(),resolve:{taskList:["TaskService",function(e){return e.get({status_id:{"NOT IN":a.status.resolve.TASK}})}]}}).state("tasks.my",{url:"/my",params:{ownership:"assigned"}}).state("tasks.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("tasks.all",{url:"/all",params:{ownership:null}}).state("documents",{url:"/documents",controller:"DocumentListCtrl",templateUrl:a.path.TPL+"dashboard/documents.html?v=8",resolve:{documentList:["DocumentService",function(e){return e.get({})}]}}).state("documents.my",{url:"/my",params:{ownership:"assigned"}}).state("documents.delegated",{url:"/delegated",params:{ownership:"delegated"}}).state("documents.all",{url:"/all",params:{ownership:null}}).state("assignments",{url:"/assignments",controller:"ExternalPageCtrl",templateUrl:a.path.TPL+"dashboard/assignments.html?v=5"}).state("calendar",{abstract:!0,controller:"CalendarCtrl",templateUrl:a.path.TPL+"dashboard/calendar.html?v=3",resolve:{documentList:["$q","DocumentService","settings",function(t,n,s){var r=t.defer();return+s.tabEnabled.documents||r.resolve([]),t.all([n.get({sequential:0,assignee_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.DOCUMENT}}),n.get({sequential:0,source_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.DOCUMENT}})]).then(function(t){var n,a=[];e.extend(t[0],t[1]);for(n in t[0])a.push(t[0][n]);r.resolve(a)}),r.promise}],taskList:["$q","TaskService",function(e,t){var s=e.defer();return e.all([t.get({sequential:1,assignee_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.TASK}}),t.get({sequential:1,source_contact_id:a.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":a.status.resolve.TASK}})]).then(function(e){var t=n(e[0]).assign(e[1]);s.resolve(t.values().value())}),s.promise}]}}).state("calendar.mwl",{url:"/calendar",views:{documentList:{controller:"DocumentListCtrl",templateUrl:a.path.TPL+"dashboard/calendar.documentList.html?v=6"},taskList:{controller:"TaskListCtrl",templateUrl:a.path.TPL+"dashboard/calendar.taskList.html?v=5"}}}).state("calendar.mwl.day",{params:{calendarView:"day"}}).state("calendar.mwl.month",{params:{calendarView:"month"}}).state("calendar.mwl.week",{params:{calendarView:"week"}}).state("reports",{url:"/reports",controller:"ExternalPageCtrl",templateUrl:a.path.TPL+"dashboard/reports.html?v=4"}).state("keyDates",{url:"/key-dates",controller:"DateListCtrl",templateUrl:a.path.TPL+"dashboard/key-dates.html?v=4",resolve:{contactList:["KeyDateService",function(e){return e.get(t().startOf("month"),t().endOf("month"))}]}}),s.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",l.setDateFormats({weekDay:"ddd"}),u.showWeeks=!1,d.theme="bootstrap"}])}),define("tasks-assignments/modules/app-documents",["tasks-assignments/modules/run"],function(){"use strict";angular.module("civitasks.appDocuments",["civitasks.run"]).config(["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,a,s,r,i,o){o.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"DocumentListCtrl",templateUrl:e.path.TPL+"contact/documents.html?v=4",resolve:{documentList:["DocumentService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.DOCUMENT}})}]}}),a.defaults.stripTrailingSlashes=!1,s.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.showWeeks=!1,i.theme="bootstrap"}])}),define("tasks-assignments/modules/app-tasks",["tasks-assignments/modules/run"],function(){"use strict";angular.module("civitasks.appTasks",["civitasks.run"]).config(["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,a,s,r,i,o){o.debugEnabled(e.DEBUG),t.otherwise("/"),n.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("main",{url:"/",controller:"TaskListCtrl",templateUrl:e.path.TPL+"contact/tasks.html?v=222",resolve:{taskList:["TaskService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.TASK
}})}]}}),a.defaults.stripTrailingSlashes=!1,s.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.showWeeks=!1,i.theme="bootstrap"}])}),define("tasks-assignments/modules/app-settings",["tasks-assignments/modules/run"],function(){"use strict";angular.module("civitasks.appSettings",["civitasks.run"]).config(["config","$stateProvider","$urlRouterProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,a,s,r,i,o){o.debugEnabled(e.DEBUG),n.otherwise("/"),t.state("settings",{url:"/",controller:"SettingsCtrl",templateUrl:e.path.TPL+"settings.html?v=5"}),a.defaults.stripTrailingSlashes=!1,s.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.showWeeks=!1,i.theme="bootstrap"}])}),define("tasks-assignments/controllers/controllers",["common/angular"],function(e){"use strict";return e.module("civitasks.controllers",[])}),define("tasks-assignments/services/services",["common/angular"],function(e){"use strict";return e.module("civitasks.services",[])}),define("tasks-assignments/services/utils",["tasks-assignments/services/services"],function(e){"use strict";e.factory("UtilsService",["config","$q","$log","$rootScope",function(e,t,n){return n.debug("Service: UtilsService"),{errorHandler:function(e,t,a){var s="",r=t||"Unknown Error";return e.is_error?(s=e.error_code||s,r=e.error_message||r,n.error(s+"\n"+r),a&&a.reject(s+"\n"+r),e.trace&&n.error(e.trace),!0):e.values?void 0:(n.error(r),a&&a.reject(r),!0)}}}])}),define("tasks-assignments/services/task",["common/angular","common/lodash","common/moment","tasks-assignments/services/services","tasks-assignments/services/utils"],function(e,t,n,a){"use strict";a.factory("Task",["$resource","$httpParamSerializer","config","$log",function(e,t,n,a){return a.debug("Service: Task"),e(n.url.REST,{action:"get",entity:"Task",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}]),a.factory("TaskService",["Task","$q","config","UtilsService","$log",function(a,s,r,i,o){return o.debug("Service: TaskService"),{assign:function(t,n){if(!t||!e.isArray(t)||!n||"number"!=typeof+n)return null;if(!t.length)return t;var r=s.defer();return a.save({action:"copy_to_assignment"},{json:{id:t,case_id:n}||{}},function(e){i.errorHandler(e,"Unable to assign tasks",r)||r.resolve(e.values)},function(){r.reject("Unable to assign tasks")}),r.promise},get:function(t){var n=s.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviTask",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id"},t),a.get({json:t},function(e){n.resolve(e.values)},function(){n.reject("Unable to fetch tasks list")}),n.promise},getOptions:function(){return s.all({taskType:this.getActivityTypes(),taskStatus:this.getTaskStatus()})},getTaskStatus:function(){var e=s.defer(),n={arr:[],obj:{}};return a.get({action:"getoptions",json:{field:"status_id"}},function(a){t.each(a.values,function(e){n.arr.push({key:e.key,value:e.value}),n.obj[e.key]=e.value}),e.resolve(n)}),e.promise},getActivityTypes:function(){var e=s.defer(),n={arr:[],obj:{}};return a.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(a){t.each(a.values,function(e){n.arr.push({key:e.key,value:e.value}),n.obj[e.key]=e.value}),e.resolve(n)}),e.promise},save:function(t){if(!t||"object"!=typeof t)return null;t.activity_date_time instanceof Date&&(t.activity_date_time=n(t.activity_date_time.getTime()).format("YYYY-MM-DD"));var r,o=s.defer(),c=e.extend({},t);return a.save({action:"create"},{json:c||{}},function(e){i.errorHandler(e,"Unable to save task",o)||(r=e.values,o.resolve(1==r.length?r[0]:null))},function(){o.reject("Unable to save task")}),o.promise},saveMultiple:function(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;t.forEach(function(e){e.activity_date_time instanceof Date&&(e.activity_date_time=n(e.activity_date_time.getTime()).format("YYYY-MM-DD"))});var r=s.defer();return a.save({action:"create_multiple"},{json:{task:t}||{}},function(e){i.errorHandler(e,"Unable to save tasks",r)||r.resolve(e.values)},function(){r.reject("Unable to save tasks")}),r.promise},sendReminder:function(e,t){if(!e||"number"!=typeof+e)return null;var n=s.defer();return a.save({action:"sendreminder"},{json:{notes:t}||{}},function(e){i.errorHandler(e,"Unable to send a reminder",n)||n.resolve(e)},function(){n.reject("Unable to send a reminder")}),n.promise},delete:function(e){if(!e||"number"!=typeof+e)return null;var t=s.defer();return a.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete task ID: "+e)}),t.promise}}}])}),define("tasks-assignments/controllers/calendar",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/task"],function(e,t){"use strict";t.controller("CalendarCtrl",["$scope","$log","$rootScope","$filter","$timeout","$state","$stateParams","taskList","documentList","settings",function(t,n,a,s,r,i,o,c,l,u){function d(t,n,a,s,r){var i,o,c,l=t.id,u=n.id,d=a.length,m=0;if(u)for(;m<d;m++)+a[m].id==+u&&(a.splice(m,1),m--,d--);l&&(i=e(t.activity_date_time).toDate(),o=s[t.activity_type_id],a.push({id:l,title:o,type:r,startsAt:i,endsAt:i,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),t.expire_date&&(c=e(t.expire_date).toDate(),+c!=+i&&a.push({id:l,title:o,type:r,startsAt:c,endsAt:c,editable:!1,deletable:!1,incrementsBadgeTotal:!0})))}this.init=function(){t.calTaskList=this.createCalEventList("task",c,a.cache.taskType.obj),+u.tabEnabled.documents&&(t.calDocList=this.createCalEventList("document",l,a.cache.documentType.obj))},this.createCalEventList=function(t,n,a){var s=[];return angular.forEach(n,function(n){n.activity_date_time=e(n.activity_date_time).toDate(),this.push({id:n.id,title:a[n.activity_type_id],type:t,startsAt:n.activity_date_time,endsAt:n.activity_date_time,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),n.expire_date&&(n.expire_date=e(n.expire_date).toDate(),+n.expire_date!=+n.activity_date_time&&this.push({id:n.id,title:a[n.activity_type_id],type:t,startsAt:n.expire_date,endsAt:n.expire_date,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))},s),s},t.calendarDay=new Date,t.calendarTitle="",t.calendarView=i.params.calendarView||"month",t.calTaskList=[],t.calDocList=[],t.displayDayView=function(n){t.calendarDay=e(n).toDate(),t.calendarView="day"},t.$on("taskDelete",function(e,n){d({},{id:n},t.calTaskList)}),t.$on("taskFormSuccess",function(e,n,s){var r=a.cache.taskStatusResolve.indexOf(n.status_id)>-1;d(r?{}:n,s,t.calTaskList,a.cache.taskType.obj,"task")}),t.$on("documentDelete",function(e,n){d({},{id:n},t.calDocList)}),t.$on("documentFormSuccess",function(e,n,s){var r=a.cache.documentStatusResolve.indexOf(n.status_id)>-1;d(r?{}:n,s,t.calDocList,a.cache.documentType.obj,"document")}),t.$on("assignmentFormSuccess",function(e,n){Array.prototype.push.apply(t.calTaskList,this.createCalEventList("task",n.taskList,a.cache.taskType.obj)),+u.tabEnabled.documents&&Array.prototype.push.apply(t.calDocList,this.createCalEventList("document",n.documentList,a.cache.documentType.obj))}.bind(this)),this.init()}])}),+define("tasks-assignments/services/key-date",["common/moment","tasks-assignments/services/services","tasks-assignments/services/utils"],function(e,t){"use strict";t.factory("KeyDate",["$resource","config","$log",function(e,t,n){return n.debug("Service: KeyDate"),e(t.url.REST,{action:"get",entity:"KeyDates",json:{}})}]),t.factory("KeyDateService",["KeyDate","$q","config","UtilsService","$log",function(t,n,a,s,r){return r.debug("Service: KeyDateService"),{get:function(a,s){var r=n.defer();return a&&s?(a=a?e(a).format("YYYY-MM-DD"):null,s=s?e(s).format("YYYY-MM-DD"):null,t.get({json:{start_date:a,end_date:s}},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch documents list")}),r.promise):null}}}])}),define("tasks-assignments/services/contact",["common/angular","common/lodash","tasks-assignments/services/services","tasks-assignments/services/utils"],function(e,t,n){"use strict";n.factory("Contact",["$resource","$httpParamSerializer","config","$log",function(e,t,n,a){return a.debug("Service: Contact"),e(n.url.REST,{action:"get",entity:"contact",debug:n.DEBUG})}]),n.factory("ContactService",["Contact","$resource","config","$q","$filter","$rootScope","UtilsService","$log",function(n,a,s,r,i,o,c,l){return l.debug("Service: ContactService"),{get:function(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null;var a=r.defer();return e={IN:t.uniq(e.IN)},n.get({json:{id:e,return:"display_name, sort_name, id, contact_id, contact_type, email"}},function(e){c.errorHandler(e,"Unable to fetch contacts",a)||a.resolve(e.values)},function(){a.reject("Unable to fetch contact")}),a.promise},search:function(t,a){if(a&&"object"!=typeof a)return null;var s=r.defer(),i={};return e.extend(i,a),i.display_name=t,i.return="display_name, contact_id, contact_type, email",n.get({action:"get",json:i},function(e){if(!c.errorHandler(e,"Unable to fetch contact list",s)){var t=[];for(var n in e.values)t.push({label:e.values[n].display_name,description:[e.values[n].email],id:e.values[n].contact_id,icon_class:e.values[n].contact_type});s.resolve(t)}},function(){s.reject("Unable to fetch contact list")}),s.promise},updateCache:function(t){var n,a,s=o.cache.contact.obj||{},r=[],c=[];e.extend(s,t);for(a in s)n=s[a],r.push(n),c.push({description:n.email?[n.email]:[],label:n.display_name,icon_class:n.contact_type,id:n.contact_id});r=i("orderBy")(r,"sort_name"),c=i("orderBy")(c,"label"),o.cache.contact={arr:r,obj:s,arrSearch:c}}}}])}),define("tasks-assignments/controllers/date-list",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/key-date","tasks-assignments/services/contact"],function(e,t){"use strict";t.controller("DateListCtrl",["$scope","$uibModal","$rootElement","$rootScope","$filter","$log","$timeout","contactList","KeyDateService","config",function(t,n,a,s,r,i,o,c,l,u){function d(){t.$watch("filterParams.dateRange.from",function(e){t.datepickerOptions.until.minDate=e}),t.$watch("filterParams.dateRange.until",function(e){t.datepickerOptions.from.maxDate=e})}i.debug("Controller: DateListCtrl"),this.init=function(){t.dateList=this.createDateList(c),s.$broadcast("ct-spinner-hide"),l.get(e().startOf("year"),e().endOf("year")).then(function(e){t.dateList=this.createDateList(e),t.dataLoading=!1}.bind(this)),d()},this.createDateList=function(e){for(var t,n=0,a=e.length,s={},r=[];n<a;n++)s[e[n].keydate]=s[e[n].keydate]||[],s[e[n].keydate].push(e[n]);for(t in s)r.push({date:t,dateContactList:s[t]});return r},t.dataLoading=!0,t.dateList=[],t.dateListLimit=5,t.dateListSelected=[],t.dpOpened={filterDates:{}},t.isCollapsed={filterDates:!0},t.filterParams={dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()},date:"month",dateType:[]},t.datepickerOptions={from:{maxDate:t.filterParams.dateRange.until},until:{minDate:t.filterParams.dateRange.from}},t.label={isoWeek:"Week",month:"Month",year:"Year",dateRange:""},t.csvExport=function(){var n,a;"dateRange"==t.filterParams.date?(n=t.filterParams.dateRange.from?e(t.filterParams.dateRange.from).format("YYYY-MM-DD"):"",a=t.filterParams.dateRange.until?e(t.filterParams.dateRange.until).format("YYYY-MM-DD"):""):(n=e().startOf(t.filterParams.date).format("YYYY-MM-DD"),a=e().endOf(t.filterParams.date).format("YYYY-MM-DD")),window.location.href=u.url.CSV_EXPORT+"/keydatescsv?start_date="+n+"&end_date="+a},t.labelDateRange=function(e,n){var a=r("date")(e,"dd/MM/yyyy")||"",s=r("date")(n,"dd/MM/yyyy")||"";s&&(s=a?" - "+s:"Until: "+s),a&&(a=s?a:"From: "+a),t.label.dateRange=a+s},t.showDateRange=function(n,a){t.$broadcast("ct-spinner-show","dateList"),l.get(e(n),e(a)).then(function(e){t.dateListSelected=this.createDateList(e),t.filterParams.date="dateRange",t.$broadcast("ct-spinner-hide","dateList")}.bind(this))}.bind(this),this.init()}])}),define("tasks-assignments/services/document",["common/angular","common/lodash","tasks-assignments/services/services","tasks-assignments/services/utils"],function(e,t,n){"use strict";n.factory("Document",["$resource","$httpParamSerializer","config","$log",function(e,t,n,a){return a.debug("Service: Document"),e(n.url.REST,{action:"get",entity:"Document",sequential:1,debug:n.DEBUG},{save:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:t}})}]),n.factory("DocumentService",["Document","$q","config","settings","UtilsService","ContactService","AssignmentService","$log",function(n,a,s,r,i,o,c,l){function u(e){return t(e).map(function(e){var t=[];return t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&t.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0]),t}).flatten().value()}function d(e){return e.filter(function(e){return!!e.case_id}).map(function(e){return e.case_id})}return l.debug("Service: DocumentService"),{assign:function(t,s){if(!t||!e.isArray(t)||!s||"number"!=typeof+s)return null;if(!t.length)return t;var r=a.defer();return n.save({action:"copy_to_assignment"},{json:{id:t,case_id:s}||{}},function(e){i.errorHandler(e,"Unable to assign documents",r)||r.resolve(e.values)},function(){r.reject("Unable to assign documents")}),r.promise},get:function(t){var s=a.defer();return t=t&&"object"==typeof t?t:{},t=e.extend({component:"CiviDocument",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id, expire_date"},t),n.get({json:t},function(e){s.resolve(e.values)},function(){s.reject("Unable to fetch documents list")}),s.promise},getOptions:function(){return a.all({documentType:this.getDocumentTypes(),documentStatus:this.getDocumentStatus()})},getDocumentStatus:function(){var e=a.defer(),s={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"status_id"}},function(n){t.each(n.values,function(e){s.arr.push({key:e.key.toString(),value:e.value}),s.obj[e.key]=e.value}),e.resolve(s)}),e.promise},getDocumentTypes:function(){var e=a.defer(),s={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"activity_type_id",options:{limit:0}}},function(n){t.each(n.values,function(e){s.arr.push({key:e.key,value:e.value}),s.obj[e.key]=e.value}),e.resolve(s)}),e.promise},save:function(t){if(!t||"object"!=typeof t)return null;var r,o=a.defer(),c=e.extend({sequential:1,debug:s.DEBUG},t);return n.save({action:"create"},{json:c||{}},function(e){i.errorHandler(e,"Unable to save document",o)||(r=e.values,o.resolve(1===r.length?r[0]:null))},function(){o.reject("Unable to save document")}),o.promise},saveMultiple:function(t){if(!t||!e.isArray(t))return null;if(!t.length)return t;var s=a.defer();return n.save({action:"create_multiple"},{json:{document:t}||{}},function(e){i.errorHandler(e,"Unable to save documents",s)||s.resolve(e.values)},function(){s.reject("Unable to save documents")}),s.promise},sendReminder:function(e,t){if(!e||"number"!=typeof+e)return null;var s=a.defer();return n.save({action:"sendreminder"},{json:{activity_id:e,notes:t||""}||{}},function(e){i.errorHandler(e,"Unable to send a reminder",s)||s.resolve(e)},function(){s.reject("Unable to send a reminder")}),s.promise},delete:function(e){if(!e||"number"!=typeof+e)return null;var t=a.defer();return n.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete document ID: "+e)}),t.promise},cacheContactsAndAssignments:function(e,n){var i,l,m=[],f=[];return void 0===n&&(n=["contacts","assignments"]),n=Array.isArray(n)?n:[n],t.contains(n,"contacts")&&(m=u(e),s.CONTACT_ID&&m.push(s.CONTACT_ID),i=m&&m.length?o.get({IN:m}).then(function(e){o.updateCache(e)}):a.resolve()),t.contains(n,"assignments")&&(f=d(e),l=f&&f.length&&r.extEnabled.assignments?c.get({IN:f}).then(function(e){c.updateCache(e)}):a.resolve()),a.all([i,l])}}}])}),define("tasks-assignments/services/file",["tasks-assignments/services/services","tasks-assignments/services/utils"],function(e){"use strict";e.factory("FileService",["$resource","config","$q","UtilsService","FileUploader","$log",function(e,t,n,a,s,r){r.debug("Service: FileService");var i=e(t.url.FILE+"/:action");return s.prototype.queueDelete=[],{delete:function(e,t,s){if(!e||"number"!=typeof+e||!t||"number"!=typeof+t||!s||"string"!=typeof s)return null;var r=n.defer();return i.save({action:"delete",entityTable:s,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1),a.errorHandler(e,"Unable to delete file",r)||r.resolve(e.values[0])},function(){r.reject("Unable to delete file")}),r.promise},get:function(e,t){if(!e||"number"!=typeof+e||!t||"string"!=typeof t)return null;var s=n.defer();return i.get({action:"list",entityTable:t,entityID:e},function(e){a.errorHandler(e,"Unable to fetch files",s)||s.resolve(e.values)},function(){s.reject("Unable to fetch files")}),s.promise},uploader:function(e,n){if(!e||"string"!=typeof e)return null;var a={url:t.url.FILE+"/upload",formData:[{entityTable:e}]};return n&&"number"==typeof n&&(a.queueLimit=n),new s(a)},upload:function(e,t){if(!e||"object"!=typeof e||!t||"number"!=typeof+t)return null;var a=n.defer(),s=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){s.push(t)},e.onErrorItem=function(e,t,n,s){a.reject("Could not upload file: "+e.file.name),r.error(" ===== Item Error: "+n+" ======"),r.error(" =====  - item ======"),r.error(e),r.error(" =====  - response ======"),r.error(t),r.error(" =====  - headers ======"),r.error(s)},e.onCompleteAll=function(){a.resolve(s)},e.uploadAll(),a.promise}}}])}),define("tasks-assignments/services/assignment",["common/angular","common/lodash","tasks-assignments/services/services","tasks-assignments/services/contact","tasks-assignments/services/utils"],function(e,t,n){"use strict";n.factory("Relationship",["$resource","config","$log",function(e,t,n){return n.debug("Service: Relationship"),e(t.url.REST,{action:"get",entity:"Relationship",json:{}})}]),n.factory("Assignment",["$resource","config","$log",function(e,t,n){return n.debug("Service: Assignment"),e(t.url.REST,{action:"get",entity:"Assignment",json:{}})}]),n.factory("AssignmentSearch",["$resource","config","$log",function(e,t,n){return n.debug("Service: AssignmentSearch"),e(t.url.ASSIGNMENTS+"/ajax/unclosed")}]),n.factory("AssignmentType",["$resource","config","$log",function(e,t,n){return n.debug("Service: AssignmentType"),e(t.url.REST,{action:"get",entity:"CaseType",json:{is_active:1}})}]),n.factory("AssignmentService",["Relationship","Assignment","AssignmentSearch","AssignmentType","ContactService","$q","config","UtilsService","$filter","$location","$state","$rootScope","$log","$timeout",function(t,n,a,s,r,i,o,c,l,u,d,m,f,v){return f.debug("Service: AssignmentService"),{get:function(e){if(!e||"number"!=typeof+e&&"object"!=typeof e)return null;var t=i.defer();return n.get({json:{options:{limit:0},id:e,return:["case_type_id","contacts","client_id","contact_id","id","is_deleted","start_date","status_id","subject"],debug:o.DEBUG}},function(e){c.errorHandler(e,"Unable to fetch assignments",t)||t.resolve(e.values)},function(){t.reject("Unable to fetch assignments")}),t.promise},assignCoordinator:function(e,n){if(!e||"number"!=typeof+e||!n||"number"!=typeof+n)return null;var a=i.defer();return t.save({action:"create",json:{sequential:1,contact_id_a:e,contact_id_b:o.LOGGED_IN_CONTACT_ID,relationship_type_id:9,case_id:n}},null,function(e){c.errorHandler(e,"Unable to assign coordinator",a)||a.resolve(e.values)},function(){a.reject("Unable to assign coordinator")}),a.promise},getTypes:function(){var e=i.defer();return s.get({},function(t){c.errorHandler(t,"Unable to fetch assignment types",e)||e.resolve(t.values)},function(){e.reject("Unable to fetch assignment types")}),e.promise},save:function(t){if(!t||"object"!=typeof t)return null;var a,s=i.defer(),r=e.extend({sequential:1,debug:o.DEBUG},t);return n.save({action:"create",json:r},null,function(e){c.errorHandler(e,"Unable to save an assignment",s)||(a=e.values,s.resolve(1===a.length?a[0]:null))},function(){s.reject("Unable to save an assignment")}),s.promise},search:function(e,t,n){return n=Array.isArray(n)?n.join(","):n,a.query({sortName:e,excludeCaseIds:t,includeContactIds:n}).$promise},updateTab:function(e){return document.getElementsByClassName("CRM_Case_Form_Search").length?void CRM.refreshParent(".CRM_Case_Form_Search"):document.getElementById("tab_case")?void CRM.tabHeader.updateCount("#tab_case",CRM.tabHeader.getCount("#tab_case")+(e||0)):void("/assignments"===u.path()&&d.reload(!0))},updateCache:function(t){var n,a,s,r=m.cache.assignment.obj||{},i=[],o=[];e.extend(r,t);for(a in r)n=r[a],s=m.cache.assignmentType.obj[n.case_type_id].title,i.push(n),o.push({label:n.contacts[0].sort_name+" - "+s+(n.end_date?" (closed)":""),label_class:+n.is_deleted||n.end_date?"strikethrough":"",id:a,extra:{case_subject:n.subject,case_type:s,contact_id:n.contacts[0].contact_id,end_date:n.end_date,sort_name:n.contacts[0].sort_name,start_date:n.start_date}});i=l("orderBy")(i,"subject"),o=l("orderBy")(o,"label"),m.cache.assignment={arr:i,obj:r,arrSearch:o}}}}])}),define("tasks-assignments/controllers/document-list",["common/angular","common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/document","tasks-assignments/services/file","tasks-assignments/services/assignment"],function(e,t,n){"use strict";n.controller("DocumentListCtrl",["$scope","$uibModal","$dialog","$rootElement","$rootScope","$state","$filter","$log","$q","$timeout","documentList","config","ContactService","AssignmentService","DocumentService","FileService","settings",function(n,a,s,r,i,o,c,l,u,d,m,f,v,p,g,h,y){function k(e,t){return t.crmMessages&&t.crmMessages.length&&e.test(t.crmMessages[0].title)}function $(e,t,n){switch(!0){case"3"!==t.status_id&&"4"!==t.status_id&&!n.status_id:e.push(t)}}function _(){n.$watch("filterParamsHolder.dateRange.from",function(e){n.datepickerOptions.until.minDate=e}),n.$watch("filterParamsHolder.dateRange.until",function(e){n.datepickerOptions.from.maxDate=e})}l.debug("Controller: DocumentListCtrl");var b=["1","2"];n.dueThisWeek=0,n.dueToday=0,n.list=m,n.listFiltered=[],n.listOngoing=[],n.listPaginated=[],n.listResolved=[],n.listResolvedLoaded=!1,n.overdue=0,n.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue"},{badgeClass:"primary",calendarView:"month",value:"dueInNextFortnight"},{badgeClass:"primary",calendarView:"month",value:"dueInNinetyDays"}],n.dpOpened={filterDates:{}},n.isCollapsed={filterAdvanced:!0,filterDates:!1,documentListResolved:!0},n.filterParams={contactId:null,documentStatus:[],ownership:o.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},n.filterParamsHolder={documentStatus:b,dateRange:{from:t().startOf("day").toDate(),until:t().add(1,"month").startOf("day").toDate()}},n.datepickerOptions={from:{maxDate:n.filterParamsHolder.dateRange.until},until:{minDate:n.filterParamsHolder.dateRange.from}},n.label={addNew:"Add Document",overdue:"Overdue",dueInNextFortnight:"Due in next fortnight",dueInNinetyDays:"Due in 90 days",dateRange:""},n.pagination={currentPage:1,itemsPerPage:10,maxSize:5},n.apply=function(e,t){var a,r=t.length,o=[];if(e&&r)switch(e){case"delete":s.open({msg:"Are you sure you want to delete "+r+" document(s)?"}).then(function(e){if(e){for(n.$broadcast("ct-spinner-show","documentList"),a=0;a<r;a++)o.push(g.delete(t[a].id));u.all(o).then(function(e){for(a=0;a<r;a++)i.$broadcast("documentDelete",t[a].id),n.list.splice(n.list.indexOf(t[a]),1);n.$broadcast("ct-spinner-hide","documentList"),p.updateTab()})}})}},n.applySidebarFilters=function(){n.filterParams.dateRange.from=n.filterParamsHolder.dateRange.from,n.filterParams.dateRange.until=n.filterParamsHolder.dateRange.until,n.filterParams.due="dateRange",n.labelDateRange()},n.changeStatus=function(e,t){return t&&"number"==typeof+t?(n.$broadcast("ct-spinner-show","documentList"),void g.save({id:e.id,status_id:t}).then(function(t){e.id=t.id,e.status_id=t.status_id,n.$broadcast("ct-spinner-hide","documentList"),p.updateTab()})):null},n.labelDateRange=function(e,t){var a=c("date")(e||n.filterParams.dateRange.from,"dd/MM/yyyy")||"",s=c("date")(t||n.filterParams.dateRange.until,"dd/MM/yyyy")||"";s&&(s=a?" - "+s:"Until: "+s),a&&(a=s?a:"From: "+a),n.label.dateRange=a+s},n.loadDocumentsResolved=function(){if(!n.listResolvedLoaded)return n.list=c("filterByStatus")(n.list,i.cache.documentStatusResolve,!1),g.get({target_contact_id:f.CONTACT_ID,status_id:{IN:f.status.resolve.DOCUMENT}}).then(function(e){g.cacheContactsAndAssignments(e).then(function(){n.listResolvedLoaded=!0}),Array.prototype.push.apply(n.list,e)})},n.deleteDocument=function(e){s.open({msg:"Are you sure you want to delete this document?"}).then(function(t){t&&g.delete(e.id).then(function(t){n.list.splice(n.list.indexOf(e),1),i.$broadcast("documentDelete",e.id),p.updateTab()})})},n.viewInCalendar=function(e){o.go("calendar.mwl."+e)},n.$on("assignmentFormSuccess",function(e,t){Array.prototype.push.apply(n.list,t.documentList)}),n.$on("documentFormSuccess",function(t,a,s){e.equals({},s)?$(n.list,a,s):e.extend(oldData,newData)}),n.$on("crmFormSuccess",function(e,t){if("success"===t.status){var n=/case|activity|assignment/i;(n.test(t.title)||k(n,t)||n.test(t.crmMessages[0].text))&&(i.cache.assignment={obj:{},arr:[]},o.go(o.current,{},{reload:!0}))}}),function(){_(),n.applySidebarFilters(),g.cacheContactsAndAssignments(m).then(function(){i.$broadcast("ct-spinner-hide"),l.debug(i.cache)})}()}])}),define("tasks-assignments/controllers/document",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/document"],function(e,t){"use strict";t.controller("DocumentCtrl",["$scope","$rootScope","config","$log",function(t,n,a,s){s.debug("Controller: DocumentCtrl"),t.document.activity_date_time=t.document.activity_date_time?e(t.document.activity_date_time).toDate():null,t.document.expire_date=t.document.expire_date?e(t.document.expire_date).toDate():null,t.document.valid_from=t.document.valid_from?e(t.document.valid_from).toDate():null,t.document.remind_me=1==t.document.remind_me,t.urlFile=a.url.FILE+"/zip?entityID="+t.document.id+"&entityTable=civicrm_activity",t.$watch("document.activity_date_time",function(e){t.document.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}])}),define("tasks-assignments/controllers/assignments",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact"],function(e){"use strict";e.controller("AssignmentsCtrl",["$scope","$log","$uibModal","$rootElement","$rootScope","$state","config",function(e,t,n,a,s,r,i){t.info("Controller: AssignmentsCtrl")}])}),define("tasks-assignments/controllers/main",["tasks-assignments/controllers/controllers","tasks-assignments/services/file"],function(e){"use strict";e.controller("MainCtrl",["$scope","$rootScope","$rootElement","$log","$uibModal","$q","FileService","config",function(e,t,n,a,s,r,i,o){a.debug("Controller: MainCtrl"),t.modalDocument=function(t,r,c){c&&c.preventDefault(),t=t||"new",r=r||{};var l=s.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/document.html?v=3",controller:"ModalDocumentCtrl",resolve:{modalMode:function(){return t},role:function(){return"admin"},data:function(){return r},files:function(){return r.id&&+r.file_count?i.get(r.id,"civicrm_activity"):[]}}});l.result.then(function(t){e.$broadcast("documentFormSuccess",t,r)},function(){a.info("Modal dismissed")})},t.modalTask=function(r){r=r||{};var i=s.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/task.html?v=5",controller:"ModalTaskCtrl",resolve:{data:function(){return r}}});i.result.then(function(n){e.$broadcast("taskFormSuccess",n,r),n.open&&t.modalTask(r)},function(){a.info("Modal dismissed")})},t.modalAssignment=function(t){t=t||{};var r=s.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/assignment.html?v=3",controller:"ModalAssignmentCtrl",size:"lg",resolve:{data:function(){return t}}});r.result.then(function(n){e.$broadcast("assignmentFormSuccess",n,t)},function(){a.info("Modal dismissed")})},t.modalReminder=function(e,t){return e&&"object"==typeof e&&t&&"string"==typeof t?void s.open({appendTo:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/reminder.html?v=1",controller:"ModalReminderCtrl",resolve:{data:function(){return e},type:function(){return t}}}):null}}])}),define("tasks-assignments/services/dialog",["tasks-assignments/services/services"],function(e){"use strict";e.factory("$dialog",["$uibModal","config","$rootElement","$log",function(e,t,n,a){return a.debug("Service: $dialog"),{open:function(a){if(!a||"object"==typeof a)return e.open({appendTo:n.find("div").eq(0),templateUrl:t.path.TPL+"modal/dialog.html",size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{copyCancel:a.copyCancel||"",copyConfirm:a.copyConfirm||"",title:a.title||"",msg:a.msg||""}}}}).result}}}])}),define("tasks-assignments/controllers/task-list",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/task","tasks-assignments/services/assignment"],function(e,t){"use strict";t.controller("TaskListCtrl",["$scope","$uibModal","$dialog","$rootElement","$rootScope","$filter","$timeout","$state","$log","taskList","config","ContactService","AssignmentService","TaskService","settings","HR_settings",function(t,n,a,s,r,i,o,c,l,u,d,m,f,v,p,g){function h(){t.$watch("filterParamsHolder.dateRange.from",function(e){t.datepickerOptions.until.minDate=e}),t.$watch("filterParamsHolder.dateRange.until",function(e){t.datepickerOptions.from.maxDate=e})}l.debug("Controller: TaskListCtrl"),this.init=function(){var e=this.contactIds,t=this.assignmentIds;this.collectId(u),e&&e.length&&m.get({IN:e}).then(function(e){m.updateCache(e)}),t&&t.length&&p.extEnabled.assignments&&f.get({IN:t}).then(function(e){f.updateCache(e)}),h(),r.$broadcast("ct-spinner-hide"),l.info(r.cache)},this.assignmentIds=[],this.contactIds=[],this.collectId=function(e){function t(e){a.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&a.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&a.push(e.target_contact_id[0])}function n(e){e.case_id&&s.push(e.case_id)}var a=this.contactIds,s=this.assignmentIds;a.push(d.LOGGED_IN_CONTACT_ID),d.CONTACT_ID&&a.push(d.CONTACT_ID),angular.forEach(e,function(e){t(e),n(e)})},t.dueFilters=[{badgeClass:"danger",calendarView:"month",value:"overdue"},{badgeClass:"primary",calendarView:"day",value:"dueToday"},{badgeClass:"primary",calendarView:"week",value:"dueThisWeek"}],t.format=g.DATE_FORMAT,t.assignments=[],t.contacts=[],t.dueToday=0,t.dueThisWeek=0,t.overdue=0,t.list=u,t.listFiltered=[],t.listLimit=5,t.listOngoing=[],t.listResolved=[],t.listResolvedLoaded=!1,t.dpOpened={filterDates:{}},t.isCollapsed={filterAdvanced:!0,filterDates:!0,taskListResolved:!0},t.filterParams={contactId:null,ownership:c.params.ownership||null,dateRange:{from:null,until:null},due:null,assignmentType:[]},t.filterParamsHolder={dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()}},t.datepickerOptions={from:{maxDate:t.filterParamsHolder.dateRange.until},until:{minDate:t.filterParamsHolder.dateRange.from}},t.label={overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:"Due Tasks"},t.applySidebarFilters=function(){t.filterParams.dateRange.from=t.filterParamsHolder.dateRange.from,
t.filterParams.dateRange.until=t.filterParamsHolder.dateRange.until,t.filterParams.due="dateRange"},t.cacheAssignment=function(e){if(!r.cache.assignment.obj[e.id]){var t={};t[e.id]={case_type_id:i("filter")(r.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"==e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},f.updateCache(t)}},t.cacheContact=function(e){var n={},a=t.contacts.filter(function(t){return t.id===e})[0];if(a)return n[a.id]={contact_id:a.id,contact_type:a.icon_class,sort_name:a.label,display_name:a.label,email:a.description.length?a.description[0]:""},m.updateCache(n),!0},t.changeStatus=function(e,n){t.$broadcast("ct-spinner-show","task"+e.id),v.save({id:e.id,status_id:n||"2"}).then(function(n){r.$broadcast("taskFormSuccess",n,e),t.$broadcast("ct-spinner-hide","task"+e.id),f.updateTab()})},t.updateTask=function(e,n){return t.cacheContact(e.assignee_contact_id[0]),v.save(angular.extend({},e,n)).catch(function(e){CRM.alert(e,"Error","error")})},t.updateContacts=function(e){t.contacts=e},t.refreshContacts=function(e){e&&m.search(e,{contact_type:"Individual"}).then(function(e){t.contacts=e})},t.refreshAssignments=function(e,n,a){e&&n&&a&&f.search(e,a).then(function(e){t.assignments=i("filter")(e,function(e){return+e.extra.contact_id==+n})})},t.loadTasksResolved=function(){if(!t.listResolvedLoaded){var e=this;i("filterByStatus")(t.list,r.cache.taskStatusResolve,!1),v.get({target_contact_id:d.CONTACT_ID,status_id:{IN:d.status.resolve.TASK}}).then(function(n){var a=e.contactIds,s=e.assignmentIds;e.collectId(n),a&&a.length&&m.get({IN:a}).then(function(e){m.updateCache(e)}),s&&s.length&&p.extEnabled.assignments&&f.get({IN:s}).then(function(e){f.updateCache(e)}),Array.prototype.push.apply(t.list,n),t.listResolvedLoaded=!0})}}.bind(this),t.deleteTask=function(e){a.open({msg:"Are you sure you want to delete this task?"}).then(function(n){n&&v.delete(e.id).then(function(n){t.list.splice(t.list.indexOf(e),1),r.$broadcast("taskDelete",e.id),f.updateTab()})})},t.viewInCalendar=function(e){c.go("calendar.mwl."+e)},t.$on("assignmentFormSuccess",function(e,n){Array.prototype.push.apply(t.list,n.taskList)}),t.$on("taskFormSuccess",function(e,n,a){angular.equals({},a)?t.list.push(n):angular.extend(a,n)}),t.$on("crmFormSuccess",function(e,t){if("success"==t.status){var n=/case|activity|assignment/i;(n.test(t.title)||t.crmMessages&&t.crmMessages.length&&(n.test(t.crmMessages[0].title)||n.test(t.crmMessages[0].text)))&&(r.cache.assignment={obj:{},arr:[]},c.go(c.current,{},{reload:!0}))}}),this.init()}])}),define("tasks-assignments/controllers/task",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/task"],function(e,t){"use strict";t.controller("TaskCtrl",["$scope","$log","$rootScope",function(t,n,a){n.debug("Controller: TaskCtrl"),t.isCollapsed=!0,t.picker={opened:!1},t.task.activity_date_time=t.task.activity_date_time?e(t.task.activity_date_time).toDate():null,t.dpOpen=function(e){t.picker.opened=!0},t.$watch("task.status_id",function(e){var n=a.cache.taskStatusResolve.indexOf(e)>-1;t.task.resolved=n,t.task.completed=n}),t.$watch("task.activity_date_time",function(e){t.task.due=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}])}),define("tasks-assignments/controllers/dashboard/nav-main",["tasks-assignments/controllers/controllers"],function(e){"use strict";e.controller("NavMainCtrl",["$scope","$state","$log",function(e,t,n){n.debug("Controller: NavMainCtrl"),e.isActive=function(e){return t.includes(e)}}])}),define("tasks-assignments/controllers/dashboard/top-bar",["tasks-assignments/controllers/controllers"],function(e){"use strict";e.controller("TopBarCtrl",["$scope","$rootScope","$state","$log",function(e,t,n,a){a.debug("Controller: TopBarCtrl"),t.itemAdd={},t.itemAdd.fn=function(){n.includes("documents")?t.modalDocument():t.modalTask()},t.itemAdd.label=function(){return n.includes("documents")?"Add Document":"Add Task"}}])}),define("tasks-assignments/controllers/modal/modal-dialog",["tasks-assignments/controllers/controllers"],function(e){"use strict";e.controller("ModalDialogCtrl",["$scope","$uibModalInstance","$timeout","content","$log",function(e,t,n,a,s){s.debug("Controller: ModalDialogCtrl"),e.title=a.title||"CiviHR Tasks & Assignments",e.msg=a.msg||"",e.copyConfirm=a.copyConfirm||"Yes",e.copyCancel=a.copyCancel||"Cancel",e.confirm=function(e){t.close(e||!0)},e.cancel=function(){t.close(!1)}}])}),define("tasks-assignments/controllers/modal/modal-document",["common/angular","common/moment","common/lodash","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/file","tasks-assignments/services/dialog","tasks-assignments/services/document","common/services/notification"],function(e,t,n,a){"use strict";a.controller("ModalDocumentCtrl",["$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","role","$filter","$uibModal","$dialog","$timeout","AssignmentService","DocumentService","ContactService","FileService","data","files","config","HR_settings","modalMode","notification",function(a,s,r,i,o,c,l,u,d,m,f,v,p,g,h,y,k,$,_,b,w){function C(e){var t=[];if(e.target_contact_id[0]||t.push("Contact"),e.activity_type_id||t.push("Document type"),e.status_id||t.push("Document status"),e.status_id||t.push("Status"),t.length){var n=1===t.length?"Required field":"Required fields",a=t.join(", ");return w.alert(n,a,{expires:5e3}),!1}return!0}function D(e){var t=r.cache.contact.arrSearch;return a.document.id?t.filter(function(t){var n=a.document[e+"_contact_id"][0];return+n===+t.id}):[]}c.debug("Controller: ModalDocumentCtrl"),function(){a.files=[],a.document={},e.copy(y,a.document),e.copy(k,a.files),a.data=y,a.role=l||"admin",a.modalTitle="edit"===b?"Edit Document":"New Document",a.document.activity_date_time=a.document.activity_date_time?t(a.document.activity_date_time).toDate():null,a.document.expire_date=a.document.expire_date?t(a.document.expire_date).toDate():null,a.document.valid_from=a.document.valid_from?t(a.document.valid_from).toDate():null,a.document.assignee_contact_id=a.document.assignee_contact_id||[],a.document.source_contact_id=a.document.source_contact_id||$.LOGGED_IN_CONTACT_ID,a.document.target_contact_id=a.document.target_contact_id||[$.CONTACT_ID],a.document.status_id=a.document.status_id||"1",a.filesTrash=[],a.uploader=h.uploader("civicrm_activity"),a.showCId=!$.CONTACT_ID,a.assignments=u("filter")(r.cache.assignment.arrSearch,function(e){return+e.extra.contact_id===+a.document.target_contact_id}),a.contacts={target:D("target"),assignee:D("assignee")},a.dpOpened={due:!1,exp:!1,form:!1},a.remindMeMessage='Checking this box sets a reminder that this document needs to be renewed a set number of days before the Expiry Date. You can set this by going <a target="_blank" href="/civicrm/tasksassignments/settings">here</a> CiviHR will do this by creating a copy of this document with the status awaiting upload, which you will be able to see in your Documents list.'}(),a.isRole=function(e){return a.role===e},a.getDocumentType=function(e){var t=n.find(r.cache.documentType.arr,function(t){return t.key===e});return t&&t.value},a.statusFieldVisible=function(){return!!a.document.status_id},a.showStatusField=function(){a.document.status_id=1},a.cacheAssignment=function(e){var t={};e&&!r.cache.assignment.obj[e.id]&&(t[e.id]={case_type_id:u("filter")(r.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"===e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},v.updateCache(t))},a.searchContactAssignments=function(e){return v.search(null,null,e).then(function(e){a.assignments=e,r.$broadcast("ct-spinner-hide")})},a.onContactChanged=function(e){r.$broadcast("ct-spinner-show"),a.document.case_id="",a.cacheContact(e),a.searchContactAssignments(e.id)},a.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},g.updateCache(t)},a.addAssignee=function(e){a.document.assignee_contact_id.indexOf(e.id)===-1&&a.document.assignee_contact_id.push(e.id),a.cacheContact(e)},a.removeAssignee=function(e){a.document.assignee_contact_id.splice(e,1)},a.fileMoveToTrash=function(e){a.filesTrash.push(a.files[e]),a.files.splice(e,1)},a.refreshAssignments=function(e){if(e){var t=a.document.target_contact_id;v.search(e,a.document.case_id).then(function(e){a.assignments=u("filter")(e,function(e){return+e.extra.contact_id===+t})})}},a.refreshContacts=function(e,t){e&&g.search(e,{contact_type:"Individual"}).then(function(e){a.contacts[t]=e})},a.cancel=function(){return a.documentForm.$pristine&&e.equals(k,a.files)&&!a.uploader.queue.length?void s.dismiss("cancel"):void m.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(a.$broadcast("ct-spinner-hide"),s.dismiss("cancel"))})},a.confirm=function(){var t=e.copy(a.document);if(C(t)){if(e.equals(y,t)&&e.equals(k,a.files)&&!a.uploader.queue.length)return void s.dismiss("cancel");var n,c=a.uploader,l=a.filesTrash,u=[];if(a.$broadcast("ct-spinner-show"),+t.case_id===+y.case_id&&delete t.case_id,t.activity_date_time=a.parseDate(t.activity_date_time)||"",t.expire_date=a.parseDate(t.expire_date),t.status_id=a.isRole("admin")?a.document.status_id:"2",l.length)for(var m=0;m<l.length;m++)n=l[m],u.push(h.delete(n.fileID,n.entityID,n.entityTable));o.all({document:p.save(t),files:u.length?o.all(u):[]}).then(function(e){if(c.queue.length){var t=d.open({appendTo:i.find("div").eq(0),templateUrl:$.path.TPL+"/modal/progress.html?v=1",size:"sm",controller:"ModalProgressCtrl",resolve:{uploader:function(){return c},entityId:function(){return e.document.id}}});return e.files=t.result,o.all(e)}return e}).then(function(e){e.files.length&&e.files[0].result?p.save({id:e.document.id,status_id:"1"}).then(function(e){a.document.status_id=e.status_id,s.close(a.document)}):e.files.length&&e.files[0].values[0].result?p.save({id:e.document.id,status_id:a.isRole("admin")?"3":"1"}).then(function(e){a.document.status_id=e.status_id,s.close(a.document)}):s.close(a.document),a.document.id=e.document.id,a.document.case_id=e.document.case_id,a.document.file_count=a.files.length+c.queue.length,v.updateTab(),r.$broadcast("document-saved"),a.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),s.dismiss(),a.$broadcast("ta-spinner-hide"),o.reject()})}},a.parseDate=function(e){e instanceof Date&&(e=e.getTime());var n=t(e,[_.DATE_FORMAT.toUpperCase(),"x","YYYY-MM-DD"]);return n.isValid()?n.format("YYYY-MM-DD"):null},a.dpOpen=function(e,t){e.preventDefault(),e.stopPropagation(),a.dpOpened[t]=!0},a.dropzoneClick=function(){f(function(){document.getElementById(r.prefix+"document-files").click()})},a.remindMeInfo=function(){CRM.help("Remind me?",a.remindMeMessage,"error")}}])}),define("tasks-assignments/controllers/modal/modal-progress",["tasks-assignments/controllers/controllers","tasks-assignments/services/file"],function(e){"use strict";e.controller("ModalProgressCtrl",["$scope","$uibModalInstance","$q","$timeout","uploader","entityId","FileService","$log",function(e,t,n,a,s,r,i,o){o.debug("Controller: ModalProgressCtrl"),e.uploader=s,s.queue.length&&(s.item=s.queue[0].file.name),s.onProgressItem=function(e){this.item=e.file.name},i.upload(s,r).then(function(e){a(function(){t.close(e)},500)}),e.cancel=function(){t.dismiss("File upload canceled")}}])}),define("tasks-assignments/controllers/modal/modal-task",["common/angular","common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/task"],function(e,t,n){"use strict";n.controller("ModalTaskCtrl",["$timeout","$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","$filter","$uibModal","$dialog","AssignmentService","TaskService","ContactService","data","config","HR_settings",function(n,a,s,r,i,o,c,l,u,d,m,f,v,p,g,h){function y(e){a.assignments=[],e[0]&&(n(function(){a.$broadcast("ct-spinner-show")},0),m.search(null,null,e).then(function(e){a.assignments=e,a.$broadcast("ct-spinner-hide")}))}function k(e){var t=[];if(e.target_contact_id[0]||t.push("Task Target"),e.activity_type_id||t.push("Task type"),e.activity_date_time||t.push("Due date"),t.length){var a=CRM.alert(t.join(", "),1===t.length?"Required field":"Required fields","error");return n(function(){a.close(),a=null},5e3),!1}return!0}function $(e){var t=r.cache.contact.arrSearch;return a.task.id?t.filter(function(t){var n=a.task[e+"_contact_id"][0];return+n===+t.id}):[]}function _(){a.$watch("task.target_contact_id",function(e,t){e!=t&&(a.task.case_id=null,a.showFieldAssignment=!1,y(e))},!0)}c.debug("Controller: ModalTaskCtrl"),a.format=h.DATE_FORMAT.toLowerCase(),a.data=p,a.task={},e.copy(p,a.task),a.task.activity_date_time=a.task.activity_date_time||t().toDate(),a.task.assignee_contact_id=a.task.assignee_contact_id||[],a.task.source_contact_id=a.task.source_contact_id||g.LOGGED_IN_CONTACT_ID,a.task.target_contact_id=a.task.target_contact_id||[g.CONTACT_ID],a.showCId=!g.CONTACT_ID,a.showFieldAssignment=!1,a.assignments=[],a.contacts={target:$("target"),assignee:$("assignee")},a.cacheAssignment=function(e){if(!r.cache.assignment.obj[e.id]){var t={};t[e.id]={case_type_id:l("filter")(r.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:"strikethrough"==e.label_class?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},m.updateCache(t)}},a.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},v.updateCache(t)},a.refreshContacts=function(e,t){e&&v.search(e,{contact_type:"Individual"}).then(function(e){a.contacts[t]=e})},a.dpOpen=function(e){e.preventDefault(),e.stopPropagation(),a.dpOpened=!0},a.cancel=function(){return a.taskForm.$pristine?void s.dismiss("cancel"):void d.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){e&&(a.$broadcast("ct-spinner-hide"),s.dismiss("cancel"))})},a.confirm=function(){var t=e.copy(a.task);if(k(t)){if(e.equals(p,t))return void s.dismiss("cancel");a.$broadcast("ct-spinner-show"),+t.case_id==+p.case_id&&delete t.case_id,t.activity_date_time=t.activity_date_time||new Date,f.save(t).then(function(e){a.task.id=e.id,a.task.case_id=e.case_id,m.updateTab(),a.openNew&&(a.task.open=!0,a.openNew=!1),s.close(a.task),a.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),a.$broadcast("ct-spinner-hide"),o.reject()})}},function(){_(),a.task.id&&y(a.task.target_contact_id)}()}])}),define("tasks-assignments/controllers/modal/modal-task-migrate",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/task"],function(e){"use strict";e.controller("ModalTaskMigrateCtrl",["$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","$filter","$uibModal","$dialog","$timeout","AssignmentService","TaskService","Task","activityType","ContactService","UtilsService","settings",function(e,t,n,a,s,r,i,o,c,l,u,d,m,f,v,p,g){r.debug("Controller: ModalTaskMigrateCtrl"),e.migrate={},e.migrate.dataLoaded=!1,e.migrate.from="",e.migrate.to="",e.migrate.task={list:[],statusList:[],statusListSelected:[]},e.migrate.document={list:[],statusList:[],statusListSelected:[]},e.contacts=n.cache.contact.arrSearch,e.getActivities=function(t){e.$broadcast("ct-spinner-show"),t=t||e.migrate.from,e.migrate.task.statusList=[],e.migrate.task.statusListSelected=[],e.migrate.document.statusList=[],e.migrate.document.statusListSelected=[],e.migrate.dataLoaded=!1;var a=[];m.get({entity:"ActivityContact",json:{component:"",sequential:"1",return:"activity_id",contact_id:t,record_type_id:"1",options:{limit:"0"}}},function(t){t.values&&t.values.length?(angular.forEach(t.values,function(e){this.push(e.activity_id)},a),m.get({entity:"Activity",json:{component:"",options:{limit:0},id:{IN:a},is_current_revision:"1",is_deleted:"0",sequential:"1",return:"assignee_contact_id, activity_type_id, assignee_contact_id, id, status_id"}},function(t){function a(t,n){var a=e.migrate[t];a.list.push(n),a.statusList.indexOf(n.status_id)>-1||(r[t].indexOf(n.status_id)>-1?a.statusList.push(n.status_id):(a.statusList.unshift(n.status_id),a.statusListSelected.push(n.status_id)))}var s=n.cache.documentType.obj,r={task:n.cache.taskStatusResolve,document:n.cache.documentStatusResolve};t.values&&t.values.length&&(t.values=i("orderBy")(t.values,"-status_id"),angular.forEach(t.values,function(e){s[e.activity_type_id]?a("document",e):a("task",e)})),e.migrate.dataLoaded=!0,e.$broadcast("ct-spinner-hide")})):(e.migrate.dataLoaded=!0,e.$broadcast("ct-spinner-hide"))})},e.refreshContacts=function(t){t&&v.search(t,{contact_type:"Individual"}).then(function(t){e.contacts=t})},e.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},v.updateCache(t)},e.cancel=function(){return e.taskMigrateForm.$pristine?void t.dismiss("cancel"):void c.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(n){n&&(e.$broadcast("ct-spinner-hide"),t.dismiss("cancel"))})},e.confirm=function(){if(e.migrate.task.statusListSelected||e.migrate.document.statusListSelected){var a,r=[],i=[],o=0;angular.forEach(e.migrate.task.list,function(t){e.migrate.task.statusListSelected.indexOf(t.status_id)>-1&&this.push(t)},r),+g.tabEnabled.documents&&angular.forEach(e.migrate.document.list,function(t){e.migrate.document.statusListSelected.indexOf(t.status_id)>-1&&this.push(t)},r),e.$broadcast("ct-spinner-show"),angular.forEach(r,function(t){t.assignee_contact_id[0]=e.migrate.to,this.push(function(){var e=s.defer();return a=o?this[o-1]:{},s.when(a).then(function(){m.save({entity:"Activity",action:"create",json:angular.extend({sequential:"1",component:""},t)},null,function(t){p.errorHandler(t,"Unable to save task",e)||e.resolve(1==t.values.length?t.values[0]:null)},function(){e.reject("Unable to save task")})}),e.promise}.bind(this)()),o++},i),s.all(i).then(function(a){a.length?CRM.alert(a.length+" item(s) re-assigned from: "+n.cache.contact.obj[e.migrate.from].sort_name+" to: "+n.cache.contact.obj[e.migrate.to].sort_name,"Migrate Tasks","success"):CRM.alert("0 items re-assigned.","Migrate Tasks","warning"),t.dismiss(),e.$broadcast("ct-spinner-hide")},function(n){CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ct-spinner-hide")})}}}])}),define("tasks-assignments/controllers/modal/modal-reminder",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/document","tasks-assignments/services/task"],function(e){"use strict";e.controller("ModalReminderCtrl",["$scope","$uibModalInstance","$dialog","$rootScope","$q","$log","$filter","TaskService","DocumentService","data","type","config",function(e,t,n,a,s,r,i,o,c,l,u,d){r.debug("Controller: ModalReminderCtrl"),e.data={},e.type=u,angular.copy(l,e.data),e.reminder={},e.data.assignee_contact_id=e.data.assignee_contact_id||[],e.data.target_contact_id=e.data.target_contact_id||[d.CONTACT_ID],e.contacts=a.cache.contact.arrSearch,e.showCId=!d.CONTACT_ID,e.cancel=function(){t.dismiss("cancel")},e.confirm=function(){e.$broadcast("ct-spinner-show"),("task"===u?o:c).sendReminder(e.data.id,e.reminder.notes).then(function(){CRM.alert("Message sent to: "+a.cache.contact.obj[e.data.assignee_contact_id[0]].sort_name,"Reminder sent","success"),t.close(),e.$broadcast("ta-spinner-hide")},function(n){return CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ta-spinner-hide"),s.reject()})}}])}),define("tasks-assignments/controllers/modal/modal-assignment",["common/lodash","common/angular","common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/document","tasks-assignments/services/task","tasks-assignments/services/assignment"],function(e,t,n,a){"use strict";a.controller("ModalAssignmentCtrl",["$timeout","$scope","$uibModalInstance","$rootScope","$q","$log","$filter","AssignmentService","TaskService","DocumentService","ContactService","data","config","settings","HR_settings",function(n,a,s,r,i,o,c,l,u,d,m,f,v,p,g){function h(t){return e.find(t,function(e){return e.create})}function y(t){var s=[];if(!t.contact_id&&s.push("Target Contact"),!t.case_type_id&&s.push("Assignment type"),!t.dueDate&&s.push("Key date"),a.taskList.filter(function(e){return e.create}).forEach(function(t){e.includes(s,"Activity type")||!t.activity_type_id&&s.push("Activity type"),e.includes(s,"Activity Due Date")||!t.activity_date_time&&s.push("Activity Due Date")}),s.length){var r=CRM.alert(s.join(", "),1===s.length?"Required field":"Required fields","error");return n(function(){r.close(),r=null},5e3),!1}return!0}o.debug("Controller: ModalAssignmentCtrl");var k={activity_type_id:null,assignee_contact_id:[],case_id:null,create:!0,isAdded:!1,name:null,source_contact_id:v.LOGGED_IN_CONTACT_ID,status_id:"1",offset:0};a.format=g.DATE_FORMAT.toLowerCase(),a.copyMessage="Click here to copy the value in row one to all rows.",a.alert={show:!1,msg:"",type:"danger"},a.assignment={},a.assignment.status_id="1",a.assignment.contact_id=v.CONTACT_ID,a.assignment.client_id=a.assignment.contact_id,a.assignment.subject="",a.assignment.dueDate=null,a.dpOpened={},a.showCId=!v.CONTACT_ID,a.activity={activitySet:{}},a.taskList=[],a.documentList=[],a.contacts={target:[],document:[],task:[]},a.updateTimeline=function(e){a.activity.activitySet=e},a.addActivity=function(e){e&&e.push(t.extend(t.copy(k),{isAdded:!0}))},a.removeActivity=function(e,t){e&&e.splice(t,1)},a.dpOpen=function(e,t){e.preventDefault(),e.stopPropagation(),a.dpOpened[t]=!0},a.refreshContacts=function(e,t,n){e&&m.search(e,{contact_type:"Individual"}).then(function(e){"target"===t?a.contacts[t]=e:a.contacts[t][n]=e})},a.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},m.updateCache(t)},a.setData=function(){var e=r.cache.assignmentType.obj[a.assignment.case_type_id];return e?(a.activity.activitySet=e.definition.activitySets[0],a.assignment.subject=r.cache.assignmentType.obj[a.assignment.case_type_id].title,void(a.assignment.dueDate=a.assignment.dueDate||new Date((new Date).setHours(0,0,0,0)))):(a.activity.activitySet={},void(a.assignment.subject=""))},a.cancel=function(){s.dismiss("cancel")},a.confirm=function(){return c("filter")(a.taskList,{create:!0}).length||c("filter")(a.documentList,{create:!0}).length?void(y(a.assignment)&&(a.$broadcast("ct-spinner-show"),a.assignment.start_date=new Date,l.save(a.assignment).then(function(e){var n=a.documentList.filter(function(e){return e.create}).map(function(t){return t.case_id=e.id,t}),o=a.taskList.filter(function(e){return e.create}).map(function(t){return t.case_id=e.id,t});i.all({relationship:l.assignCoordinator(a.assignment.contact_id,e.id),document:d.saveMultiple(n.map(function(e){return t.copy(e)})),task:u.saveMultiple(o.map(function(e){return t.copy(e)}))}).then(function(i){var c,u=[],d=[],m={};for(c=0;c<i.task.length;c++)o[c].id=i.task[c].id,u.push(i.task[c].id);for(c=0;c<i.document.length;c++)n[c].id=i.document[c].id,d.push(i.document[c].id);m[e.id]=t.extend(t.copy(a.assignment),{id:e.id,client_id:{1:a.assignment.client_id},contact_id:{1:a.assignment.contact_id},contacts:[{sort_name:r.cache.contact.obj[a.assignment.contact_id].sort_name,contact_id:a.assignment.contact_id,role:"Client"},{sort_name:r.cache.contact.obj[v.LOGGED_IN_CONTACT_ID].sort_name,contact_id:v.LOGGED_IN_CONTACT_ID,role:"Case Coordinator"}],is_deleted:"0",end_date:"",activities:u.concat(d)}),l.updateCache(m),l.updateTab(1),s.close({documentList:n,taskList:o}),a.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),a.$broadcast("ct-spinner-hide"),i.reject()})},function(e){return CRM.alert(e,"Error","error"),a.$broadcast("ct-spinner-hide"),i.reject()}))):(a.alert.msg="Please add at least one task.",void(a.alert.show=!0))},a.copyAssignee=function(t,n){var s=h(t);t.forEach(function(r,i){var o=a.contacts[n][e.indexOf(t,s)]||[],c=s.assignee_contact_id?[s.assignee_contact_id[0]]:s.assignee_contact_id;r.create&&(a.contacts[n][i]=o.slice(),r.assignee_contact_id=c)})},a.copyDate=function(e){e.forEach(function(t){t.create&&(t.activity_date_time=h(e).activity_date_time)})},a.$watch("activity.activitySet",function(e){if(!e||!e.activityTypes)return void(a.taskList=[]);for(var n,s,i,o=e.activityTypes,l=o.length,u=[],d=[],m=0;m<l;m++)n=t.copy(k),n.name=o[m].name,n.offset=o[m].reference_offset,s=n.name?c("filter")(r.cache.documentType.arr,{value:n.name},!0)[0]:"",s?(n.activity_type_id=s.key,u.push(n)):(i=n.name?c("filter")(r.cache.taskType.arr,{value:n.name},!0)[0]:"",n.activity_type_id=i?i.key:null,d.push(n));t.copy(d,a.taskList),+p.tabEnabled.documents&&t.copy(u,a.documentList)})}]),a.controller("ModalAssignmentActivityCtrl",["$scope","$log",function(e,t){t.debug("Controller: ModalAssignmentTaskCtrl"),e.isDisabled=!e.activity.activity_type_id&&!e.activity.isAdded,e.activity.create=!e.isDisabled,e.$watch("$parent.assignment.dueDate",function(t){e.activity.create&&(e.activity.activity_date_time=t?n(t).add(e.activity.offset,"days").toDate():null)}),e.$watch("$parent.assignment.contact_id",function(t){t&&e.activity.create&&(e.activity.target_contact_id=[t])})}])}),define("tasks-assignments/controllers/external-page",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact"],function(e){"use strict";e.controller("ExternalPageCtrl",["$scope","$log","$uibModal","$rootElement","$rootScope","$state","config",function(e,t,n,a,s,r,i){t.debug("Controller: ExternalPageCtrl"),e.assignmentsUrl=i.url.ASSIGNMENTS+"?reset=1",e.reportsUrl=i.url.CIVI_DASHBOARD+"?reset=1",e.$on("assignmentFormSuccess",function(){r.go(r.current,{},{reload:!0})}),e.$on("iframe-ready",function(){s.$broadcast("ct-spinner-hide")})}])}),define("tasks-assignments/services/settings",["tasks-assignments/services/services","tasks-assignments/services/utils"],function(e){"use strict";e.factory("Settings",["$resource","config","$log",function(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"TASettings",json:{}})}]),e.factory("SettingsService",["Settings","$q","config","UtilsService","$log","settings",function(e,t,n,a,s,r){return s.debug("Service: SettingsService"),{get:function(a){var s=t.defer();return a=a&&"object"==typeof a?a:[],e.get({json:{sequential:"1",debug:n.DEBUG,fields:a}},function(e){s.resolve(e.values)},function(){s.reject("Unable to fetch tasks list")}),s.promise},set:function(s){if(!s||"object"!=typeof s)return null;var i=t.defer();return e.save({action:"set",json:{sequential:1,debug:n.DEBUG,fields:s}},null,function(e){a.errorHandler(e,"Unable to save",i)||(r.tabEnabled={documents:s.documents_tab||r.tabEnabled.documents_tab,keyDates:s.keydates_tab||r.tabEnabled.keydates_tab},r.copy.button.assignmentAdd=s.add_assignment_button_title,i.resolve(e.values))},function(){i.reject("Unable to save")}),i.promise}}}])}),define("tasks-assignments/controllers/settings",["tasks-assignments/controllers/controllers","tasks-assignments/services/settings"],function(e){"use strict";e.controller("SettingsCtrl",["$scope","$rootScope","$rootElement","$location","$dialog","$q","$log","$state","$uibModal","SettingsService","Task","config","settings",function(e,t,n,a,s,r,i,o,c,l,u,d,m){i.debug("Controller: SettingsCtrl"),e.settings=angular.copy(m),e.configureAddAssignmentBtn=!!e.settings.copy.button.assignmentAdd;var f=function(){var e=r.defer();return u.get({entity:"Activity",action:"getoptions",json:{field:"activity_type_id"}},function(t){e.resolve(t.values||[])},function(){e.reject("Unable to get activity types")}),e.promise}();e.modalTaskMigrate=function(){c.open({appendTo:n.find("div").eq(0),templateUrl:d.path.TPL+"modal/taskMigrate.html?v=1",controller:"ModalTaskMigrateCtrl",resolve:{activityType:function(){return f}}}).result.then(function(t){e.$broadcast("taskMigrateFormSuccess",t)},function(){i.info("Modal dismissed")})},e.confirm=function(){e.$broadcast("ct-spinner-show"),l.set({documents_tab:e.settings.tabEnabled.documents,keydates_tab:e.settings.tabEnabled.keyDates,add_assignment_button_title:e.settings.copy.button.assignmentAdd,is_task_dashboard_default:e.settings.isTaskDashboardDefault,days_to_create_a_document_clone:e.settings.daysToCreateADocumentClone}).then(function(t){e.$broadcast("ct-spinner-hide"),e.settingsForm.$pristine=!0},function(t){CRM.alert(t,"Error","error"),e.$broadcast("ct-spinner-hide")})},e.$on("$stateChangeStart",function(n,a,r,i,c){e.settingsForm.$pristine||(n.preventDefault(),s.open({copyCancel:"No",msg:"Are you sure you want to leave this page? Changes will be lost!"}).then(function(e){return e?void o.go(a.name,r,{notify:!1}).then(function(){t.$broadcast("$stateChangeSuccess",a,r,i,c)}):void t.$broadcast("$stateChangeSuccess")}))}),t.$broadcast("ct-spinner-hide")}])}),define("tasks-assignments/directives/directives",["common/angular"],function(e){"use strict";return e.module("civitasks.directives",[])}),define("tasks-assignments/directives/civi-events",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("ctCiviEvents",["$rootScope","$log",function(e,t){return t.debug("Directive: ctCiviEvents"),{link:function(e){CRM.$(document).on("crmFormSuccess",function(n,a){t.debug("crmFormSuccess"),t.debug(a),e.$broadcast("crmFormSuccess",a)}),CRM.$(document).on("crmFormSubmit",function(n,a){t.debug("crmFormSubmit"),t.debug(a),e.$broadcast("crmFormSubmit",a)}),CRM.$(document).on("crmFormCancel",function(n,a){t.debug("crmFormCancel"),t.debug(a),e.$broadcast("crmFormCancel",a)})}}}])}),define("tasks-assignments/directives/iframe",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("taIframe",["$rootScope","$log",function(e,t){return t.debug("Directive: taIframe"),{link:function(t,n,a){var s=n[0];s.addEventListener("load",function(){var t,r=frames[a.name].document,i=["branding","toolbar","civicrm-menu","civicrm-footer","access"],o=0,c=i.length;for(o;o<c;o++)t=r.getElementById(i[o]),t&&(t.style.display="none");r.body.style.paddingTop="10px",s.height=r.body.scrollHeight+"px",n.addClass("ct-iframe-ready"),e.$broadcast("iframe-ready")})}}}])}),define("tasks-assignments/directives/sidebar-filters",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("sidebarFilters",["$log","config",function(e,t){return e.debug("Directive: sidebarFilters"),{restrict:"E",scope:!0,transclude:!0,templateUrl:t.path.TPL+"directives/sidebar-filters.html"}}])}),define("tasks-assignments/directives/spinner",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("ctSpinner",["$rootScope","$log",function(e,t){return t.debug("Directive: ctSpinner"),{link:function(t,n,a){function s(){var e=window.getComputedStyle(n[0]).position;return"relative"==e||"absolute"==e||"fixed"==e}function r(){s()||(n.css("position","relative"),l=!0),n.append(c),u=!0}function i(){u&&c.parentNode.removeChild(c),
u=!1,l&&n.css("position","")}var o,c=document.createElement("div"),l=!1,u=!1;c.className="ct-spinner-cover ct-spinner-img","undefined"!=typeof a.ctSpinnerShow&&r(),"undefined"!=typeof a.ctSpinnerMainView&&(c.className="ct-spinner-cover",o=document.createElement("div"),o.className="ct-spinner ct-spinner-img",e.$on("$stateChangeStart",function(){r(),document.body.appendChild(o)}),e.$on("$stateChangeSuccess",function(){i(),o.parentNode.removeChild(o)}),e.$on("$stateChangeError",function(){i(),o.parentNode.removeChild(o)})),t.$on("ct-spinner-show",function(e,t){if(!t||a.ctSpinnerId&&a.ctSpinnerId==t)return void r()}),t.$on("ct-spinner-hide",function(e,t){if(!t||a.ctSpinnerId&&a.ctSpinnerId==t)return void i()})}}}])}),define("tasks-assignments/directives/validate",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("taValidate",["$log",function(e){return e.debug("Directive: taValidate"),{restrict:"A",require:"^form",scope:{isWarning:"=?taValidateWarning"},link:function(e,t,n,a){function s(e,n){t.toggleClass("has-success",!e&&!n),d.toggleClass("glyphicon-ok",!e&&!n)}function r(e,n){t.toggleClass("has-warning",!e&&n),d.toggleClass("glyphicon-warning-sign",!e&&n)}function i(e){t.toggleClass("has-error",e),d.toggleClass("glyphicon-remove",e)}var o=t[0].querySelector("[name]"),c=angular.element(o),l=c.attr("name"),u=document.createElement("span"),d=angular.element(u);l&&(t.addClass("has-feedback"),d.addClass("glyphicon form-control-feedback"),c.after(d),e.$watch(function(){return a[l]&&a[l].$invalid},function(t){a[l].$dirty&&(s(t,e.isWarning),i(t))}),"undefined"!=typeof e.isWarning&&e.$watch("isWarning",function(e){var t=a[l].$invalid;a[l].$dirty&&(s(t,e),r(t,e))}),c.bind("blur",function(){i(a[l].$invalid)}))}}}])}),define("tasks-assignments/filters/filters",["common/angular"],function(e){"use strict";return e.module("civitasks.filters",[])}),define("tasks-assignments/filters/assignment-type",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByAssignmentType",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterByAssignmentType"),function(e,n){var a,s=t.cache.assignment.obj,r=n.length,i=[],o=0,c=e.length;if(!c||!r)return e;for(o;o<c;o++)a=s[e[o].case_id],a&&n.indexOf(a.case_type_id)!==-1&&i.push(e[o]);return i}}])}),define("tasks-assignments/filters/contact-id",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByContactId",["$filter","config","$log",function(e,t,n){return n.debug("Filter: filterByContactId"),function(e,t){var n=[],a=0,s=e.length;if(!s||!t||"number"!=typeof+t)return e;for(a;a<s;a++)+e[a].assignee_contact_id[0]!==+t&&+e[a].source_contact_id!==+t&&+e[a].target_contact_id!==+t||n.push(e[a]);return n}}])}),define("tasks-assignments/filters/date",["common/moment","tasks-assignments/filters/filters"],function(e,t){"use strict";t.filter("filterByDate",["$filter","$log",function(t,n){return n.debug("Filter: filterBy.date"),function(t,n){if(!t||!t.length||!n)return[];var a,s,r,i=[],o=0,c=t.length;for(a=e().startOf(n),s=e().endOf(n);o<c;o++)r=e(t[o].date),r>a&&r<s&&i.push(t[o]);return i}}])}),define("tasks-assignments/filters/date-parse",["common/moment","tasks-assignments/filters/filters"],function(e,t){"use strict";t.filter("dateParse",["$filter","$log",function(t,n){return n.debug("Filter: dateParse"),function(t){return e(t).toDate()}}])}),define("tasks-assignments/filters/date-type",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByDateType",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterBy.dateType"),function(e,t){var n,a,s,r=[],i=0,o=e.length,c=t.length;if(!o||!c)return e;for(i;i<o;i++)for(n=0,a=e[i].dateContactList,s=a.length,n;n<s;n++)if(t.indexOf(a[n].type)!==-1){r.push(e[i]);break}return r}}])}),define("tasks-assignments/filters/due",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByDue",["$filter","$log",function(e,t){function n(e,t,n){return null!==e&&e>=t&&(e<=n||null===n)||null===e&&null===n}return t.debug("Filter: filterByDue"),function(e,t,a){if(!e)return null;var s=[],r=0,i=e.length,o=new Date,c=o.setHours(0,0,0,0);if(!i||!t)return e;switch(t){case"overdue":var l;for(r;r<i;r++)l=null,e[r].activity_date_time&&(l=new Date(e[r].activity_date_time).setHours(0,0,0,0)),l<c&&null!==l&&s.push(e[r]);break;case"dateRange":if(!a||"object"!=typeof a)return e;var u,d=a.from?new Date(a.from).setHours(0,0,0,0):null,m=a.until?new Date(a.until).setHours(0,0,0,0):null;for(r;r<i;r++)u=e[r].activity_date_time?new Date(e[r].activity_date_time).setHours(0,0,0,0):null,n(u,d,m)&&s.push(e[r]);break;case"dueToday":for(r;r<i;r++)new Date(e[r].activity_date_time).setHours(0,0,0,0)==c&&s.push(e[r]);break;case"dueThisWeek":var u,f=new Date,v=f.getDay(),p=f.getDate()-v+(0==v?-6:1),g=new Date(f.setDate(p)),h=new Date(f.setDate(g.getDate()+7));for(r;r<i;r++)u=new Date(e[r].activity_date_time).setHours(0,0,0,0),u>c&&u>=g.setHours(0,0,0,0)&&u<h.setHours(0,0,0,0)&&s.push(e[r]);break;case"dueInNextFortnight":var y=o.setDate(o.getDate()+14);for(r;r<i;r++)new Date(e[r].activity_date_time).setHours(0,0,0,0)>=c&&new Date(e[r].activity_date_time).setHours(0,0,0,0)<=y&&s.push(e[r]);break;case"dueInNinetyDays":var k=o.setDate(o.getDate()+90);for(r;r<i;r++)new Date(e[r].activity_date_time).setHours(0,0,0,0)>=c&&new Date(e[r].activity_date_time).setHours(0,0,0,0)<=k&&s.push(e[r])}return s}}])}),define("tasks-assignments/filters/offset",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("offset",["$log",function(e){return e.debug("Filter: offset"),function(e,t){return t=t||0,e.slice(parseInt(t,10))}}])}),define("tasks-assignments/filters/ownership",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByOwnership",["$log","config",function(e,t){e.debug("Filter: filterByOwnership");var n={assigned:function(e){return~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)},delegated:function(e){return e.source_contact_id===t.LOGGED_IN_CONTACT_ID&&!~e.assignee_contact_id.indexOf(t.LOGGED_IN_CONTACT_ID)}};return function(e,t){try{return e.filter(n[t])}catch(t){return e}}}])}),define("tasks-assignments/filters/status",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByStatus",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterByStatus"),function(e,t,n){var a=[],s=0,r=e.length,i=t.length,n="undefined"==typeof n||n;if(!r||!i)return e;for(s;s<r;s++)t.indexOf(e[s].status_id)!==-1==n&&a.push(e[s]);return a}}])}),define("tasks-assignments/app",["tasks-assignments/modules/config","tasks-assignments/modules/settings","tasks-assignments/modules/run","tasks-assignments/modules/app-dashboard","tasks-assignments/modules/app-documents","tasks-assignments/modules/app-tasks","tasks-assignments/modules/app-settings","tasks-assignments/controllers/controllers","tasks-assignments/controllers/calendar","tasks-assignments/controllers/date-list","tasks-assignments/controllers/document-list","tasks-assignments/controllers/document","tasks-assignments/controllers/assignments","tasks-assignments/controllers/main","tasks-assignments/controllers/task-list","tasks-assignments/controllers/task","tasks-assignments/controllers/dashboard/nav-main","tasks-assignments/controllers/dashboard/top-bar","tasks-assignments/controllers/modal/modal-dialog","tasks-assignments/controllers/modal/modal-document","tasks-assignments/controllers/modal/modal-progress","tasks-assignments/controllers/modal/modal-task","tasks-assignments/controllers/modal/modal-task-migrate","tasks-assignments/controllers/modal/modal-reminder","tasks-assignments/controllers/modal/modal-assignment","tasks-assignments/controllers/external-page","tasks-assignments/controllers/settings","tasks-assignments/directives/directives","tasks-assignments/directives/civi-events","tasks-assignments/directives/iframe","tasks-assignments/directives/sidebar-filters","tasks-assignments/directives/spinner","tasks-assignments/directives/validate","tasks-assignments/filters/filters","tasks-assignments/filters/assignment-type","tasks-assignments/filters/contact-id","tasks-assignments/filters/date","tasks-assignments/filters/date-parse","tasks-assignments/filters/date-type","tasks-assignments/filters/due","tasks-assignments/filters/offset","tasks-assignments/filters/ownership","tasks-assignments/filters/status","tasks-assignments/services/services"],function(){"use strict";document.addEventListener("taInit",function(e){angular.bootstrap(document.getElementById(e.detail.module),["civitasks."+e.detail.app])}),document.dispatchEvent("function"==typeof window.CustomEvent?new CustomEvent("taReady"):function(){var e=document.createEvent("Event");return e.initEvent("taReady",!0,!0),e}())}),function(){var e=CRM.tasksAssignments.extensionPath+"js/src/tasks-assignments";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"tasks-assignments":e,"tasks-assignments/vendor/angular-bootstrap-calendar":e+"/vendor/angular/angular-bootstrap-calendar-tpls-custom","tasks-assignments/vendor/angular-checklist-model":e+"/vendor/angular/checklist-model","tasks-assignments/vendor/angular-router":e+"/vendor/angular/angular-ui-router"}}),require(["tasks-assignments/app"])}(require);
/**
 * CiviTasks Dashboard Calendar based on:
 * angular-bootstrap-calendar - A pure AngularJS bootstrap themed responsive calendar that can display events and has views for year, month, week and day
 * @version v0.10.6
 * @link https://github.com/mattlewis92/angular-bootstrap-calendar
 * @license MIT
 */

/**
 * State-based routing for AngularJS
 * @version v0.2.15
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

define("tasks-assignments/modules/config",["common/angular"],function(e){"use strict";e.module("civitasks.config",[]).constant("config",{DEBUG:!!+CRM.debug,CLASS_NAME_PREFIX:"ct-",CONTACT_ID:CRM.contactId||null,LOGGED_IN_CONTACT_ID:CRM.adminId||null,path:{EXT:CRM.Tasksassignments.extensionPath,TPL:CRM.Tasksassignments.extensionPath+"views/"},permissions:{allowDelete:CRM.Tasksassignments.permissions.delete_tasks_and_documents},url:{REST:CRM.url("civicrm/ajax/rest"),ASSIGNMENTS:CRM.url("civicrm/case"),CIVI_DASHBOARD:CRM.url("civicrm/"),CONTACT:CRM.url("civicrm/contact/view"),FILE:"/civicrm/tasksassignments/file",CSV_EXPORT:CRM.url("civicrm/tasksassignments")},status:{resolve:{DOCUMENT:["3","4"],TASK:["2","3","6","8"]}}})}),define("tasks-assignments/modules/settings",["common/angular"],function(e){"use strict";e.module("civitasks.settings",[]).value("settings",{tabEnabled:{documents:CRM.Tasksassignments.settings.documents_tab,keyDates:CRM.Tasksassignments.settings.keydates_tab},extEnabled:{assignments:CRM.Tasksassignments.case_extension},copy:{button:{assignmentAdd:CRM.Tasksassignments.settings.add_assignment_button_title}},isTaskDashboardDefault:CRM.Tasksassignments.settings.is_task_dashboard_default})}),define("tasks-assignments/vendor/angular-bootstrap-calendar",["common/moment"],function(e){"use strict";angular.module("mwl.calendar",[]),angular.module("mwl.calendar").run(["$templateCache",function(e){e.put("src/templates/calendar.html",'<div class="cal-context" ng-switch="view"><div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div><div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div><mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year"></mwl-calendar-year><mwl-calendar-month events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month"></mwl-calendar-month><mwl-calendar-week events="events" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week"></mwl-calendar-week><mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day"></mwl-calendar-day></div>'),e.put("src/templates/calendarCustom.html",'<div class="cal-context" ng-switch="view"> <div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div> <div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div> <mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year" ></mwl-calendar-year> <mwl-calendar-month events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month" ></mwl-calendar-month> <mwl-calendar-week events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week" ></mwl-calendar-week> <mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day" ></mwl-calendar-day></div>'),e.put("src/templates/calendarDayView.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.timeLabel"></div><div class="span11 col-xs-11 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.eventsLabel"></div></div><div class="cal-day-panel clearfix" ng-style="{height: (vm.hours.length * vm.hourHeight) + \'px\'}"><div class="cal-day-panel-hour"><div class="cal-day-hour" ng-repeat="hour in vm.hours track by $index"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><strong ng-bind="hour.label"></strong></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight" ng-class="\'dh-event-\' + event.type" ng-repeat="event in vm.view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title | calendarTruncateEventTitle:20:event.height"></span></a></div></div></div>'),e.put("src/templates/calendarMonthDay.html",'<div class="cal-month-day" ng-class="{\n            \'cal-day-outmonth\': !day.inMonth,\n            \'cal-day-inmonth\': day.inMonth,\n            \'cal-day-weekend\': day.isWeekend,\n            \'cal-day-past\': day.isPast,\n            \'cal-day-today\': day.isToday,\n            \'cal-day-future\': day.isFuture\n          }"><small class="cal-events-num badge badge-important pull-left" ng-show="day.badgeTotal > 0" ng-bind="day.badgeTotal"></small> <span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" ng-bind="day.label"></span><div class="cal-day-tick" ng-show="dayIndex === vm.openDayIndex && vm.view[vm.openDayIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div ng-include="\'src/templates/calendarMonthEventsList.html\'"></div></div>'),e.put("src/templates/calendarMonthDayCustom.html",'<div class="cal-month-day" ng-class="{ \'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture }"> <ul class="cal-list-events-num"> <li ng-show="day.badgeEventsTotal > 0"> <small class="badge badge-danger-light" ng-bind="day.badgeEventsTotal"></small> Tasks </li> <li ng-show="day.badgeDocumentsTotal > 0"> <small class="badge badge-dark" ng-bind="day.badgeDocumentsTotal"></small> Documents </li> </ul> <span class="pull-right" data-cal-date ng-bind="day.label"> </span></div>'),e.put("src/templates/calendarMonthEventsList.html",'<div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" ng-repeat="event in day.events track by $index" class="pull-left event" ng-class="\'event-\' + event.type" ng-mouseenter="vm.highlightEvent(event, true)" ng-mouseleave="vm.highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div>'),e.put("src/templates/calendarMonthView.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"><div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"><div class="cal-row-fluid cal-before-eventlist"><div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.dayClicked(day)" ng-class="{pointer: day.events.length > 0}"><div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openDayIndex].events.length > 0" events="vm.view[vm.openDayIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>'),e.put("src/templates/calendarMonthViewCustom.html",'<div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"> <div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"> <div class="cal-row-fluid cal-before-eventlist"> <div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="pointer cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.calendarCtrl.drillDown(day.date)"> <div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div> </div> </div> </div></div>'),e.put("src/templates/calendarSlideBox.html",'<div class="cal-slide-box" collapse="vm.shouldCollapse" mwl-collapse-fallback="vm.shouldCollapse"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in events track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title"></span> <span ng-show="isMonthView">(<span ng-bind="event.startsAt | date:\'shortTime\'"></span>)</span> <span ng-show="isYearView">(<span ng-bind="event.startsAt | date:\'MMM d, h:mm a\'"></span>)</span></a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="vm.$sce.trustAsHtml(editEventHtml)" ng-click="onEditEventClick({calendarEvent: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="vm.$sce.trustAsHtml(deleteEventHtml)" ng-click="onDeleteEventClick({calendarEvent: event})"></a></li></ul></div></div>'),e.put("src/templates/calendarWeekView.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{\n        \'cal-day-weekend\': day.isWeekend,\n        \'cal-day-past\': day.isPast,\n        \'cal-day-today\': day.isToday,\n        \'cal-day-future\': day.isFuture}"><span ng-bind="day.weekDayLabel"></span><br><small><span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"></span></small></div></div><div class="cal-row-fluid" ng-repeat="event in vm.view.events track by $index"><div ng-class="\'cal-cell\' + event.daySpan + \' cal-offset\' + event.dayOffset + \' day-highlight dh-event-\' + event.type" data-event-class><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"></a></div></div></div>'),e.put("src/templates/calendarWeekViewCustom.html",'<div class="cal-week-box"> <div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{ \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture}"> <span ng-bind="day.weekDayLabel"></span> <br> <small> <span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"> </span> </small> </div> </div> <div class="cal-col-fluid" ng-repeat="col in vm.view.cols track by $index"> <div class="cal-row-fluid" ng-repeat="event in col track by $index"> <div ng-if="event.title" ng-class="\'day-highlight dh-event-\' + event.type + \' dh-event-overdue-\' + event.overdue" data-event-class> <a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"> </a> </div> </div> </div></div>'),e.put("src/templates/calendarYearView.html",'<div class="cal-year-box"><div ng-repeat="rowOffset in [0, 4, 8] track by rowOffset"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in vm.view | calendarLimitTo:4:rowOffset track by $index" ng-init="monthIndex = vm.view.indexOf(month)" ng-click="vm.monthClicked(month)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(month.date)" ng-bind="month.label"></span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.badgeTotal > 0" ng-bind="month.badgeTotal"></small><div class="cal-day-tick" ng-show="monthIndex === vm.openMonthIndex && vm.view[vm.openMonthIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openMonthIndex].events.length > 0" events="vm.view[vm.openMonthIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>')}]),"use strict",angular.module("mwl.calendar").constant("moment",e),"use strict",angular.module("mwl.calendar").factory("calendarTitle",["moment","calendarConfig",function(e,t){function n(n){return e(n).format(t.titleFormats.day)}function r(n){var r=t.titleFormats.week;return r.replace("{week}",e(n).week()).replace("{year}",e(n).format("YYYY"))}function i(n){return e(n).format(t.titleFormats.month)}function s(n){return e(n).format(t.titleFormats.year)}return{day:n,week:r,month:i,year:s}}]),"use strict",angular.module("mwl.calendar").factory("calendarHelper",["moment","calendarConfig",function(e,t){function n(t,n,r,i){return t=e(t),n=e(n),r=e(r),i=e(i),t.isAfter(r)&&t.isBefore(i)||n.isAfter(r)&&n.isBefore(i)||t.isBefore(r)&&n.isAfter(i)||t.isSame(r)||n.isSame(i)}function r(t,r,i){var s=e(t).startOf(r),o=e(t).endOf(r);return i.filter(function(e){return n(e.startsAt,e.endsAt,s,o)})}function i(e){return e.filter(function(e){return e.incrementsBadgeTotal!==!1}).length}function s(){var n=[],r=0;while(r<7)n.push(e().weekday(r++).format(t.dateFormats.weekDay));return n}function o(e,t,r){return e.filter(function(e){return n(e.startsAt,e.endsAt,t,r)})}function u(n,s){var u=[],a=r(s,"year",n),f=e(s).startOf("year"),l=0;while(l<12){var c=f.clone(),h=c.clone().endOf("month"),p=o(a,c,h);u.push({label:c.format(t.dateFormats.month),isToday:c.isSame(e().startOf("month")),events:p,date:c,badgeTotal:i(p)}),f.add(1,"month"),l++}return u}function a(t,n,s){var u=r(s,"month",t),a=r(s,"month",n),f=e(s).startOf("month"),l=f.clone().startOf("week"),c=e(s).endOf("month").endOf("week"),h=[],p=e().startOf("day");while(l.isBefore(c)){var d=l.month()===e(s).month(),v=[],m=[];d&&(v=o(u,l,l.clone().endOf("day")),m=o(a,l,l.clone().endOf("day"))),h.push({label:l.date(),date:l.clone(),inMonth:d,isPast:p.isAfter(l),isToday:p.isSame(l),isFuture:p.isBefore(l),isWeekend:[0,6].indexOf(l.day())>-1,events:v,documents:m,badgeEventsTotal:i(v),badgeDocumentsTotal:i(m)}),l.add(1,"day")}return h}function f(n,r,i){var s=e(i).startOf("week"),u=e(i).endOf("week"),a=s.clone(),f=[],l=[],c=10,h=e().startOf("day");while(f.length<7)l.push([]),f.push({weekDayLabel:a.format(t.dateFormats.weekDay),date:a.clone(),dayLabel:a.format(t.dateFormats.day),isPast:a.isBefore(h),isToday:a.isSame(h),isFuture:a.isAfter(h),isWeekend:[0,6].indexOf(a.day())>-1}),a.add(1,"day");var p=o(n.concat(r),s,u).map(function(t){var n=e(t.startsAt).startOf("day"),r=e(t.endsAt).startOf("day"),i=e(s).startOf("day"),o=e(u).startOf("day"),a,f;return n.isBefore(i)||n.isSame(i)?a=0:a=n.diff(i,"days"),r.isAfter(o)&&(r=o),n.isBefore(i)&&(n=i),f=e(r).diff(n,"days")+1,t.daySpan=f,t.dayOffset=a,t.overdue=n.isBefore(h),l[a].push(t),t});return l.map(function(e){c=e.length>c?e.length:c}),l.map(function(e){if(e.length<c)for(var t=e.length;t<c;t++)e.push({})}),{days:f,events:p,cols:l,rowsMax:c}}function l(t,r,i,s,u){var a=e(r).startOf("day").add(i,"hours"),f=e(r).startOf("day").add(s,"hours"),l=(s-i+1)*u,c=u/60,h=[],p=o(t,e(r).startOf("day").toDate(),e(r).endOf("day").toDate());return p.map(function(t){e(t.startsAt).isBefore(a)?t.top=0:t.top=e(t.startsAt).startOf("minute").diff(a.startOf("minute"),"minutes")*c-2;if(e(t.endsAt).isAfter(f))t.height=l-t.top;else{var n=t.startsAt;e(t.startsAt).isBefore(a)&&(n=a.toDate()),t.height=e(t.endsAt).diff(n,"minutes")*c}return t.top-t.height>l&&(t.height=0),t.left=0,t}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return h.forEach(function(r,i){var s=!0;r.forEach(function(t){if(n(e.startsAt,e.endsAt,t.startsAt,t.endsAt)||n(t.startsAt,t.endsAt,e.startsAt,e.endsAt))s=!1}),s&&t&&(t=!1,e.left=i*150,h[i].push(e))}),t&&(e.left=h.length*150,h.push([e])),e})}return{getWeekDayNames:s,getYearView:u,getMonthView:a,getWeekView:f,getDayView:l}}]),"use strict",angular.module("mwl.calendar").service("calendarDebounce",["$timeout",function(e){function t(t,n,r){var i;return function(){function u(){i=null,r||t.apply(s,o)}var s=this,o=arguments,a=r&&!i;e.cancel(i),i=e(u,n),a&&t.apply(s,o)}}return t}]),"use strict",angular.module("mwl.calendar").provider("calendarConfig",function(){var e={hour:"ha",day:"D MMM",month:"MMMM",weekDay:"dddd"},t={day:"dddd D MMMM, YYYY",week:"Week {week} of {year}",month:"MMMM YYYY",year:"YYYY"},n={eventsLabel:"Events",timeLabel:"Time"},r=this;r.setDateFormats=function(t){return angular.extend(e,t),r},r.setTitleFormats=function(e){return angular.extend(t,e),r},r.setI18nStrings=function(e){return angular.extend(n,e),r},r.$get=function(){return{dateFormats:e,titleFormats:t,i18nStrings:n}}}),"use strict",angular.module("mwl.calendar").filter("calendarTruncateEventTitle",function(){return function(e,t,n){return e?e.length>=t&&e.length/20>n/30?e.substr(0,t)+"...":e:""}}),"use strict",angular.module("mwl.calendar").filter("calendarLimitTo",function(){return function(e,t,n){return Math.abs(Number(t))===Infinity?t=Number(t):t=parseInt(t),isNaN(t)?e:(angular.isNumber(e)&&(e=e.toString()),!angular.isArray(e)&&!angular.isString(e)?e:(n=!n||isNaN(n)?0:parseInt(n),n=n<0&&n>=-e.length?e.length+n:n,t>=0?e.slice(n,n+t):n===0?e.slice(t,e.length):e.slice(Math.max(0,n+t),n)))}}),"use strict",angular.module("mwl.calendar").directive("mwlDateModifier",function(){return{restrict:"A",controller:["$element","$attrs","$scope","moment",function(e,t,n,r){function i(){angular.isDefined(t.setToToday)?n.date=new Date:angular.isDefined(t.increment)?n.date=r(n.date).add(1,n.increment).toDate():angular.isDefined(t.decrement)&&(n.date=r(n.date).subtract(1,n.decrement).toDate()),n.$apply()}e.bind("click",i),n.$on("$destroy",function(){e.unbind("click",i)})}],scope:{date:"=",increment:"=",decrement:"="}}}),"use strict",angular.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,n){var r=e.$watch(t.mwlCollapseFallback,function(e){e?n.addClass("ng-hide"):n.removeClass("ng-hide")}),i=e.$on("$destroy",function(){i(),r()})}]}}]),"use strict",angular.module("mwl.calendar").directive("mwlCalendarYear",function(){return{templateUrl:"src/templates/calendarYearView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var r=this,i=!0;e.$on("calendar.refreshView",function(){r.view=n.getYearView(e.events,e.currentDay),e.autoOpen&&i&&(i=!1,r.view.forEach(function(n){t(e.currentDay).startOf("month").isSame(n.date)&&r.monthClicked(n,!0)}))}),r.monthClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),r.openRowIndex=null;var i=r.view.indexOf(t);i===r.openMonthIndex?r.openMonthIndex=null:(r.openMonthIndex=i,r.openRowIndex=Math.floor(i/4))}}],controllerAs:"vm",link:function(e,t,n,r){e.vm.calendarCtrl=r}}}),"use strict",angular.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"src/templates/calendarWeekViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{documents:"=",events:"=",currentDay:"=",onEventClick:"="},controller:["$scope","calendarHelper",function(e,t){var n=this;e.$on("calendar.refreshView",function(){n.view=t.getWeekView(e.events,e.documents,e.currentDay)})}],controllerAs:"vm",link:function(e,t,n,r){e.vm.calendarCtrl=r}}}),"use strict",angular.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"src/templates/calendarSlideBox.html",replace:!0,controller:["$scope","$sce",function(e,t){var n=this;n.$sce=t;var r=e.$watch("isOpen",function(e){n.shouldCollapse=!e}),i=e.$on("$destroy",function(){i(),r()})}],controllerAs:"vm",require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,n,r){e.isMonthView=!!r[0],e.isYearView=!!r[1]},scope:{isOpen:"=",events:"=",onEventClick:"=",editEventHtml:"=",onEditEventClick:"=",deleteEventHtml:"=",onDeleteEventClick:"="}}}),"use strict",angular.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"src/templates/calendarMonthViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",documents:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var r=this,i=!0;e.$on("calendar.refreshView",function(){r.weekDays=n.getWeekDayNames(),r.view=n.getMonthView(e.events,e.documents,e.currentDay);var s=Math.floor(r.view.length/7);r.monthOffsets=[];for(var o=0;o<s;o++)r.monthOffsets.push(o*7);e.autoOpen&&i&&(i=!1,r.view.forEach(function(n){n.inMonth&&t(e.currentDay).startOf("day").isSame(n.date)&&r.dayClicked(n,!0)}))}),r.dayClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),r.openRowIndex=null;var i=r.view.indexOf(t);i===r.openDayIndex?r.openDayIndex=null:(r.openDayIndex=i,r.openRowIndex=Math.floor(i/7))},r.highlightEvent=function(e,t){r.view.forEach(function(n){delete n.highlightClass;if(t){var r=n.events.indexOf(e)>-1;r&&(n.highlightClass="day-highlight dh-event-"+e.type)}})}}],controllerAs:"vm",link:function(e,t,n,r){e.vm.calendarCtrl=r}}}),"use strict",angular.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"src/templates/calendarDayView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",dayViewStart:"=",dayViewEnd:"=",dayViewSplit:"="},controller:["$scope","$timeout","moment","calendarHelper","calendarConfig",function(e,t,n,r,i){function a(){o=n(e.dayViewStart||"00:00","HH:mm"),u=n(e.dayViewEnd||"23:00","HH:mm"),s.dayViewSplit=parseInt(e.dayViewSplit),s.hourHeight=60/e.dayViewSplit*30,s.hours=[];var t=n(o);for(var r=0;r<=u.diff(o,"hours");r++)s.hours.push({label:t.format(i.dateFormats.hour)}),t.add(1,"hour")}var s=this,o,u;s.calendarConfig=i;var f=n.locale();e.$on("calendar.refreshView",function(){f!==n.locale()&&(f=n.locale(),a()),s.view=r.getDayView(e.events,e.currentDay,o.hours(),u.hours(),s.hourHeight)}),a()}],controllerAs:"vm"}}),"use strict",angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"src/templates/calendarCustom.html",restrict:"EA",scope:{events:"=",documents:"=",view:"=",viewTitle:"=",currentDay:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onEventClick:"&",onEditEventClick:"&",onDeleteEventClick:"&",onTimespanClick:"&",onDrillDownClick:"&",dayViewStart:"@",dayViewEnd:"@",dayViewSplit:"@"},controller:["$scope","$timeout","moment","calendarTitle","calendarDebounce",function(e,t,n,r,i){var s=this;e.events=e.events||[],e.documents=e.documents||[],s.changeView=function(t,n){e.view=t,e.currentDay=n},s.drillDown=function(t){var r=n(t).toDate(),i={year:"month",month:"day",week:"day"};e.onDrillDownClick({calendarDate:r,calendarNextView:i[e.view]})!==!1&&s.changeView(i[e.view],r)};var o=n(e.currentDay),u=angular.copy(e.view),a=i(function(){r[e.view]&&(e.viewTitle=r[e.view](e.currentDay));var t=n(e.currentDay),i=!0;o.clone().startOf(e.view).isSame(t.clone().startOf(e.view))&&!o.isSame(t)&&e.view===u&&(i=!1),o=t,u=angular.copy(e.view),i&&e.$broadcast("calendar.refreshView")},50),f=e.$watch(function(){return n.locale()},a),l=[];l.push(f),l.push(e.$watch("currentDay",a)),l.push(e.$watch("view",a)),l.push(e.$watch("events",a,!0)),l.push(e.$watch("documents",a,!0));var c=e.$on("$destroy",function(){l.forEach(function(e){e()})});l.push(c)}]}})}),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,t){function n(e,t,n){if(angular.isArray(e))for(var r=e.length;r--;)if(n(e[r],t))return!0;return!1}function r(e,t,r){return e=angular.isArray(e)?e:[],n(e,t,r)||e.push(t),e}function i(e,t,n){if(angular.isArray(e))for(var r=e.length;r--;)if(n(e[r],t)){e.splice(r,1);break}return e}function s(s,o,u){function p(e,t){s.checked=n(e,c,h)}t(o)(s);var a=e(u.checklistModel),f=a.assign,l=e(u.checklistChange),c=e(u.checklistValue)(s.$parent),h=angular.equals;u.hasOwnProperty("checklistComparator")&&(h=e(u.checklistComparator)(s.$parent)),s.$watch("checked",function(e,t){if(e===t)return;var n=a(s.$parent);e===!0?f(s.$parent,r(n,c,h)):f(s.$parent,i(n,c,h)),l&&l(s)}),angular.isFunction(s.$parent.$watchCollection)?s.$parent.$watchCollection(u.checklistModel,p):s.$parent.$watch(u.checklistModel,p,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if(e[0].tagName!=="INPUT"||t.type!=="checkbox")throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!t.checklistValue)throw"You should provide `checklist-value`.";return e.removeAttr("checklist-model"),e.attr("ng-model","checked"),s}}}]),typeof module!="undefined"&&typeof exports!="undefined"&&module.exports===exports&&(module.exports="ui.router"),function(e,t,n){function c(e,t){return f(new(f(function(){},{prototype:e})),t)}function h(e){return a(arguments,function(t){t!==e&&a(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function p(e,t){var n=[];for(var r in e.path){if(e.path[r]!==t.path[r])break;n.push(e.path[r])}return n}function d(e){if(Object.keys)return Object.keys(e);var t=[];return a(e,function(e,n){t.push(n)}),t}function v(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,r=Number(arguments[2])||0;r=r<0?Math.ceil(r):Math.floor(r),r<0&&(r+=n);for(;r<n;r++)if(r in e&&e[r]===t)return r;return-1}function m(e,t,n,r){var i=p(n,r),s,o={},u=[];for(var a in i){if(!i[a].params)continue;s=d(i[a].params);if(!s.length)continue;for(var l in s){if(v(u,s[l])>=0)continue;u.push(s[l]),o[s[l]]=e[s[l]]}}return f({},o,t)}function g(e,t,n){if(!n){n=[];for(var r in e)n.push(r)}for(var i=0;i<n.length;i++){var s=n[i];if(e[s]!=t[s])return!1}return!0}function y(e,t){var n={};return a(e,function(e){n[e]=t[e]}),n}function b(e,t){var n={};return a(e,function(e){n[e[t]]=e}),n}function w(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return a(n,function(n){n in e&&(t[n]=e[n])}),t}function E(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var r in e)v(n,r)==-1&&(t[r]=e[r]);return t}function S(e,t){var n=u(e)?[]:{};return a(e,function(e,r){n[r]=i(t)?t(e):e[t]}),n}function x(e,t){var n=u(e),r=n?[]:{};return a(e,function(e,i){t(e,i)&&(r[n?r.length:i]=e)}),r}function T(e,t){var n=u(e)?[]:{};return a(e,function(e,r){n[r]=t(e,r)}),n}function N(e,t){var i=1,u=2,l={},c=[],p=l,m=f(e.when(l),{$$promises:l,$$values:l});this.study=function(l){function S(e,n){if(w[n]===u)return;b.push(n);if(w[n]===i)throw b.splice(0,v(b,n)),new Error("Cyclic dependency: "+b.join(" -> "));w[n]=i;if(s(e))y.push(n,[function(){return t.get(e)}],c);else{var r=t.annotate(e);a(r,function(e){e!==n&&l.hasOwnProperty(e)&&S(l[e],e)}),y.push(n,e,r)}b.pop(),w[n]=u}function x(e){return o(e)&&e.then&&e.$$promises}if(!o(l))throw new Error("'invocables' must be an object");var g=d(l||{}),y=[],b=[],w={};return a(l,S),l=b=w=null,function(i,s,u){function S(){--b||(w||h(v,s.$$values),c.$$values=v,c.$$promises=c.$$promises||!0,delete c.$$inheritedValues,l.resolve(v))}function T(e){c.$$failure=e,l.reject(e)}function k(n,s,o){function h(e){f.reject(e),T(e)}function p(){if(r(c.$$failure))return;try{f.resolve(t.invoke(s,u,v)),f.promise.then(function(e){v[n]=e,S()},h)}catch(e){h(e)}}var f=e.defer(),l=0;a(o,function(e){d.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&(l++,d[e].then(function(t){v[e]=t,--l||p()},h))}),l||p(),d[n]=f.promise}x(i)&&u===n&&(u=s,s=i,i=null);if(!i)i=p;else if(!o(i))throw new Error("'locals' must be an object");if(!s)s=m;else if(!x(s))throw new Error("'parent' must be a promise returned by $resolve.resolve()");var l=e.defer(),c=l.promise,d=c.$$promises={},v=f({},i),b=1+y.length/3,w=!1;if(r(s.$$failure))return T(s.$$failure),c;s.$$inheritedValues&&h(v,E(s.$$inheritedValues,g)),f(d,s.$$promises),s.$$values?(w=h(v,E(s.$$values,g)),c.$$inheritedValues=E(s.$$values,g),S()):(s.$$inheritedValues&&(c.$$inheritedValues=E(s.$$inheritedValues,g)),s.then(S,T));for(var N=0,C=y.length;N<C;N+=3)i.hasOwnProperty(y[N])?S():k(y[N],y[N+1],y[N+2]);return c}},this.resolve=function(e,t,n,r){return this.study(e)(t,n,r)}}function C(e,t,n){this.fromConfig=function(e,t,n){return r(e.template)?this.fromString(e.template,t):r(e.templateUrl)?this.fromUrl(e.templateUrl,t):r(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return i(e)?e(t):e},this.fromUrl=function(n,r){return i(n)&&(n=n(r)),n==null?null:e.get(n,{cache:t,headers:{Accept:"text/html"}}).then(function(e){return e.data})},this.fromProvider=function(e,t,r){return n.invoke(e,null,r||{params:t})}}function L(e,t,r){function m(t,n,r,i){v.push(t);if(p[t])return p[t];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(d[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");return d[t]=new k.Param(t,n,r,i),d[t]}function g(e,t,n,r){var i=["",""],s=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return s;switch(n){case!1:i=["(",")"+(r?"?":"")];break;case!0:i=["?(",")?"];break;default:i=["("+n+"|",")?"]}return s+i[0]+t+i[1]}function y(r,i){var s,o,u,f,l,h;return s=r[2]||r[3],l=t.params[s],u=e.substring(a,r.index),o=i?r[4]:r[4]||(r[1]=="*"?".*":null),f=k.type(o||"string")||c(k.type("string"),{pattern:new RegExp(o,t.caseInsensitive?"i":n)}),{id:s,regexp:o,segment:u,type:f,cfg:l}}t=f({params:{}},o(t)?t:{});var i=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,s=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,u="^",a=0,l,h=this.segments=[],p=r?r.params:{},d=this.params=r?r.params.$$new():new k.ParamSet,v=[];this.source=e;var b,w,E;while(l=i.exec(e)){b=y(l,!1);if(b.segment.indexOf("?")>=0)break;w=m(b.id,b.type,b.cfg,"path"),u+=g(b.segment,w.type.pattern.source,w.squash,w.isOptional),h.push(b.segment),a=i.lastIndex}E=e.substring(a);var S=E.indexOf("?");if(S>=0){var x=this.sourceSearch=E.substring(S);E=E.substring(0,S),this.sourcePath=e.substring(0,a+S);if(x.length>0){a=0;while(l=s.exec(x))b=y(l,!0),w=m(b.id,b.type,b.cfg,"search"),a=i.lastIndex}}else this.sourcePath=e,this.sourceSearch="";u+=g(E)+(t.strict===!1?"/?":"")+"$",h.push(E),this.regexp=new RegExp(u,t.caseInsensitive?"i":n),this.prefix=h[0],this.$$paramNames=v}function A(e){f(this,e)}function O(){function p(e){return e!=null?e.toString().replace(/\//g,"%2F"):e}function m(e){return e!=null?e.toString().replace(/%2F/g,"/"):e}function S(){return{strict:l,caseInsensitive:e}}function N(e){return i(e)||u(e)&&i(e[e.length-1])}function C(){while(b.length){var e=b.shift();if(e.pattern)throw new Error("You cannot override a type's .pattern at runtime.");t.extend(g[e.name],w.invoke(e.def))}}function M(e){f(this,e||{})}k=this;var e=!1,l=!0,h=!1,g={},y=!0,b=[],w,E={string:{encode:p,decode:m,is:function(e){return e==null||!r(e)||typeof e=="string"},pattern:/[^/]*/},"int":{encode:p,decode:function(e){return parseInt(e,10)},is:function(e){return r(e)&&this.decode(e.toString())===e},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return parseInt(e,10)!==0},is:function(e){return e===!0||e===!1},pattern:/0|1/},date:{encode:function(e){return this.is(e)?[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-"):n},decode:function(e){if(this.is(e))return e;var t=this.capture.exec(e);return t?new Date(t[1],t[2]-1,t[3]):n},is:function(e){return e instanceof Date&&!isNaN(e.valueOf())},equals:function(e,t){return this.is(e)&&this.is(t)&&e.toISOString()===t.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:t.toJson,decode:t.fromJson,is:t.isObject,equals:t.equals,pattern:/[^/]*/},any:{encode:t.identity,decode:t.identity,equals:t.equals,pattern:/.*/}};O.$$getDefaultValue=function(e){if(!N(e.value))return e.value;if(!w)throw new Error("Injectable functions cannot be called at configuration time");return w.invoke(e.value)},this.caseInsensitive=function(t){return r(t)&&(e=t),e},this.strictMode=function(e){return r(e)&&(l=e),l},this.defaultSquashPolicy=function(e){if(!r(e))return h;if(e!==!0&&e!==!1&&!s(e))throw new Error("Invalid squash policy: "+e+". Valid policies: false, true, arbitrary-string");return h=e,e},this.compile=function(e,t){return new L(e,f(S(),t))},this.isMatcher=function(e){if(!o(e))return!1;var t=!0;return a(L.prototype,function(n,s){i(n)&&(t=t&&r(e[s])&&i(e[s]))}),t},this.type=function(e,t,n){if(!r(t))return g[e];if(g.hasOwnProperty(e))throw new Error("A type named '"+e+"' has already been defined.");return g[e]=new A(f({name:e},t)),n&&(b.push({name:e,def:n}),y||C()),this},a(E,function(e,t){g[t]=new A(f({name:t},e))}),g=c(g,{}),this.$get=["$injector",function(e){return w=e,y=!1,C(),a(E,function(e,t){g[t]||(g[t]=new A(e))}),this}],this.Param=function(t,i,a,l){function E(e){var t=o(e)?d(e):[],n=v(t,"value")===-1&&v(t,"type")===-1&&v(t,"squash")===-1&&v(t,"array")===-1;return n&&(e={value:e}),e.$$fn=N(e.value)?e.value:function(){return e.value},e}function S(e,n,r){if(e.type&&n)throw new Error("Param '"+t+"' has two type configurations.");return n?n:e.type?e.type instanceof A?e.type:new A(e.type):r==="config"?g.any:g.string}function C(){var e={array:l==="search"?"auto":!1},n=t.match(/\[\]$/)?{array:!0}:{};return f(e,n,a).array}function k(e,t){var n=e.squash;if(!t||n===!1)return!1;if(!r(n)||n==null)return h;if(n===!0||s(n))return n;throw new Error("Invalid squash policy: '"+n+"'. Valid policies: false, true, or arbitrary string")}function L(e,t,r,i){var o,a,f=[{from:"",to:r||t?n:""},{from:null,to:r||t?n:""}];return o=u(e.replace)?e.replace:[],s(i)&&o.push({from:i,to:n}),a=T(o,function(e){return e.from}),x(f,function(e){return v(a,e.from)===-1}).concat(o)}function O(){if(!w)throw new Error("Injectable functions cannot be called at configuration time");var e=w.invoke(a.$$fn);if(e!==null&&e!==n&&!c.type.is(e))throw new Error("Default value ("+e+") for parameter '"+c.id+"' is not an instance of Type ("+c.type.name+")");return e}function M(e){function t(e){return function(t){return t.from===e}}function n(e){var n=T(x(c.replace,t(e)),function(e){return e.to});return n.length?n[0]:e}return e=n(e),r(e)?c.type.$normalize(e):O()}function _(){return"{Param:"+t+" "+i+" squash: '"+y+"' optional: "+m+"}"}var c=this;a=E(a),i=S(a,i,l);var p=C();i=p?i.$asArray(p,l==="search"):i,i.name==="string"&&!p&&l==="path"&&a.value===n&&(a.value="");var m=a.value!==n,y=k(a,m),b=L(a,p,m,y);f(this,{id:t,type:i,location:l,array:p,squash:y,replace:b,isOptional:m,value:M,dynamic:n,config:a,toString:_})},M.prototype={$$new:function(){return c(this,f(new M,{$$parent:this}))},$$keys:function(){var e=[],t=[],n=this,r=d(M.prototype);while(n)t.push(n),n=n.$$parent;return t.reverse(),a(t,function(t){a(d(t),function(t){v(e,t)===-1&&v(r,t)===-1&&e.push(t)})}),e},$$values:function(e){var t={},n=this;return a(n.$$keys(),function(r){t[r]=n[r].value(e&&e[r])}),t},$$equals:function(e,t){var n=!0,r=this;return a(r.$$keys(),function(i){var s=e&&e[i],o=t&&t[i];r[i].type.equals(s,o)||(n=!1)}),n},$$validates:function(r){var i=this.$$keys(),s,o,u,a,f;for(s=0;s<i.length;s++){o=this[i[s]],u=r[i[s]];if(!(u!==n&&u!==null||!o.isOptional))break;a=o.type.$normalize(u);if(!o.type.is(a))return!1;f=o.type.encode(a);if(t.isString(f)&&!o.type.pattern.exec(f))return!1}return!0},$$parent:n},this.ParamSet=M}function M(e,o){function p(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return t!=null?t[1].replace(/\\(.)/g,"$1"):""}function d(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t[n==="$"?0:Number(n)]})}function v(e,t,n){if(!n)return!1;var i=e.invoke(t,t,{$match:n});return r(i)?i:!0}function m(r,i,o,u){function v(e,t,n){return f==="/"?e:t?f.slice(0,-1)+e:n?f.slice(1)+e:e}function m(e){function i(e){var t=e(o,r);return t?(s(t)&&r.replace().url(t),!0):!1}if(e&&e.defaultPrevented)return;var t=d&&r.url()===d;d=n;var u=a.length,f;for(f=0;f<u;f++)if(i(a[f]))return;l&&i(l)}function g(){return h=h||i.$on("$locationChangeSuccess",m),h}var f=u.baseHref(),p=r.url(),d;return c||g(),{sync:function(){m()},listen:function(){return g()},update:function(e){if(e){p=r.url();return}if(r.url()===p)return;r.url(p),r.replace()},push:function(e,t,i){var s=e.format(t||{});s!==null&&t&&t["#"]&&(s+="#"+t["#"]),r.url(s),d=i&&i.$$avoidResync?r.url():n,i&&i.replace&&r.replace()},href:function(n,i,s){if(!n.validates(i))return null;var o=e.html5Mode();t.isObject(o)&&(o=o.enabled);var u=n.format(i);s=s||{},!o&&u!==null&&(u="#"+e.hashPrefix()+u),u!==null&&i&&i["#"]&&(u+="#"+i["#"]),u=v(u,o,s.absolute);if(!s.absolute||!u)return u;var a=!o&&u?"/":"",f=r.port();return f=f===80||f===443?"":":"+f,[r.protocol(),"://",r.host(),f,a,u].join("")}}}var a=[],l=null,c=!1,h;this.rule=function(e){if(!i(e))throw new Error("'rule' must be a function");return a.push(e),this},this.otherwise=function(e){if(s(e)){var t=e;e=function(){return t}}else if(!i(e))throw new Error("'rule' must be a function");return l=e,this},this.when=function(e,t){var n,r=s(t);s(e)&&(e=o.compile(e));if(!r&&!i(t)&&!u(t))throw new Error("invalid 'handler' in when()");var a={matcher:function(e,t){return r&&(n=o.compile(t),t=["$match",function(e){return n.format(e)}]),f(function(n,r){return v(n,t,e.exec(r.path(),r.search()))},{prefix:s(e.prefix)?e.prefix:""})},regex:function(e,t){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return r&&(n=t,t=["$match",function(e){return d(n,e)}]),f(function(n,r){return v(n,t,e.exec(r.path()))},{prefix:p(e)})}},l={matcher:o.isMatcher(e),regex:e instanceof RegExp};for(var c in l)if(l[c])return this.rule(a[c](e,t));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(e){e===n&&(e=!0),c=e},this.$get=m,m.$inject=["$location","$rootScope","$injector","$browser"]}function _(e,h){function C(e){return e.indexOf(".")===0||e.indexOf("^")===0}function L(e,t){if(!e)return n;var r=s(e),i=r?e:e.name,o=C(i);if(o){if(!t)throw new Error("No reference point given for path '"+i+"'");t=L(t);var u=i.split("."),a=0,f=u.length,l=t;for(;a<f;a++){if(u[a]===""&&a===0){l=t;continue}if(u[a]==="^"){if(!l.parent)throw new Error("Path '"+i+"' not valid for state '"+t.name+"'");l=l.parent;continue}break}u=u.slice(a).join("."),i=l.name+(l.name&&u?".":"")+u}var c=b[i];return c&&(r||!r&&(c===e||c.self===e))?c:n}function A(e,t){S[e]||(S[e]=[]),S[e].push(t)}function O(e){var t=S[e]||[];while(t.length)M(t.shift())}function M(t){t=c(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}});var n=t.name;if(!s(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(b.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var r=n.indexOf(".")!==-1?n.substring(0,n.lastIndexOf(".")):s(t.parent)?t.parent:o(t.parent)&&s(t.parent.name)?t.parent.name:"";if(r&&!b[r])return A(r,t.self);for(var u in N)i(N[u])&&(t[u]=N[u](t,N.$delegates[u]));return b[n]=t,!t[x]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){(E.$current.navigable!=t||!g(e,n))&&E.transitionTo(t,e,{inherit:!0,location:!1})}]),O(n),t}function _(e){return e.indexOf("*")>-1}function D(e){var t=e.split("."),n=E.$current.name.split(".");for(var r=0,i=t.length;r<i;r++)t[r]==="*"&&(n[r]="*");return t[0]==="**"&&(n=n.slice(v(n,t[1])),n.unshift("**")),t[t.length-1]==="**"&&(n.splice(v(n,t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length!=n.length?!1:n.join("")===t.join("")}function P(e,t){return s(e)&&!r(t)?N[e]:!i(t)||!s(e)?this:(N[e]&&!N.$delegates[e]&&(N.$delegates[e]=N[e]),N[e]=t,this)}function H(e,t){return o(e)?t=e:t.name=e,M(t),this}function B(e,h,v,w,S,N,C,k,A){function B(t,n,r,i){var s=e.$broadcast("$stateNotFound",t,n,r);if(s.defaultPrevented)return C.update(),P;if(!s.retry)return null;if(i.$retry)return C.update(),H;var o=E.transition=h.when(s.retry);return o.then(function(){return o!==E.transition?O:(t.options.$retry=!0,E.transitionTo(t.to,t.toParams,t.options))},function(){return P}),C.update(),o}function F(e,n,r,s,o,f){function d(){var n=[];return a(e.views,function(r,s){var a=r.resolve&&r.resolve!==e.resolve?r.resolve:{};a.$template=[function(){return v.load(s,{view:r,locals:o.globals,params:l,notify:f.notify})||""}],n.push(S.resolve(a,o.globals,o.resolve,e).then(function(n){if(i(r.controllerProvider)||u(r.controllerProvider)){var f=t.extend({},a,o.globals);n.$$controller=w.invoke(r.controllerProvider,null,f)}else n.$$controller=r.controller;n.$$state=e,n.$$controllerAs=r.controllerAs,o[s]=n}))}),h.all(n).then(function(){return o.globals})}var l=r?n:y(e.params.$$keys(),n),c={$stateParams:l};o.resolve=S.resolve(e.resolve,c,o.resolve,e);var p=[o.resolve.then(function(e){o.globals=e})];return s&&p.push(s),h.all(p).then(d).then(function(e){return o})}var O=h.reject(new Error("transition superseded")),M=h.reject(new Error("transition prevented")),P=h.reject(new Error("transition aborted")),H=h.reject(new Error("transition failed"));return p.locals={resolve:null,globals:{$stateParams:{}}},E={params:{},current:p.self,$current:p,transition:null},E.reload=function(t){return E.transitionTo(E.current,N,{reload:t||!0,inherit:!1,notify:!0})},E.go=function(t,n,r){return E.transitionTo(t,n,f({inherit:!0,relative:E.$current},r))},E.transitionTo=function(n,i,u){i=i||{},u=f({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},u||{});var a=E.$current,d=E.params,v=a.path,g,b=L(n,u.relative),S=i["#"];if(!r(b)){var T={to:n,toParams:i,options:u},k=B(T,a.self,d,u);if(k)return k;n=T.to,i=T.toParams,u=T.options,b=L(n,u.relative);if(!r(b))throw u.relative?new Error("Could not resolve '"+n+"' from state '"+u.relative+"'"):new Error("No such state '"+n+"'")}if(b[x])throw new Error("Cannot transition to abstract state '"+n+"'");u.inherit&&(i=m(N,i||{},E.$current,b));if(!b.params.$$validates(i))return H;i=b.params.$$values(i),n=b;var A=n.path,_=0,D=A[_],P=p.locals,I=[];if(!u.reload)while(D&&D===v[_]&&D.ownParams.$$equals(i,d))P=I[_]=D.locals,_++,D=A[_];else if(s(u.reload)||o(u.reload)){if(o(u.reload)&&!u.reload.name)throw new Error("Invalid reload state object");var q=u.reload===!0?v[0]:L(u.reload);if(u.reload&&!q)throw new Error("No such reload state '"+(s(u.reload)?u.reload:u.reload.name)+"'");while(D&&D===v[_]&&D!==q)P=I[_]=D.locals,_++,D=A[_]}if(j(n,i,a,d,P,u))return S&&(i["#"]=S),E.params=i,l(E.params,N),u.location&&n.navigable&&n.navigable.url&&(C.push(n.navigable.url,i,{$$avoidResync:!0,replace:u.location==="replace"}),C.update(!0)),E.transition=null,h.when(E.current);i=y(n.params.$$keys(),i||{});if(u.notify&&e.$broadcast("$stateChangeStart",n.self,i,a.self,d).defaultPrevented)return e.$broadcast("$stateChangeCancel",n.self,i,a.self,d),C.update(),M;var R=h.when(P);for(var U=_;U<A.length;U++,D=A[U])P=I[U]=c(P),R=F(D,i,D===n,R,P,u);var z=E.transition=R.then(function(){var t,r,s;if(E.transition!==z)return O;for(t=v.length-1;t>=_;t--)s=v[t],s.self.onExit&&w.invoke(s.self.onExit,s.self,s.locals.globals),s.locals=null;for(t=_;t<A.length;t++)r=A[t],r.locals=I[t],r.self.onEnter&&w.invoke(r.self.onEnter,r.self,r.locals.globals);return S&&(i["#"]=S),E.transition!==z?O:(E.$current=n,E.current=n.self,E.params=i,l(E.params,N),E.transition=null,u.location&&n.navigable&&C.push(n.navigable.url,n.navigable.locals.globals.$stateParams,{$$avoidResync:!0,replace:u.location==="replace"}),u.notify&&e.$broadcast("$stateChangeSuccess",n.self,i,a.self,d),C.update(!0),E.current)},function(t){return E.transition!==z?O:(E.transition=null,g=e.$broadcast("$stateChangeError",n.self,i,a.self,d,t),g.defaultPrevented||C.update(),h.reject(t))});return z},E.is=function(t,i,s){s=f({relative:E.$current},s||{});var o=L(t,s.relative);return r(o)?E.$current!==o?!1:i?g(o.params.$$values(i),N):!0:n},E.includes=function(t,i,o){o=f({relative:E.$current},o||{});if(s(t)&&_(t)){if(!D(t))return!1;t=E.$current.name}var u=L(t,o.relative);return r(u)?r(E.$current.includes[u.name])?i?g(u.params.$$values(i),N,d(i)):!0:!1:n},E.href=function(t,i,s){s=f({lossy:!0,inherit:!0,absolute:!1,relative:E.$current},s||{});var o=L(t,s.relative);if(!r(o))return null;s.inherit&&(i=m(N,i||{},E.$current,o));var u=o&&s.lossy?o.navigable:o;return!u||u.url===n||u.url===null?null:C.href(u.url,y(o.params.$$keys().concat("#"),i||{}),{absolute:s.absolute})},E.get=function(e,t){if(arguments.length===0)return T(d(b),function(e){return b[e].self});var n=L(e,t||E.$current);return n&&n.self?n.self:null},E}function j(e,t,n,r,i,s){function o(e,t,n){function r(t){return e.params[t].location!="search"}var i=e.params.$$keys().filter(r),s=w.apply({},[e.params].concat(i)),o=new k.ParamSet(s);return o.$$equals(t,n)}if(!s.reload&&e===n&&(i===n.locals||e.self.reloadOnSearch===!1&&o(n,r,t)))return!0}var p,b={},E,S={},x="abstract",N={parent:function(e){if(r(e.parent)&&e.parent)return L(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?L(t[1]):p},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=f({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url,n={params:e.params||{}};if(s(t))return t.charAt(0)=="^"?h.compile(t.substring(1),n):(e.parent.navigable||p).url.concat(t,n);if(!t||h.isMatcher(t))return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},ownParams:function(e){var t=e.url&&e.url.params||new k.ParamSet;return a(e.params||{},function(e,n){t[n]||(t[n]=new k.Param(n,null,e,"config"))}),t},params:function(e){return e.parent&&e.parent.params?f(e.parent.params.$$new(),e.ownParams):new k.ParamSet},views:function(e){var t={};return a(r(e.views)?e.views:{"":e},function(n,r){r.indexOf("@")<0&&(r+="@"+e.parent.name),t[r]=n}),t},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?f({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};p=M({name:"",url:"^",views:null,"abstract":!0}),p.navigable=null,this.decorator=P,this.state=H,this.$get=B,B.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter","$location","$urlMatcherFactory"]}function D(){function e(e,t){return{load:function(r,i){var s,o={template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}};return i=f(o,i),i.view&&(s=t.fromConfig(i.view,i.params,i.locals)),s&&i.notify&&e.$broadcast("$viewContentLoading",i),s}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function P(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){return n(function(){e[0].scrollIntoView()},0,!1)}}]}function H(e,n,r,i){function s(){return n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(t){return null}}}function f(e,t){var n=function(){return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}};if(a)return{enter:function(e,t,n){var r=a.enter(e,null,t,n);r&&r.then&&r.then(n)},leave:function(e,t){var n=a.leave(e,t);n&&n.then&&n.then(t)}};if(u){var r=u&&u(t,e);return{enter:function(e,t,n){r.enter(e,null,t),n()},leave:function(e,t){r.leave(e),t()}}}return n()}var o=s(),u=o("$animator"),a=o("$animate"),l={restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,s,o){return function(n,s,u){function m(){a&&(a.remove(),a=null),c&&(c.$destroy(),c=null),l&&(v.leave(l,function(){a=null}),a=l,l=null)}function g(a){var f,g=j(n,u,s,i),y=g&&e.$current&&e.$current.locals[g];if(!a&&y===h)return;f=n.$new(),h=e.$current.locals[g];var b=o(f,function(e){v.enter(e,s,function(){c&&c.$emit("$viewContentAnimationEnded"),(t.isDefined(d)&&!d||n.$eval(d))&&r(e)}),m()});l=b,c=f,c.$emit("$viewContentLoaded"),c.$eval(p)}var a,l,c,h,p=u.onload||"",d=u.autoscroll,v=f(u,n);n.$on("$stateChangeSuccess",function(){g(!1)}),n.$on("$viewContentLoading",function(){g(!1)}),g(!0)}}};return l}function B(e,t,n,r){return{restrict:"ECA",priority:-400,compile:function(i){var s=i.html();return function(i,o,u){var a=n.$current,f=j(i,u,o,r),l=a&&a.locals[f];if(!l)return;o.data("$uiView",{name:f,state:l.$$state}),o.html(l.$template?l.$template:s);var c=e(o.contents());if(l.$$controller){l.$scope=i,l.$element=o;var h=t(l.$$controller,l);l.$$controllerAs&&(i[l.$$controllerAs]=h),o.data("$ngControllerController",h),o.children().data("$ngControllerController",h)}c(i)}}}}function j(e,t,n,r){var i=r(t.uiView||t.name||"")(e),s=n.inheritedData("$uiView");return i.indexOf("@")>=0?i:i+"@"+(s?s.state.name:"")}function F(e,t){var n=e.match(/^\s*({[^}]*})\s*$/),r;n&&(e=t+"("+n[1]+")"),r=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!r||r.length!==4)throw new Error("Invalid state ref '"+e+"'");return{state:r[1],paramExpr:r[3]||null}}function I(e){var t=e.parent().inheritedData("$uiView");if(t&&t.state&&t.state.name)return t.state}function q(e,n){var r=["location","inherit","reload","absolute"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(i,s,o,u){var a=F(o.uiSref,e.current.name),f=null,l=null,c=I(s)||e.$current,h=Object.prototype.toString.call(s.prop("href"))==="[object SVGAnimatedString]"?"xlink:href":"href",p=null,d=s.prop("tagName").toUpperCase()==="A",v=s[0].nodeName==="FORM",m=v?"action":h,g=!0,y={relative:c,inherit:!0},b=i.$eval(o.uiSrefOpts)||{};t.forEach(r,function(e){e in b&&(y[e]=b[e])});var w=function(n){n&&(f=t.copy(n));if(!g)return;p=e.href(a.state,f,y);var r=u[1]||u[0];r&&r.$$addStateInfo(a.state,f);if(p===null)return g=!1,!1;o.$set(m,p)};a.paramExpr&&(i.$watch(a.paramExpr,function(e,t){e!==f&&w(e)},!0),f=t.copy(i.$eval(a.paramExpr))),w();if(v)return;s.bind("click",function(t){var r=t.which||t.button;if(!(r>1||t.ctrlKey||t.metaKey||t.shiftKey||s.attr("target"))){var i=n(function(){e.go(a.state,f,y)});t.preventDefault();var o=d&&!p?1:0;t.preventDefault=function(){o--<=0&&n.cancel(i)}}})}}}function R(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,r,i){function u(){a()?r.addClass(o):r.removeClass(o)}function a(){for(var e=0;e<s.length;e++)if(f(s[e].state,s[e].params))return!0;return!1}function f(t,n){return typeof i.uiSrefActiveEq!="undefined"?e.is(t.name,n):e.includes(t.name,n)}var s=[],o;o=n(i.uiSrefActiveEq||i.uiSrefActive||"",!1)(t),this.$$addStateInfo=function(t,n){var i=e.get(t,I(r));s.push({state:i||{name:t},params:n}),u()},t.$on("$stateChangeSuccess",u)}]}}function U(e){var t=function(t){return e.is(t)};return t.$stateful=!0,t}function z(e){var t=function(t){return e.includes(t)};return t.$stateful=!0,t}var r=t.isDefined,i=t.isFunction,s=t.isString,o=t.isObject,u=t.isArray,a=t.forEach,f=t.extend,l=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),N.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",N),C.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",C);var k;L.prototype.concat=function(e,t){var n={caseInsensitive:k.caseInsensitive(),strict:k.strictMode(),squash:k.defaultSquashPolicy()};return new L(this.sourcePath+e+this.sourceSearch,f(n,t),this)},L.prototype.toString=function(){return this.source},L.prototype.exec=function(e,t){function c(e){function t(e){return e.split("").reverse().join("")}function n(e){return e.replace(/\\-/g,"-")}var r=t(e).split(/-(?!\\)/),i=T(r,t);return T(i,n).reverse()}var n=this.regexp.exec(e);if(!n)return null;t=t||{};var r=this.parameters(),i=r.length,s=this.segments.length-1,o={},u,a,f,l;if(s!==n.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(u=0;u<s;u++){l=r[u];var h=this.params[l],p=n[u+1];for(a=0;a<h.replace;a++)h.replace[a].from===p&&(p=h.replace[a].to);p&&h.array===!0&&(p=c(p)),o[l]=h.value(p)}for(;u<i;u++)l=r[u],o[l]=this.params[l].value(t[l]);return o},L.prototype.parameters=function(e){return r(e)?this.params[e]||null:this.$$paramNames},L.prototype.validates=function(e){return this.params.$$validates(e)},L.prototype.format=function(e){function c(e){return encodeURIComponent(e).replace(/-/g,function(e){return"%5C%"+e.charCodeAt(0).toString(16).toUpperCase()})}e=e||{};var t=this.segments,n=this.parameters(),r=this.params;if(!this.validates(e))return null;var i,o=!1,a=t.length-1,f=n.length,l=t[0];for(i=0;i<f;i++){var h=i<a,p=n[i],d=r[p],v=d.value(e[p]),m=d.isOptional&&d.type.equals(d.value(),v),g=m?d.squash:!1,y=d.type.encode(v);if(h){var b=t[i+1];if(g===!1)y!=null&&(u(y)?l+=T(y,c).join("-"):l+=encodeURIComponent(y)),l+=b;else if(g===!0){var w=l.match(/\/$/)?/\/?(.*)/:/(.*)/;l+=b.match(w)[1]}else s(g)&&(l+=g+b)}else{if(y==null||m&&g!==!1)continue;u(y)||(y=[y]),y=T(y,encodeURIComponent).join("&"+p+"="),l+=(o?"&":"?")+(p+"="+y),o=!0}}return l},A.prototype.is=function(e,t){return!0},A.prototype.encode=function(e,t){return e},A.prototype.decode=function(e,t){return e},A.prototype.equals=function(e,t){return e==t},A.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)},A.prototype.pattern=/.*/,A.prototype.toString=function(){return"{Type:"+this.name+"}"},A.prototype.$normalize=function(e){return this.is(e)?e:this.decode(e)},A.prototype.$asArray=function(e,t){function i(e,t){function i(e,t){return function(){return e[t].apply(e,arguments)}}function s(e){return u(e)?e:r(e)?[e]:[]}function o(e){switch(e.length){case 0:return n;case 1:return t==="auto"?e[0]:e;default:return e}}function a(e){return!e}function f(e,t){return function(r){r=s(r);var i=T(r,e);return t===!0?x(i,a).length===0:o(i)}}function l(e){return function(n,r){var i=s(n),o=s(r);if(i.length!==o.length)return!1;for(var u=0;u<i.length;u++)if(!e(i[u],o[u]))return!1;return!0}}this.encode=f(i(e,"encode")),this.decode=f(i(e,"decode")),this.is=f(i(e,"is"),!0),this.equals=l(i(e,"equals")),this.pattern=e.pattern,this.$normalize=f(i(e,"$normalize")),this.name=e.name,this.$arrayMode=t}if(!e)return this;if(e==="auto"&&!t)throw new Error("'auto' array mode is for query parameters only");return new i(this,e)},t.module("ui.router.util").provider("$urlMatcherFactory",O),t.module("ui.router.util").run(["$urlMatcherFactory",function(e){}]),M.$inject=["$locationProvider","$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",M),_.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",_),D.$inject=[],t.module("ui.router.state").provider("$view",D),t.module("ui.router.state").provider("$uiViewScroll",P),H.$inject=["$state","$injector","$uiViewScroll","$interpolate"],B.$inject=["$compile","$controller","$state","$interpolate"],t.module("ui.router.state").directive("uiView",H),t.module("ui.router.state").directive("uiView",B),q.$inject=["$state","$timeout"],R.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",q).directive("uiSrefActive",R).directive("uiSrefActiveEq",R),U.$inject=["$state"],z.$inject=["$state"],t.module("ui.router.state").filter("isState",U).filter("includedByState",z)}(window,window.angular),define("tasks-assignments/modules/run",["common/angular","common/ui-select","common/modules/xeditable-civi","tasks-assignments/vendor/angular-bootstrap-calendar","tasks-assignments/vendor/angular-checklist-model","tasks-assignments/vendor/angular-router","tasks-assignments/modules/config","tasks-assignments/modules/settings","common/modules/routers/compu-ui-router","common/filters/angular-date/format-date","common/directives/angular-date/date-input","common/directives/prevent-animations"],function(e){"use strict";e.module("civitasks.run",["angularFileUpload","ngResource","ngAnimate","ngSanitize","compu.ui.router","ui.select","mwl.calendar","textAngular","checklist-model","civitasks.config","civitasks.controllers","civitasks.directives","civitasks.filters","civitasks.services","civitasks.settings","xeditable","xeditable-civi","common.angularDate","common.directives"]).run(["config","settings","$rootScope","$rootElement","$q","$location","DocumentService","TaskService","AssignmentService","KeyDateService","ContactService","editableOptions","$log",function(t,n,r,i,s,o,u,a,f,l,c,h,p){p.debug("civitasks.run"),r.pathTpl=t.path.TPL,r.permissions=t.permissions,r.prefix=t.CLASS_NAME_PREFIX,r.url=t.url,r.location=o,r.settings=n,r.cache={contact:{obj:{},arr:[],addSearch:[]},assignment:{obj:{},arr:[],arrSearch:[]},assignmentType:{obj:{},arr:[]},dateType:{obj:{period_start_date:"Contract Start Date",period_end_date:"Contract End Date",birth_date:"Birthday",probation_end_date:"Probation End Date"},arr:[]},documentType:{obj:{},arr:[]},documentStatus:{obj:{},arr:[]},documentStatusResolve:t.status.resolve.DOCUMENT,taskType:{obj:{},arr:[]},taskStatus:{obj:{},arr:[]},taskStatusResolve:t.status.resolve.TASK},a.getOptions().then(function(t){e.extend(r.cache,t)}),u.getOptions().then(function(t){e.extend(r.cache,t)}),f.getTypes().then(function(t){e.extend(r.cache.assignmentType.obj,t),e.forEach(t,function(e){this.push(e)},r.cache.assignmentType.arr)}),c.get({IN:[t.LOGGED_IN_CONTACT_ID]}).then(function(e){c.updateCache(e)}),e.forEach(r.cache.dateType.obj,function(e,t){this.push({key:t,value:e})},r.cache.dateType.arr),r.$on("$stateChangeSuccess",function(){i.removeClass("ct-page-loading")}),h.theme="bs3"}])}),define("tasks-assignments/modules/app-dashboard",["common/angular","common/moment","common/services/angular-date/date-format","tasks-assignments/modules/run"],function(e,t){"use strict";e.module("civitasks.appDashboard",["civitasks.run"]).config(["config","$resourceProvider","$httpProvider","$logProvider","$urlRouterProvider","$stateProvider","calendarConfigProvider","uibDatepickerConfig","uiSelectConfig",function(n,r,i,s,o,u,a,f,l){s.debugEnabled(n.DEBUG),o.otherwise("/tasks"),u.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).state("tasks",{url:"/tasks",controller:"TaskListCtrl",templateUrl:n.path.TPL+"dashboard/tasks.html?v="+(new Date).getTime(),resolve:{taskList:["$q","TaskService",function(t,r){var i=t.defer();return t.all([r.get({sequential:0,assignee_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.TASK}}),r.get({sequential:0,source_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.TASK}})]).then(function(t){var n,r=[];e.extend(t[0],t[1]);for(n in t[0])r.push(t[0][n]);i.resolve(r)}),i.promise}]}}).state("tasks.my",{url:"/my",params:{userRole:{field:"assignee_contact_id",isEqual:!0}}}).state("tasks.delegated",{url:"/delegated",params:{userRole:{field:"assignee_contact_id",isEqual:!1}}}).state("tasks.all",{url:"/all",params:{userRole:{field:null,isEqual:null}}}).state("documents",{url:"/documents",controller:"DocumentListCtrl",templateUrl:n.path.TPL+"dashboard/documents.html?v=8",resolve:{documentList:["$q","DocumentService",function(t,r){var i=t.defer();return t.all([r.get({sequential:0,assignee_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.DOCUMENT}}),r.get({sequential:0,source_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.DOCUMENT}})]).then(function(t){var n,r=[];e.extend(t[0],t[1]);for(n in t[0])r.push(t[0][n]);i.resolve(r)}),i.promise}]}}).state("documents.my",{url:"/my",params:{userRole:{field:"assignee_contact_id",isEqual:!0}}}).state("documents.delegated",{url:"/delegated",params:{userRole:{field:"assignee_contact_id",isEqual:!1}}}).state("documents.all",{url:"/all",params:{userRole:{field:null,isEqual:null}}}).state("assignments",{url:"/assignments",controller:"ExternalPageCtrl",templateUrl:n.path.TPL+"dashboard/assignments.html?v=5"}).state("calendar",{"abstract":!0,controller:"CalendarCtrl",templateUrl:n.path.TPL+"dashboard/calendar.html?v=3",resolve:{documentList:["$q","DocumentService","settings",function(t,r,i){var s=t.defer();return+i.tabEnabled.documents||s.resolve([]),t.all([r.get({sequential:0,assignee_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.DOCUMENT}}),r.get({sequential:0,source_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.DOCUMENT}})]).then(function(t){var n,r=[];e.extend(t[0],t[1]);for(n in t[0])r.push(t[0][n]);s.resolve(r)}),s.promise}],taskList:["$q","TaskService",function(t,r){var i=t.defer();return t.all([r.get({sequential:0,assignee_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.TASK}}),r.get({sequential:0,source_contact_id:n.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":n.status.resolve.TASK}})]).then(function(t){var n,r=[];e.extend(t[0],t[1]);for(n in t[0])r.push(t[0][n]);i.resolve(r)}),i.promise}]}}).state("calendar.mwl",{url:"/calendar",views:{documentList:{controller:"DocumentListCtrl",templateUrl:n.path.TPL+"dashboard/calendar.documentList.html?v=6"},taskList:{controller:"TaskListCtrl",templateUrl:n.path.TPL+"dashboard/calendar.taskList.html?v=5"}}}).state("calendar.mwl.day",{params:{calendarView:"day"}}).state("calendar.mwl.month",{params:{calendarView:"month"}}).state("calendar.mwl.week",{params:{calendarView:"week"}}).state("reports",{url:"/reports",controller:"ExternalPageCtrl",templateUrl:n.path.TPL+"dashboard/reports.html?v=4"}).state("keyDates",{url:"/key-dates",controller:"DateListCtrl",templateUrl:n.path.TPL+"dashboard/key-dates.html?v=4",resolve:{contactList:["KeyDateService",function(e){return e.get(t().startOf("month"),t().endOf("month"))}]}}),r.defaults.stripTrailingSlashes=!1,i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",a.setDateFormats({weekDay:"ddd"}),f.showWeeks=!1,l.theme="bootstrap"}])}),define("tasks-assignments/modules/app-documents",["tasks-assignments/modules/run"],function(){"use strict";angular.module("civitasks.appDocuments",["civitasks.run"]).config(["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,r,i,s,o,u){u.debugEnabled(e.DEBUG),t.otherwise("/"),n.state("main",{url:"/",controller:"DocumentListCtrl",templateUrl:e.path.TPL+"contact/documents.html?v=4",resolve:{documentList:["DocumentService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.DOCUMENT}})}]}}),r.defaults.stripTrailingSlashes=!1,i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",s.showWeeks=!1,o.theme="bootstrap"}])}),define("tasks-assignments/modules/app-tasks",["tasks-assignments/modules/run"],function(){"use strict";angular.module("civitasks.appTasks",["civitasks.run"]).config(["config","$urlRouterProvider","$stateProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,r,i,s,o,u){u.debugEnabled(e.DEBUG),t.otherwise("/"),n.state("main",{url:"/",controller:"TaskListCtrl",templateUrl:e.path.TPL+"contact/tasks.html?v=222",resolve:{taskList:["TaskService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.TASK}})}]}}),r.defaults.stripTrailingSlashes=!1,i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",s.showWeeks=!1,o.theme="bootstrap"}])}),define("tasks-assignments/modules/app-settings",["tasks-assignments/modules/run"],function(){"use strict";angular.module("civitasks.appSettings",["civitasks.run"]).config(["config","$stateProvider","$urlRouterProvider","$resourceProvider","$httpProvider","uibDatepickerConfig","uiSelectConfig","$logProvider",function(e,t,n,r,i,s,o,u){u.debugEnabled(e.DEBUG),n.otherwise("/"),t.state("settings",{url:"/",controller:"SettingsCtrl",templateUrl:e.path.TPL+"settings.html?v=5"}),r.defaults.stripTrailingSlashes=!1,i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",s.showWeeks=!1,o.theme="bootstrap"}])}),define("tasks-assignments/controllers/controllers",["common/angular"],function(e){"use strict";return e.module("civitasks.controllers",[])}),define("tasks-assignments/services/services",["common/angular"],function(e){"use strict";return e.module("civitasks.services",[])}),define("tasks-assignments/services/utils",["tasks-assignments/services/services"],function(e){"use strict";e.factory("UtilsService",["config","$q","$log","$rootScope",function(e,t,n){return n.debug("Service: UtilsService"),{errorHandler:function(e,t,r){var i="",s=t||"Unknown Error";if(e.is_error)return i=e.error_code||i,s=e.error_message||s,n.error(i+"\n"+s),r&&r.reject(i+"\n"+s),e.trace&&n.error(e.trace),!0;if(!e.values)return n.error(s),r&&r.reject(s),!0}}}])}),define("tasks-assignments/services/task",["common/angular","common/moment","tasks-assignments/services/services","tasks-assignments/services/utils"],function(e,t,n){"use strict";n.factory("Task",["$resource","config","$log",function(e,t,n){return n.debug("Service: Task"),e(t.url.REST,{action:"get",entity:"Task",json:{}})}]),n.factory("TaskService",["Task","$q","config","UtilsService","$log",function(n,r,i,s,o){return o.debug("Service: TaskService"),{assign:function(t,o){if(!t||!e.isArray(t)||!o||typeof +o!="number")return null;if(!t.length)return t;var u=r.defer();return n.save({action:"copy_to_assignment",json:{sequential:1,debug:i.DEBUG,id:t,case_id:o}},null,function(e){if(s.errorHandler(e,"Unable to assign tasks",u))return;u.resolve(e.values)},function(){u.reject("Unable to assign tasks")}),u.promise},get:function(t){var i=r.defer();return t=t&&typeof t=="object"?t:{},t=e.extend({component:"CiviTask",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1","return":"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id"},t),n.get({json:t},function(e){i.resolve(e.values)},function(){i.reject("Unable to fetch tasks list")}),i.promise},getOptions:function(){var e=r.defer(),t=r.defer(),i=r.defer(),s={arr:[],obj:{}},o={arr:[],obj:{}};return n.get({action:"getoptions",json:{field:"activity_type_id"}},function(e){var n;for(n in e.values)s.arr.push({key:n,value:e.values[n]});s.obj=e.values,t.resolve(s)}),n.get({action:"getoptions",json:{field:"status_id"}},function(e){var t;for(t in e.values)o.arr.push({key:t,value:e.values[t]});o.obj=e.values,i.resolve(o)}),r.all({taskType:t.promise,taskStatus:i.promise}).then(function(t){e.resolve(t)}),e.promise},save:function(o){if(!o||typeof o!="object")return null;o.activity_date_time instanceof Date&&(o.activity_date_time=t(o.activity_date_time.getTime()).format("YYYY-MM-DD"));var u=r.defer(),a=e.extend({sequential:1,debug:i.DEBUG},o),f;return n.save({action:"create",json:a},null,function(e){if(s.errorHandler(e,"Unable to save task",u))return;f=e.values,u.resolve(f.length==1?f[0]:null)},function(){u.reject("Unable to save task")}),u.promise},saveMultiple:function(o){if(!o||!e.isArray(o))return null;if(!o.length)return o;o.forEach(function(e){e.activity_date_time instanceof Date&&(e.activity_date_time=t(e.activity_date_time.getTime()).format("YYYY-MM-DD"))});var u=r.defer();return n.save({action:"create_multiple",json:{sequential:1,debug:i.DEBUG,task:o}},null,function(e){if(s.errorHandler(e,"Unable to save tasks",u))return;u.resolve(e.values)},function(){u.reject("Unable to save tasks")}),u.promise},sendReminder:function(e,t){if(!e||typeof +e!="number")return null;var o=r.defer();return n.save({action:"sendreminder",json:{sequential:1,debug:i.DEBUG,activity_id:e,notes:t||""}},null,function(e){if(s.errorHandler(e,"Unable to send a reminder",o))return;o.resolve(e)},function(){o.reject("Unable to send a reminder")}),o.promise},"delete":function(e){if(!e||typeof +e!="number")return null;var t=r.defer();return n.delete({action:"delete",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete task ID: "+e)}),t.promise}}}])}),define("tasks-assignments/controllers/calendar",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/task"],function(e,t){"use strict";t.controller("CalendarCtrl",["$scope","$log","$rootScope","$filter","$timeout","$state","$stateParams","taskList","documentList","settings",function(t,n,r,i,s,o,u,a,f,l){function c(t,n,r,i,s){var o,u,a=t.id,f,l=n.id,c=r.length,h=0;if(l)for(;h<c;h++)+r[h].id==+l&&(r.splice(h,1),h--,c--);a&&(o=e(t.activity_date_time).toDate(),u=i[t.activity_type_id],r.push({id:a,title:u,type:s,startsAt:o,endsAt:o,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),!t.expire_date||(f=e(t.expire_date).toDate(),+f!=+o&&r.push({id:a,title:u,type:s,startsAt:f,endsAt:f,editable:!1,deletable:!1,incrementsBadgeTotal:!0})))}this.init=function(){t.calTaskList=this.createCalEventList("task",a,r.cache.taskType.obj);if(!+l.tabEnabled.documents)return;t.calDocList=this.createCalEventList("document",f,r.cache.documentType.obj)},this.createCalEventList=function(t,n,r){var i=[];return angular.forEach(n,function(n){n.activity_date_time=e(n.activity_date_time).toDate(),this.push({id:n.id,title:r[n.activity_type_id],type:t,startsAt:n.activity_date_time,endsAt:n.activity_date_time,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),!n.expire_date||(n.expire_date=e(n.expire_date).toDate(),+n.expire_date!=+n.activity_date_time&&this.push({id:n.id,title:r[n.activity_type_id],type:t,startsAt:n.expire_date,endsAt:n.expire_date,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))},i),i},t.calendarDay=new Date,t.calendarTitle="",t.calendarView=o.params.calendarView||"month",t.calTaskList=[],t.calDocList=[],t.displayDayView=function(n){t.calendarDay=e(n).toDate(),t.calendarView="day"},t.$on("taskDelete",function(e,n){c({},{id:n},t.calTaskList)}),t.$on("taskFormSuccess",function(e,n,i){var s=r.cache.taskStatusResolve.indexOf(n.status_id)>-1;c(s?{}:n,i,t.calTaskList,r.cache.taskType.obj,"task")}),t.$on("documentDelete",function(e,n){c({},{id:n},t.calDocList)}),t.$on("documentFormSuccess",function(e,n,i){var s=r.cache.documentStatusResolve.indexOf(n.status_id)>-1;c(s?{}:n,i,t.calDocList,r.cache.documentType.obj,"document")}),t.$on("assignmentFormSuccess",function(e,n){Array.prototype.push.apply(t.calTaskList,this.createCalEventList("task",n.taskList,r.cache.taskType.obj));if(!+l.tabEnabled.documents)return;Array.prototype.push.apply(t.calDocList,this.createCalEventList("document",n.documentList,r.cache.documentType.obj))}.bind(this)),this.init()}])}),+define("tasks-assignments/services/key-date",["common/moment","tasks-assignments/services/services","tasks-assignments/services/utils"],function(e,t){"use strict";t.factory("KeyDate",["$resource","config","$log",function(e,t,n){return n.debug("Service: KeyDate"),e(t.url.REST,{action:"get",entity:"KeyDates",json:{}})}]),t.factory("KeyDateService",["KeyDate","$q","config","UtilsService","$log",function(t,n,r,i,s){return s.debug("Service: KeyDateService"),{get:function(r,i){var s=n.defer();return!r||!i?null:(r=r?e(r).format("YYYY-MM-DD"):null,i=i?e(i).format("YYYY-MM-DD"):null,t.get({json:{start_date:r,end_date:i}},function(e){s.resolve(e.values)},function(){s.reject("Unable to fetch documents list")}),s.promise)}}}])}),define("tasks-assignments/services/contact",["tasks-assignments/services/services","tasks-assignments/services/utils"],function(e){"use strict";e.factory("ContactService",["$resource","config","$q","$filter","$rootScope","UtilsService","$log",function(e,t,n,r,i,s,o){o.debug("Service: ContactService");var u=e(t.url.REST,{action:"get",entity:"contact",json:{}});return{get:function(e){if(!e||typeof +e!="number"&&typeof e!="object")return null;var r=n.defer();return u.get({json:{id:e,"return":"display_name, sort_name, id, contact_id, contact_type, email",debug:t.DEBUG}},function(e){if(s.errorHandler(e,"Unable to fetch contacts",r))return;r.resolve(e.values)},function(){r.reject("Unable to fetch contact")}),r.promise},search:function(e,t){if(i&&typeof i!="object")return null;var r=n.defer(),i={};return angular.extend(i,t),i.display_name=e,i.return="display_name, contact_id, contact_type, email",u.get({action:"get",json:i},function(e){if(s.errorHandler(e,"Unable to fetch contact list",r))return;var t=[];for(var n in e.values)t.push({label:e.values[n].display_name,description:[e.values[n].email],id:e.values[n].contact_id,icon_class:e.values[n].contact_type});r.resolve(t)},function(){r.reject("Unable to fetch contact list")}),r.promise},updateCache:function(e){var t=i.cache.contact.obj||{},n=[],s=[],o,u;angular.extend(t,e);for(u in t)o=t[u],n.push(o),s.push({description:o.email?[o.email]:[],label:o.display_name,icon_class:o.contact_type,id:o.contact_id});n=r("orderBy")(n,"sort_name"),s=r("orderBy")(s,"label"),i.cache.contact={arr:n,obj:t,arrSearch:s}}}}])}),define("tasks-assignments/controllers/date-list",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/key-date","tasks-assignments/services/contact"],function(e,t){"use strict";t.controller("DateListCtrl",["$scope","$uibModal","$rootElement","$rootScope","$filter","$log","$timeout","contactList","KeyDateService","config",function(t,n,r,i,s,o,u,a,f,l){function c(){t.$watch("filterParams.dateRange.from",function(e){t.datepickerOptions.until.minDate=e}),t.$watch("filterParams.dateRange.until",function(e){t.datepickerOptions.from.maxDate=e})}o.debug("Controller: DateListCtrl"),this.init=function(){t.dateList=this.createDateList(a),i.$broadcast("ct-spinner-hide"),f.get(e().startOf("year"),e().endOf("year")).then(function(e){t.dateList=this.createDateList(e),t.dataLoading=!1}.bind(this)),c()},this.createDateList=function(e){var t=0,n=e.length,r,i={},s=[];for(;t<n;t++)i[e[t].keydate]=i[e[t].keydate]||[],i[e[t].keydate].push(e[t]);for(r in i)s.push({date:r,dateContactList:i[r]});return s},t.dataLoading=!0,t.dateList=[],t.dateListLimit=5,t.dateListSelected=[],t.dpOpened={filterDates:{}},t.isCollapsed={filterDates:!0},t.filterParams={dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()},date:"month",dateType:[]},t.datepickerOptions={from:{maxDate:t.filterParams.dateRange.until},until:{minDate:t.filterParams.dateRange.from}},t.label={isoWeek:"Week",month:"Month",year:"Year",dateRange:""},t.csvExport=function(){var n,r;t.filterParams.date=="dateRange"?(n=t.filterParams.dateRange.from?e(t.filterParams.dateRange.from).format("YYYY-MM-DD"):"",r=t.filterParams.dateRange.until?e(t.filterParams.dateRange.until).format("YYYY-MM-DD"):""):(n=e().startOf(t.filterParams.date).format("YYYY-MM-DD"),r=e().endOf(t.filterParams.date).format("YYYY-MM-DD")),window.location.href=l.url.CSV_EXPORT+"/keydatescsv?start_date="+n+"&end_date="+r},t.labelDateRange=function(e,n){var r=s("date")(e,"dd/MM/yyyy")||"",i=s("date")(n,"dd/MM/yyyy")||"";i&&(i=r?" - "+i:"Until: "+i),r&&(r=i?r:"From: "+r),t.label.dateRange=r+i},t.showDateRange=function(n,r){t.$broadcast("ct-spinner-show","dateList"),f.get(e(n),e(r)).then(function(e){t.dateListSelected=this.createDateList(e),t.filterParams.date="dateRange",t.$broadcast("ct-spinner-hide","dateList")}.bind(this))}.bind(this),this.init()}])}),+define("tasks-assignments/services/document",["tasks-assignments/services/services","tasks-assignments/services/utils"],function(e){"use strict";e.factory("Document",["$resource","config","$log",function(e,t,n){return n.debug("Service: Document"),e(t.url.REST,{action:"get",entity:"Document",json:{}})}]),e.factory("DocumentService",["Document","$q","config","UtilsService","$log",function(e,t,n,r,i){return i.debug("Service: DocumentService"),{assign:function(i,s){if(!i||!angular.isArray(i)||!s||typeof +s!="number")return null;if(!i.length)return i;var o=t.defer();return e.save({action:"copy_to_assignment",json:{sequential:1,debug:n.DEBUG,id:i,case_id:s}},null,function(e){if(r.errorHandler(e,"Unable to assign documents",o))return;o.resolve(e.values)},function(){o.reject("Unable to assign documents")}),o.promise},get:function(n){var r=t.defer();return n=n&&typeof n=="object"?n:{},n=angular.extend({component:"CiviDocument",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1","return":"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id, expire_date"},n),e.get({json:n},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch documents list")}),r.promise},getOptions:function(){var n=t.defer(),r=t.defer(),i=t.defer(),s={arr:[],obj:{}},o={arr:[],obj:{}};return e.get({action:"getoptions",json:{field:"activity_type_id"}},function(e){var t;for(t in e.values)s.arr.push({key:t,value:e.values[t]});s.obj=e.values,r.resolve(s)}),e.get({action:"getoptions",json:{field:"status_id"}},function(e){var t;for(t in e.values)o.arr.push({key:t,value:e.values[t]});o.obj=e.values,i.resolve(o)}),t.all({documentType:r.promise,documentStatus:i.promise}).then(function(e){n.resolve(e)}),n.promise},save:function(i){if(!i||typeof i!="object")return null;var s=t.defer(),o=angular.extend({sequential:1,debug:n.DEBUG},i),u;return e.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to save document",s))return;u=e.values,s.resolve(u.length==1?u[0]:null)},function(){s.reject("Unable to save document")}),s.promise},saveMultiple:function(i){if(!i||!angular.isArray(i))return null;if(!i.length)return i;var s=t.defer();return e.save({action:"create_multiple",json:{sequential:1,debug:n.DEBUG,document:i}},null,function(e){if(r.errorHandler(e,"Unable to save documents",s))return;s.resolve(e.values)},function(){s.reject("Unable to save documents")}),s.promise},sendReminder:function(i,s){if(!i||typeof +i!="number")return null;var o=t.defer();return e.save({action:"sendreminder",json:{sequential:1,debug:n.DEBUG,activity_id:i,notes:s||""}},null,function(e){if(r.errorHandler(e,"Unable to send a reminder",o))return;o.resolve(e)},function(){o.reject("Unable to send a reminder")}),o.promise},"delete":function(n){if(!n||typeof +n!="number")return null;var r=t.defer();return e.delete({action:"delete",json:{id:n}},function(e){r.resolve(e)},function(){r.reject("Could not delete document ID: "+n)}),r.promise}}}])}),define("tasks-assignments/services/file",["tasks-assignments/services/services","tasks-assignments/services/utils"],function(e){"use strict";e.factory("FileService",["$resource","config","$q","UtilsService","FileUploader","$log",function(e,t,n,r,i,s){s.debug("Service: FileService");var o=e(t.url.FILE+"/:action");return i.prototype.queueDelete=[],{"delete":function(e,t,i){if(!e||typeof +e!="number"||!t||typeof +t!="number"||!i||typeof i!="string")return null;var s=n.defer();return o.save({action:"delete",entityTable:i,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1);if(r.errorHandler(e,"Unable to delete file",s))return;s.resolve(e.values[0])},function(){s.reject("Unable to delete file")}),s.promise},get:function(e,t){if(!e||typeof +e!="number"||!t||typeof t!="string")return null;var i=n.defer();return o.get({action:"list",entityTable:t,entityID:e},function(e){if(r.errorHandler(e,"Unable to fetch files",i))return;i.resolve(e.values)},function(){i.reject("Unable to fetch files")}),i.promise},uploader:function(e,n){if(!e||typeof e!="string")return null;var r={url:t.url.FILE+"/upload",formData:[{entityTable:e}]};return n&&typeof n=="number"&&(r.queueLimit=n),new i(r)},upload:function(e,t){if(!e||typeof e!="object"||!t||typeof +t!="number")return null;var r=n.defer(),i=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){i.push(t)},e.onErrorItem=function(e,t,n,i){r.reject("Could not upload file: "+e.file.name),s.error(" ===== Item Error: "+n+" ======"),s.error(" =====  - item ======"),s.error(e),s.error(" =====  - response ======"),s.error(t),s.error(" =====  - headers ======"),s.error(i)},e.onCompleteAll=function(){r.resolve(i)},e.uploadAll(),r.promise}}}])}),define("tasks-assignments/services/assignment",["tasks-assignments/services/services","tasks-assignments/services/utils"],function(e){"use strict";e.factory("Relationship",["$resource","config","$log",function(e,t,n){return n.debug("Service: Relationship"),e(t.url.REST,{action:"get",entity:"Relationship",json:{}})}]),e.factory("Assignment",["$resource","config","$log",function(e,t,n){return n.debug("Service: Assignment"),e(t.url.REST,{action:"get",entity:"Assignment",json:{}})}]),e.factory("AssignmentSearch",["$resource","config","$log",function(e,t,n){return n.debug("Service: AssignmentSearch"),e(t.url.ASSIGNMENTS+"/ajax/unclosed")}]),e.factory("AssignmentType",["$resource","config","$log",function(e,t,n){return n.debug("Service: AssignmentType"),e(t.url.REST,{action:"get",entity:"CaseType",json:{is_active:1}})}]),e.factory("AssignmentService",["Relationship","Assignment","AssignmentSearch","AssignmentType","$q","config","UtilsService","$filter","$location","$state","$rootScope","$log","$timeout",function(e,t,n,r,i,s,o,u,a,f,l,c,h){return c.debug("Service: AssignmentService"),{get:function(e){if(!e||typeof +e!="number"&&typeof e!="object")return null;var n=i.defer();return t.get({json:{options:{limit:0},id:e,debug:s.DEBUG}},function(e){if(o.errorHandler(e,"Unable to fetch assignments",n))return;n.resolve(e.values)},function(){n.reject("Unable to fetch assignments")}),n.promise},assignCoordinator:function(t,n){if(!t||typeof +t!="number"||!n||typeof +n!="number")return null;var r=i.defer();return e.save({action:"create",json:{sequential:1,contact_id_a:t,contact_id_b:s.LOGGED_IN_CONTACT_ID,relationship_type_id:9,case_id:n}},null,function(e){if(o.errorHandler(e,"Unable to assign coordinator",r))return;r.resolve(e.values)},function(){r.reject("Unable to assign coordinator")}),r.promise},getTypes:function(){var e=i.defer();return r.get({},function(t){if(o.errorHandler(t,"Unable to fetch assignment types",e))return;e.resolve(t.values)},function(){e.reject("Unable to fetch assignment types")}),e.promise},save:function(e){if(!e||typeof e!="object")return null;var n=i.defer(),r=angular.extend({sequential:1,debug:s.DEBUG},e),u;return t.save({action:"create",json:r},null,function(e){if(o.errorHandler(e,"Unable to save an assignment",n))return;u=e.values,n.resolve(u.length==1?u[0]:null)},function(){n.reject("Unable to save an assignment")}),n.promise},search:function(e,t){return n.query({term:e,excludeCaseIds:t}).$promise},updateTab:function(e){if(document.getElementsByClassName("CRM_Case_Form_Search").length){CRM.refreshParent(".CRM_Case_Form_Search");return}if(!!document.getElementById("tab_case")){CRM.tabHeader.updateCount("#tab_case",CRM.tabHeader.getCount("#tab_case")+(e||0));return}a.path()=="/assignments"&&f.reload(!0)},updateCache:function(e){c.debug("updateCache"),c.debug(e);var t=l.cache.assignment.obj||{},n=[],r=[],i,s,o;angular.extend(t,e);for(s in t)i=t[s],o=l.cache.assignmentType.obj[i.case_type_id].title,n.push(i),r.push({label:i.contacts[0].sort_name+" - "+o+(i.end_date?" (closed)":""),label_class:+i.is_deleted||i.end_date?"strikethrough":"",id:s,extra:{case_subject:i.subject,case_type:o,contact_id:i.contacts[0].contact_id,end_date:i.end_date,sort_name:i.contacts[0].sort_name,start_date:i.start_date}});n=u("orderBy")(n,"subject"),r=u("orderBy")(r,"label"),l.cache.assignment={arr:n,obj:t,arrSearch:r}}}}])}),define("tasks-assignments/controllers/document-list",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/document","tasks-assignments/services/file","tasks-assignments/services/assignment"],function(e,t){"use strict";t.controller("DocumentListCtrl",["$scope","$uibModal","$dialog","$rootElement","$rootScope","$state","$filter","$log","$q","$timeout","documentList","config","ContactService","AssignmentService","DocumentService","FileService","settings",function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function y(){t.$watch("filterParamsHolder.dateRange.from",function(e){t.datepickerOptions.until.minDate=e}),t.$watch("filterParamsHolder.dateRange.until",function(e){t.datepickerOptions.from.maxDate=e})}a.debug("Controller: DocumentListCtrl"),this.init=function(){var e=this.contactIds,t=this.assignmentIds;this.collectId(c),e&&e.length&&p.get({IN:e}).then(function(e){p.updateCache(e)}),t&&t.length&&g.extEnabled.assignments&&d.get({IN:t}).then(function(e){d.updateCache(e)}),y(),s.$broadcast("ct-spinner-hide"),a.debug(s.cache)},this.assignmentIds=[],this.contactIds=[],this.collectId=function(e){function r(e){t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&t.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0])}function i(e){e.case_id&&n.push(e.case_id)}var t=this.contactIds,n=this.assignmentIds;t.push(h.LOGGED_IN_CONTACT_ID),h.CONTACT_ID&&t.push(h.CONTACT_ID),angular.forEach(e,function(e){r(e),i(e)})},t.pagination={currentPage:1,itemsPerPage:10,maxSize:5},t.dueToday=0,t.dueThisWeek=0,t.overdue=0,t.documentList=c,t.documentListFiltered=[],t.documentListOngoing=[],t.documentListPaginated=[],t.documentListResolved=[],t.documentListResolvedLoaded=!1,t.action={selected:null,applyTo:"selected"},t.actionList=[{type:"delete",label:"Delete"}],t.checklist={selected:{},isCheckedAll:{}},t.dpOpened={filterDates:{}},t.isCollapsed={filterAdvanced:!0,filterDates:!0,documentListResolved:!0},t.filterParams={contactId:null,documentStatus:[],userRole:o.params.userRole||{field:null,isEqual:null},dateRange:{from:null,until:null},due:null,assignmentType:[]},t.filterParamsHolder={documentStatus:[],dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()}},t.datepickerOptions={from:{maxDate:t.filterParamsHolder.dateRange.until},until:{minDate:t.filterParamsHolder.dateRange.from}},t.label={addNew:"Add Document",overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:""},t.apply=function(e,n){var i=n.length,o=[],u;if(!e||!i)return;switch(e){case"delete":r.open({msg:"Are you sure you want to delete "+i+" document(s)?"}).then(function(e){if(!e)return;t.$broadcast("ct-spinner-show","documentList"),u=0;for(;u<i;u++)o.push(v.delete(n[u].id));f.all(o).then(function(e){u=0;for(;u<i;u++)s.$broadcast("documentDelete",n[u].id),t.documentList.splice(t.documentList.indexOf(n[u]),1);t.checklist.isCheckedAll={},t.checklist.selected={},t.$broadcast("ct-spinner-hide","documentList"),d.updateTab()})})}},t.changeStatus=function(e,n){if(!n||typeof +n!="number")return null;t.$broadcast("ct-spinner-show","documentList"),v.save({id:e.id,status_id:n}).then(function(n){e.id=n.id,e.status_id=n.status_id,s.$broadcast("documentFormSuccess",n,e),t.$broadcast("ct-spinner-hide","documentList"),d.updateTab()})},t.toggleAll=function(e){t.checklist.isCheckedAll[e]?t.checklist.selected[e]=angular.copy(t.documentListPaginated):t.checklist.selected[e]=[]},t.toggleIsCheckedAll=function(){l(function(){t.checklist.isCheckedAll[t.pagination.currentPage]=t.checklist.selected[t.pagination.currentPage].length==t.documentListPaginated.length})},t.labelDateRange=function(e,n){var r=u("date")(e,"dd/MM/yyyy")||"",i=u("date")(n,"dd/MM/yyyy")||"";i&&(i=r?" - "+i:"Until: "+i),r&&(r=i?r:"From: "+r),t.label.dateRange=r+i},t.loadDocumentsResolved=function(){if(t.documentListResolvedLoaded)return;var e=this;t.documentList=u("filterByStatus")(t.documentList,s.cache.documentStatusResolve,!1),v.get({target_contact_id:h.CONTACT_ID,status_id:{IN:h.status.resolve.DOCUMENT}}).then(function(n){var r=e.contactIds,i=e.assignmentIds;e.collectId(n),r&&r.length&&p.get({IN:r}).then(function(e){p.updateCache(e)}),i&&i.length&&g.extEnabled.assignments&&d.get({IN:i}).then(function(e){d.updateCache(e)}),Array.prototype.push.apply(t.documentList,n),t.documentListResolvedLoaded=!0})}.bind(this),t.deleteDocument=function(e){r.open({msg:"Are you sure you want to delete this document?"}).then(function(n){if(!n)return;v.delete(e.id).then(function(n){t.documentList.splice(t.documentList.indexOf(e),1),angular.forEach(t.checklist.selected,function(t){t.splice(t.indexOf(e),1)}),s.$broadcast("documentDelete",e.id),d.updateTab()})})},t.viewInCalendar=function(e){o.go("calendar.mwl."+e)},t.$on("assignmentFormSuccess",function(e,n){Array.prototype.push.apply(t.documentList,n.documentList)}),t.$on("documentFormSuccess",function(e,n,r){angular.equals({},r)?t.documentList.push(n):angular.extend(r,n)}),t.$on("crmFormSuccess",function(e,t){if(t.status=="success"){var n=/case|activity|assignment/i;if(n.test(t.title)||t.crmMessages&&t.crmMessages.length&&(n.test(t.crmMessages[0].title)||n.test(t.crmMessages[0].text)))s.cache.assignment={obj:{},arr:[]},o.go(o.current,{},{reload:!0})}}),this.init()}])}),define("tasks-assignments/controllers/document",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/document"],function(e,t){"use strict";t.controller("DocumentCtrl",["$scope","$rootScope","config","$log",function(t,n,r,i){i.debug("Controller: DocumentCtrl"),t.document.activity_date_time=t.document.activity_date_time?e(t.document.activity_date_time).toDate():null,t.document.expire_date=t.document.expire_date?e(t.document.expire_date).toDate():null,t.urlFile=r.url.FILE+"/zip?entityID="+t.document.id+"&entityTable=civicrm_activity",t.$watch("document.activity_date_time",function(e){t.document.due=(new Date(e)).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}])}),define("tasks-assignments/controllers/assignments",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact"],function(e){"use strict";e.controller("AssignmentsCtrl",["$scope","$log","$uibModal","$rootElement","$rootScope","$state","config",function(e,t,n,r,i,s,o){t.info("Controller: AssignmentsCtrl")}])}),define("tasks-assignments/controllers/main",["tasks-assignments/controllers/controllers","tasks-assignments/services/file"],function(e){"use strict";e.controller("MainCtrl",["$scope","$rootScope","$rootElement","$log","$uibModal","$q","FileService","config",function(e,t,n,r,i,s,o,u){r.debug("Controller: MainCtrl"),t.modalDocument=function(s,a){a&&a.preventDefault(),s=s||{};var f=i.open({appendTo:n.find("div").eq(0),templateUrl:u.path.TPL+"modal/document.html?v=3",controller:"ModalDocumentCtrl",resolve:{data:function(){return s},files:function(){return!s.id||!+s.file_count?[]:o.get(s.id,"civicrm_activity")}}});f.result.then(function(n){e.$broadcast("documentFormSuccess",n,s),n.open&&t.modalDocument(s)},function(){r.info("Modal dismissed")})},t.modalTask=function(s){s=s||{};var o=i.open({appendTo:n.find("div").eq(0),templateUrl:u.path.TPL+"modal/task.html?v=5",controller:"ModalTaskCtrl",resolve:{data:function(){return s}}});o.result.then(function(n){e.$broadcast("taskFormSuccess",n,s),n.open&&t.modalTask(s)},function(){r.info("Modal dismissed")})},t.modalAssignment=function(t){t=t||{};var s=i.open({appendTo:n.find("div").eq(0),templateUrl:u.path.TPL+"modal/assignment.html?v=3",controller:"ModalAssignmentCtrl",size:"lg",resolve:{data:function(){return t}}});s.result.then(function(n){e.$broadcast("assignmentFormSuccess",n,t)},function(){r.info("Modal dismissed")})},t.modalReminder=function(e,t){if(!e||typeof e!="object"||!t||typeof t!="string")return null;i.open({appendTo:n.find("div").eq(0),templateUrl:u.path.TPL+"modal/reminder.html?v=1",controller:"ModalReminderCtrl",resolve:{data:function(){return e},type:function(){return t}}})}}])}),define("tasks-assignments/services/dialog",["tasks-assignments/services/services"],function(e){"use strict";e.factory("$dialog",["$uibModal","config","$rootElement","$log",function(e,t,n,r){return r.debug("Service: $dialog"),{open:function(r){if(r&&typeof r!="object")return;return e.open({appendTo:n.find("div").eq(0),templateUrl:t.path.TPL+"modal/dialog.html",size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{copyCancel:r.copyCancel||"",copyConfirm:r.copyConfirm||"",title:r.title||"",msg:r.msg||""}}}}).result}}}])}),define("tasks-assignments/controllers/task-list",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/task","tasks-assignments/services/assignment"],function(e,t){"use strict";t.controller("TaskListCtrl",["$scope","$uibModal","$dialog","$rootElement","$rootScope","$filter","$timeout","$state","$log","taskList","config","ContactService","AssignmentService","TaskService","settings","HR_settings",function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){function g(){t.$watch("filterParamsHolder.dateRange.from",function(e){t.datepickerOptions.until.minDate=e}),t.$watch("filterParamsHolder.dateRange.until",function(e){t.datepickerOptions.from.maxDate=e})}f.debug("Controller: TaskListCtrl"),this.init=function(){var e=this.contactIds,t=this.assignmentIds;this.collectId(l),e&&e.length&&h.get({IN:e}).then(function(e){h.updateCache(e)}),t&&t.length&&v.extEnabled.assignments&&p.get({IN:t}).then(function(e){p.updateCache(e)}),g(),s.$broadcast("ct-spinner-hide"),f.info(s.cache)},this.assignmentIds=[],this.contactIds=[],this.collectId=function(e){function r(e){t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&t.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0])}function i(e){e.case_id&&n.push(e.case_id)}var t=this.contactIds,n=this.assignmentIds;t.push(c.LOGGED_IN_CONTACT_ID),c.CONTACT_ID&&t.push(c.CONTACT_ID),angular.forEach(e,function(e){r(e),i(e)})},t.format=m.DATE_FORMAT,t.assignments=[],t.contacts=[],t.dueToday=0,t.dueThisWeek=0,t.overdue=0,t.taskList=l,t.taskListFiltered=[],t.taskListLimit=5,t.taskListOngoing=[],t.taskListResolved=[],t.taskListResolvedLoaded=!1,t.dpOpened={filterDates:{}},t.isCollapsed={filterAdvanced:!0,filterDates:!0,taskListResolved:!0},t.filterParams={contactId:null,userRole:a.params.userRole||{field:null,isEqual:null},dateRange:{from:null,until:null},due:null,assignmentType:[]},t.filterParamsHolder={dateRange:{from:e().startOf("day").toDate(),until:e().add(1,"month").startOf("day").toDate()}},t.datepickerOptions={from:{maxDate:t.filterParamsHolder.dateRange.until},until:{minDate:t.filterParamsHolder.dateRange.from}},t.label={overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:"Due Tasks"},t.cacheAssignment=function(e){if(s.cache.assignment.obj[e.id])return;var t={};t[e.id]={case_type_id:o("filter")(s.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:e.label_class=="strikethrough"?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},p.updateCache(t)},t.cacheContact=function(e){var n={},r=t.contacts.filter(function(t){return t.id===e})[0];if(!r)return;return n[r.id]={contact_id:r.id,contact_type:r.icon_class,sort_name:r.label,display_name:r.label,email:r.description.length?r.description[0]:""},h.updateCache(n),!0},t.changeStatus=function(e,n){t.$broadcast("ct-spinner-show","task"+e.id),d.save({id:e.id,status_id:n||"2"}).then(function(n){s.$broadcast("taskFormSuccess",n,e),t.$broadcast("ct-spinner-hide","task"+e.id),p.updateTab()})},t.updateTask=function(e,t){var n=d.save(angular.extend({id:e.id},t));return n.then(null,function(e){CRM.alert(e,"Error","error")}),n},t.updateAssignments=function(e,n){t.assignments=o("filter")(e,function(e){return+e.extra.contact_id==+n})},t.updateContacts=function(e){t.contacts=e},t.refreshContacts=function(e){if(!e)return;h.search(e,{contact_type:"Individual"}).then(function(e){t.contacts=e})},t.refreshAssignments=function(e,n,r){if(!e||!n||!r)return;p.search(e,r).then(function(e){t.assignments=o("filter")(e,function(e){return+e.extra.contact_id==+n})})},t.loadTasksResolved=function(){if(t.taskListResolvedLoaded)return;var e=this;o("filterByStatus")(t.taskList,s.cache.taskStatusResolve,!1),d.get({target_contact_id:c.CONTACT_ID,status_id:{IN:c.status.resolve.TASK}}).then(function(n){var r=e.contactIds,i=e.assignmentIds;e.collectId(n),r&&r.length&&h.get({IN:r}).then(function(e){h.updateCache(e)}),i&&i.length&&v.extEnabled.assignments&&p.get({IN:i}).then(function(e){p.updateCache(e)}),Array.prototype.push.apply(t.taskList,n),t.taskListResolvedLoaded=!0})}.bind(this),t.deleteTask=function(e){r.open({msg:"Are you sure you want to delete this task?"}).then(function(n){if(!n)return;d.delete(e.id).then(function(n){t.taskList.splice(t.taskList.indexOf(e),1),s.$broadcast("taskDelete",e.id),p.updateTab()})})},t.viewInCalendar=function(e){a.go("calendar.mwl."+e)},t.$on("assignmentFormSuccess",function(e,n){Array.prototype.push.apply(t.taskList,n.taskList)}),t.$on("taskFormSuccess",function(e,n,r){angular.equals({},r)?t.taskList.push(n):angular.extend(r,n)}),t.$on("crmFormSuccess",function(e,t){if(t.status=="success"){var n=/case|activity|assignment/i;if(n.test(t.title)||t.crmMessages&&t.crmMessages.length&&(n.test(t.crmMessages[0].title)||n.test(t.crmMessages[0].text)))s.cache.assignment={obj:{},arr:[]},a.go(a.current,{},{reload:!0})}}),this.init()}])}),define("tasks-assignments/controllers/task",["common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/task"],function(e,t){"use strict";t.controller("TaskCtrl",["$scope","$log","$rootScope",function(t,n,r){n.debug("Controller: TaskCtrl"),t.isCollapsed=!0,t.picker={opened:!1},t.task.activity_date_time=t.task.activity_date_time?e(t.task.activity_date_time).toDate():null,t.dpOpen=function(e){e.preventDefault(),e.stopPropagation(),t.picker.opened=!0},t.$watch("task.status_id",function(e){var n=r.cache.taskStatusResolve.indexOf(e)>-1;t.task.resolved=n,t.task.completed=n}),t.$watch("task.activity_date_time",function(e){t.task.due=(new Date(e)).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}])}),define("tasks-assignments/controllers/dashboard/nav-main",["tasks-assignments/controllers/controllers"],function(e){"use strict";e.controller("NavMainCtrl",["$scope","$state","$log",function(e,t,n){n.debug("Controller: NavMainCtrl"),e.isActive=function(e){return t.includes(e)}}])}),define("tasks-assignments/controllers/dashboard/top-bar",["tasks-assignments/controllers/controllers"],function(e){"use strict";e.controller("TopBarCtrl",["$scope","$rootScope","$state","$log",function(e,t,n,r){r.debug("Controller: TopBarCtrl"),t.itemAdd={},t.itemAdd.fn=function(){n.includes("documents")?t.modalDocument():t.modalTask()},t.itemAdd.label=function(){return n.includes("documents")?"Add Document":"Add Task"}}])}),define("tasks-assignments/controllers/modal/modal-dialog",["tasks-assignments/controllers/controllers"],function(e){"use strict";e.controller("ModalDialogCtrl",["$scope","$uibModalInstance","$timeout","content","$log",function(e,t,n,r,i){i.debug("Controller: ModalDialogCtrl"),e.title=r.title||"CiviHR Tasks & Assignments",e.msg=r.msg||"",e.copyConfirm=r.copyConfirm||"Yes",e.copyCancel=r.copyCancel||"Cancel",e.confirm=function(e){t.close(e||!0)},e.cancel=function(){t.close(!1)}}])}),define("tasks-assignments/controllers/modal/modal-document",["common/angular","common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/file","tasks-assignments/services/dialog","tasks-assignments/services/document"],function(e,t,n){"use strict";n.controller("ModalDocumentCtrl",["$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","$filter","$uibModal","$dialog","$timeout","AssignmentService","DocumentService","ContactService","FileService","data","files","config","HR_settings",function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){function w(e){var t=i.cache.contact.arrSearch;return n.document.id?t.filter(function(t){var r=n.document[e+"_contact_id"][0];return+r===+t.id}):[]}u.debug("Controller: ModalDocumentCtrl"),n.files=[],n.document={},e.copy(m,n.document),e.copy(g,n.files),n.data=m,n.document.assignee_contact_id=n.document.assignee_contact_id||[],n.document.source_contact_id=n.document.source_contact_id||y.LOGGED_IN_CONTACT_ID,n.document.target_contact_id=n.document.target_contact_id||[y.CONTACT_ID],n.document.status_id=n.document.status_id||"1",n.filesTrash=[],n.uploader=v.uploader("civicrm_activity"),n.showCId=!y.CONTACT_ID,n.assignments=a("filter")(i.cache.assignment.arrSearch,function(e){return+e.extra.contact_id==+n.document.target_contact_id}),n.contacts={target:w("target"),assignee:w("assignee")},n.cacheAssignment=function(e){if(i.cache.assignment.obj[e.id])return;var t={};t[e.id]={case_type_id:a("filter")(i.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:e.label_class=="strikethrough"?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},h.updateCache(t)},n.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},d.updateCache(t)},n.fileMoveToTrash=function(e){n.filesTrash.push(n.files[e]),n.files.splice(e,1)},n.refreshAssignments=function(e){if(!e)return;var t=n.document.target_contact_id;h.search(e,n.document.case_id).then(function(e){n.assignments=a("filter")(e,function(e){return+e.extra.contact_id==+t})})},n.refreshContacts=function(e,t){if(!e)return;d.search(e,{contact_type:"Individual"}).then(function(e){n.contacts[t]=e})},n.dpOpened={due:!1,exp:!1},n.cancel=function(){if(n.documentForm.$pristine){r.dismiss("cancel");return}l.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){if(!e)return;n.$broadcast("ct-spinner-hide"),r.dismiss("cancel")})},n.confirm=function(){if(e.equals(m,n.document)&&e.equals(g,n.files)&&!n.uploader.queue.length){r.dismiss("cancel");return}var t=n.uploader,i=n.filesTrash,u=[],a;n.$broadcast("ct-spinner-show"),+n.document.case_id==+m.case_id&&delete n.document.case_id,n.document.activity_date_time=n.parseDate(n.document.activity_date_time)||new Date,n.document.expire_date=n.parseDate(n.document.expire_date);if(i.length)for(var l=0;l<i.length;l++)a=i[l],u.push(v.delete(a.fileID,a.entityID,a.entityTable));o.all({document:p.save(n.document),files:u.length?o.all(u):[]}).then(function(e){if(t.queue.length){var n=f.open({appendTo:s.find("div").eq(0),templateUrl:y.path.TPL+"/modal/progress.html?v=1",size:"sm",controller:"ModalProgressCtrl",resolve:{uploader:function(){return t},entityId:function(){return e.document.id}}});return e.files=n.result,o.all(e)}return e}).then(function(e){n.document.id=e.document.id,n.document.case_id=e.document.case_id,n.document.file_count=n.files.length+t.queue.length,n.document.open=n.openNew,h.updateTab(),r.close(n.document),n.$broadcast("ta-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),r.dismiss(),n.$broadcast("ta-spinner-hide"),o.reject()})},n.parseDate=function(e){e instanceof Date&&(e=e.getTime());var n=t(e,[b.DATE_FORMAT.toUpperCase(),"x","YYYY-MM-DD"]);return n.isValid()?n.format("YYYY-MM-DD"):null},n.dpOpen=function(e,t){e.preventDefault(),e.stopPropagation(),n.dpOpened[t]=!0},n.dropzoneClick=function(){c(function(){document.getElementById(i.prefix+"document-files").click()})}}])}),define("tasks-assignments/controllers/modal/modal-progress",["tasks-assignments/controllers/controllers","tasks-assignments/services/file"],function(e){"use strict";e.controller("ModalProgressCtrl",["$scope","$uibModalInstance","$q","$timeout","uploader","entityId","FileService","$log",function(e,t,n,r,i,s,o,u){u.debug("Controller: ModalProgressCtrl"),e.uploader=i,i.queue.length&&(i.item=i.queue[0].file.name),i.onProgressItem=function(e){this.item=e.file.name},o.upload(i,s).then(function(e){r(function(){t.close(e)},500)}),e.cancel=function(){t.dismiss("File upload canceled")}}])}),define("tasks-assignments/controllers/modal/modal-task",["common/angular","common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/task"],function(e,t,n){"use strict";n.controller("ModalTaskCtrl",["$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","$filter","$uibModal","$dialog","AssignmentService","TaskService","ContactService","data","config","HR_settings",function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){function g(){var e=i.cache.assignment.arrSearch;return e.filter(function(e){return+e.extra.contact_id===+n.task.target_contact_id})}function y(e){var t=i.cache.contact.arrSearch;return n.task.id?t.filter(function(t){var r=n.task[e+"_contact_id"][0];return+r===+t.id}):[]}u.debug("Controller: ModalTaskCtrl"),n.format=m.DATE_FORMAT.toLowerCase(),n.data=d,n.task={},e.copy(d,n.task),n.task.activity_date_time=n.task.activity_date_time||t().toDate(),n.task.assignee_contact_id=n.task.assignee_contact_id||[],n.task.source_contact_id=n.task.source_contact_id||v.LOGGED_IN_CONTACT_ID,n.task.target_contact_id=n.task.target_contact_id||[v.CONTACT_ID],n.showCId=!v.CONTACT_ID,n.assignments=g(),n.contacts={target:y("target"),assignee:y("assignee")},n.cacheAssignment=function(e){if(i.cache.assignment.obj[e.id])return;var t={};t[e.id]={case_type_id:a("filter")(i.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:e.label_class=="strikethrough"?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},c.updateCache(t)},n.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},p.updateCache(t)},n.refreshAssignments=function(e){if(!e)return;var t=n.task.target_contact_id;c.search(e,n.task.case_id).then(function(e){n.assignments=a("filter")(e,function(e){return+e.extra.contact_id==+t})})},n.refreshContacts=function(e,t){if(!e)return;p.search(e,{contact_type:"Individual"}).then(function(e){n.contacts[t]=e})},n.dpOpen=function(e){e.preventDefault(),e.stopPropagation(),n.dpOpened=!0},n.cancel=function(){if(n.taskForm.$pristine){r.dismiss("cancel");return}l.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(e){if(!e)return;n.$broadcast("ct-spinner-hide"),r.dismiss("cancel")})},n.confirm=function(){if(e.equals(d,n.task)){r.dismiss("cancel");return}n.$broadcast("ct-spinner-show"),+n.task.case_id==+d.case_id&&delete n.task.case_id,n.task.activity_date_time=n.task.activity_date_time||new Date,h.save(n.task).then(function(e){n.task.id=e.id,n.task.case_id=e.case_id,c.updateTab(),n.openNew&&(n.task.open=!0,n.openNew=!1),r.close(n.task),n.$broadcast("ct-spinner-hide");return},function(e){return CRM.alert(e,"Error","error"),r.dismiss(),n.$broadcast("ct-spinner-hide"),o.reject()})}}])}),define("tasks-assignments/controllers/modal/modal-task-migrate",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/task"],function(e){"use strict";e.controller("ModalTaskMigrateCtrl",["$scope","$uibModalInstance","$rootScope","$rootElement","$q","$log","$filter","$uibModal","$dialog","$timeout","AssignmentService","TaskService","Task","activityType","ContactService","UtilsService","settings",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){s.debug("Controller: ModalTaskMigrateCtrl"),e.migrate={},e.migrate.dataLoaded=!1,e.migrate.from="",e.migrate.to="",e.migrate.task={list:[],statusList:[],statusListSelected:[]},e.migrate.document={list:[],statusList:[],statusListSelected:[]},e.contacts=n.cache.contact.arrSearch,e.getActivities=function(t){e.$broadcast("ct-spinner-show"),t=t||e.migrate.from,e.migrate.task.statusList=[],e.migrate.task.statusListSelected=[],e.migrate.document.statusList=[],e.migrate.document.statusListSelected=[],e.migrate.dataLoaded=!1;var r=[];h.get({entity:"ActivityContact",json:{component:"",sequential:"1","return":"activity_id",contact_id:t,record_type_id:"1",options:{limit:"0"}}},function(t){t.values&&t.values.length?(angular.forEach(t.values,function(e){this.push(e.activity_id)},r),h.get({entity:"Activity",json:{component:"",options:{limit:0},id:{IN:r},is_current_revision:"1",is_deleted:"0",sequential:"1","return":"assignee_contact_id, activity_type_id, assignee_contact_id, id, status_id"}},function(t){function r(t,n){var r=e.migrate[t];r.list.push(n),r.statusList.indexOf(n.status_id)>-1||(s[t].indexOf(n.status_id)>-1?r.statusList.push(n.status_id):(r.statusList.unshift(n.status_id),r.statusListSelected.push(n.status_id)))}var i=n.cache.documentType.obj,s={task:n.cache.taskStatusResolve,document:n.cache.documentStatusResolve};t.values&&t.values.length&&(t.values=o("orderBy")(t.values,"-status_id"),angular.forEach(t.values,function(e){i[e.activity_type_id]?r("document",e):r("task",e)})),e.migrate.dataLoaded=!0,e.$broadcast("ct-spinner-hide")})):(e.migrate.dataLoaded=!0,e.$broadcast("ct-spinner-hide"))})},e.refreshContacts=function(t){if(!t)return;d.search(t,{contact_type:"Individual"}).then(function(t){e.contacts=t})},e.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},d.updateCache(t)},e.cancel=function(){if(e.taskMigrateForm.$pristine){t.dismiss("cancel");return}a.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(n){if(!n)return;e.$broadcast("ct-spinner-hide"),t.dismiss("cancel")})},e.confirm=function(){if(!e.migrate.task.statusListSelected&&!e.migrate.document.statusListSelected)return;var r=[],s=[],o,u=0;angular.forEach(e.migrate.task.list,function(t){e.migrate.task.statusListSelected.indexOf(t.status_id)>-1&&this.push(t)},r),!+m.tabEnabled.documents||angular.forEach(e.migrate.document.list,function(t){e.migrate.document.statusListSelected.indexOf(t.status_id)>-1&&this.push(t)},r),e.$broadcast("ct-spinner-show"),angular.forEach(r,function(t){t.assignee_contact_id[0]=e.migrate.to,this.push(function(){var e=i.defer();return o=u?this[u-1]:{},i.when(o).then(function(){h.save({entity:"Activity",action:"create",json:angular.extend({sequential:"1",component:""},t)},null,function(t){if(v.errorHandler(t,"Unable to save task",e))return;e.resolve(t.values.length==1?t.values[0]:null)},function(){e.reject("Unable to save task")})}),e.promise}.bind(this)()),u++},s),i.all(s).then(function(r){r.length?CRM.alert(r.length+" item(s) re-assigned from: "+n.cache.contact.obj[e.migrate.from].sort_name+" to: "+n.cache.contact.obj[e.migrate.to].sort_name,"Migrate Tasks","success"):CRM.alert("0 items re-assigned.","Migrate Tasks","warning"),t.dismiss(),e.$broadcast("ct-spinner-hide");return},function(n){CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ct-spinner-hide");return})}}])}),define("tasks-assignments/controllers/modal/modal-reminder",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/dialog","tasks-assignments/services/document","tasks-assignments/services/task"],function(e){"use strict";e.controller("ModalReminderCtrl",["$scope","$uibModalInstance","$dialog","$rootScope","$q","$log","$filter","TaskService","DocumentService","data","type","config",function(e,t,n,r,i,s,o,u,a,f,l,c){s.debug("Controller: ModalReminderCtrl"),e.data={},e.type=l,angular.copy(f,e.data),e.reminder={},e.data.assignee_contact_id=e.data.assignee_contact_id||[],e.data.target_contact_id=e.data.target_contact_id||[c.CONTACT_ID],e.contacts=r.cache.contact.arrSearch,e.showCId=!c.CONTACT_ID,e.cancel=function(){t.dismiss("cancel")},e.confirm=function(){e.$broadcast("ct-spinner-show"),(l==="task"?u:a).sendReminder(e.data.id,e.reminder.notes).then(function(){CRM.alert("Message sent to: "+r.cache.contact.obj[e.data.assignee_contact_id[0]].sort_name,"Reminder sent","success"),t.close(),e.$broadcast("ta-spinner-hide");return},function(n){return CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ta-spinner-hide"),i.reject()})}}])}),define("tasks-assignments/controllers/modal/modal-assignment",["common/angular","common/moment","tasks-assignments/controllers/controllers","tasks-assignments/services/contact","tasks-assignments/services/document","tasks-assignments/services/task","tasks-assignments/services/assignment"],function(e,t,n){"use strict";n.controller("ModalAssignmentCtrl",["$scope","$uibModalInstance","$rootScope","$q","$log","$filter","AssignmentService","TaskService","DocumentService","ContactService","data","config","settings","HR_settings",function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){s.debug("Controller: ModalAssignmentCtrl");var v={activity_type_id:null,assignee_contact_id:[],case_id:null,create:!0,isAdded:!1,name:null,source_contact_id:h.LOGGED_IN_CONTACT_ID,status_id:"1",offset:0};t.format=d.DATE_FORMAT.toLowerCase(),t.copyMessage="Click here to copy the value in row one to all rows.",t.alert={show:!1,msg:"",type:"danger"},t.assignment={},t.assignment.status_id="1",t.assignment.contact_id=h.CONTACT_ID,t.assignment.client_id=t.assignment.contact_id,t.assignment.subject="",t.assignment.dueDate=null,t.dpOpened={},t.showCId=!h.CONTACT_ID,t.activitySet={},t.taskList=[],t.documentList=[],t.contacts={target:[],document:[],task:[]},t.addActivity=function(t){if(!t)return;t.push(e.extend(e.copy(v),{isAdded:!0}))},t.removeActivity=function(e,t){if(!e)return;e.splice(t,1)},t.dpOpen=function(e,n){e.preventDefault(),e.stopPropagation(),t.dpOpened[n]=!0},t.refreshContacts=function(e,n,r){if(!e)return;l.search(e,{contact_type:"Individual"}).then(function(e){n==="target"?t.contacts[n]=e:t.contacts[n][r]=e})},t.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,display_name:e.label,email:e.description.length?e.description[0]:""},l.updateCache(t)},t.setData=function(){var e=r.cache.assignmentType.obj[t.assignment.case_type_id];if(!e){t.activitySet={},t.assignment.subject="";return}t.activitySet=e.definition.activitySets[0],t.assignment.subject=r.cache.assignmentType.obj[t.assignment.case_type_id].title,t.assignment.dueDate=t.assignment.dueDate||new Date((new Date).setHours(0,0,0,0))},t.cancel=function(){n.dismiss("cancel")},t.confirm=function(){if(!o("filter")(t.taskList,{create:!0}).length&&!o("filter")(t.documentList,{create:!0}).length){t.alert.msg="Please add at least one task.",t.alert.show=!0;return}t.$broadcast("ct-spinner-show");var s=[],l=[],c=[],p=[],d={},v,m;t.assignment.start_date=new Date,u.save(t.assignment).then(function(o){e.forEach(t.taskList,function(e){e.create&&(e.case_id=o.id,this.push(e))},l),e.forEach(t.documentList,function(e){e.create&&(e.case_id=o.id,this.push(e))},s),i.all({task:a.saveMultiple(l),document:f.saveMultiple(s),relationship:u.assignCoordinator(t.assignment.contact_id,o.id)}).then(function(i){v=0,m=i.task.length;for(v;v<m;v++)l[v].id=i.task[v].id,c.push(i.task[v].id);v=0,m=i.document.length;for(v;v<m;v++)s[v].id=i.document[v].id,p.push(i.document[v].id);d[o.id]=e.extend(e.copy(t.assignment),{id:o.id,client_id:{1:t.assignment.client_id},contact_id:{1:t.assignment.contact_id},contacts:[{sort_name:r.cache.contact.obj[t.assignment.contact_id].sort_name,contact_id:t.assignment.contact_id,role:"Client"},{sort_name:r.cache.contact.obj[h.LOGGED_IN_CONTACT_ID].sort_name,contact_id:h.LOGGED_IN_CONTACT_ID,role:"Case Coordinator"}],is_deleted:"0",end_date:"",activities:c.concat(p)}),u.updateCache(d),u.updateTab(1),n.close({documentList:s,taskList:l}),t.$broadcast("ct-spinner-hide")},function(e){return CRM.alert(e,"Error","error"),n.dismiss(),t.$broadcast("ct-spinner-hide"),i.reject()})},function(e){return CRM.alert(e,"Error","error"),n.dismiss(),t.$broadcast("ct-spinner-hide"),i.reject()})},t.copyAssignee=function(n,r){n.forEach(function(e,i){e.create&&(t.contacts[r][i]=t.contacts[r][0].slice(),e.assignee_contact_id=[n[0].assignee_contact_id[0]])})},t.copyDate=function(t){var n=t[0].activity_date_time;t.forEach(function(e){e.create&&(e.activity_date_time=n)})},t.$watch("activitySet",function(n){if(!n.activityTypes)return;var i,s=n.activityTypes,u=s.length,a=[],f,l=[],c,h=0;for(;h<u;h++){i=e.copy(v),i.name=s[h].name,i.offset=s[h].reference_offset,f=i.name?o("filter")(r.cache.documentType.arr,{value:i.name},!0)[0]:"";if(f){i.activity_type_id=f.key,a.push(i);continue}c=i.name?o("filter")(r.cache.taskType.arr,{value:i.name},!0)[0]:"",i.activity_type_id=c?c.key:null,l.push(i)}e.copy(l,t.taskList);if(!+p.tabEnabled.documents)return;e.copy(a,t.documentList)})}]),n.controller("ModalAssignmentActivityCtrl",["$scope","$log",function(e,n){n.debug("Controller: ModalAssignmentTaskCtrl"),e.isDisabled=!e.activity.activity_type_id&&!e.activity.isAdded,e.activity.create=!e.isDisabled;if(e.isDisabled)return;e.$watch("$parent.assignment.dueDate",function(n){e.activity.activity_date_time=n?t(n).add(e.activity.offset,"days").toDate():null}),e.$watch("$parent.assignment.contact_id",function(t){if(!t)return;e.activity.target_contact_id=[t]})}])}),define("tasks-assignments/controllers/external-page",["tasks-assignments/controllers/controllers","tasks-assignments/services/contact"],function(e){"use strict";e.controller("ExternalPageCtrl",["$scope","$log","$uibModal","$rootElement","$rootScope","$state","config",function(e,t,n,r,i,s,o){t.debug("Controller: ExternalPageCtrl"),e.assignmentsUrl=o.url.ASSIGNMENTS+"?reset=1",e.reportsUrl=o.url.CIVI_DASHBOARD+"?reset=1",e.$on("assignmentFormSuccess",function(){s.go(s.current,{},{reload:!0})}),e.$on("iframe-ready",function(){i.$broadcast("ct-spinner-hide")})}])}),define("tasks-assignments/services/settings",["tasks-assignments/services/services","tasks-assignments/services/utils"],function(e){"use strict";e.factory("Settings",["$resource","config","$log",function(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"TASettings",json:{}})}]),e.factory("SettingsService",["Settings","$q","config","UtilsService","$log","settings",function(e,t,n,r,i,s){return i.debug("Service: SettingsService"),{get:function(r){var i=t.defer();return r=r&&typeof r=="object"?r:[],e.get({json:{sequential:"1",debug:n.DEBUG,fields:r}},function(e){i.resolve(e.values)},function(){i.reject("Unable to fetch tasks list")}),i.promise},set:function(i){if(!i||typeof i!="object")return null;var o=t.defer();return e.save({action:"set",json:{sequential:1,debug:n.DEBUG,fields:i}},null,function(e){if(r.errorHandler(e,"Unable to save",o))return;s.tabEnabled={documents:i.documents_tab||s.tabEnabled.documents_tab,keyDates:i.keydates_tab||s.tabEnabled.keydates_tab},s.copy.button.assignmentAdd=i.add_assignment_button_title,o.resolve(e.values)},function(){o.reject("Unable to save")}),o.promise}}}])}),define("tasks-assignments/controllers/settings",["tasks-assignments/controllers/controllers","tasks-assignments/services/settings"],function(e){"use strict";e.controller("SettingsCtrl",["$scope","$rootScope","$rootElement","$location","$dialog","$q","$log","$state","$uibModal","SettingsService","Task","config","settings",function(e,t,n,r,i,s,o,u,a,f,l,c,h){o.debug("Controller: SettingsCtrl"),e.settings=angular.copy(h),e.configureAddAssignmentBtn=!!e.settings.copy.button.assignmentAdd;var p=function(){var e=s.defer();return l.get({entity:"Activity",action:"getoptions",json:{field:"activity_type_id"}},function(t){e.resolve(t.values||[])},function(){e.reject("Unable to get activity types")}),e.promise}();e.modalTaskMigrate=function(){a.open({appendTo:n.find("div").eq(0),templateUrl:c.path.TPL+"modal/taskMigrate.html?v=1",controller:"ModalTaskMigrateCtrl",resolve:{activityType:function(){return p}}}).result.then(function(t){e.$broadcast("taskMigrateFormSuccess",t)},function(){o.info("Modal dismissed")})},e.confirm=function(){e.$broadcast("ct-spinner-show"),f.set({documents_tab:e.settings.tabEnabled.documents,keydates_tab:e.settings.tabEnabled.keyDates,add_assignment_button_title:e.settings.copy.button.assignmentAdd,is_task_dashboard_default:e.settings.isTaskDashboardDefault}).then(function(t){e.$broadcast("ct-spinner-hide"),e.settingsForm.$pristine=!0},function(t){CRM.alert(t,"Error","error"),e.$broadcast("ct-spinner-hide")})},e.$on("$stateChangeStart",function(n,r,s,o,a){if(e.settingsForm.$pristine)return;n.preventDefault(),i.open({copyCancel:"No",msg:"Are you sure you want to leave this page? Changes will be lost!"}).then(function(e){if(!e){t.$broadcast("$stateChangeSuccess");return}u.go(r.name,s,{notify:!1}).then(function(){t.$broadcast("$stateChangeSuccess",r,s,o,a)})})}),t.$broadcast("ct-spinner-hide")}])}),define("tasks-assignments/directives/directives",["common/angular"],function(e){"use strict";return e.module("civitasks.directives",[])}),define("tasks-assignments/directives/civi-events",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("ctCiviEvents",["$rootScope","$log",function(e,t){return t.debug("Directive: ctCiviEvents"),{link:function(e){CRM.$(document).on("crmFormSuccess",function(n,r){t.debug("crmFormSuccess"),t.debug(r),e.$broadcast("crmFormSuccess",r)}),CRM.$(document).on("crmFormSubmit",function(n,r){t.debug("crmFormSubmit"),t.debug(r),e.$broadcast("crmFormSubmit",r)}),CRM.$(document).on("crmFormCancel",function(n,r){t.debug("crmFormCancel"),t.debug(r),e.$broadcast("crmFormCancel",r)})}}}])}),define("tasks-assignments/directives/iframe",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("taIframe",["$rootScope","$log",function(e,t){return t.debug("Directive: taIframe"),{link:function(t,n,r){var i=n[0];i.addEventListener("load",function(){var t=frames[r.name].document,s=["branding","toolbar","civicrm-menu","civicrm-footer","access"],o=0,u,a=s.length;for(o;o<a;o++){u=t.getElementById(s[o]);if(!u)continue;u.style.display="none"}t.body.style.paddingTop="10px",i.height=t.body.scrollHeight+"px",n.addClass("ct-iframe-ready"),e.$broadcast("iframe-ready")})}}}])}),define("tasks-assignments/directives/spinner",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("ctSpinner",["$rootScope","$log",function(e,t){return t.debug("Directive: ctSpinner"),{link:function(t,n,r){function a(){var e=window.getComputedStyle(n[0]).position;return e=="relative"||e=="absolute"||e=="fixed"}function f(){a()||(n.css("position","relative"),s=!0),n.append(i),o=!0}function l(){o&&i.parentNode.removeChild(i),o=!1,s&&n.css("position","")}var i=document.createElement("div"),s=!1,o=!1,u;i.className="ct-spinner-cover ct-spinner-img",typeof r.ctSpinnerShow!="undefined"&&f(),typeof r.ctSpinnerMainView!="undefined"&&(i.className="ct-spinner-cover",u=document.createElement("div"),u.className="ct-spinner ct-spinner-img",e.$on("$stateChangeStart",function(){f(),document.body.appendChild(u)}),e.$on("$stateChangeSuccess",function(){l(),u.parentNode.removeChild(u)}),e.$on("$stateChangeError",function(){l(),u.parentNode.removeChild(u)})),t.$on("ct-spinner-show",function(e,t){if(!t||r.ctSpinnerId&&r.ctSpinnerId==t){f();return}}),t.$on("ct-spinner-hide",function(e,t){if(!t||r.ctSpinnerId&&r.ctSpinnerId==t){l();return}})}}}])}),define("tasks-assignments/directives/validate",["tasks-assignments/directives/directives"],function(e){"use strict";e.directive("taValidate",["$log",function(e){return e.debug("Directive: taValidate"),{restrict:"A",require:"^form",scope:{isWarning:"=?taValidateWarning"},link:function(e,t,n,r){function f(e,n){t.toggleClass("has-success",!e&&!n),a.toggleClass("glyphicon-ok",!e&&!n)}function l(e,n){t.toggleClass("has-warning",!e&&n),a.toggleClass("glyphicon-warning-sign",!e&&n)}function c(e){t.toggleClass("has-error",e),a.toggleClass("glyphicon-remove",e)}var i=t[0].querySelector("[name]"),s=angular.element(i),o=s.attr("name"),u=document.createElement("span"),a=angular.element(u);if(!o)return;t.addClass("has-feedback"),a.addClass("glyphicon form-control-feedback"),s.after(a),e.$watch(function(){return r[o]&&r[o].$invalid},function(t){r[o].$dirty&&(f(t,e.isWarning),c(t))}),typeof e.isWarning!="undefined"&&e.$watch("isWarning",function(e){var t=r[o].$invalid;r[o].$dirty&&(f(t,e),l(t,e))}),s.bind("blur",function(){c(r[o].$invalid)})}}}])}),define("tasks-assignments/filters/filters",["common/angular"],function(e){"use strict";return e.module("civitasks.filters",[])}),define("tasks-assignments/filters/assignment-type",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByAssignmentType",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterByAssignmentType"),function(e,n){var r,i=t.cache.assignment.obj,s=n.length,o=[],u=0,a=e.length;if(!a||!s)return e;for(u;u<a;u++)r=i[e[u].case_id],r&&n.indexOf(r.case_type_id)!==-1&&o.push(e[u]);return o}}])}),define("tasks-assignments/filters/contact-id",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByContactId",["$filter","config","$log",function(e,t,n){return n.debug("Filter: filterByContactId"),function(e,t){var n=[],r=0,i=e.length;if(!i||!t||typeof +t!="number")return e;for(r;r<i;r++)(+e[r].assignee_contact_id[0]===+t||+e[r].source_contact_id===+t||+e[r].target_contact_id===+t)&&n.push(e[r]);return n}}])}),define("tasks-assignments/filters/date",["common/moment","tasks-assignments/filters/filters"],function(e,t){"use strict";t.filter("filterBy.date",["$filter","$log",function(t,n){return n.debug("Filter: filterBy.date"),function(t,n){if(!t||!t.length||!n)return[];var r=[],i=0,s=t.length,o,u,a;o=e().startOf(n),u=e().endOf(n);for(;i<s;i++)a=e(t[i].date),a>o&&a<u&&r.push(t[i]);return r}}])}),define("tasks-assignments/filters/date-parse",["common/moment","tasks-assignments/filters/filters"],function(e,t){"use strict";t.filter("dateParse",["$filter","$log",function(t,n){return n.debug("Filter: dateParse"),function(t){return e(t).toDate()}}])}),define("tasks-assignments/filters/date-type",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterBy.dateType",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterBy.dateType"),function(e,t){var n=[],r=0,i,s=e.length,o=t.length,u,a;if(!s||!o)return e;for(r;r<s;r++){i=0,u=e[r].dateContactList,a=u.length;for(i;i<a;i++)if(t.indexOf(u[i].type)!==-1){n.push(e[r]);break}}return n}}])}),define("tasks-assignments/filters/due",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByDue",["$filter","$log",function(e,t){return t.debug("Filter: filterByDue"),function(e,t,n){if(!e)return null;var r=[],i=0,s=e.length,o=(new Date).setHours(0,0,0,0);if(!s||!t)return e;switch(t){case"overdue":for(i;i<s;i++)((new Date(e[i].activity_date_time)).setHours(0,0,0,0)<o||e[i].expire_date&&(new Date(e[i].expire_date)).setHours(0,0,0,0)<o)&&r.push(e[i]);break;case"dateRange":if(!n||typeof n!="object")return e;var u,a,f=n.from?(new Date(n.from)).setHours(0,0,0,0):-Infinity,l=n.until?(new Date(n.until)).setHours(0,0,0,0):Infinity;for(i;i<s;i++)u=(new Date(e[i].activity_date_time)).setHours(0,0,0,0),a=e[i].expire_date?(new Date(e[i].expire_date)).setHours(0,0,0,0):!1,(u>=f&&u<=l||a&&a>=f&&a<=l)&&r.push(e[i]);break;case"dueToday":for(i;i<s;i++)((new Date(e[i].activity_date_time)).setHours(0,0,0,0)==o||e[i].expire_date&&(new Date(e[i].expire_date)).setHours(0,0,0,0)==o)&&r.push(e[i]);break;case"dueThisWeek":var c=new Date,h=c.getDay(),p=c.getDate()-h+(h==0?-6:1),d=new Date(c.setDate(p)),v=new Date(c.setDate(d.getDate()+7)),u,a;for(i;i<s;i++)u=(new Date(e[i].activity_date_time)).setHours(0,0,0,0),a=e[i].expire_date?(new Date(e[i].expire_date)).setHours(0,0,0,0):!1,(u>=d.setHours(0,0,0,0)&&u<v.setHours(0,0,0,0)||a&&a>=d.setHours(0,0,0,0)&&a<v.setHours(0,0,0,0))&&r.push(e[i])}return r}}])}),define("tasks-assignments/filters/offset",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("offset",["$log",function(e){return e.debug("Filter: offset"),function(e,t){return t=t||0,e.slice(parseInt(t,10))}}])}),define("tasks-assignments/filters/user-role",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByUserRole",["$filter","config","$log",function(e,t,n){return n.debug("Filter: filterByUserRole"),function(e,n,r){var i=[],s=0,o=e.length,r=typeof r!="undefined"?r:!0;if(!o||!n)return e;for(s;s<o;s++)e[s][n]==t.LOGGED_IN_CONTACT_ID==r&&i.push(e[s]);return i}}])}),define("tasks-assignments/filters/status",["tasks-assignments/filters/filters"],function(e){"use strict";e.filter("filterByStatus",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterByStatus"),function(e,t,n){var r=[],i=0,s=e.length,o=t.length,n=typeof n!="undefined"?n:!0;if(!s||!o)return e;for(i;i<s;i++)t.indexOf(e[i].status_id)!==-1==n&&r.push(e[i]);return r}}])}),define("tasks-assignments/app",["tasks-assignments/modules/config","tasks-assignments/modules/settings","tasks-assignments/modules/run","tasks-assignments/modules/app-dashboard","tasks-assignments/modules/app-documents","tasks-assignments/modules/app-tasks","tasks-assignments/modules/app-settings","tasks-assignments/controllers/controllers","tasks-assignments/controllers/calendar","tasks-assignments/controllers/date-list","tasks-assignments/controllers/document-list","tasks-assignments/controllers/document","tasks-assignments/controllers/assignments","tasks-assignments/controllers/main","tasks-assignments/controllers/task-list","tasks-assignments/controllers/task","tasks-assignments/controllers/dashboard/nav-main","tasks-assignments/controllers/dashboard/top-bar","tasks-assignments/controllers/modal/modal-dialog","tasks-assignments/controllers/modal/modal-document","tasks-assignments/controllers/modal/modal-progress","tasks-assignments/controllers/modal/modal-task","tasks-assignments/controllers/modal/modal-task-migrate","tasks-assignments/controllers/modal/modal-reminder","tasks-assignments/controllers/modal/modal-assignment","tasks-assignments/controllers/external-page","tasks-assignments/controllers/settings","tasks-assignments/directives/directives","tasks-assignments/directives/civi-events","tasks-assignments/directives/iframe","tasks-assignments/directives/spinner","tasks-assignments/directives/validate","tasks-assignments/filters/filters","tasks-assignments/filters/assignment-type","tasks-assignments/filters/contact-id","tasks-assignments/filters/date","tasks-assignments/filters/date-parse","tasks-assignments/filters/date-type","tasks-assignments/filters/due","tasks-assignments/filters/offset","tasks-assignments/filters/user-role","tasks-assignments/filters/status","tasks-assignments/services/services"],function(){"use strict";document.addEventListener("taInit",function(e){angular.bootstrap(document.getElementById(e.detail.module),["civitasks."+e.detail.app])}),document.dispatchEvent(typeof window.CustomEvent=="function"?new CustomEvent("taReady"):function(){var e=document.createEvent("Event");return e.initEvent("taReady",!0,!0),e}())}),function(){var e=CRM.Tasksassignments.extensionPath+"js/src/tasks-assignments";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"tasks-assignments":e,"tasks-assignments/vendor/angular-select":e+"/vendor/angular/select","tasks-assignments/vendor/angular-bootstrap-calendar":e+"/vendor/angular/angular-bootstrap-calendar-tpls-custom","tasks-assignments/vendor/angular-checklist-model":e+"/vendor/angular/checklist-model","tasks-assignments/vendor/angular-router":e+"/vendor/angular/angular-ui-router","tasks-assignments/vendor/angular-xeditable":e+"/vendor/angular/xeditable","tasks-assignments/vendor/angular-xeditable-civi":e+"/vendor/angular/xeditable-civi","tasks-assignments/vendor/text-angular":e+"/vendor/angular/textAngular.min","tasks-assignments/vendor/text-angular-rangy":e+"/vendor/angular/textAngular-rangy.min","tasks-assignments/vendor/text-angular-sanitize":e+"/vendor/angular/textAngular-sanitize.min"},shim:{"tasks-assignments/vendor/angular-xeditable-civi":{deps:["tasks-assignments/vendor/angular-xeditable","tasks-assignments/vendor/angular-select","tasks-assignments/vendor/text-angular"]},"tasks-assignments/vendor/text-angular":{deps:["tasks-assignments/vendor/text-angular-rangy","tasks-assignments/vendor/text-angular-sanitize"]}}}),require(["tasks-assignments/app"])}(require);
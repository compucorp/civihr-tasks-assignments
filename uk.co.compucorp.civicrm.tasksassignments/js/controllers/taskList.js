define(['controllers/controllers',        'services/contact'], function(controllers){    controllers.controller('TaskListCtrl',['$scope', '$modal', '$rootElement', '$rootScope', '$log', 'taskList',        'settings', 'ContactService',        function($scope, $modal, $rootElement, $rootScope, $log, taskList, settings, ContactService){            $log.debug('Controller: TaskListCtrl');            this.init = function(){                var contactIds;                if (taskList.length) {                    contactIds = this.collectCId(taskList);                }                if (contactIds && contactIds.length) {                    ContactService.get({'IN': contactIds}).then(function(data){                        ContactService.updateCache(data);                    });                }            }            this.collectCId = function(taskList){                var contactId = [];                angular.forEach(taskList,function(task){                    contactId.push(task.source_contact_id);                    if (task.assignee_contact_id && task.assignee_contact_id.length) {                        contactId.push(task.assignee_contact_id[0]);                    }                });                return contactId;            }            $scope.taskList = taskList;            $scope.modalTask = function(data) {                    var data = data || {},                    modalInstance = $modal.open({                        targetDomEl: $rootElement.find('div').eq(0),                        templateUrl: settings.pathTpl+'modal/task.html?v='+(new Date().getTime()),                        controller: 'ModalTaskCtrl',                        resolve: {                            data: function(){                                return data;                            }                        }                    });                modalInstance.result.then(function(results){                    angular.equals({}, data) ? $scope.taskList.push(results) : angular.extend(data,results);                }, function(){                    $log.info('Modal dismissed');                });            }            this.init();        }]);});
//! moment.js
//! version : 2.8.4
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

/**
 * CiviTasks Dashboard Calendar based on:
 * angular-bootstrap-calendar - A pure AngularJS bootstrap themed responsive calendar that can display events and has views for year, month, week and day
 * @version v0.10.6
 * @link https://github.com/mattlewis92/angular-bootstrap-calendar
 * @license MIT
 */

/**
 * State-based routing for AngularJS
 * @version v0.2.15
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

/*!
 * ui-select
 * http://github.com/angular-ui/ui-select
 * Version: 0.11.2 - 2015-03-17T04:08:46.474Z
 * License: MIT
 */

/**
 * @license Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2012, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.3
 * Build date: 26 February 2012
 */

/**
 * @license Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2012, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.3
 * Build date: 26 February 2012
 */

/**
 * @license AngularJS v1.3.10
 * (c) 2010-2014 Google, Inc. http://angularjs.org
 * License: MIT
 */

/*
@license textAngular
Author : Austin Anderson
License : 2013 MIT
Version 1.3.7

See README.md or https://github.com/fraywing/textAngular/wiki for requirements and use.
*/

/*
@license textAngular
Author : Austin Anderson
License : 2013 MIT
Version 1.3.11

See README.md or https://github.com/fraywing/textAngular/wiki for requirements and use.
*/

(function(){(function(t){function n(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function r(e,t){return Ct.call(e,t)}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function s(e){wt.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function o(e,t){var n=!0;return p(function(){return n&&(s(e),n=!1),t.apply(this,arguments)},t)}function u(e,t){yn[e]||(s(t),yn[e]=!0)}function a(e,t){return function(n){return m(e.call(this,n),t)}}function f(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function l(){}function c(e,t){t!==!1&&_(e),d(this,e),this._d=new Date(+e._d)}function h(e){var t=N(e),n=t.year||0,r=t.quarter||0,i=t.month||0,s=t.week||0,o=t.day||0,u=t.hour||0,a=t.minute||0,f=t.second||0,l=t.millisecond||0;this._milliseconds=+l+1e3*f+6e4*a+36e5*u,this._days=+o+7*s,this._months=+i+3*r+12*n,this._data={},this._locale=wt.localeData(),this._bubble()}function p(e,t){for(var n in t)r(t,n)&&(e[n]=t[n]);return r(t,"toString")&&(e.toString=t.toString),r(t,"valueOf")&&(e.valueOf=t.valueOf),e}function d(e,t){var n,r,i;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Ht.length>0)for(n in Ht)r=Ht[n],i=t[r],"undefined"!=typeof i&&(e[r]=i);return e}function v(e){return 0>e?Math.ceil(e):Math.floor(e)}function m(e,t,n){for(var r=""+Math.abs(e),i=e>=0;r.length<t;)r="0"+r;return(i?n?"+":"":"-")+r}function g(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t- +e.clone().add(n.months,"M"),n}function y(e,t){var n;return t=j(t,e),e.isBefore(t)?n=g(e,t):(n=g(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function b(e,t){return function(n,r){var i,s;return null===r||isNaN(+r)||(u(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),s=n,n=r,r=s),n="string"==typeof n?+n:n,i=wt.duration(n,r),w(this,i,e),this}}function w(e,t,n,r){var i=t._milliseconds,s=t._days,o=t._months;r=null==r?!0:r,i&&e._d.setTime(+e._d+i*n),s&&dt(e,"Date",pt(e,"Date")+s*n),o&&ht(e,pt(e,"Month")+o*n),r&&wt.updateOffset(e,s||o)}function E(e){return"[object Array]"===Object.prototype.toString.call(e)}function S(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function x(e,t,n){var r,i=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0;for(r=0;i>r;r++)(n&&e[r]!==t[r]||!n&&k(e[r])!==k(t[r]))&&o++;return o+s}function T(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=cn[e]||hn[t]||t}return e}function N(e){var t,n,i={};for(n in e)r(e,n)&&(t=T(n),t&&(i[t]=e[n]));return i}function C(e){var n,r;if(0===e.indexOf("week"))n=7,r="day";else{if(0!==e.indexOf("month"))return;n=12,r="month"}wt[e]=function(i,s){var o,u,a=wt._locale[e],f=[];if("number"==typeof i&&(s=i,i=t),u=function(e){var t=wt().utc().set(r,e);return a.call(wt._locale,t,i||"")},null!=s)return u(s);for(o=0;n>o;o++)f.push(u(o));return f}}function k(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function L(e,t){return(new Date(Date.UTC(e,t+1,0))).getUTCDate()}function A(e,t,n){return at(wt([e,11,31+t-n]),t,n).week}function O(e){return M(e)?366:365}function M(e){return e%4===0&&e%100!==0||e%400===0}function _(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Lt]<0||e._a[Lt]>11?Lt:e._a[At]<1||e._a[At]>L(e._a[kt],e._a[Lt])?At:e._a[Ot]<0||e._a[Ot]>24||24===e._a[Ot]&&(0!==e._a[Mt]||0!==e._a[_t]||0!==e._a[Dt])?Ot:e._a[Mt]<0||e._a[Mt]>59?Mt:e._a[_t]<0||e._a[_t]>59?_t:e._a[Dt]<0||e._a[Dt]>999?Dt:-1,e._pf._overflowDayOfYear&&(kt>t||t>At)&&(t=At),e._pf.overflow=t)}function D(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length&&e._pf.bigHour===t)),e._isValid}function P(e){return e?e.toLowerCase().replace("_","-"):e}function H(e){for(var t,n,r,i,s=0;s<e.length;){for(i=P(e[s]).split("-"),t=i.length,n=P(e[s+1]),n=n?n.split("-"):null;t>0;){if(r=B(i.slice(0,t).join("-")))return r;if(n&&n.length>=t&&x(i,n,!0)>=t-1)break;t--}s++}return null}function B(e){var t=null;if(!Pt[e]&&Bt)try{t=wt.locale(),require("./locale/"+e),wt.locale(t)}catch(n){}return Pt[e]}function j(e,t){var n,r;return t._isUTC?(n=t.clone(),r=(wt.isMoment(e)||S(e)?+e:+wt(e))- +n,n._d.setTime(+n._d+r),wt.updateOffset(n,!1),n):wt(e).local()}function F(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function I(e){var t,n,r=e.match(qt);for(t=0,n=r.length;n>t;t++)r[t]=gn[r[t]]?gn[r[t]]:F(r[t]);return function(i){var s="";for(t=0;n>t;t++)s+=r[t]instanceof Function?r[t].call(i,e):r[t];return s}}function q(e,t){return e.isValid()?(t=R(t,e.localeData()),pn[t]||(pn[t]=I(t)),pn[t](e)):e.localeData().invalidDate()}function R(e,t){function n(e){return t.longDateFormat(e)||e}var r=5;for(Rt.lastIndex=0;r>=0&&Rt.test(e);)e=e.replace(Rt,n),Rt.lastIndex=0,r-=1;return e}function U(e,t){var n,r=t._strict;switch(e){case"Q":return Yt;case"DDDD":return en;case"YYYY":case"GGGG":case"gggg":return r?tn:Wt;case"Y":case"G":case"g":return rn;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return r?nn:Xt;case"S":if(r)return Yt;case"SS":if(r)return Zt;case"SSS":if(r)return en;case"DDD":return zt;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return $t;case"a":case"A":return t._locale._meridiemParse;case"x":return Qt;case"X":return Gt;case"Z":case"ZZ":return Jt;case"T":return Kt;case"SSSS":return Vt;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return r?Zt:Ut;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Ut;case"Do":return r?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return n=new RegExp(G(Q(e.replace("\\","")),"i"))}}function z(e){e=e||"";var t=e.match(Jt)||[],n=t[t.length-1]||[],r=(n+"").match(fn)||["-",0,0],i=+(60*r[1])+k(r[2]);return"+"===r[0]?-i:i}function W(e,t,n){var r,i=n._a;switch(e){case"Q":null!=t&&(i[Lt]=3*(k(t)-1));break;case"M":case"MM":null!=t&&(i[Lt]=k(t)-1);break;case"MMM":case"MMMM":r=n._locale.monthsParse(t,e,n._strict),null!=r?i[Lt]=r:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(i[At]=k(t));break;case"Do":null!=t&&(i[At]=k(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=k(t));break;case"YY":i[kt]=wt.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":i[kt]=k(t);break;case"a":case"A":n._isPm=n._locale.isPM(t);break;case"h":case"hh":n._pf.bigHour=!0;case"H":case"HH":i[Ot]=k(t);break;case"m":case"mm":i[Mt]=k(t);break;case"s":case"ss":i[_t]=k(t);break;case"S":case"SS":case"SSS":case"SSSS":i[Dt]=k(1e3*("0."+t));break;case"x":n._d=new Date(k(t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=z(t);break;case"dd":case"ddd":case"dddd":r=n._locale.weekdaysParse(t),null!=r?(n._w=n._w||{},n._w.d=r):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=k(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=wt.parseTwoDigitYear(t)}}function X(e){var t,r,i,s,o,u,a;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(o=1,u=4,r=n(t.GG,e._a[kt],at(wt(),1,4).year),i=n(t.W,1),s=n(t.E,1)):(o=e._locale._week.dow,u=e._locale._week.doy,r=n(t.gg,e._a[kt],at(wt(),o,u).year),i=n(t.w,1),null!=t.d?(s=t.d,o>s&&++i):s=null!=t.e?t.e+o:o),a=ft(r,i,s,u,o),e._a[kt]=a.year,e._dayOfYear=a.dayOfYear}function V(e){var t,r,i,s,o=[];if(!e._d){for(i=J(e),e._w&&null==e._a[At]&&null==e._a[Lt]&&X(e),e._dayOfYear&&(s=n(e._a[kt],i[kt]),e._dayOfYear>O(s)&&(e._pf._overflowDayOfYear=!0),r=it(s,0,e._dayOfYear),e._a[Lt]=r.getUTCMonth(),e._a[At]=r.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=o[t]=i[t];for(;7>t;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[Ot]&&0===e._a[Mt]&&0===e._a[_t]&&0===e._a[Dt]&&(e._nextDay=!0,e._a[Ot]=0),e._d=(e._useUTC?it:rt).apply(null,o),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm),e._nextDay&&(e._a[Ot]=24)}}function $(e){var t;e._d||(t=N(e._i),e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],V(e))}function J(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function K(e){if(e._f===wt.ISO_8601)return void Z(e);e._a=[],e._pf.empty=!0;var n,r,i,s,o,u=""+e._i,a=u.length,f=0;for(i=R(e._f,e._locale).match(qt)||[],n=0;n<i.length;n++)s=i[n],r=(u.match(U(s,e))||[])[0],r&&(o=u.substr(0,u.indexOf(r)),o.length>0&&e._pf.unusedInput.push(o),u=u.slice(u.indexOf(r)+r.length),f+=r.length),gn[s]?(r?e._pf.empty=!1:e._pf.unusedTokens.push(s),W(s,r,e)):e._strict&&!r&&e._pf.unusedTokens.push(s);e._pf.charsLeftOver=a-f,u.length>0&&e._pf.unusedInput.push(u),e._pf.bigHour===!0&&e._a[Ot]<=12&&(e._pf.bigHour=t),e._isPm&&e._a[Ot]<12&&(e._a[Ot]+=12),e._isPm===!1&&12===e._a[Ot]&&(e._a[Ot]=0),V(e),_(e)}function Q(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,i){return t||n||r||i})}function G(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Y(e){var t,n,r,s,o;if(0===e._f.length)return e._pf.invalidFormat=!0,void (e._d=new Date(0/0));for(s=0;s<e._f.length;s++)o=0,t=d({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=i(),t._f=e._f[s],K(t),D(t)&&(o+=t._pf.charsLeftOver,o+=10*t._pf.unusedTokens.length,t._pf.score=o,(null==r||r>o)&&(r=o,n=t));p(e,n||t)}function Z(e){var t,n,r=e._i,i=sn.exec(r);if(i){for(e._pf.iso=!0,t=0,n=un.length;n>t;t++)if(un[t][1].exec(r)){e._f=un[t][0]+(i[6]||" ");break}for(t=0,n=an.length;n>t;t++)if(an[t][1].exec(r)){e._f+=an[t][0];break}r.match(Jt)&&(e._f+="Z"),K(e)}else e._isValid=!1}function et(e){Z(e),e._isValid===!1&&(delete e._isValid,wt.createFromInputFallback(e))}function tt(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function nt(e){var n,r=e._i;r===t?e._d=new Date:S(r)?e._d=new Date(+r):null!==(n=jt.exec(r))?e._d=new Date(+n[1]):"string"==typeof r?et(e):E(r)?(e._a=tt(r.slice(0),function(e){return parseInt(e,10)}),V(e)):"object"==typeof r?$(e):"number"==typeof r?e._d=new Date(r):wt.createFromInputFallback(e)}function rt(e,t,n,r,i,s,o){var u=new Date(e,t,n,r,i,s,o);return 1970>e&&u.setFullYear(e),u}function it(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function st(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function ot(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function ut(e,t,n){var r=wt.duration(e).abs(),i=Nt(r.as("s")),s=Nt(r.as("m")),o=Nt(r.as("h")),u=Nt(r.as("d")),a=Nt(r.as("M")),f=Nt(r.as("y")),l=i<dn.s&&["s",i]||1===s&&["m"]||s<dn.m&&["mm",s]||1===o&&["h"]||o<dn.h&&["hh",o]||1===u&&["d"]||u<dn.d&&["dd",u]||1===a&&["M"]||a<dn.M&&["MM",a]||1===f&&["y"]||["yy",f];return l[2]=t,l[3]=+e>0,l[4]=n,ot.apply({},l)}function at(e,t,n){var r,i=n-t,s=n-e.day();return s>i&&(s-=7),i-7>s&&(s+=7),r=wt(e).add(s,"d"),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function ft(e,t,n,r,i){var s,o,u=it(e,0,1).getUTCDay();return u=0===u?7:u,n=null!=n?n:i,s=i-u+(u>r?7:0)-(i>u?7:0),o=7*(t-1)+(n-i)+s+1,{year:o>0?e:e-1,dayOfYear:o>0?o:O(e-1)+o}}function lt(e){var n,r=e._i,i=e._f;return e._locale=e._locale||wt.localeData(e._l),null===r||i===t&&""===r?wt.invalid({nullInput:!0}):("string"==typeof r&&(e._i=r=e._locale.preparse(r)),wt.isMoment(r)?new c(r,!0):(i?E(i)?Y(e):K(e):nt(e),n=new c(e),n._nextDay&&(n.add(1,"d"),n._nextDay=t),n))}function ct(e,t){var n,r;if(1===t.length&&E(t[0])&&(t=t[0]),!t.length)return wt();for(n=t[0],r=1;r<t.length;++r)t[r][e](n)&&(n=t[r]);return n}function ht(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),L(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function pt(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function dt(e,t,n){return"Month"===t?ht(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function vt(e,t){return function(n){return null!=n?(dt(this,e,n),wt.updateOffset(this,t),this):pt(this,e)}}function mt(e){return 400*e/146097}function gt(e){return 146097*e/400}function yt(e){wt.duration.fn[e]=function(){return this._data[e]}}function bt(e){"undefined"==typeof ender&&(Et=Tt.moment,Tt.moment=e?o("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",wt):wt)}for(var wt,Et,St,xt="2.8.4",Tt="undefined"!=typeof global?global:this,Nt=Math.round,Ct=Object.prototype.hasOwnProperty,kt=0,Lt=1,At=2,Ot=3,Mt=4,_t=5,Dt=6,Pt={},Ht=[],Bt="undefined"!=typeof e&&e&&e.exports,jt=/^\/?Date\((\-?\d+)/i,Ft=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,It=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,qt=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Rt=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ut=/\d\d?/,zt=/\d{1,3}/,Wt=/\d{1,4}/,Xt=/[+\-]?\d{1,6}/,Vt=/\d+/,$t=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Jt=/Z|[\+\-]\d\d:?\d\d/gi,Kt=/T/i,Qt=/[\+\-]?\d+/,Gt=/[\+\-]?\d+(\.\d{1,3})?/,Yt=/\d/,Zt=/\d\d/,en=/\d{3}/,tn=/\d{4}/,nn=/[+-]?\d{6}/,rn=/[+-]?\d+/,sn=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,on="YYYY-MM-DDTHH:mm:ssZ",un=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],an=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],fn=/([\+\-]|\d\d)/gi,ln=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),cn={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},hn={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},pn={},dn={s:45,m:45,h:22,d:26,M:11},vn="DDD w W M D d".split(" "),mn="M D H h m s w W".split(" "),gn={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+m(Math.abs(e),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return k(this.milliseconds()/100)},SS:function(){return m(k(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(k(e/60),2)+":"+m(k(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(k(e/60),2)+m(k(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},yn={},bn=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];vn.length;)St=vn.pop(),gn[St+"o"]=f(gn[St],St);for(;mn.length;)St=mn.pop(),gn[St+St]=a(gn[St],2);gn.DDDD=a(gn.DDD,3),p(l.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,t,n){var r,i,s;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;12>r;r++){if(i=wt.utc([2e3,r]),n&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[r]||(s="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[r]=new RegExp(s.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!n&&this._monthsParse[r].test(e))return r}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=wt([2e3,1]).day(t),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,n){var r=this._calendar[e];return"function"==typeof r?r.apply(t,[n]):r},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return"function"==typeof i?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return at(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),wt=function(e,n,r,s){var o;return"boolean"==typeof r&&(s=r,r=t),o={},o._isAMomentObject=!0,o._i=e,o._f=n,o._l=r,o._strict=s,o._isUTC=!1,o._pf=i(),lt(o)},wt.suppressDeprecationWarnings=!1,wt.createFromInputFallback=o("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),wt.min=function(){var e=[].slice.call(arguments,0);return ct("isBefore",e)},wt.max=function(){var e=[].slice.call(arguments,0);return ct("isAfter",e)},wt.utc=function(e,n,r,s){var o;return"boolean"==typeof r&&(s=r,r=t),o={},o._isAMomentObject=!0,o._useUTC=!0,o._isUTC=!0,o._l=r,o._i=e,o._f=n,o._strict=s,o._pf=i(),lt(o).utc()},wt.unix=function(e){return wt(1e3*e)},wt.duration=function(e,t){var n,i,s,o,u=e,a=null;return wt.isDuration(e)?u={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(u={},t?u[t]=e:u.milliseconds=e):(a=Ft.exec(e))?(n="-"===a[1]?-1:1,u={y:0,d:k(a[At])*n,h:k(a[Ot])*n,m:k(a[Mt])*n,s:k(a[_t])*n,ms:k(a[Dt])*n}):(a=It.exec(e))?(n="-"===a[1]?-1:1,s=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*n},u={y:s(a[2]),M:s(a[3]),d:s(a[4]),h:s(a[5]),m:s(a[6]),s:s(a[7]),w:s(a[8])}):"object"==typeof u&&("from"in u||"to"in u)&&(o=y(wt(u.from),wt(u.to)),u={},u.ms=o.milliseconds,u.M=o.months),i=new h(u),wt.isDuration(e)&&r(e,"_locale")&&(i._locale=e._locale),i},wt.version=xt,wt.defaultFormat=on,wt.ISO_8601=function(){},wt.momentProperties=Ht,wt.updateOffset=function(){},wt.relativeTimeThreshold=function(e,n){return dn[e]===t?!1:n===t?dn[e]:(dn[e]=n,!0)},wt.lang=o("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return wt.locale(e,t)}),wt.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?wt.defineLocale(e,t):wt.localeData(e),n&&(wt.duration._locale=wt._locale=n)),wt._locale._abbr},wt.defineLocale=function(e,t){return null!==t?(t.abbr=e,Pt[e]||(Pt[e]=new l),Pt[e].set(t),wt.locale(e),Pt[e]):(delete Pt[e],null)},wt.langData=o("moment.langData is deprecated. Use moment.localeData instead.",function(e){return wt.localeData(e)}),wt.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return wt._locale;if(!E(e)){if(t=B(e))return t;e=[e]}return H(e)},wt.isMoment=function(e){return e instanceof c||null!=e&&r(e,"_isAMomentObject")},wt.isDuration=function(e){return e instanceof h};for(St=bn.length-1;St>=0;--St)C(bn[St]);wt.normalizeUnits=function(e){return T(e)},wt.invalid=function(e){var t=wt.utc(0/0);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},wt.parseZone=function(){return wt.apply(null,arguments).parseZone()},wt.parseTwoDigitYear=function(e){return k(e)+(k(e)>68?1900:2e3)},p(wt.fn=c.prototype,{clone:function(){return wt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=wt(this).utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():q(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):q(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return D(this)},isDSTShifted:function(){return this._a?this.isValid()&&x(this._a,(this._isUTC?wt.utc(this._a):wt(this._a)).toArray())>0:!1},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){return this._isUTC&&(this.zone(0,e),this._isUTC=!1,e&&this.add(this._dateTzOffset(),"m")),this},format:function(e){var t=q(this,e||wt.defaultFormat);return this.localeData().postformat(t)},add:b(1,"add"),subtract:b(-1,"subtract"),diff:function(e,t,n){var r,i,s,o=j(e,this),u=6e4*(this.zone()-o.zone());return t=T(t),"year"===t||"month"===t?(r=432e5*(this.daysInMonth()+o.daysInMonth()),i=12*(this.year()-o.year())+(this.month()-o.month()),s=this-wt(this).startOf("month")-(o-wt(o).startOf("month")),s-=6e4*(this.zone()-wt(this).startOf("month").zone()-(o.zone()-wt(o).startOf("month").zone())),i+=s/r,"year"===t&&(i/=12)):(r=this-o,i="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-u)/864e5:"week"===t?(r-u)/6048e5:r),n?i:v(i)},from:function(e,t){return wt.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(wt(),e)},calendar:function(e){var t=e||wt(),n=j(t,this).startOf("day"),r=this.diff(n,"days",!0),i=-6>r?"sameElse":-1>r?"lastWeek":0>r?"lastDay":1>r?"sameDay":2>r?"nextDay":7>r?"nextWeek":"sameElse";return this.format(this.localeData().calendar(i,this,wt(t)))},isLeapYear:function(){return M(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=st(e,this.localeData()),this.add(e-t,"d")):t},month:vt("Month",!0),startOf:function(e){switch(e=T(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(e){return e=T(e),e===t||"millisecond"===e?this:this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")},isAfter:function(e,t){var n;return t=T("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=wt.isMoment(e)?e:wt(e),+this>+e):(n=wt.isMoment(e)?+e:+wt(e),n<+this.clone().startOf(t))},isBefore:function(e,t){var n;return t=T("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=wt.isMoment(e)?e:wt(e),+e>+this):(n=wt.isMoment(e)?+e:+wt(e),+this.clone().endOf(t)<n)},isSame:function(e,t){var n;return t=T(t||"millisecond"),"millisecond"===t?(e=wt.isMoment(e)?e:wt(e),+this===+e):(n=+wt(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))},min:o("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=wt.apply(null,arguments),this>e?this:e}),max:o("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=wt.apply(null,arguments),e>this?this:e}),zone:function(e,t){var n,r=this._offset||0;return null==e?this._isUTC?r:this._dateTzOffset():("string"==typeof e&&(e=z(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(n=this._dateTzOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.subtract(n,"m"),r!==e&&(!t||this._changeInProgress?w(this,wt.duration(r-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,wt.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?wt(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return L(this.year(),this.month())},dayOfYear:function(e){var t=Nt((wt(this).startOf("day")-wt(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=at(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=at(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=at(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return A(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return A(this.year(),e.dow,e.doy)},get:function(e){return e=T(e),this[e]()},set:function(e,t){return e=T(e),"function"==typeof this[e]&&this[e](t),this},locale:function(e){var n;return e===t?this._locale._abbr:(n=wt.localeData(e),null!=n&&(this._locale=n),this)},lang:o("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return e===t?this.localeData():this.locale(e)}),localeData:function(){return this._locale},_dateTzOffset:function(){return 15*Math.round(this._d.getTimezoneOffset()/15)}}),wt.fn.millisecond=wt.fn.milliseconds=vt("Milliseconds",!1),wt.fn.second=wt.fn.seconds=vt("Seconds",!1),wt.fn.minute=wt.fn.minutes=vt("Minutes",!1),wt.fn.hour=wt.fn.hours=vt("Hours",!0),wt.fn.date=vt("Date",!0),wt.fn.dates=o("dates accessor is deprecated. Use date instead.",vt("Date",!0)),wt.fn.year=vt("FullYear",!0),wt.fn.years=o("years accessor is deprecated. Use year instead.",vt("FullYear",!0)),wt.fn.days=wt.fn.day,wt.fn.months=wt.fn.month,wt.fn.weeks=wt.fn.week,wt.fn.isoWeeks=wt.fn.isoWeek,wt.fn.quarters=wt.fn.quarter,wt.fn.toJSON=wt.fn.toISOString,p(wt.duration.fn=h.prototype,{_bubble:function(){var e,t,n,r=this._milliseconds,i=this._days,s=this._months,o=this._data,u=0;o.milliseconds=r%1e3,e=v(r/1e3),o.seconds=e%60,t=v(e/60),o.minutes=t%60,n=v(t/60),o.hours=n%24,i+=v(n/24),u=v(mt(i)),i-=v(gt(u)),s+=v(i/30),i%=30,u+=v(s/12),s%=12,o.days=i,o.months=s,o.years=u},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return v(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*k(this._months/12)},humanize:function(e){var t=ut(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=wt.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=wt.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=T(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=T(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*mt(t),"month"===e?n:n/12;switch(t=this._days+Math.round(gt(this._months/12)),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:wt.fn.lang,locale:wt.fn.locale,toIsoString:o("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),r=Math.abs(this.hours()),i=Math.abs(this.minutes()),s=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(r||i||s?"T":"")+(r?r+"H":"")+(i?i+"M":"")+(s?s+"S":""):"P0D"},localeData:function(){return this._locale}}),wt.duration.fn.toString=wt.duration.fn.toISOString;for(St in ln)r(ln,St)&&yt(St.toLowerCase());wt.duration.fn.asMilliseconds=function(){return this.as("ms")},wt.duration.fn.asSeconds=function(){return this.as("s")},wt.duration.fn.asMinutes=function(){return this.as("m")},wt.duration.fn.asHours=function(){return this.as("h")},wt.duration.fn.asDays=function(){return this.as("d")},wt.duration.fn.asWeeks=function(){return this.as("weeks")},wt.duration.fn.asMonths=function(){return this.as("M")},wt.duration.fn.asYears=function(){return this.as("y")},wt.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===k(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),Bt?e.exports=wt:"function"==typeof define&&define.amd?(define("moment",["require","exports","module"],function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(Tt.moment=Et),wt}),bt(!0)):bt()}).call(this),define("angularBootstrapCalendar",["moment"],function(e){angular.module("mwl.calendar",[]),angular.module("mwl.calendar").run(["$templateCache",function(e){e.put("src/templates/calendar.html",'<div class="cal-context" ng-switch="view"><div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div><div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div><mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year"></mwl-calendar-year><mwl-calendar-month events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month"></mwl-calendar-month><mwl-calendar-week events="events" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week"></mwl-calendar-week><mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day"></mwl-calendar-day></div>'),e.put("src/templates/calendarCustom.html",'<div class="cal-context" ng-switch="view"> <div class="alert alert-danger" ng-switch-default>The value passed to the view attribute of the calendar is not set</div> <div class="alert alert-danger" ng-hide="currentDay">The value passed to current-day attribute of the calendar is not set</div> <mwl-calendar-year events="events" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="year" ></mwl-calendar-year> <mwl-calendar-month events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" on-edit-event-click="onEditEventClick" on-delete-event-click="onDeleteEventClick" on-timespan-click="onTimespanClick" edit-event-html="editEventHtml" delete-event-html="deleteEventHtml" auto-open="autoOpen" ng-switch-when="month" ></mwl-calendar-month> <mwl-calendar-week events="events" documents="documents" current-day="currentDay" on-event-click="onEventClick" ng-switch-when="week" ></mwl-calendar-week> <mwl-calendar-day events="events" current-day="currentDay" on-event-click="onEventClick" day-view-start="dayViewStart" day-view-end="dayViewEnd" day-view-split="dayViewSplit || 30" ng-switch-when="day" ></mwl-calendar-day></div>'),e.put("src/templates/calendarDayView.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.timeLabel"></div><div class="span11 col-xs-11 cal-cell" ng-bind="vm.calendarConfig.i18nStrings.eventsLabel"></div></div><div class="cal-day-panel clearfix" ng-style="{height: (vm.hours.length * vm.hourHeight) + \'px\'}"><div class="cal-day-panel-hour"><div class="cal-day-hour" ng-repeat="hour in vm.hours track by $index"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><strong ng-bind="hour.label"></strong></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 30"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part" ng-show="vm.dayViewSplit < 15"><div class="span1 col-xs-1"></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight" ng-class="\'dh-event-\' + event.type" ng-repeat="event in vm.view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title | calendarTruncateEventTitle:20:event.height"></span></a></div></div></div>'),e.put("src/templates/calendarMonthDay.html",'<div class="cal-month-day" ng-class="{\n            \'cal-day-outmonth\': !day.inMonth,\n            \'cal-day-inmonth\': day.inMonth,\n            \'cal-day-weekend\': day.isWeekend,\n            \'cal-day-past\': day.isPast,\n            \'cal-day-today\': day.isToday,\n            \'cal-day-future\': day.isFuture\n          }"><small class="cal-events-num badge badge-important pull-left" ng-show="day.badgeTotal > 0" ng-bind="day.badgeTotal"></small> <span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" ng-bind="day.label"></span><div class="cal-day-tick" ng-show="dayIndex === vm.openDayIndex && vm.view[vm.openDayIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div ng-include="\'src/templates/calendarMonthEventsList.html\'"></div></div>'),e.put("src/templates/calendarMonthDayCustom.html",'<div class="cal-month-day" ng-class="{ \'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture }"> <ul class="cal-list-events-num"> <li ng-show="day.badgeEventsTotal > 0"> <small class="badge badge-danger-light" ng-bind="day.badgeEventsTotal"></small> Tasks </li> <li ng-show="day.badgeDocumentsTotal > 0"> <small class="badge badge-dark" ng-bind="day.badgeDocumentsTotal"></small> Documents </li> </ul> <span class="pull-right" data-cal-date ng-bind="day.label"> </span></div>'),e.put("src/templates/calendarMonthEventsList.html",'<div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" ng-repeat="event in day.events track by $index" class="pull-left event" ng-class="\'event-\' + event.type" ng-mouseenter="vm.highlightEvent(event, true)" ng-mouseleave="vm.highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div>'),e.put("src/templates/calendarMonthView.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"><div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"><div class="cal-row-fluid cal-before-eventlist"><div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.dayClicked(day)" ng-class="{pointer: day.events.length > 0}"><div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openDayIndex].events.length > 0" events="vm.view[vm.openDayIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>'),e.put("src/templates/calendarMonthViewCustom.html",'<div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.weekDays track by $index" ng-bind="day"></div></div><div class="cal-month-box"> <div ng-repeat="rowOffset in vm.monthOffsets track by rowOffset"> <div class="cal-row-fluid cal-before-eventlist"> <div ng-repeat="day in vm.view | calendarLimitTo:7:rowOffset track by $index" ng-init="dayIndex = vm.view.indexOf(day)" class="pointer cal-cell1 cal-cell {{ day.highlightClass }}" ng-click="vm.calendarCtrl.drillDown(day.date)"> <div ng-include="\'src/templates/calendarMonthDayCustom.html\'"></div> </div> </div> </div></div>'),e.put("src/templates/calendarSlideBox.html",'<div class="cal-slide-box" collapse="vm.shouldCollapse" mwl-collapse-fallback="vm.shouldCollapse"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in events track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="onEventClick({calendarEvent: event})"><span ng-bind="event.title"></span> <span ng-show="isMonthView">(<span ng-bind="event.startsAt | date:\'shortTime\'"></span>)</span> <span ng-show="isYearView">(<span ng-bind="event.startsAt | date:\'MMM d, h:mm a\'"></span>)</span></a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="vm.$sce.trustAsHtml(editEventHtml)" ng-click="onEditEventClick({calendarEvent: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="vm.$sce.trustAsHtml(deleteEventHtml)" ng-click="onDeleteEventClick({calendarEvent: event})"></a></li></ul></div></div>'),e.put("src/templates/calendarWeekView.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{\n        \'cal-day-weekend\': day.isWeekend,\n        \'cal-day-past\': day.isPast,\n        \'cal-day-today\': day.isToday,\n        \'cal-day-future\': day.isFuture}"><span ng-bind="day.weekDayLabel"></span><br><small><span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"></span></small></div></div><div class="cal-row-fluid" ng-repeat="event in vm.view.events track by $index"><div ng-class="\'cal-cell\' + event.daySpan + \' cal-offset\' + event.dayOffset + \' day-highlight dh-event-\' + event.type" data-event-class><a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"></a></div></div></div>'),e.put("src/templates/calendarWeekViewCustom.html",'<div class="cal-week-box"> <div class="cal-row-fluid cal-row-head"> <div class="cal-cell1" ng-repeat="day in vm.view.days track by $index" ng-class="{ \'cal-day-weekend\': day.isWeekend, \'cal-day-past\': day.isPast, \'cal-day-today\': day.isToday, \'cal-day-future\': day.isFuture}"> <span ng-bind="day.weekDayLabel"></span> <br> <small> <span data-cal-date ng-click="vm.calendarCtrl.drillDown(day.date)" class="pointer" ng-bind="day.dayLabel"> </span> </small> </div> </div> <div class="cal-col-fluid" ng-repeat="col in vm.view.cols track by $index"> <div class="cal-row-fluid" ng-repeat="event in col track by $index"> <div ng-if="event.title" ng-class="\'day-highlight dh-event-\' + event.type + \' dh-event-overdue-\' + event.overdue" data-event-class> <a href="javascript:;" ng-click="onEventClick({calendarEvent: event})" class="cal-event-week" ng-bind="event.title"> </a> </div> </div> </div></div>'),e.put("src/templates/calendarYearView.html",'<div class="cal-year-box"><div ng-repeat="rowOffset in [0, 4, 8] track by rowOffset"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in vm.view | calendarLimitTo:4:rowOffset track by $index" ng-init="monthIndex = vm.view.indexOf(month)" ng-click="vm.monthClicked(month)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.drillDown(month.date)" ng-bind="month.label"></span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.badgeTotal > 0" ng-bind="month.badgeTotal"></small><div class="cal-day-tick" ng-show="monthIndex === vm.openMonthIndex && vm.view[vm.openMonthIndex].events.length > 0"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><mwl-calendar-slide-box is-open="vm.openRowIndex === $index && vm.view[vm.openMonthIndex].events.length > 0" events="vm.view[vm.openMonthIndex].events" on-event-click="onEventClick" edit-event-html="editEventHtml" on-edit-event-click="onEditEventClick" delete-event-html="deleteEventHtml" on-delete-event-click="onDeleteEventClick"></mwl-calendar-slide-box></div></div>')}]),angular.module("mwl.calendar").constant("moment",e),angular.module("mwl.calendar").factory("calendarTitle",["moment","calendarConfig",function(e,t){function n(n){return e(n).format(t.titleFormats.day)}function r(n){var r=t.titleFormats.week;return r.replace("{week}",e(n).week()).replace("{year}",e(n).format("YYYY"))}function i(n){return e(n).format(t.titleFormats.month)}function s(n){return e(n).format(t.titleFormats.year)}return{day:n,week:r,month:i,year:s}}]),angular.module("mwl.calendar").factory("calendarHelper",["moment","calendarConfig",function(e,t){function n(t,n,r,i){return t=e(t),n=e(n),r=e(r),i=e(i),t.isAfter(r)&&t.isBefore(i)||n.isAfter(r)&&n.isBefore(i)||t.isBefore(r)&&n.isAfter(i)||t.isSame(r)||n.isSame(i)}function r(t,r,i){var s=e(t).startOf(r),o=e(t).endOf(r);return i.filter(function(e){return n(e.startsAt,e.endsAt,s,o)})}function i(e){return e.filter(function(e){return e.incrementsBadgeTotal!==!1}).length}function s(){var n=[],r=0;while(r<7)n.push(e().weekday(r++).format(t.dateFormats.weekDay));return n}function o(e,t,r){return e.filter(function(e){return n(e.startsAt,e.endsAt,t,r)})}function u(n,s){var u=[],a=r(s,"year",n),f=e(s).startOf("year"),l=0;while(l<12){var c=f.clone(),h=c.clone().endOf("month"),p=o(a,c,h);u.push({label:c.format(t.dateFormats.month),isToday:c.isSame(e().startOf("month")),events:p,date:c,badgeTotal:i(p)}),f.add(1,"month"),l++}return u}function a(t,n,s){var u=r(s,"month",t),a=r(s,"month",n),f=e(s).startOf("month"),l=f.clone().startOf("week"),c=e(s).endOf("month").endOf("week"),h=[],p=e().startOf("day");while(l.isBefore(c)){var d=l.month()===e(s).month(),v=[],m=[];d&&(v=o(u,l,l.clone().endOf("day")),m=o(a,l,l.clone().endOf("day"))),h.push({label:l.date(),date:l.clone(),inMonth:d,isPast:p.isAfter(l),isToday:p.isSame(l),isFuture:p.isBefore(l),isWeekend:[0,6].indexOf(l.day())>-1,events:v,documents:m,badgeEventsTotal:i(v),badgeDocumentsTotal:i(m)}),l.add(1,"day")}return h}function f(n,r,i){var s=e(i).startOf("week"),u=e(i).endOf("week"),a=s.clone(),f=[],l=[],c=0,h=e().startOf("day");while(f.length<7)l.push([]),f.push({weekDayLabel:a.format(t.dateFormats.weekDay),date:a.clone(),dayLabel:a.format(t.dateFormats.day),isPast:a.isBefore(h),isToday:a.isSame(h),isFuture:a.isAfter(h),isWeekend:[0,6].indexOf(a.day())>-1}),a.add(1,"day");var p=o(n.concat(r),s,u).map(function(t){var n=e(t.startsAt).startOf("day"),r=e(t.endsAt).startOf("day"),i=e(s).startOf("day"),o=e(u).startOf("day"),a,f;return n.isBefore(i)||n.isSame(i)?a=0:a=n.diff(i,"days"),r.isAfter(o)&&(r=o),n.isBefore(i)&&(n=i),f=e(r).diff(n,"days")+1,t.daySpan=f,t.dayOffset=a,t.overdue=n.isBefore(h),l[a].push(t),t});return l.map(function(e){c=e.length>c?e.length:c}),l.map(function(e){if(e.length<c)for(var t=e.length;t<c;t++)e.push({})}),{days:f,events:p,cols:l,rowsMax:c}}function l(t,r,i,s,u){var a=e(r).startOf("day").add(i,"hours"),f=e(r).startOf("day").add(s,"hours"),l=(s-i+1)*u,c=u/60,h=[],p=o(t,e(r).startOf("day").toDate(),e(r).endOf("day").toDate());return p.map(function(t){e(t.startsAt).isBefore(a)?t.top=0:t.top=e(t.startsAt).startOf("minute").diff(a.startOf("minute"),"minutes")*c-2;if(e(t.endsAt).isAfter(f))t.height=l-t.top;else{var n=t.startsAt;e(t.startsAt).isBefore(a)&&(n=a.toDate()),t.height=e(t.endsAt).diff(n,"minutes")*c}return t.top-t.height>l&&(t.height=0),t.left=0,t}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return h.forEach(function(r,i){var s=!0;r.forEach(function(t){if(n(e.startsAt,e.endsAt,t.startsAt,t.endsAt)||n(t.startsAt,t.endsAt,e.startsAt,e.endsAt))s=!1}),s&&t&&(t=!1,e.left=i*150,h[i].push(e))}),t&&(e.left=h.length*150,h.push([e])),e})}return{getWeekDayNames:s,getYearView:u,getMonthView:a,getWeekView:f,getDayView:l}}]),angular.module("mwl.calendar").service("calendarDebounce",["$timeout",function(e){function t(t,n,r){var i;return function(){function u(){i=null,r||t.apply(s,o)}var s=this,o=arguments,a=r&&!i;e.cancel(i),i=e(u,n),a&&t.apply(s,o)}}return t}]),angular.module("mwl.calendar").provider("calendarConfig",function(){var e={hour:"ha",day:"D MMM",month:"MMMM",weekDay:"dddd"},t={day:"dddd D MMMM, YYYY",week:"Week {week} of {year}",month:"MMMM YYYY",year:"YYYY"},n={eventsLabel:"Events",timeLabel:"Time"},r=this;r.setDateFormats=function(t){return angular.extend(e,t),r},r.setTitleFormats=function(e){return angular.extend(t,e),r},r.setI18nStrings=function(e){return angular.extend(n,e),r},r.$get=function(){return{dateFormats:e,titleFormats:t,i18nStrings:n}}}),angular.module("mwl.calendar").filter("calendarTruncateEventTitle",function(){return function(e,t,n){return e?e.length>=t&&e.length/20>n/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").filter("calendarLimitTo",function(){return function(e,t,n){return Math.abs(Number(t))===Infinity?t=Number(t):t=parseInt(t),isNaN(t)?e:(angular.isNumber(e)&&(e=e.toString()),!angular.isArray(e)&&!angular.isString(e)?e:(n=!n||isNaN(n)?0:parseInt(n),n=n<0&&n>=-e.length?e.length+n:n,t>=0?e.slice(n,n+t):n===0?e.slice(t,e.length):e.slice(Math.max(0,n+t),n)))}}),angular.module("mwl.calendar").directive("mwlDateModifier",function(){return{restrict:"A",controller:["$element","$attrs","$scope","moment",function(e,t,n,r){function i(){angular.isDefined(t.setToToday)?n.date=new Date:angular.isDefined(t.increment)?n.date=r(n.date).add(1,n.increment).toDate():angular.isDefined(t.decrement)&&(n.date=r(n.date).subtract(1,n.decrement).toDate()),n.$apply()}e.bind("click",i),n.$on("$destroy",function(){e.unbind("click",i)})}],scope:{date:"=",increment:"=",decrement:"="}}}),angular.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,n){var r=e.$watch(t.mwlCollapseFallback,function(e){e?n.addClass("ng-hide"):n.removeClass("ng-hide")}),i=e.$on("$destroy",function(){i(),r()})}]}}]),angular.module("mwl.calendar").directive("mwlCalendarYear",function(){return{templateUrl:"src/templates/calendarYearView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var r=this,i=!0;e.$on("calendar.refreshView",function(){r.view=n.getYearView(e.events,e.currentDay),e.autoOpen&&i&&(i=!1,r.view.forEach(function(n){t(e.currentDay).startOf("month").isSame(n.date)&&r.monthClicked(n,!0)}))}),r.monthClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),r.openRowIndex=null;var i=r.view.indexOf(t);i===r.openMonthIndex?r.openMonthIndex=null:(r.openMonthIndex=i,r.openRowIndex=Math.floor(i/4))}}],controllerAs:"vm",link:function(e,t,n,r){e.vm.calendarCtrl=r}}}),angular.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"src/templates/calendarWeekViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{documents:"=",events:"=",currentDay:"=",onEventClick:"="},controller:["$scope","calendarHelper",function(e,t){var n=this;e.$on("calendar.refreshView",function(){n.view=t.getWeekView(e.events,e.documents,e.currentDay)})}],controllerAs:"vm",link:function(e,t,n,r){e.vm.calendarCtrl=r}}}),angular.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"src/templates/calendarSlideBox.html",replace:!0,controller:["$scope","$sce",function(e,t){var n=this;n.$sce=t;var r=e.$watch("isOpen",function(e){n.shouldCollapse=!e}),i=e.$on("$destroy",function(){i(),r()})}],controllerAs:"vm",require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,n,r){e.isMonthView=!!r[0],e.isYearView=!!r[1]},scope:{isOpen:"=",events:"=",onEventClick:"=",editEventHtml:"=",onEditEventClick:"=",deleteEventHtml:"=",onDeleteEventClick:"="}}}),angular.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"src/templates/calendarMonthViewCustom.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",documents:"=",currentDay:"=",onEventClick:"=",onEditEventClick:"=",onDeleteEventClick:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onTimespanClick:"="},controller:["$scope","moment","calendarHelper",function(e,t,n){var r=this,i=!0;e.$on("calendar.refreshView",function(){r.weekDays=n.getWeekDayNames(),r.view=n.getMonthView(e.events,e.documents,e.currentDay);var s=Math.floor(r.view.length/7);r.monthOffsets=[];for(var o=0;o<s;o++)r.monthOffsets.push(o*7);e.autoOpen&&i&&(i=!1,r.view.forEach(function(n){n.inMonth&&t(e.currentDay).startOf("day").isSame(n.date)&&r.dayClicked(n,!0)}))}),r.dayClicked=function(t,n){n||e.onTimespanClick({calendarDate:t.date.toDate()}),r.openRowIndex=null;var i=r.view.indexOf(t);i===r.openDayIndex?r.openDayIndex=null:(r.openDayIndex=i,r.openRowIndex=Math.floor(i/7))},r.highlightEvent=function(e,t){r.view.forEach(function(n){delete n.highlightClass;if(t){var r=n.events.indexOf(e)>-1;r&&(n.highlightClass="day-highlight dh-event-"+e.type)}})}}],controllerAs:"vm",link:function(e,t,n,r){e.vm.calendarCtrl=r}}}),angular.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"src/templates/calendarDayView.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=",currentDay:"=",onEventClick:"=",dayViewStart:"=",dayViewEnd:"=",dayViewSplit:"="},controller:["$scope","$timeout","moment","calendarHelper","calendarConfig",function(e,t,n,r,i){function a(){o=n(e.dayViewStart||"00:00","HH:mm"),u=n(e.dayViewEnd||"23:00","HH:mm"),s.dayViewSplit=parseInt(e.dayViewSplit),s.hourHeight=60/e.dayViewSplit*30,s.hours=[];var t=n(o);for(var r=0;r<=u.diff(o,"hours");r++)s.hours.push({label:t.format(i.dateFormats.hour)}),t.add(1,"hour")}var s=this,o,u;s.calendarConfig=i;var f=n.locale();e.$on("calendar.refreshView",function(){f!==n.locale()&&(f=n.locale(),a()),s.view=r.getDayView(e.events,e.currentDay,o.hours(),u.hours(),s.hourHeight)}),a()}],controllerAs:"vm"}}),angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"src/templates/calendarCustom.html",restrict:"EA",scope:{events:"=",documents:"=",view:"=",viewTitle:"=",currentDay:"=",editEventHtml:"=",deleteEventHtml:"=",autoOpen:"=",onEventClick:"&",onEditEventClick:"&",onDeleteEventClick:"&",onTimespanClick:"&",onDrillDownClick:"&",dayViewStart:"@",dayViewEnd:"@",dayViewSplit:"@"},controller:["$scope","$timeout","moment","calendarTitle","calendarDebounce",function(e,t,n,r,i){var s=this;e.events=e.events||[],e.documents=e.documents||[],s.changeView=function(t,n){e.view=t,e.currentDay=n},s.drillDown=function(t){var r=n(t).toDate(),i={year:"month",month:"day",week:"day"};e.onDrillDownClick({calendarDate:r,calendarNextView:i[e.view]})!==!1&&s.changeView(i[e.view],r)};var o=n(e.currentDay),u=angular.copy(e.view),a=i(function(){r[e.view]&&(e.viewTitle=r[e.view](e.currentDay));var t=n(e.currentDay),i=!0;o.clone().startOf(e.view).isSame(t.clone().startOf(e.view))&&!o.isSame(t)&&e.view===u&&(i=!1),o=t,u=angular.copy(e.view),i&&e.$broadcast("calendar.refreshView")},50),f=e.$watch(function(){return n.locale()},a),l=[];l.push(f),l.push(e.$watch("currentDay",a)),l.push(e.$watch("view",a)),l.push(e.$watch("events",a,!0)),l.push(e.$watch("documents",a,!0));var c=e.$on("$destroy",function(){l.forEach(function(e){e()})});l.push(c)}]}})}),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,t){function n(e,t,n){if(angular.isArray(e))for(var r=e.length;r--;)if(n(e[r],t))return!0;return!1}function r(e,t,r){return e=angular.isArray(e)?e:[],n(e,t,r)||e.push(t),e}function i(e,t,n){if(angular.isArray(e))for(var r=e.length;r--;)if(n(e[r],t)){e.splice(r,1);break}return e}function s(s,o,u){function p(e,t){s.checked=n(e,c,h)}t(o)(s);var a=e(u.checklistModel),f=a.assign,l=e(u.checklistChange),c=e(u.checklistValue)(s.$parent),h=angular.equals;u.hasOwnProperty("checklistComparator")&&(h=e(u.checklistComparator)(s.$parent)),s.$watch("checked",function(e,t){if(e===t)return;var n=a(s.$parent);e===!0?f(s.$parent,r(n,c,h)):f(s.$parent,i(n,c,h)),l&&l(s)}),angular.isFunction(s.$parent.$watchCollection)?s.$parent.$watchCollection(u.checklistModel,p):s.$parent.$watch(u.checklistModel,p,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if(e[0].tagName!=="INPUT"||t.type!=="checkbox")throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!t.checklistValue)throw"You should provide `checklist-value`.";return e.removeAttr("checklist-model"),e.attr("ng-model","checked"),s}}}]),define("angularChecklistModel",function(){}),typeof e!="undefined"&&typeof exports!="undefined"&&e.exports===exports&&(e.exports="ui.router"),function(e,t,n){function c(e,t){return f(new(f(function(){},{prototype:e})),t)}function h(e){return a(arguments,function(t){t!==e&&a(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function p(e,t){var n=[];for(var r in e.path){if(e.path[r]!==t.path[r])break;n.push(e.path[r])}return n}function d(e){if(Object.keys)return Object.keys(e);var t=[];return a(e,function(e,n){t.push(n)}),t}function v(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,r=Number(arguments[2])||0;r=r<0?Math.ceil(r):Math.floor(r),r<0&&(r+=n);for(;r<n;r++)if(r in e&&e[r]===t)return r;return-1}function m(e,t,n,r){var i=p(n,r),s,o={},u=[];for(var a in i){if(!i[a].params)continue;s=d(i[a].params);if(!s.length)continue;for(var l in s){if(v(u,s[l])>=0)continue;u.push(s[l]),o[s[l]]=e[s[l]]}}return f({},o,t)}function g(e,t,n){if(!n){n=[];for(var r in e)n.push(r)}for(var i=0;i<n.length;i++){var s=n[i];if(e[s]!=t[s])return!1}return!0}function y(e,t){var n={};return a(e,function(e){n[e]=t[e]}),n}function b(e,t){var n={};return a(e,function(e){n[e[t]]=e}),n}function w(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return a(n,function(n){n in e&&(t[n]=e[n])}),t}function E(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var r in e)v(n,r)==-1&&(t[r]=e[r]);return t}function S(e,t){var n=u(e)?[]:{};return a(e,function(e,r){n[r]=i(t)?t(e):e[t]}),n}function x(e,t){var n=u(e),r=n?[]:{};return a(e,function(e,i){t(e,i)&&(r[n?r.length:i]=e)}),r}function T(e,t){var n=u(e)?[]:{};return a(e,function(e,r){n[r]=t(e,r)}),n}function N(e,t){var i=1,u=2,l={},c=[],p=l,m=f(e.when(l),{$$promises:l,$$values:l});this.study=function(l){function S(e,n){if(w[n]===u)return;b.push(n);if(w[n]===i)throw b.splice(0,v(b,n)),new Error("Cyclic dependency: "+b.join(" -> "));w[n]=i;if(s(e))y.push(n,[function(){return t.get(e)}],c);else{var r=t.annotate(e);a(r,function(e){e!==n&&l.hasOwnProperty(e)&&S(l[e],e)}),y.push(n,e,r)}b.pop(),w[n]=u}function x(e){return o(e)&&e.then&&e.$$promises}if(!o(l))throw new Error("'invocables' must be an object");var g=d(l||{}),y=[],b=[],w={};return a(l,S),l=b=w=null,function(i,s,u){function S(){--b||(w||h(v,s.$$values),c.$$values=v,c.$$promises=c.$$promises||!0,delete c.$$inheritedValues,l.resolve(v))}function T(e){c.$$failure=e,l.reject(e)}function k(n,s,o){function h(e){f.reject(e),T(e)}function p(){if(r(c.$$failure))return;try{f.resolve(t.invoke(s,u,v)),f.promise.then(function(e){v[n]=e,S()},h)}catch(e){h(e)}}var f=e.defer(),l=0;a(o,function(e){d.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&(l++,d[e].then(function(t){v[e]=t,--l||p()},h))}),l||p(),d[n]=f.promise}x(i)&&u===n&&(u=s,s=i,i=null);if(!i)i=p;else if(!o(i))throw new Error("'locals' must be an object");if(!s)s=m;else if(!x(s))throw new Error("'parent' must be a promise returned by $resolve.resolve()");var l=e.defer(),c=l.promise,d=c.$$promises={},v=f({},i),b=1+y.length/3,w=!1;if(r(s.$$failure))return T(s.$$failure),c;s.$$inheritedValues&&h(v,E(s.$$inheritedValues,g)),f(d,s.$$promises),s.$$values?(w=h(v,E(s.$$values,g)),c.$$inheritedValues=E(s.$$values,g),S()):(s.$$inheritedValues&&(c.$$inheritedValues=E(s.$$inheritedValues,g)),s.then(S,T));for(var N=0,C=y.length;N<C;N+=3)i.hasOwnProperty(y[N])?S():k(y[N],y[N+1],y[N+2]);return c}},this.resolve=function(e,t,n,r){return this.study(e)(t,n,r)}}function C(e,t,n){this.fromConfig=function(e,t,n){return r(e.template)?this.fromString(e.template,t):r(e.templateUrl)?this.fromUrl(e.templateUrl,t):r(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return i(e)?e(t):e},this.fromUrl=function(n,r){return i(n)&&(n=n(r)),n==null?null:e.get(n,{cache:t,headers:{Accept:"text/html"}}).then(function(e){return e.data})},this.fromProvider=function(e,t,r){return n.invoke(e,null,r||{params:t})}}function L(e,t,r){function m(t,n,r,i){v.push(t);if(p[t])return p[t];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(d[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");return d[t]=new k.Param(t,n,r,i),d[t]}function g(e,t,n,r){var i=["",""],s=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return s;switch(n){case!1:i=["(",")"+(r?"?":"")];break;case!0:i=["?(",")?"];break;default:i=["("+n+"|",")?"]}return s+i[0]+t+i[1]}function y(r,i){var s,o,u,f,l,h;return s=r[2]||r[3],l=t.params[s],u=e.substring(a,r.index),o=i?r[4]:r[4]||(r[1]=="*"?".*":null),f=k.type(o||"string")||c(k.type("string"),{pattern:new RegExp(o,t.caseInsensitive?"i":n)}),{id:s,regexp:o,segment:u,type:f,cfg:l}}t=f({params:{}},o(t)?t:{});var i=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,s=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,u="^",a=0,l,h=this.segments=[],p=r?r.params:{},d=this.params=r?r.params.$$new():new k.ParamSet,v=[];this.source=e;var b,w,E;while(l=i.exec(e)){b=y(l,!1);if(b.segment.indexOf("?")>=0)break;w=m(b.id,b.type,b.cfg,"path"),u+=g(b.segment,w.type.pattern.source,w.squash,w.isOptional),h.push(b.segment),a=i.lastIndex}E=e.substring(a);var S=E.indexOf("?");if(S>=0){var x=this.sourceSearch=E.substring(S);E=E.substring(0,S),this.sourcePath=e.substring(0,a+S);if(x.length>0){a=0;while(l=s.exec(x))b=y(l,!0),w=m(b.id,b.type,b.cfg,"search"),a=i.lastIndex}}else this.sourcePath=e,this.sourceSearch="";u+=g(E)+(t.strict===!1?"/?":"")+"$",h.push(E),this.regexp=new RegExp(u,t.caseInsensitive?"i":n),this.prefix=h[0],this.$$paramNames=v}function A(e){f(this,e)}function O(){function p(e){return e!=null?e.toString().replace(/\//g,"%2F"):e}function m(e){return e!=null?e.toString().replace(/%2F/g,"/"):e}function S(){return{strict:l,caseInsensitive:e}}function N(e){return i(e)||u(e)&&i(e[e.length-1])}function C(){while(b.length){var e=b.shift();if(e.pattern)throw new Error("You cannot override a type's .pattern at runtime.");t.extend(g[e.name],w.invoke(e.def))}}function M(e){f(this,e||{})}k=this;var e=!1,l=!0,h=!1,g={},y=!0,b=[],w,E={string:{encode:p,decode:m,is:function(e){return e==null||!r(e)||typeof e=="string"},pattern:/[^/]*/},"int":{encode:p,decode:function(e){return parseInt(e,10)},is:function(e){return r(e)&&this.decode(e.toString())===e},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return parseInt(e,10)!==0},is:function(e){return e===!0||e===!1},pattern:/0|1/},date:{encode:function(e){return this.is(e)?[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-"):n},decode:function(e){if(this.is(e))return e;var t=this.capture.exec(e);return t?new Date(t[1],t[2]-1,t[3]):n},is:function(e){return e instanceof Date&&!isNaN(e.valueOf())},equals:function(e,t){return this.is(e)&&this.is(t)&&e.toISOString()===t.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:t.toJson,decode:t.fromJson,is:t.isObject,equals:t.equals,pattern:/[^/]*/},any:{encode:t.identity,decode:t.identity,equals:t.equals,pattern:/.*/}};O.$$getDefaultValue=function(e){if(!N(e.value))return e.value;if(!w)throw new Error("Injectable functions cannot be called at configuration time");return w.invoke(e.value)},this.caseInsensitive=function(t){return r(t)&&(e=t),e},this.strictMode=function(e){return r(e)&&(l=e),l},this.defaultSquashPolicy=function(e){if(!r(e))return h;if(e!==!0&&e!==!1&&!s(e))throw new Error("Invalid squash policy: "+e+". Valid policies: false, true, arbitrary-string");return h=e,e},this.compile=function(e,t){return new L(e,f(S(),t))},this.isMatcher=function(e){if(!o(e))return!1;var t=!0;return a(L.prototype,function(n,s){i(n)&&(t=t&&r(e[s])&&i(e[s]))}),t},this.type=function(e,t,n){if(!r(t))return g[e];if(g.hasOwnProperty(e))throw new Error("A type named '"+e+"' has already been defined.");return g[e]=new A(f({name:e},t)),n&&(b.push({name:e,def:n}),y||C()),this},a(E,function(e,t){g[t]=new A(f({name:t},e))}),g=c(g,{}),this.$get=["$injector",function(e){return w=e,y=!1,C(),a(E,function(e,t){g[t]||(g[t]=new A(e))}),this}],this.Param=function(t,i,a,l){function E(e){var t=o(e)?d(e):[],n=v(t,"value")===-1&&v(t,"type")===-1&&v(t,"squash")===-1&&v(t,"array")===-1;return n&&(e={value:e}),e.$$fn=N(e.value)?e.value:function(){return e.value},e}function S(e,n,r){if(e.type&&n)throw new Error("Param '"+t+"' has two type configurations.");return n?n:e.type?e.type instanceof A?e.type:new A(e.type):r==="config"?g.any:g.string}function C(){var e={array:l==="search"?"auto":!1},n=t.match(/\[\]$/)?{array:!0}:{};return f(e,n,a).array}function k(e,t){var n=e.squash;if(!t||n===!1)return!1;if(!r(n)||n==null)return h;if(n===!0||s(n))return n;throw new Error("Invalid squash policy: '"+n+"'. Valid policies: false, true, or arbitrary string")}function L(e,t,r,i){var o,a,f=[{from:"",to:r||t?n:""},{from:null,to:r||t?n:""}];return o=u(e.replace)?e.replace:[],s(i)&&o.push({from:i,to:n}),a=T(o,function(e){return e.from}),x(f,function(e){return v(a,e.from)===-1}).concat(o)}function O(){if(!w)throw new Error("Injectable functions cannot be called at configuration time");var e=w.invoke(a.$$fn);if(e!==null&&e!==n&&!c.type.is(e))throw new Error("Default value ("+e+") for parameter '"+c.id+"' is not an instance of Type ("+c.type.name+")");return e}function M(e){function t(e){return function(t){return t.from===e}}function n(e){var n=T(x(c.replace,t(e)),function(e){return e.to});return n.length?n[0]:e}return e=n(e),r(e)?c.type.$normalize(e):O()}function _(){return"{Param:"+t+" "+i+" squash: '"+y+"' optional: "+m+"}"}var c=this;a=E(a),i=S(a,i,l);var p=C();i=p?i.$asArray(p,l==="search"):i,i.name==="string"&&!p&&l==="path"&&a.value===n&&(a.value="");var m=a.value!==n,y=k(a,m),b=L(a,p,m,y);f(this,{id:t,type:i,location:l,array:p,squash:y,replace:b,isOptional:m,value:M,dynamic:n,config:a,toString:_})},M.prototype={$$new:function(){return c(this,f(new M,{$$parent:this}))},$$keys:function(){var e=[],t=[],n=this,r=d(M.prototype);while(n)t.push(n),n=n.$$parent;return t.reverse(),a(t,function(t){a(d(t),function(t){v(e,t)===-1&&v(r,t)===-1&&e.push(t)})}),e},$$values:function(e){var t={},n=this;return a(n.$$keys(),function(r){t[r]=n[r].value(e&&e[r])}),t},$$equals:function(e,t){var n=!0,r=this;return a(r.$$keys(),function(i){var s=e&&e[i],o=t&&t[i];r[i].type.equals(s,o)||(n=!1)}),n},$$validates:function(r){var i=this.$$keys(),s,o,u,a,f;for(s=0;s<i.length;s++){o=this[i[s]],u=r[i[s]];if(!(u!==n&&u!==null||!o.isOptional))break;a=o.type.$normalize(u);if(!o.type.is(a))return!1;f=o.type.encode(a);if(t.isString(f)&&!o.type.pattern.exec(f))return!1}return!0},$$parent:n},this.ParamSet=M}function M(e,o){function p(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return t!=null?t[1].replace(/\\(.)/g,"$1"):""}function d(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t[n==="$"?0:Number(n)]})}function v(e,t,n){if(!n)return!1;var i=e.invoke(t,t,{$match:n});return r(i)?i:!0}function m(r,i,o,u){function v(e,t,n){return f==="/"?e:t?f.slice(0,-1)+e:n?f.slice(1)+e:e}function m(e){function i(e){var t=e(o,r);return t?(s(t)&&r.replace().url(t),!0):!1}if(e&&e.defaultPrevented)return;var t=d&&r.url()===d;d=n;var u=a.length,f;for(f=0;f<u;f++)if(i(a[f]))return;l&&i(l)}function g(){return h=h||i.$on("$locationChangeSuccess",m),h}var f=u.baseHref(),p=r.url(),d;return c||g(),{sync:function(){m()},listen:function(){return g()},update:function(e){if(e){p=r.url();return}if(r.url()===p)return;r.url(p),r.replace()},push:function(e,t,i){var s=e.format(t||{});s!==null&&t&&t["#"]&&(s+="#"+t["#"]),r.url(s),d=i&&i.$$avoidResync?r.url():n,i&&i.replace&&r.replace()},href:function(n,i,s){if(!n.validates(i))return null;var o=e.html5Mode();t.isObject(o)&&(o=o.enabled);var u=n.format(i);s=s||{},!o&&u!==null&&(u="#"+e.hashPrefix()+u),u!==null&&i&&i["#"]&&(u+="#"+i["#"]),u=v(u,o,s.absolute);if(!s.absolute||!u)return u;var a=!o&&u?"/":"",f=r.port();return f=f===80||f===443?"":":"+f,[r.protocol(),"://",r.host(),f,a,u].join("")}}}var a=[],l=null,c=!1,h;this.rule=function(e){if(!i(e))throw new Error("'rule' must be a function");return a.push(e),this},this.otherwise=function(e){if(s(e)){var t=e;e=function(){return t}}else if(!i(e))throw new Error("'rule' must be a function");return l=e,this},this.when=function(e,t){var n,r=s(t);s(e)&&(e=o.compile(e));if(!r&&!i(t)&&!u(t))throw new Error("invalid 'handler' in when()");var a={matcher:function(e,t){return r&&(n=o.compile(t),t=["$match",function(e){return n.format(e)}]),f(function(n,r){return v(n,t,e.exec(r.path(),r.search()))},{prefix:s(e.prefix)?e.prefix:""})},regex:function(e,t){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return r&&(n=t,t=["$match",function(e){return d(n,e)}]),f(function(n,r){return v(n,t,e.exec(r.path()))},{prefix:p(e)})}},l={matcher:o.isMatcher(e),regex:e instanceof RegExp};for(var c in l)if(l[c])return this.rule(a[c](e,t));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(e){e===n&&(e=!0),c=e},this.$get=m,m.$inject=["$location","$rootScope","$injector","$browser"]}function _(e,h){function C(e){return e.indexOf(".")===0||e.indexOf("^")===0}function L(e,t){if(!e)return n;var r=s(e),i=r?e:e.name,o=C(i);if(o){if(!t)throw new Error("No reference point given for path '"+i+"'");t=L(t);var u=i.split("."),a=0,f=u.length,l=t;for(;a<f;a++){if(u[a]===""&&a===0){l=t;continue}if(u[a]==="^"){if(!l.parent)throw new Error("Path '"+i+"' not valid for state '"+t.name+"'");l=l.parent;continue}break}u=u.slice(a).join("."),i=l.name+(l.name&&u?".":"")+u}var c=b[i];return c&&(r||!r&&(c===e||c.self===e))?c:n}function A(e,t){S[e]||(S[e]=[]),S[e].push(t)}function O(e){var t=S[e]||[];while(t.length)M(t.shift())}function M(t){t=c(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}});var n=t.name;if(!s(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(b.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var r=n.indexOf(".")!==-1?n.substring(0,n.lastIndexOf(".")):s(t.parent)?t.parent:o(t.parent)&&s(t.parent.name)?t.parent.name:"";if(r&&!b[r])return A(r,t.self);for(var u in N)i(N[u])&&(t[u]=N[u](t,N.$delegates[u]));return b[n]=t,!t[x]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){(E.$current.navigable!=t||!g(e,n))&&E.transitionTo(t,e,{inherit:!0,location:!1})}]),O(n),t}function _(e){return e.indexOf("*")>-1}function D(e){var t=e.split("."),n=E.$current.name.split(".");for(var r=0,i=t.length;r<i;r++)t[r]==="*"&&(n[r]="*");return t[0]==="**"&&(n=n.slice(v(n,t[1])),n.unshift("**")),t[t.length-1]==="**"&&(n.splice(v(n,t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length!=n.length?!1:n.join("")===t.join("")}function P(e,t){return s(e)&&!r(t)?N[e]:!i(t)||!s(e)?this:(N[e]&&!N.$delegates[e]&&(N.$delegates[e]=N[e]),N[e]=t,this)}function H(e,t){return o(e)?t=e:t.name=e,M(t),this}function B(e,h,v,w,S,N,C,k,A){function B(t,n,r,i){var s=e.$broadcast("$stateNotFound",t,n,r);if(s.defaultPrevented)return C.update(),P;if(!s.retry)return null;if(i.$retry)return C.update(),H;var o=E.transition=h.when(s.retry);return o.then(function(){return o!==E.transition?O:(t.options.$retry=!0,E.transitionTo(t.to,t.toParams,t.options))},function(){return P}),C.update(),o}function F(e,n,r,s,o,f){function d(){var n=[];return a(e.views,function(r,s){var a=r.resolve&&r.resolve!==e.resolve?r.resolve:{};a.$template=[function(){return v.load(s,{view:r,locals:o.globals,params:l,notify:f.notify})||""}],n.push(S.resolve(a,o.globals,o.resolve,e).then(function(n){if(i(r.controllerProvider)||u(r.controllerProvider)){var f=t.extend({},a,o.globals);n.$$controller=w.invoke(r.controllerProvider,null,f)}else n.$$controller=r.controller;n.$$state=e,n.$$controllerAs=r.controllerAs,o[s]=n}))}),h.all(n).then(function(){return o.globals})}var l=r?n:y(e.params.$$keys(),n),c={$stateParams:l};o.resolve=S.resolve(e.resolve,c,o.resolve,e);var p=[o.resolve.then(function(e){o.globals=e})];return s&&p.push(s),h.all(p).then(d).then(function(e){return o})}var O=h.reject(new Error("transition superseded")),M=h.reject(new Error("transition prevented")),P=h.reject(new Error("transition aborted")),H=h.reject(new Error("transition failed"));return p.locals={resolve:null,globals:{$stateParams:{}}},E={params:{},current:p.self,$current:p,transition:null},E.reload=function(t){return E.transitionTo(E.current,N,{reload:t||!0,inherit:!1,notify:!0})},E.go=function(t,n,r){return E.transitionTo(t,n,f({inherit:!0,relative:E.$current},r))},E.transitionTo=function(n,i,u){i=i||{},u=f({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},u||{});var a=E.$current,d=E.params,v=a.path,g,b=L(n,u.relative),S=i["#"];if(!r(b)){var T={to:n,toParams:i,options:u},k=B(T,a.self,d,u);if(k)return k;n=T.to,i=T.toParams,u=T.options,b=L(n,u.relative);if(!r(b))throw u.relative?new Error("Could not resolve '"+n+"' from state '"+u.relative+"'"):new Error("No such state '"+n+"'")}if(b[x])throw new Error("Cannot transition to abstract state '"+n+"'");u.inherit&&(i=m(N,i||{},E.$current,b));if(!b.params.$$validates(i))return H;i=b.params.$$values(i),n=b;var A=n.path,_=0,D=A[_],P=p.locals,I=[];if(!u.reload)while(D&&D===v[_]&&D.ownParams.$$equals(i,d))P=I[_]=D.locals,_++,D=A[_];else if(s(u.reload)||o(u.reload)){if(o(u.reload)&&!u.reload.name)throw new Error("Invalid reload state object");var q=u.reload===!0?v[0]:L(u.reload);if(u.reload&&!q)throw new Error("No such reload state '"+(s(u.reload)?u.reload:u.reload.name)+"'");while(D&&D===v[_]&&D!==q)P=I[_]=D.locals,_++,D=A[_]}if(j(n,i,a,d,P,u))return S&&(i["#"]=S),E.params=i,l(E.params,N),u.location&&n.navigable&&n.navigable.url&&(C.push(n.navigable.url,i,{$$avoidResync:!0,replace:u.location==="replace"}),C.update(!0)),E.transition=null,h.when(E.current);i=y(n.params.$$keys(),i||{});if(u.notify&&e.$broadcast("$stateChangeStart",n.self,i,a.self,d).defaultPrevented)return e.$broadcast("$stateChangeCancel",n.self,i,a.self,d),C.update(),M;var R=h.when(P);for(var U=_;U<A.length;U++,D=A[U])P=I[U]=c(P),R=F(D,i,D===n,R,P,u);var z=E.transition=R.then(function(){var t,r,s;if(E.transition!==z)return O;for(t=v.length-1;t>=_;t--)s=v[t],s.self.onExit&&w.invoke(s.self.onExit,s.self,s.locals.globals),s.locals=null;for(t=_;t<A.length;t++)r=A[t],r.locals=I[t],r.self.onEnter&&w.invoke(r.self.onEnter,r.self,r.locals.globals);return S&&(i["#"]=S),E.transition!==z?O:(E.$current=n,E.current=n.self,E.params=i,l(E.params,N),E.transition=null,u.location&&n.navigable&&C.push(n.navigable.url,n.navigable.locals.globals.$stateParams,{$$avoidResync:!0,replace:u.location==="replace"}),u.notify&&e.$broadcast("$stateChangeSuccess",n.self,i,a.self,d),C.update(!0),E.current)},function(t){return E.transition!==z?O:(E.transition=null,g=e.$broadcast("$stateChangeError",n.self,i,a.self,d,t),g.defaultPrevented||C.update(),h.reject(t))});return z},E.is=function(t,i,s){s=f({relative:E.$current},s||{});var o=L(t,s.relative);return r(o)?E.$current!==o?!1:i?g(o.params.$$values(i),N):!0:n},E.includes=function(t,i,o){o=f({relative:E.$current},o||{});if(s(t)&&_(t)){if(!D(t))return!1;t=E.$current.name}var u=L(t,o.relative);return r(u)?r(E.$current.includes[u.name])?i?g(u.params.$$values(i),N,d(i)):!0:!1:n},E.href=function(t,i,s){s=f({lossy:!0,inherit:!0,absolute:!1,relative:E.$current},s||{});var o=L(t,s.relative);if(!r(o))return null;s.inherit&&(i=m(N,i||{},E.$current,o));var u=o&&s.lossy?o.navigable:o;return!u||u.url===n||u.url===null?null:C.href(u.url,y(o.params.$$keys().concat("#"),i||{}),{absolute:s.absolute})},E.get=function(e,t){if(arguments.length===0)return T(d(b),function(e){return b[e].self});var n=L(e,t||E.$current);return n&&n.self?n.self:null},E}function j(e,t,n,r,i,s){function o(e,t,n){function r(t){return e.params[t].location!="search"}var i=e.params.$$keys().filter(r),s=w.apply({},[e.params].concat(i)),o=new k.ParamSet(s);return o.$$equals(t,n)}if(!s.reload&&e===n&&(i===n.locals||e.self.reloadOnSearch===!1&&o(n,r,t)))return!0}var p,b={},E,S={},x="abstract",N={parent:function(e){if(r(e.parent)&&e.parent)return L(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?L(t[1]):p},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=f({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url,n={params:e.params||{}};if(s(t))return t.charAt(0)=="^"?h.compile(t.substring(1),n):(e.parent.navigable||p).url.concat(t,n);if(!t||h.isMatcher(t))return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},ownParams:function(e){var t=e.url&&e.url.params||new k.ParamSet;return a(e.params||{},function(e,n){t[n]||(t[n]=new k.Param(n,null,e,"config"))}),t},params:function(e){return e.parent&&e.parent.params?f(e.parent.params.$$new(),e.ownParams):new k.ParamSet},views:function(e){var t={};return a(r(e.views)?e.views:{"":e},function(n,r){r.indexOf("@")<0&&(r+="@"+e.parent.name),t[r]=n}),t},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?f({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};p=M({name:"",url:"^",views:null,"abstract":!0}),p.navigable=null,this.decorator=P,this.state=H,this.$get=B,B.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter","$location","$urlMatcherFactory"]}function D(){function e(e,t){return{load:function(r,i){var s,o={template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}};return i=f(o,i),i.view&&(s=t.fromConfig(i.view,i.params,i.locals)),s&&i.notify&&e.$broadcast("$viewContentLoading",i),s}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function P(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){return n(function(){e[0].scrollIntoView()},0,!1)}}]}function H(e,n,r,i){function s(){return n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(t){return null}}}function f(e,t){var n=function(){return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}};if(a)return{enter:function(e,t,n){var r=a.enter(e,null,t,n);r&&r.then&&r.then(n)},leave:function(e,t){var n=a.leave(e,t);n&&n.then&&n.then(t)}};if(u){var r=u&&u(t,e);return{enter:function(e,t,n){r.enter(e,null,t),n()},leave:function(e,t){r.leave(e),t()}}}return n()}var o=s(),u=o("$animator"),a=o("$animate"),l={restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,s,o){return function(n,s,u){function m(){a&&(a.remove(),a=null),c&&(c.$destroy(),c=null),l&&(v.leave(l,function(){a=null}),a=l,l=null)}function g(a){var f,g=j(n,u,s,i),y=g&&e.$current&&e.$current.locals[g];if(!a&&y===h)return;f=n.$new(),h=e.$current.locals[g];var b=o(f,function(e){v.enter(e,s,function(){c&&c.$emit("$viewContentAnimationEnded"),(t.isDefined(d)&&!d||n.$eval(d))&&r(e)}),m()});l=b,c=f,c.$emit("$viewContentLoaded"),c.$eval(p)}var a,l,c,h,p=u.onload||"",d=u.autoscroll,v=f(u,n);n.$on("$stateChangeSuccess",function(){g(!1)}),n.$on("$viewContentLoading",function(){g(!1)}),g(!0)}}};return l}function B(e,t,n,r){return{restrict:"ECA",priority:-400,compile:function(i){var s=i.html();return function(i,o,u){var a=n.$current,f=j(i,u,o,r),l=a&&a.locals[f];if(!l)return;o.data("$uiView",{name:f,state:l.$$state}),o.html(l.$template?l.$template:s);var c=e(o.contents());if(l.$$controller){l.$scope=i,l.$element=o;var h=t(l.$$controller,l);l.$$controllerAs&&(i[l.$$controllerAs]=h),o.data("$ngControllerController",h),o.children().data("$ngControllerController",h)}c(i)}}}}function j(e,t,n,r){var i=r(t.uiView||t.name||"")(e),s=n.inheritedData("$uiView");return i.indexOf("@")>=0?i:i+"@"+(s?s.state.name:"")}function F(e,t){var n=e.match(/^\s*({[^}]*})\s*$/),r;n&&(e=t+"("+n[1]+")"),r=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!r||r.length!==4)throw new Error("Invalid state ref '"+e+"'");return{state:r[1],paramExpr:r[3]||null}}function I(e){var t=e.parent().inheritedData("$uiView");if(t&&t.state&&t.state.name)return t.state}function q(e,n){var r=["location","inherit","reload","absolute"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(i,s,o,u){var a=F(o.uiSref,e.current.name),f=null,l=null,c=I(s)||e.$current,h=Object.prototype.toString.call(s.prop("href"))==="[object SVGAnimatedString]"?"xlink:href":"href",p=null,d=s.prop("tagName").toUpperCase()==="A",v=s[0].nodeName==="FORM",m=v?"action":h,g=!0,y={relative:c,inherit:!0},b=i.$eval(o.uiSrefOpts)||{};t.forEach(r,function(e){e in b&&(y[e]=b[e])});var w=function(n){n&&(f=t.copy(n));if(!g)return;p=e.href(a.state,f,y);var r=u[1]||u[0];r&&r.$$addStateInfo(a.state,f);if(p===null)return g=!1,!1;o.$set(m,p)};a.paramExpr&&(i.$watch(a.paramExpr,function(e,t){e!==f&&w(e)},!0),f=t.copy(i.$eval(a.paramExpr))),w();if(v)return;s.bind("click",function(t){var r=t.which||t.button;if(!(r>1||t.ctrlKey||t.metaKey||t.shiftKey||s.attr("target"))){var i=n(function(){e.go(a.state,f,y)});t.preventDefault();var o=d&&!p?1:0;t.preventDefault=function(){o--<=0&&n.cancel(i)}}})}}}function R(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,r,i){function u(){a()?r.addClass(o):r.removeClass(o)}function a(){for(var e=0;e<s.length;e++)if(f(s[e].state,s[e].params))return!0;return!1}function f(t,n){return typeof i.uiSrefActiveEq!="undefined"?e.is(t.name,n):e.includes(t.name,n)}var s=[],o;o=n(i.uiSrefActiveEq||i.uiSrefActive||"",!1)(t),this.$$addStateInfo=function(t,n){var i=e.get(t,I(r));s.push({state:i||{name:t},params:n}),u()},t.$on("$stateChangeSuccess",u)}]}}function U(e){var t=function(t){return e.is(t)};return t.$stateful=!0,t}function z(e){var t=function(t){return e.includes(t)};return t.$stateful=!0,t}var r=t.isDefined,i=t.isFunction,s=t.isString,o=t.isObject,u=t.isArray,a=t.forEach,f=t.extend,l=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),N.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",N),C.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",C);var k;L.prototype.concat=function(e,t){var n={caseInsensitive:k.caseInsensitive(),strict:k.strictMode(),squash:k.defaultSquashPolicy()};return new L(this.sourcePath+e+this.sourceSearch,f(n,t),this)},L.prototype.toString=function(){return this.source},L.prototype.exec=function(e,t){function c(e){function t(e){return e.split("").reverse().join("")}function n(e){return e.replace(/\\-/g,"-")}var r=t(e).split(/-(?!\\)/),i=T(r,t);return T(i,n).reverse()}var n=this.regexp.exec(e);if(!n)return null;t=t||{};var r=this.parameters(),i=r.length,s=this.segments.length-1,o={},u,a,f,l;if(s!==n.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(u=0;u<s;u++){l=r[u];var h=this.params[l],p=n[u+1];for(a=0;a<h.replace;a++)h.replace[a].from===p&&(p=h.replace[a].to);p&&h.array===!0&&(p=c(p)),o[l]=h.value(p)}for(;u<i;u++)l=r[u],o[l]=this.params[l].value(t[l]);return o},L.prototype.parameters=function(e){return r(e)?this.params[e]||null:this.$$paramNames},L.prototype.validates=function(e){return this.params.$$validates(e)},L.prototype.format=function(e){function c(e){return encodeURIComponent(e).replace(/-/g,function(e){return"%5C%"+e.charCodeAt(0).toString(16).toUpperCase()})}e=e||{};var t=this.segments,n=this.parameters(),r=this.params;if(!this.validates(e))return null;var i,o=!1,a=t.length-1,f=n.length,l=t[0];for(i=0;i<f;i++){var h=i<a,p=n[i],d=r[p],v=d.value(e[p]),m=d.isOptional&&d.type.equals(d.value(),v),g=m?d.squash:!1,y=d.type.encode(v);if(h){var b=t[i+1];if(g===!1)y!=null&&(u(y)?l+=T(y,c).join("-"):l+=encodeURIComponent(y)),l+=b;else if(g===!0){var w=l.match(/\/$/)?/\/?(.*)/:/(.*)/;l+=b.match(w)[1]}else s(g)&&(l+=g+b)}else{if(y==null||m&&g!==!1)continue;u(y)||(y=[y]),y=T(y,encodeURIComponent).join("&"+p+"="),l+=(o?"&":"?")+(p+"="+y),o=!0}}return l},A.prototype.is=function(e,t){return!0},A.prototype.encode=function(e,t){return e},A.prototype.decode=function(e,t){return e},A.prototype.equals=function(e,t){return e==t},A.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)},A.prototype.pattern=/.*/,A.prototype.toString=function(){return"{Type:"+this.name+"}"},A.prototype.$normalize=function(e){return this.is(e)?e:this.decode(e)},A.prototype.$asArray=function(e,t){function i(e,t){function i(e,t){return function(){return e[t].apply(e,arguments)}}function s(e){return u(e)?e:r(e)?[e]:[]}function o(e){switch(e.length){case 0:return n;case 1:return t==="auto"?e[0]:e;default:return e}}function a(e){return!e}function f(e,t){return function(r){r=s(r);var i=T(r,e);return t===!0?x(i,a).length===0:o(i)}}function l(e){return function(n,r){var i=s(n),o=s(r);if(i.length!==o.length)return!1;for(var u=0;u<i.length;u++)if(!e(i[u],o[u]))return!1;return!0}}this.encode=f(i(e,"encode")),this.decode=f(i(e,"decode")),this.is=f(i(e,"is"),!0),this.equals=l(i(e,"equals")),this.pattern=e.pattern,this.$normalize=f(i(e,"$normalize")),this.name=e.name,this.$arrayMode=t}if(!e)return this;if(e==="auto"&&!t)throw new Error("'auto' array mode is for query parameters only");return new i(this,e)},t.module("ui.router.util").provider("$urlMatcherFactory",O),t.module("ui.router.util").run(["$urlMatcherFactory",function(e){}]),M.$inject=["$locationProvider","$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",M),_.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",_),D.$inject=[],t.module("ui.router.state").provider("$view",D),t.module("ui.router.state").provider("$uiViewScroll",P),H.$inject=["$state","$injector","$uiViewScroll","$interpolate"],B.$inject=["$compile","$controller","$state","$interpolate"],t.module("ui.router.state").directive("uiView",H),t.module("ui.router.state").directive("uiView",B),q.$inject=["$state","$timeout"],R.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",q).directive("uiSrefActive",R).directive("uiSrefActiveEq",R),U.$inject=["$state"],z.$inject=["$state"],t.module("ui.router.state").filter("isState",U).filter("includedByState",z)}(window,window.angular),define("angularRouter",function(){}),function(){var e={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,COMMAND:91,MAP:{91:"COMMAND",8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSEBREAK",20:"CAPSLOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",43:"+",44:"PRINTSCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},isControl:function(t){var n=t.which;switch(n){case e.COMMAND:case e.SHIFT:case e.CTRL:case e.ALT:return!0}return t.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&e<=123},isVerticalMovement:function(t){return~[e.UP,e.DOWN].indexOf(t)},isHorizontalMovement:function(t){return~[e.LEFT,e.RIGHT,e.BACKSPACE,e.DELETE].indexOf(t)}};angular.element.prototype.querySelectorAll===undefined&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))}),angular.element.prototype.closest===undefined&&(angular.element.prototype.closest=function(e){var t=this[0],n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;while(t){if(n.bind(t)(e))return t;t=t.parentElement}return!1});var t=0,n=angular.module("ui.select",[]).constant("uiSelectConfig",{theme:"bootstrap",searchEnabled:!0,sortable:!1,placeholder:"",refreshDelay:1e3,closeOnSelect:!0,generateId:function(){return t++},appendToBody:!1}).service("uiSelectMinErr",function(){var e=angular.$$minErr("ui.select");return function(){var t=e.apply(this,arguments),n=t.message.replace(new RegExp("\nhttp://errors.angularjs.org/.*"),"");return new Error(n)}}).directive("uisTranscludeAppend",function(){return{link:function(e,t,n,r,i){i(e,function(e){t.append(e)})}}}).filter("highlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n){return n&&t?t.replace(new RegExp(e(n),"gi"),'<span class="ui-select-highlight">$&</span>'):t}}).factory("uisOffset",["$document","$window",function(e,t){return function(n){var r=n[0].getBoundingClientRect();return{width:r.width||n.prop("offsetWidth"),height:r.height||n.prop("offsetHeight"),top:r.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:r.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}}}]);n.directive("uiSelectChoices",["uiSelectConfig","uisRepeatParser","uiSelectMinErr","$compile",function(e,t,n,r){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){var n=t.parent().attr("theme")||e.theme;return n+"/choices.tpl.html"},compile:function(i,s){if(!s.repeat)throw n("repeat","Expected 'repeat' expression.");return function(s,o,u,a,f){var l=u.groupBy;a.parseRepeatAttr(u.repeat,l),a.disableChoiceExpression=u.uiDisableChoice,a.onHighlightCallback=u.onHighlight;if(l){var c=o.querySelectorAll(".ui-select-choices-group");if(c.length!==1)throw n("rows","Expected 1 .ui-select-choices-group but got '{0}'.",c.length);c.attr("ng-repeat",t.getGroupNgRepeatExpression())}var h=o.querySelectorAll(".ui-select-choices-row");if(h.length!==1)throw n("rows","Expected 1 .ui-select-choices-row but got '{0}'.",h.length);h.attr("ng-repeat",t.getNgRepeatExpression(a.parserResult.itemName,"$select.items",a.parserResult.trackByExp,l)).attr("ng-if","$select.open").attr("ng-mouseenter","$select.setActiveItem("+a.parserResult.itemName+")").attr("ng-click","$select.select("+a.parserResult.itemName+",false,$event)");var p=o.querySelectorAll(".ui-select-choices-row-inner");if(p.length!==1)throw n("rows","Expected 1 .ui-select-choices-row-inner but got '{0}'.",p.length);p.attr("uis-transclude-append",""),r(o,f)(s),s.$watch("$select.search",function(e){e&&!a.open&&a.multiple&&a.activate(!1,!0),a.activeIndex=a.tagging.isActivated?-1:0,a.refresh(u.refresh)}),u.$observe("refreshDelay",function(){var t=s.$eval(u.refreshDelay);a.refreshDelay=t!==undefined?t:e.refreshDelay})}}}}]),n.controller("uiSelectCtrl",["$scope","$element","$timeout","$filter","uisRepeatParser","uiSelectMinErr","uiSelectConfig",function(t,n,r,i,s,o,u){function l(){if(a.resetSearchInput||a.resetSearchInput===undefined&&u.resetSearchInput)a.search=f,a.selected&&a.items.length&&!a.multiple&&(a.activeIndex=a.items.indexOf(a.selected))}function p(t){var n=!0;switch(t){case e.DOWN:!a.open&&a.multiple?a.activate(!1,!0):a.activeIndex<a.items.length-1&&a.activeIndex++;break;case e.UP:!a.open&&a.multiple?a.activate(!1,!0):(a.activeIndex>0||a.search.length===0&&a.tagging.isActivated&&a.activeIndex>-1)&&a.activeIndex--;break;case e.TAB:(!a.multiple||a.open)&&a.select(a.items[a.activeIndex],!0);break;case e.ENTER:a.open&&a.activeIndex>=0?a.select(a.items[a.activeIndex]):a.activate(!1,!0);break;case e.ESC:a.close();break;default:n=!1}return n}function d(){var e=n.querySelectorAll(".ui-select-choices-content"),t=e.querySelectorAll(".ui-select-choices-row");if(t.length<1)throw o("choices","Expected multiple .ui-select-choices-row but got '{0}'.",t.length);if(a.activeIndex<0)return;var r=t[a.activeIndex],i=r.offsetTop+r.clientHeight-e[0].scrollTop,s=e[0].offsetHeight;i>s?e[0].scrollTop+=i-s:i<r.clientHeight&&(a.isGrouped&&a.activeIndex===0?e[0].scrollTop=0:e[0].scrollTop-=r.clientHeight-i)}var a=this,f="";a.placeholder=u.placeholder,a.searchEnabled=u.searchEnabled,a.sortable=u.sortable,a.refreshDelay=u.refreshDelay,a.removeSelected=!1,a.closeOnSelect=!0,a.search=f,a.activeIndex=0,a.items=[],a.open=!1,a.focus=!1,a.disabled=!1,a.selected=undefined,a.focusser=undefined,a.resetSearchInput=!0,a.multiple=undefined,a.disableChoiceExpression=undefined,a.tagging={isActivated:!1,fct:undefined},a.taggingTokens={isActivated:!1,tokens:undefined},a.lockChoiceExpression=undefined,a.clickTriggeredSelect=!1,a.$filter=i,a.searchInput=n.querySelectorAll("input.ui-select-search");if(a.searchInput.length!==1)throw o("searchInput","Expected 1 input.ui-select-search but got '{0}'.",a.searchInput.length);a.isEmpty=function(){return angular.isUndefined(a.selected)||a.selected===null||a.selected===""},a.activate=function(e,n){!a.disabled&&!a.open&&(n||l(),t.$broadcast("uis:activate"),a.open=!0,a.activeIndex=a.activeIndex>=a.items.length?0:a.activeIndex,a.activeIndex===-1&&a.taggingLabel!==!1&&(a.activeIndex=0),r(function(){a.search=e||a.search,a.searchInput[0].focus()}))},a.findGroupByName=function(e){return a.groups&&a.groups.filter(function(t){return t.name===e})[0]},a.parseRepeatAttr=function(e,n){function r(e){a.groups=[],angular.forEach(e,function(e){var r=t.$eval(n),i=angular.isFunction(r)?r(e):e[r],s=a.findGroupByName(i);s?s.items.push(e):a.groups.push({name:i,items:[e]})}),a.items=[],a.groups.forEach(function(e){a.items=a.items.concat(e.items)})}function i(e){a.items=e}a.setItemsFn=n?r:i,a.parserResult=s.parse(e),a.isGrouped=!!n,a.itemProperty=a.parserResult.itemName,a.refreshItems=function(e){e=e||a.parserResult.source(t);var n=a.selected;if(angular.isArray(n)&&!n.length||!a.removeSelected)a.setItemsFn(e);else if(e!==undefined){var r=e.filter(function(e){return n.indexOf(e)<0});a.setItemsFn(r)}},t.$watchCollection(a.parserResult.source,function(e){if(e===undefined||e===null)a.items=[];else{if(!angular.isArray(e))throw o("items","Expected an array but got '{0}'.",e);a.refreshItems(e),a.ngModel.$modelValue=null}})};var c;a.refresh=function(e){e!==undefined&&(c&&r.cancel(c),c=r(function(){t.$eval(e)},a.refreshDelay))},a.setActiveItem=function(e){a.activeIndex=a.items.indexOf(e)},a.isActive=function(e){if(!a.open)return!1;var t=a.items.indexOf(e[a.itemProperty]),n=t===a.activeIndex;return!n||t<0&&a.taggingLabel!==!1||t<0&&a.taggingLabel===!1?!1:(n&&!angular.isUndefined(a.onHighlightCallback)&&e.$eval(a.onHighlightCallback),n)},a.isDisabled=function(e){if(!a.open)return;var t=a.items.indexOf(e[a.itemProperty]),n=!1,r;return t>=0&&!angular.isUndefined(a.disableChoiceExpression)&&(r=a.items[t],n=!!e.$eval(a.disableChoiceExpression),r._uiSelectChoiceDisabled=n),n},a.select=function(e,n,i){if(e===undefined||!e._uiSelectChoiceDisabled){if(!a.items&&!a.search)return;if(!e||!e._uiSelectChoiceDisabled){if(a.tagging.isActivated){if(a.taggingLabel===!1)if(a.activeIndex<0){e=a.tagging.fct!==undefined?a.tagging.fct(a.search):a.search;if(!e||angular.equals(a.items[0],e))return}else e=a.items[a.activeIndex];else if(a.activeIndex===0){if(e===undefined)return;if(a.tagging.fct!==undefined&&typeof e=="string"){e=a.tagging.fct(a.search);if(!e)return}else typeof e=="string"&&(e=e.replace(a.taggingLabel,"").trim())}if(a.selected&&angular.isArray(a.selected)&&a.selected.filter(function(t){return angular.equals(t,e)}).length>0){a.close(n);return}}t.$broadcast("uis:select",e);var s={};s[a.parserResult.itemName]=e,r(function(){a.onSelectCallback(t,{$item:e,$model:a.parserResult.modelMapper(t,s)})}),a.closeOnSelect&&a.close(n),i&&i.type==="click"&&(a.clickTriggeredSelect=!0)}}},a.close=function(e){if(!a.open)return;a.ngModel&&a.ngModel.$setTouched&&a.ngModel.$setTouched(),l(),a.open=!1,t.$broadcast("uis:close",e)},a.setFocus=function(){a.focus||a.focusInput[0].focus()},a.clear=function(e){a.select(undefined),e.stopPropagation(),a.focusser[0].focus()},a.toggle=function(e){a.open?(a.close(),e.preventDefault(),e.stopPropagation()):a.activate()},a.isLocked=function(e,t){var n,r=a.selected[t];return r&&!angular.isUndefined(a.lockChoiceExpression)&&(n=!!e.$eval(a.lockChoiceExpression),r._uiSelectChoiceLocked=n),n};var h=null;a.sizeSearchInput=function(){var e=a.searchInput[0],n=a.searchInput.parent().parent()[0],i=function(){return n.clientWidth*!!e.offsetParent},s=function(t){if(t===0)return!1;var n=t-e.offsetLeft-10;return n<50&&(n=t),a.searchInput.css("width",n+"px"),!0};a.searchInput.css("width","10px"),r(function(){h===null&&!s(i())&&(h=t.$watch(i,function(e){s(e)&&(h(),h=null)}))})},a.searchInput.on("keydown",function(n){var i=n.which;t.$apply(function(){var t=!1;if(a.items.length>0||a.tagging.isActivated){p(i);if(a.taggingTokens.isActivated){for(var s=0;s<a.taggingTokens.tokens.length;s++)a.taggingTokens.tokens[s]===e.MAP[n.keyCode]&&a.search.length>0&&(t=!0);t&&r(function(){a.searchInput.triggerHandler("tagged");var t=a.search.replace(e.MAP[n.keyCode],"").trim();a.tagging.fct&&(t=a.tagging.fct(t)),t&&a.select(t,!0)})}}}),e.isVerticalMovement(i)&&a.items.length>0&&d()}),a.searchInput.on("paste",function(e){var t=e.originalEvent.clipboardData.getData("text/plain");if(t&&t.length>0&&a.taggingTokens.isActivated&&a.tagging.fct){var n=t.split(a.taggingTokens.tokens[0]);n&&n.length>0&&(angular.forEach(n,function(e){var t=a.tagging.fct(e);t&&a.select(t,!0)}),e.preventDefault(),e.stopPropagation())}}),a.searchInput.on("tagged",function(){r(function(){l()})}),t.$on("$destroy",function(){a.searchInput.off("keyup keydown tagged blur paste")})}]),n.directive("uiSelect",["$document","uiSelectConfig","uiSelectMinErr","uisOffset","$compile","$parse","$timeout",function(e,t,n,r,i,s,o){return{restrict:"EA",templateUrl:function(e,n){var r=n.theme||t.theme;return r+(angular.isDefined(n.multiple)?"/select-multiple.tpl.html":"/select.tpl.html")},replace:!0,transclude:!0,require:["uiSelect","^ngModel"],scope:!0,controller:"uiSelectCtrl",controllerAs:"$select",compile:function(i,u){return angular.isDefined(u.multiple)?i.append("<ui-select-multiple/>").removeAttr("multiple"):i.append("<ui-select-single/>"),function(i,u,a,f,l){function p(e){if(!c.open)return;var t=!1;window.jQuery?t=window.jQuery.contains(u[0],e.target):t=u[0].contains(e.target);if(!t&&!c.clickTriggeredSelect){var n=["input","button","textarea"],r=angular.element(e.target).scope(),s=r&&r.$select&&r.$select!==c;s||(s=~n.indexOf(e.target.tagName.toLowerCase())),c.close(s),i.$digest()}c.clickTriggeredSelect=!1}function g(){var t=r(u);v=angular.element('<div class="ui-select-placeholder"></div>'),v[0].style.width=t.width+"px",v[0].style.height=t.height+"px",u.after(v),m=u[0].style.width,e.find("body").append(u),u[0].style.position="absolute",u[0].style.left=t.left+"px",u[0].style.top=t.top+"px",u[0].style.width=t.width+"px"}function y(){if(v===null)return;v.replaceWith(u),v=null,u[0].style.position="",u[0].style.left="",u[0].style.top="",u[0].style.width=m}var c=f[0],h=f[1];c.generatedId=t.generateId(),c.baseTitle=a.title||"Select box",c.focusserTitle=c.baseTitle+" focus",c.focusserId="focusser-"+c.generatedId,c.closeOnSelect=function(){return angular.isDefined(a.closeOnSelect)?s(a.closeOnSelect)():t.closeOnSelect}(),c.onSelectCallback=s(a.onSelect),c.onRemoveCallback=s(a.onRemove),c.ngModel=h,c.choiceGrouped=function(e){return c.isGrouped&&e&&e.name},a.tabindex&&a.$observe("tabindex",function(e){c.focusInput.attr("tabindex",e),u.removeAttr("tabindex")}),i.$watch("searchEnabled",function(){var e=i.$eval(a.searchEnabled);c.searchEnabled=e!==undefined?e:t.searchEnabled}),i.$watch("sortable",function(){var e=i.$eval(a.sortable);c.sortable=e!==undefined?e:t.sortable}),a.$observe("disabled",function(){c.disabled=a.disabled!==undefined?a.disabled:!1}),a.$observe("resetSearchInput",function(){var e=i.$eval(a.resetSearchInput);c.resetSearchInput=e!==undefined?e:!0}),a.$observe("tagging",function(){if(a.tagging!==undefined){var e=i.$eval(a.tagging);c.tagging={isActivated:!0,fct:e!==!0?e:undefined}}else c.tagging={isActivated:!1,fct:undefined}}),a.$observe("taggingLabel",function(){a.tagging!==undefined&&(a.taggingLabel==="false"?c.taggingLabel=!1:c.taggingLabel=a.taggingLabel!==undefined?a.taggingLabel:"(new)")}),a.$observe("taggingTokens",function(){if(a.tagging!==undefined){var e=a.taggingTokens!==undefined?a.taggingTokens.split("|"):[",","ENTER"];c.taggingTokens={isActivated:!0,tokens:e}}}),angular.isDefined(a.autofocus)&&o(function(){c.setFocus()}),angular.isDefined(a.focusOn)&&i.$on(a.focusOn,function(){o(function(){c.setFocus()})}),e.on("click",p),i.$on("$destroy",function(){e.off("click",p)}),l(i,function(e){var t=angular.element("<div>").append(e),r=t.querySelectorAll(".ui-select-match");r.removeAttr("ui-select-match"),r.removeAttr("data-ui-select-match");if(r.length!==1)throw n("transcluded","Expected 1 .ui-select-match but got '{0}'.",r.length);u.querySelectorAll(".ui-select-match").replaceWith(r);var i=t.querySelectorAll(".ui-select-choices");i.removeAttr("ui-select-choices"),i.removeAttr("data-ui-select-choices");if(i.length!==1)throw n("transcluded","Expected 1 .ui-select-choices but got '{0}'.",i.length);u.querySelectorAll(".ui-select-choices").replaceWith(i)});var d=i.$eval(a.appendToBody);if(d!==undefined?d:t.appendToBody)i.$watch("$select.open",function(e){e?g():y()}),i.$on("$destroy",function(){y()});var v=null,m=""}}}}]),n.directive("uiSelectMatch",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){var n=t.parent().attr("theme")||e.theme,r=t.parent().attr("multiple");return n+(r?"/match-multiple.tpl.html":"/match.tpl.html")},link:function(t,n,r,i){function s(e){i.allowClear=angular.isDefined(e)?e===""?!0:e.toLowerCase()==="true":!1}i.lockChoiceExpression=r.uiLockChoice,r.$observe("placeholder",function(t){i.placeholder=t!==undefined?t:e.placeholder}),r.$observe("allowClear",s),s(r.allowClear),i.multiple&&i.sizeSearchInput()}}}]),n.directive("uiSelectMultiple",["uiSelectMinErr","$timeout",function(t,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],controller:["$scope","$timeout",function(e,t){var n=this,r=e.$select,i;e.$evalAsync(function(){i=e.ngModel}),n.activeMatchIndex=-1,n.updateModel=function(){i.$setViewValue(Date.now()),n.refreshComponent()},n.refreshComponent=function(){r.refreshItems(),r.sizeSearchInput()},n.removeChoice=function(i){var s=r.selected[i];if(s._uiSelectChoiceLocked)return;var o={};o[r.parserResult.itemName]=s,r.selected.splice(i,1),n.activeMatchIndex=-1,r.sizeSearchInput(),t(function(){r.onRemoveCallback(e,{$item:s,$model:r.parserResult.modelMapper(e,o)})}),n.updateModel()},n.getPlaceholder=function(){if(r.selected.length)return;return r.placeholder}}],controllerAs:"$selectMultiple",link:function(r,i,s,o){function l(e){return angular.isNumber(e.selectionStart)?e.selectionStart:e.value.length}function c(t){function p(){switch(t){case e.LEFT:return~f.activeMatchIndex?c:s;case e.RIGHT:return!~f.activeMatchIndex||o===s?(u.activate(),!1):a;case e.BACKSPACE:return~f.activeMatchIndex?(f.removeChoice(o),c):s;case e.DELETE:return~f.activeMatchIndex?(f.removeChoice(f.activeMatchIndex),o):!1}}var n=l(u.searchInput[0]),r=u.selected.length,i=0,s=r-1,o=f.activeMatchIndex,a=f.activeMatchIndex+1,c=f.activeMatchIndex-1,h=o;return n>0||u.search.length&&t==e.RIGHT?!1:(u.close(),h=p(),!u.selected.length||h===!1?f.activeMatchIndex=-1:f.activeMatchIndex=Math.min(s,Math.max(i,h)),!0)}function h(e){if(e===undefined||u.search===undefined)return!1;var t=e.filter(function(e){return u.search.toUpperCase()===undefined||e===undefined?!1:e.toUpperCase()===u.search.toUpperCase()}).length>0;return t}function p(e,t){var n=-1;if(angular.isArray(e)){var r=angular.copy(e);for(var i=0;i<r.length;i++)if(u.tagging.fct===undefined)r[i]+" "+u.taggingLabel===t&&(n=i);else{var s=r[i];s.isTag=!0,angular.equals(s,t)&&(n=i)}}return n}var u=o[0],a=r.ngModel=o[1],f=r.$selectMultiple;u.multiple=!0,u.removeSelected=!0,u.focusInput=u.searchInput,a.$parsers.unshift(function(){var e={},t,n=[];for(var i=u.selected.length-1;i>=0;i--)e={},e[u.parserResult.itemName]=u.selected[i],t=u.parserResult.modelMapper(r,e),n.unshift(t);return n}),a.$formatters.unshift(function(e){var t=u.parserResult.source(r,{$select:{search:""}}),n={},i;if(!t)return e;var s=[],o=function(e,t){if(!e||!e.length)return;for(var o=e.length-1;o>=0;o--){n[u.parserResult.itemName]=e[o],i=u.parserResult.modelMapper(r,n);if(u.parserResult.trackByExp){var a=/\.(.+)/.exec(u.parserResult.trackByExp);if(a.length>0&&i[a[1]]==t[a[1]])return s.unshift(e[o]),!0}if(angular.equals(i,t))return s.unshift(e[o]),!0}return!1};if(!e)return s;for(var a=e.length-1;a>=0;a--)o(u.selected,e[a])||o(t,e[a])||s.unshift(e[a]);return s}),r.$watchCollection(function(){return a.$modelValue},function(e,t){t!=e&&(a.$modelValue=null,f.refreshComponent())}),a.$render=function(){if(!angular.isArray(a.$viewValue)){if(!angular.isUndefined(a.$viewValue)&&a.$viewValue!==null)throw t("multiarr","Expected model value to be array but got '{0}'",a.$viewValue);u.selected=[]}u.selected=a.$viewValue,r.$evalAsync()},r.$on("uis:select",function(e,t){u.selected.push(t),f.updateModel()}),r.$on("uis:activate",function(){f.activeMatchIndex=-1}),r.$watch("$select.disabled",function(e,t){t&&!e&&u.sizeSearchInput()}),u.searchInput.on("keydown",function(t){var n=t.which;r.$apply(function(){var r=!1;e.isHorizontalMovement(n)&&(r=c(n)),r&&n!=e.TAB&&(t.preventDefault(),t.stopPropagation())})}),u.searchInput.on("keyup",function(t){e.isVerticalMovement(t.which)||r.$evalAsync(function(){u.activeIndex=u.taggingLabel===!1?-1:0});if(u.tagging.isActivated&&u.search.length>0){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||e.isVerticalMovement(t.which))return;u.activeIndex=u.taggingLabel===!1?-1:0;if(u.taggingLabel===!1)return;var n=angular.copy(u.items),i=angular.copy(u.items),s,o,a=!1,f=-1,l,c;if(u.tagging.fct!==undefined){l=u.$filter("filter")(n,{isTag:!0}),l.length>0&&(c=l[0]),n.length>0&&c&&(a=!0,n=n.slice(1,n.length),i=i.slice(1,i.length)),s=u.tagging.fct(u.search),s.isTag=!0;if(i.filter(function(e){return angular.equals(e,u.tagging.fct(u.search))}).length>0)return;s.isTag=!0}else{l=u.$filter("filter")(n,function(e){return e.match(u.taggingLabel)}),l.length>0&&(c=l[0]),o=n[0],o!==undefined&&n.length>0&&c&&(a=!0,n=n.slice(1,n.length),i=i.slice(1,i.length)),s=u.search+" "+u.taggingLabel;if(p(u.selected,u.search)>-1)return;if(h(i.concat(u.selected))){a&&(n=i,r.$evalAsync(function(){u.activeIndex=0,u.items=n}));return}if(h(i)){a&&(u.items=i.slice(1,i.length));return}}a&&(f=p(u.selected,s)),f>-1?n=n.slice(f+1,n.length-1):(n=[],n.push(s),n=n.concat(i)),r.$evalAsync(function(){u.activeIndex=0,u.items=n})}}),u.searchInput.on("blur",function(){n(function(){f.activeMatchIndex=-1})})}}}]),n.directive("uiSelectSingle",["$timeout","$compile",function(t,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],link:function(r,i,s,o){var u=o[0],a=o[1];a.$parsers.unshift(function(e){var t={},n;return t[u.parserResult.itemName]=e,n=u.parserResult.modelMapper(r,t),n}),a.$formatters.unshift(function(e){var t=u.parserResult.source(r,{$select:{search:""}}),n={},i;if(t){var s=function(t){return n[u.parserResult.itemName]=t,i=u.parserResult.modelMapper(r,n),i==e};if(u.selected&&s(u.selected))return u.selected;for(var o=t.length-1;o>=0;o--)if(s(t[o]))return t[o]}return e}),r.$watch("$select.selected",function(e){a.$viewValue!==e&&a.$setViewValue(e)}),a.$render=function(){u.selected=a.$viewValue},r.$on("uis:select",function(e,t){u.selected=t}),r.$on("uis:close",function(e,n){t(function(){u.focusser.prop("disabled",!1),n||u.focusser[0].focus()},0,!1)}),r.$on("uis:activate",function(){f.prop("disabled",!0)});var f=angular.element("<input ng-disabled='$select.disabled' class='ui-select-focusser ui-select-offscreen' type='text' id='{{ $select.focusserId }}' aria-label='{{ $select.focusserTitle }}' aria-haspopup='true' role='button' />");n(f)(r),u.focusser=f,u.focusInput=f,i.parent().append(f),f.bind("focus",function(){r.$evalAsync(function(){u.focus=!0})}),f.bind("blur",function(){r.$evalAsync(function(){u.focus=!1})}),f.bind("keydown",function(t){if(t.which===e.BACKSPACE){t.preventDefault(),t.stopPropagation(),u.select(undefined),r.$apply();return}if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC)return;if(t.which==e.DOWN||t.which==e.UP||t.which==e.ENTER||t.which==e.SPACE)t.preventDefault(),t.stopPropagation(),u.activate();r.$digest()}),f.bind("keyup input",function(t){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||t.which==e.ENTER||t.which===e.BACKSPACE)return;u.activate(f.val()),f.val(""),r.$digest()})}}}]),n.directive("uiSelectSort",["$timeout","uiSelectConfig","uiSelectMinErr",function(e,t,n){return{require:"^uiSelect",link:function(t,r,i,s){if(t[i.uiSelectSort]===null)throw n("sort","Expected a list to sort");var o=angular.extend({axis:"horizontal"},t.$eval(i.uiSelectSortOptions)),u=o.axis,a="dragging",f="dropping",l="dropping-before",c="dropping-after";t.$watch(function(){return s.sortable},function(e){e?r.attr("draggable",!0):r.removeAttr("draggable")}),r.on("dragstart",function(e){r.addClass(a),(e.dataTransfer||e.originalEvent.dataTransfer).setData("text/plain",t.$index)}),r.on("dragend",function(){r.removeClass(a)});var h=function(e,t){this.splice(t,0,this.splice(e,1)[0])},p=function(e){e.preventDefault();var t=u==="vertical"?e.offsetY||e.layerY||(e.originalEvent?e.originalEvent.offsetY:0):e.offsetX||e.layerX||(e.originalEvent?e.originalEvent.offsetX:0);t<this[u==="vertical"?"offsetHeight":"offsetWidth"]/2?(r.removeClass(c),r.addClass(l)):(r.removeClass(l),r.addClass(c))},d,v=function(t){t.preventDefault();var n=parseInt((t.dataTransfer||t.originalEvent.dataTransfer).getData("text/plain"),10);e.cancel(d),d=e(function(){m(n)},20)},m=function(e){var n=t.$eval(i.uiSelectSort),s=n[e],o=null;r.hasClass(l)?e<t.$index?o=t.$index-1:o=t.$index:e<t.$index?o=t.$index:o=t.$index+1,h.apply(n,[e,o]),t.$apply(function(){t.$emit("uiSelectSort:change",{array:n,item:s,from:e,to:o})}),r.removeClass(f),r.removeClass(l),r.removeClass(c),r.off("drop",v)};r.on("dragenter",function(){if(r.hasClass(a))return;r.addClass(f),r.on("dragover",p),r.on("drop",v)}),r.on("dragleave",function(e){if(e.target!=r)return;r.removeClass(f),r.removeClass(l),r.removeClass(c),r.off("dragover",p),r.off("drop",v)})}}}]),n.service("uisRepeatParser",["uiSelectMinErr","$parse",function(e,t){var n=this;n.parse=function(n){var r=n.match(/^\s*(?:([\s\S]+?)\s+as\s+)?([\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!r)throw e("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",n);return{itemName:r[2],source:t(r[3]),trackByExp:r[4],modelMapper:t(r[1]||r[2])}},n.getGroupNgRepeatExpression=function(){return"$group in $select.groups"},n.getNgRepeatExpression=function(e,t,n,r){var i=e+" in "+(r?"$group.items":t);return n&&(i+=" track by "+n),i}}])}(),angular.module("ui.select").run(["$templateCache",function(e){e.put("bootstrap/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content dropdown-menu" role="listbox" ng-show="$select.items.length > 0"><li class="ui-select-choices-group" id="ui-select-choices-{{ $select.generatedId }}"><div class="divider" ng-show="$select.isGrouped && $index > 0"></div><div ng-show="$select.isGrouped" class="ui-select-choices-group-label dropdown-header" ng-bind="$group.name"></div><div id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}" role="option"><a href="javascript:void(0)" class="ui-select-choices-row-inner"></a></div></li></ul>'),e.put("bootstrap/match-multiple.tpl.html",'<span class="ui-select-match"><span ng-repeat="$item in $select.selected"><span class="ui-select-match-item btn btn-default btn-xs" tabindex="-1" type="button" ng-disabled="$select.disabled" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$selectMultiple.activeMatchIndex === $index, \'select-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&nbsp;&times;</span> <span uis-transclude-append=""></span></span></span></span>'),e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty()" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="glyphicon glyphicon-remove" aria-hidden="true"></i></a></span></div>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-click="$select.activate()" ng-model="$select.search" role="combobox" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div><div class="ui-select-choices"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><input type="text" autocomplete="off" tabindex="-1" aria-expanded="true" aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="form-control ui-select-search" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.searchEnabled && $select.open"><div class="ui-select-choices"></div></div>'),e.put("select2/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content select2-results"><li class="ui-select-choices-group" ng-class="{\'select2-result-with-children\': $select.choiceGrouped($group) }"><div ng-show="$select.choiceGrouped($group)" class="ui-select-choices-group-label select2-result-label" ng-bind="$group.name"></div><ul role="listbox" id="ui-select-choices-{{ $select.generatedId }}" ng-class="{\'select2-result-sub\': $select.choiceGrouped($group), \'select2-result-single\': !$select.choiceGrouped($group) }"><li role="option" id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{\'select2-highlighted\': $select.isActive(this), \'select2-disabled\': $select.isDisabled(this)}"><div class="select2-result-label ui-select-choices-row-inner"></div></li></ul></li></ul>'),e.put("select2/match-multiple.tpl.html",'<span class="ui-select-match"><li class="ui-select-match-item select2-search-choice" ng-repeat="$item in $select.selected" ng-class="{\'select2-search-choice-focus\':$selectMultiple.activeMatchIndex === $index, \'select2-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span uis-transclude-append=""></span> <a href="javascript:;" class="ui-select-match-close select2-search-choice-close" ng-click="$selectMultiple.removeChoice($index)" tabindex="-1"></a></li></span>'),e.put("select2/match.tpl.html",'<a class="select2-choice ui-select-match" ng-class="{\'select2-default\': $select.isEmpty()}" ng-click="$select.toggle($event)" aria-label="{{ $select.baseTitle }} select"><span ng-show="$select.isEmpty()" class="select2-chosen">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="select2-chosen" ng-transclude=""></span> <abbr ng-if="$select.allowClear && !$select.isEmpty()" class="select2-search-choice-close" ng-click="$select.clear($event)"></abbr> <span class="select2-arrow ui-select-toggle"><b></b></span></a>'),e.put("select2/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple select2 select2-container select2-container-multi" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled}"><ul class="select2-choices"><span class="ui-select-match"></span><li class="select2-search-field"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="select2-input ui-select-search" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-model="$select.search" ng-click="$select.activate()" style="width: 34px;" ondrop="return false;"></li></ul><div class="select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="ui-select-choices"></div></div></div>'),e.put("select2/select.tpl.html",'<div class="ui-select-container select2 select2-container" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled, \'select2-container-active\': $select.focus, \'select2-allowclear\': $select.allowClear && !$select.isEmpty()}"><div class="ui-select-match"></div><div class="select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="select2-search" ng-show="$select.searchEnabled"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="ui-select-search select2-input" ng-model="$select.search"></div><div class="ui-select-choices"></div></div></div>'),e.put("selectize/choices.tpl.html",'<div ng-show="$select.open" class="ui-select-choices selectize-dropdown single"><div class="ui-select-choices-content selectize-dropdown-content"><div class="ui-select-choices-group optgroup" role="listbox"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label optgroup-header" ng-bind="$group.name"></div><div role="option" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}"><div class="option ui-select-choices-row-inner" data-selectable=""></div></div></div></div></div>'),e.put("selectize/match.tpl.html",'<div ng-hide="($select.open || $select.isEmpty())" class="ui-select-match" ng-transclude=""></div>'),e.put("selectize/select.tpl.html",'<div class="ui-select-container selectize-control single" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.activate()"><div class="ui-select-match"></div><input type="text" autocomplete="off" tabindex="-1" class="ui-select-search ui-select-toggle" ng-click="$select.toggle($event)" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-hide="!$select.searchEnabled || ($select.selected && !$select.open)" ng-disabled="$select.disabled" aria-label="{{ $select.baseTitle }}"></div><div class="ui-select-choices"></div></div>')}]),define("angularSelect",function(){}),!function(e,t){t["true"]=e,window.rangy=function(){function e(e,t){var n=typeof e[t];return n==c||n==l&&!!e[t]||"unknown"==n}function t(e,t){return typeof e[t]==l&&!!e[t]}function n(e,t){return typeof e[t]!=h}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function i(e){return e&&g(e,m)&&b(e,v)}function s(e){window.alert("Rangy not supported in your browser. Reason: "+e),w.initialized=!0,w.supported=!1}function o(e){var t="Rangy warning: "+e;w.config.alertOnWarn?window.alert(t):typeof window.console!=h&&typeof window.console.log!=h&&window.console.log(t)}function u(){if(!w.initialized){var n,r=!1,o=!1;e(document,"createRange")&&(n=document.createRange(),g(n,d)&&b(n,p)&&(r=!0),n.detach());var u=t(document,"body")?document.body:document.getElementsByTagName("body")[0];u&&e(u,"createTextRange")&&(n=u.createTextRange(),i(n)&&(o=!0)),r||o||s("Neither Range nor TextRange are implemented"),w.initialized=!0,w.features={implementsDomRange:r,implementsTextRange:o};for(var a=S.concat(E),f=0,l=a.length;l>f;++f)try{a[f](w)}catch(c){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",c)}}}function a(e){e=e||window,u();for(var t=0,n=x.length;n>t;++t)x[t](e)}function f(e){this.name=e,this.initialized=!1,this.supported=!1}var l="object",c="function",h="undefined",p=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],d=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],v=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],m=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],g=r(e),y=r(t),b=r(n),w={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:g,areHostObjects:y,areHostProperties:b,isTextRange:i},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};w.fail=s,w.warn=o,{}.hasOwnProperty?w.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:s("hasOwnProperty not supported");var E=[],S=[];w.init=u,w.addInitListener=function(e){w.initialized?e(w):E.push(e)};var x=[];w.addCreateMissingNativeApiListener=function(e){x.push(e)},w.createMissingNativeApi=a,f.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},f.prototype.warn=function(e){w.warn("Module "+this.name+": "+e)},f.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},w.createModule=function(e,t){var n=new f(e);w.modules[e]=n,S.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},w.requireModules=function(e){for(var t,n,r=0,i=e.length;i>r;++r){if(n=e[r],t=w.modules[n],!(t&&t instanceof f))throw new Error("Module '"+n+"' not found");if(!t.supported)throw new Error("Module '"+n+"' not supported")}};var T=!1,N=function(){T||(T=!0,w.initialized||u())};return typeof window==h?void s("No window found"):typeof document==h?void s("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),e(window,"addEventListener")?window.addEventListener("load",N,!1):e(window,"attachEvent")?window.attachEvent("onload",N):s("Window does not have required addEventListener or attachEvent method"),w)}(),rangy.createModule("DomUtil",function(e,t){function n(e){var t;return typeof e.namespaceURI==N||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)t++;return t}function s(e){var t;return f(e)?e.length:(t=e.childNodes)?t.length:0}function o(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(A(r,n))return n;return null}function u(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function a(e,t,n){for(var r,i=n?e:e.parentNode;i;){if(r=i.parentNode,r===t)return i;i=r}return null}function f(e){var t=e.nodeType;return 3==t||4==t||8==t}function l(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function c(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),l(n,e),n}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=N)return e.ownerDocument;if(typeof e.document!=N)return e.document;if(e.parentNode)return h(e.parentNode);throw new Error("getDocument: no document found for node")}function p(e){var t=h(e);if(typeof t.defaultView!=N)return t.defaultView;if(typeof t.parentWindow!=N)return t.parentWindow;throw new Error("Cannot get a window object for node")}function d(e){if(typeof e.contentDocument!=N)return e.contentDocument;if(typeof e.contentWindow!=N)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=N)return e.contentWindow;if(typeof e.contentDocument!=N)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function m(e){return C.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function g(e){for(var t;t=e.parentNode;)e=t;return e}function y(e,t,n,r){var s,u,f,l,c;if(e==n)return t===r?0:r>t?-1:1;if(s=a(n,e,!0))return t<=i(s)?-1:1;if(s=a(e,n,!0))return i(s)<r?-1:1;if(u=o(e,n),f=e===u?u:a(e,u,!0),l=n===u?u:a(n,u,!0),f===l)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(c=u.firstChild;c;){if(c===f)return-1;if(c===l)return 1;c=c.nextSibling}throw new Error("Should not be here!")}function b(e){for(var t,n=h(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function w(e){if(!e)return"[No node]";if(f(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function E(e){this.root=e,this._next=e}function S(e){return new E(e)}function x(e,t){this.node=e,this.offset=t}function T(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var N="undefined",C=e.util;C.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),C.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var k=document.createElement("div");C.areHostMethods(k,["insertBefore","appendChild","cloneNode"]||!C.areHostObjects(k,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),C.isHostProperty(k,"innerHTML")||t.fail("Element is missing innerHTML property");var L=document.createTextNode("test");C.areHostMethods(L,["splitText","deleteData","insertData","appendData","cloneNode"]||!C.areHostObjects(k,["previousSibling","nextSibling","childNodes","parentNode"])||!C.areHostProperties(L,["data"]))||t.fail("Incomplete Text Node implementation");var A=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};E.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},x.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"}},T.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},T.prototype.toString=function(){return this.message},e.dom={arrayContains:A,isHtmlNamespace:n,parentElement:r,getNodeIndex:i,getNodeLength:s,getCommonAncestor:o,isAncestorOf:u,getClosestAncestorIn:a,isCharacterDataNode:f,insertAfter:l,splitDataNode:c,getDocument:h,getWindow:p,getIframeWindow:v,getIframeDocument:d,getBody:m,getRootContainer:g,comparePoints:y,inspectNode:w,fragmentFromNodeChildren:b,createIterator:S,DomPosition:x},e.DOMException=T}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(j.isAncestorOf(e,t.startContainer,!0)||j.isAncestorOf(e,t.endContainer,!0))}function n(e){return j.getDocument(e.startContainer)}function r(e,t,n){var r=e._listeners[t];if(r)for(var i=0,s=r.length;s>i;++i)r[i].call(e,{target:e,args:n})}function i(e){return new F(e.parentNode,j.getNodeIndex(e))}function s(e){return new F(e.parentNode,j.getNodeIndex(e)+1)}function o(e,t,n){var r=11==e.nodeType?e.firstChild:e;return j.isCharacterDataNode(t)?n==t.length?j.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:j.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function u(e){for(var t,r,i,s=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(i=e.getSubtreeIterator(),r.appendChild(u(i)),i.detach(!0)),10==r.nodeType)throw new I("HIERARCHY_REQUEST_ERR");s.appendChild(r)}return s}function a(e,t,n){var r,i;n=n||{stop:!1};for(var s,o;s=e.next();)if(e.isPartiallySelectedSubtree()){if(t(s)===!1)return void (n.stop=!0);if(o=e.getSubtreeIterator(),a(o,t,n),o.detach(!0),n.stop)return}else for(r=j.createIterator(s);i=r.next();)if(t(i)===!1)return void (n.stop=!0)}function f(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),f(t),t.detach(!0)):e.remove()}function l(e){for(var t,r,i=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(l(r)),r.detach(!0)):e.remove(),10==t.nodeType)throw new I("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function c(e,t,n){var r,i=!!t&&!!t.length,s=!!n;i&&(r=new RegExp("^("+t.join("|")+")$"));var o=[];return a(new p(e,!1),function(e){i&&!r.test(e.nodeType)||s&&!n(e)||o.push(e)}),o}function h(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+j.inspectNode(e.startContainer)+":"+e.startOffset+", "+j.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&j.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||j.isCharacterDataNode(this.sc)?j.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||j.isCharacterDataNode(this.ec)?j.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function d(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function v(e,t,n){this.nodes=c(e,t,n),this._next=this.nodes[0],this._position=0}function m(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){if(r=i.nodeType,j.arrayContains(e,r))return i;i=i.parentNode}return null}}function g(e,t){if(J(e,t))throw new d("INVALID_NODE_TYPE_ERR")}function y(e){if(!e.startContainer)throw new I("INVALID_STATE_ERR")}function b(e,t){if(!j.arrayContains(t,e.nodeType))throw new d("INVALID_NODE_TYPE_ERR")}function w(e,t){if(0>t||t>(j.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new I("INDEX_SIZE_ERR")}function E(e,t){if(V(e,!0)!==V(t,!0))throw new I("WRONG_DOCUMENT_ERR")}function S(e){if($(e,!0))throw new I("NO_MODIFICATION_ALLOWED_ERR")}function x(e,t){if(!e)throw new I(t)}function T(e){return!j.arrayContains(R,e.nodeType)&&!V(e,!0)}function N(e,t){return t<=(j.isCharacterDataNode(e)?e.length:e.childNodes.length)}function C(e){return!!e.startContainer&&!!e.endContainer&&!T(e.startContainer)&&!T(e.endContainer)&&N(e.startContainer,e.startOffset)&&N(e.endContainer,e.endOffset)}function k(e){if(y(e),!C(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function L(){}function A(e){e.START_TO_START=et,e.START_TO_END=tt,e.END_TO_END=nt,e.END_TO_START=rt,e.NODE_BEFORE=it,e.NODE_AFTER=st,e.NODE_BEFORE_AND_AFTER=ot,e.NODE_INSIDE=ut}function O(e){A(e),A(e.prototype)}function M(e,t){return function(){k(this);var n,r,i=this.startContainer,o=this.startOffset,u=this.commonAncestorContainer,f=new p(this,!0);i!==u&&(n=j.getClosestAncestorIn(i,u,!0),r=s(n),i=r.node,o=r.offset),a(f,S),f.reset();var l=e(f);return f.detach(),t(this,i,o,i,o),l}}function _(n,r,o){function u(e,t){return function(n){y(this),b(n,q),b(X(n),R);var r=(e?i:s)(n);(t?a:c)(this,r.node,r.offset)}}function a(e,t,n){var i=e.endContainer,s=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((X(t)!=X(i)||1==j.comparePoints(t,n,i,s))&&(i=t,s=n),r(e,t,n,i,s))}function c(e,t,n){var i=e.startContainer,s=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((X(t)!=X(i)||-1==j.comparePoints(t,n,i,s))&&(i=t,s=n),r(e,i,s,t,n))}function h(e,t,n){(t!==e.startContainer||n!==e.startOffset||t!==e.endContainer||n!==e.endOffset)&&r(e,t,n,t,n)}n.prototype=new L,e.util.extend(n.prototype,{setStart:function(e,t){y(this),g(e,!0),w(e,t),a(this,e,t)},setEnd:function(e,t){y(this),g(e,!0),w(e,t),c(this,e,t)},setStartBefore:u(!0,!0),setStartAfter:u(!1,!0),setEndBefore:u(!0,!1),setEndAfter:u(!1,!1),collapse:function(e){k(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(this),g(e,!0),r(this,e,0,e,j.getNodeLength(e))},selectNode:function(e){y(this),g(e,!1),b(e,q);var t=i(e),n=s(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:M(l,r),deleteContents:M(f,r),canSurroundContents:function(){k(this),S(this.startContainer),S(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){o(this)},splitBoundaries:function(){k(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,s=e===n;j.isCharacterDataNode(n)&&i>0&&i<n.length&&j.splitDataNode(n,i),j.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=j.splitDataNode(e,t),s?(i-=t,n=e):n==e.parentNode&&i>=j.getNodeIndex(e)&&i++,t=0),r(this,e,t,n,i)},normalizeBoundaries:function(){k(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},o=function(r){var s=r.previousSibling;if(s&&s.nodeType==r.nodeType){e=r;var o=r.length;if(t=s.length,r.insertData(0,s.data),s.parentNode.removeChild(s),e==n)i+=t,n=e;else if(n==r.parentNode){var u=j.getNodeIndex(r);i==u?(n=r,i=o):i>u&&i--}}},u=!0;if(j.isCharacterDataNode(n))n.length==i&&s(n);else{if(i>0){var a=n.childNodes[i-1];a&&j.isCharacterDataNode(a)&&s(a)}u=!this.collapsed}if(u){if(j.isCharacterDataNode(e))0==t&&o(e);else if(t<e.childNodes.length){var f=e.childNodes[t];f&&j.isCharacterDataNode(f)&&o(f)}}else e=n,t=i;r(this,e,t,n,i)},collapseToPoint:function(e,t){y(this),g(e,!0),w(e,t),h(this,e,t)}}),O(n)}function D(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:j.getCommonAncestor(e.startContainer,e.endContainer)}function P(e,t,n,i,s){var o=e.startContainer!==t||e.startOffset!==n,u=e.endContainer!==i||e.endOffset!==s;e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=s,D(e),r(e,"boundarychange",{startMoved:o,endMoved:u})}function H(e){y(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,r(e,"detach",null),e._listeners=null}function B(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},D(this)}e.requireModules(["DomUtil"]);var j=e.dom,F=j.DomPosition,I=e.DOMException;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,j.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!j.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new B(n(this.range));var t=this._current,r=t,i=0,s=t,o=j.getNodeLength(t);j.isAncestorOf(t,this.sc,!0)&&(r=this.sc,i=this.so),j.isAncestorOf(t,this.ec,!0)&&(s=this.ec,o=this.eo),P(e,r,i,s,o)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},d.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},d.prototype.toString=function(){return this.message},v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var q=[1,3,4,5,7,8,10],R=[2,9,11],U=[5,6,10,12],z=[1,3,4,5,7,8,10,11],W=[1,3,4,5,7,8],X=j.getRootContainer,V=m([9,11]),$=m(U),J=m([6,10,12]),K=document.createElement("style"),Q=!1;try{K.innerHTML="<b>x</b>",Q=3==K.firstChild.nodeType}catch(G){}e.features.htmlParsingConforms=Q;var Y=Q?function(e){var t=this.startContainer,n=j.getDocument(t);if(!t)throw new I("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:j.isCharacterDataNode(t)&&(r=j.parentElement(t)),r=null===r||"HTML"==r.nodeName&&j.isHtmlNamespace(j.getDocument(r).documentElement)&&j.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,j.fragmentFromNodeChildren(r)}:function(e){y(this);var t=n(this),r=t.createElement("body");return r.innerHTML=e,j.fragmentFromNodeChildren(r)},Z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],et=0,tt=1,nt=2,rt=3,it=0,st=1,ot=2,ut=3;L.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){k(this),E(this.startContainer,t.startContainer);var n,r,i,s,o=e==rt||e==et?"start":"end",u=e==tt||e==et?"start":"end";return n=this[o+"Container"],r=this[o+"Offset"],i=t[u+"Container"],s=t[u+"Offset"],j.comparePoints(n,r,i,s)},insertNode:function(e){if(k(this),b(e,z),S(this.startContainer),j.isAncestorOf(e,this.startContainer,!0))throw new I("HIERARCHY_REQUEST_ERR");var t=o(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){k(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&j.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new p(this,!0);return e=u(r),r.detach(),e},canSurroundContents:function(){k(this),S(this.startContainer),S(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(b(e,W),!this.canSurroundContents())throw new d("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);o(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){k(this);for(var e,t=new B(n(this)),r=Z.length;r--;)e=Z[r],t[e]=this[e];return t},toString:function(){k(this);var e=this.startContainer;if(e===this.endContainer&&j.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new p(this,!0);return a(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){k(this);var t=e.parentNode,n=j.getNodeIndex(e);if(!t)throw new I("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return 0>r?i>0?ot:it:i>0?st:ut},comparePoint:function(e,t){return k(this),x(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),j.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:j.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Y,toHtml:function(){k(this);var e=n(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(k(this),x(e,"NOT_FOUND_ERR"),j.getDocument(e)!==n(this))return!1;var r=e.parentNode,i=j.getNodeIndex(e);x(r,"NOT_FOUND_ERR");var s=j.comparePoints(r,i,this.endContainer,this.endOffset),o=j.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?0>=s&&o>=0:0>s&&o>0},isPointInRange:function(e,t){return k(this),x(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),j.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&j.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if(k(this),n(e)!=n(this))throw new I("WRONG_DOCUMENT_ERR");var r=j.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),i=j.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=r&&i>=0:0>r&&i>0},intersection:function(e){if(this.intersectsRange(e)){var t=j.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=j.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==j.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==j.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new d("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ut},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,j.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return k(this),new v(this,e,t)},getNodes:function(e,t){return k(this),c(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){y(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){y(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return B.rangesEqual(this,e)},isValid:function(){return C(this)},inspect:function(){return h(this)}},_(B,P,H),e.rangePrototype=L.prototype,B.rangeProperties=Z,B.RangeIterator=p,B.copyComparisonConstants=O,B.createPrototypeRange=_,B.inspect=h,B.getRangeDocument=n,B.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=B,e.RangeException=d}),rangy.createModule("WrappedRange",function(e){function t(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),s=r==i?r:o.getCommonAncestor(r,i);return s==t?s:o.getCommonAncestor(t,s)}function n(e){return 0==e.compareEndPoints("StartToEnd",e)}function r(e,t,n,r){var i=e.duplicate();i.collapse(n);var s=i.parentElement();if(o.isAncestorOf(t,s,!0)||(s=t),!s.canHaveHTML)return new u(s.parentNode,o.getNodeIndex(s));var a,f,l,c,p,d=o.getDocument(s).createElement("span"),v=n?"StartToStart":"StartToEnd";do s.insertBefore(d,d.previousSibling),i.moveToElementText(d);while((a=i.compareEndPoints(v,e))>0&&d.previousSibling);if(p=d.nextSibling,-1==a&&p&&o.isCharacterDataNode(p)){i.setEndPoint(n?"EndToStart":"EndToEnd",e);var m;if(/[\r\n]/.test(p.data)){var y=i.duplicate(),b=y.text.replace(/\r\n/g,"\r").length;for(m=y.moveStart("character",b);-1==(a=y.compareEndPoints("StartToEnd",y));)m++,y.moveStart("character",1)}else m=i.text.length;c=new u(p,m)}else f=(r||!n)&&d.previousSibling,l=(r||n)&&d.nextSibling,c=l&&o.isCharacterDataNode(l)?new u(l,0):f&&o.isCharacterDataNode(f)?new u(f,f.length):new u(s,o.getNodeIndex(d));return d.parentNode.removeChild(d),c}function i(e,t){var n,r,i,s,u=e.offset,a=o.getDocument(e.node),f=a.body.createTextRange(),l=o.isCharacterDataNode(e.node);return l?(n=e.node,r=n.parentNode):(s=e.node.childNodes,n=u<s.length?s[u]:null,r=e.node),i=a.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),f.moveToElementText(i),f.collapse(!t),r.removeChild(i),l&&f[t?"moveStart":"moveEnd"]("character",u),f}e.requireModules(["DomUtil","DomRange"]);var s,o=e.dom,u=o.DomPosition,a=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){s=function(e){this.textRange=e,this.refresh()},s.prototype=new a(document),s.prototype.refresh=function(){var e,i,s=t(this.textRange);n(this.textRange)?i=e=r(this.textRange,s,!0,!0):(e=r(this.textRange,s,!0,!1),i=r(this.textRange,s,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(i.node,i.offset)},a.copyComparisonConstants(s);var f=function(){return this}();"undefined"==typeof f.Range&&(f.Range=s),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else!function(){function t(e){for(var t,n=l.length;n--;)t=l[n],e[t]=e.nativeRange[t]}function n(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i;(s||o)&&(e.setEnd(r,i),e.setStart(t,n))}function r(e){e.nativeRange.detach(),e.detached=!0;for(var t,n=l.length;n--;)t=l[n],e[t]=null}var i,u,f,l=a.rangeProperties;s=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,t(this)},a.createPrototypeRange(s,n,r),i=s.prototype,i.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},i.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},i.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},i.cloneContents=function(){return this.nativeRange.cloneContents()},i.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},i.collapse=function(e){this.nativeRange.collapse(e),t(this)},i.cloneRange=function(){return new s(this.nativeRange.cloneRange())},i.refresh=function(){t(this)},i.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");o.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0),h.setEnd(c,0);try{h.setStart(c,1),u=!0,i.setStart=function(e,n){this.nativeRange.setStart(e,n),t(this)},i.setEnd=function(e,n){this.nativeRange.setEnd(e,n),t(this)},f=function(e){return function(n){this.nativeRange[e](n),t(this)}}}catch(p){u=!1,i.setStart=function(e,n){try{this.nativeRange.setStart(e,n)}catch(r){this.nativeRange.setEnd(e,n),this.nativeRange.setStart(e,n)}t(this)},i.setEnd=function(e,n){try{this.nativeRange.setEnd(e,n)}catch(r){this.nativeRange.setStart(e,n),this.nativeRange.setEnd(e,n)}t(this)},f=function(e,n){return function(r){try{this.nativeRange[e](r)}catch(i){this.nativeRange[n](r),this.nativeRange[e](r)}t(this)}}}i.setStartBefore=f("setStartBefore","setEndBefore"),i.setStartAfter=f("setStartAfter","setEndAfter"),i.setEndBefore=f("setEndBefore","setStartBefore"),i.setEndAfter=f("setEndAfter","setStartAfter"),h.selectNodeContents(c),i.selectNodeContents=h.startContainer==c&&h.endContainer==c&&0==h.startOffset&&h.endOffset==c.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,a.getEndOffset(e))},h.selectNodeContents(c),h.setEnd(c,3);var d=document.createRange();d.selectNodeContents(c),d.setEnd(c,4),d.setStart(c,2),i.compareBoundaryPoints=-1==h.compareBoundaryPoints(h.START_TO_END,d)&1==h.compareBoundaryPoints(h.END_TO_START,d)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(h,"createContextualFragment")&&(i.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),o.getBody(document).removeChild(c),h.detach(),d.detach()}(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(s.rangeToTextRange=function(e){if(e.collapsed){var t=i(new u(e.startContainer,e.startOffset),!0);return t}var n=i(new u(e.startContainer,e.startOffset),!0),r=i(new u(e.endContainer,e.endOffset),!1),s=o.getDocument(e.startContainer).body.createTextRange();return s.setEndPoint("StartToStart",n),s.setEndPoint("EndToEnd",r),s}),s.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=s,e.createRange=function(t){return t=t||document,new s(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new a(e)},e.createIframeRange=function(t){return e.createRange(o.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(o.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function r(e){return(e||window).document.selection}function i(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function s(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function o(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function u(t){var n;return t instanceof T?(n=t._selectionNativeRange,n||(n=e.createNativeRange(S.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof N?n=t.nativeRange:e.features.implementsDomRange&&t instanceof S.getWindow(t.startContainer).Range&&(n=t),n}function a(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!S.isAncestorOf(e[0],e[t]))return!1;return!0}function f(e){var t=e.getNodes();if(!a(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function l(e){return!!e&&"undefined"!=typeof e.text}function c(e,t){var n=new N(t);e._ranges=[n],i(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function h(t){if(t._ranges.length=0,"None"==t.docSelection.type)o(t);else{var n=t.docSelection.createRange();if(l(n))c(t,n);else{t.rangeCount=n.length;for(var r,s=S.getDocument(n.item(0)),u=0;u<t.rangeCount;++u)r=e.createRange(s),r.selectNode(n.item(u)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,i(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,t){for(var n=e.docSelection.createRange(),r=f(t),i=S.getDocument(n.item(0)),s=S.getBody(i).createControlRange(),o=0,u=n.length;u>o;++o)s.add(n.item(o));try{s.add(r)}catch(a){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}s.select(),h(e)}function d(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function v(e,t){for(var n,r=S.getDocument(t[0].startContainer),i=S.getBody(r).createControlRange(),s=0;s<rangeCount;++s){n=f(t[s]);try{i.add(n)}catch(o){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),h(e)}function m(e,t){if(e.anchorNode&&S.getDocument(e.anchorNode)!==S.getDocument(t))throw new C("WRONG_DOCUMENT_ERR")}function g(e){var t=[],n=new k(e.anchorNode,e.anchorOffset),r=new k(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var s=0,o=e.rangeCount;o>s;++s)t[s]=T.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var y,b,w="boolean",E="_rangySelection",S=e.dom,x=e.util,T=e.DomRange,N=e.WrappedRange,C=e.DOMException,k=S.DomPosition,L="Control",A=e.util.isHostMethod(window,"getSelection"),O=e.util.isHostObject(document,"selection"),M=O&&(!A||e.config.preferTextRange);M?(y=r,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return"None"!=n.type||S.getDocument(n.createRange().parentElement())==t}):A?(y=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=y;var _=y(),D=e.createNativeRange(document),P=S.getBody(document),H=x.areHostObjects(_,["anchorNode","focusNode"]&&x.areHostProperties(_,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=H;var B=x.isHostMethod(_,"extend");e.features.selectionHasExtend=B;var j="number"==typeof _.rangeCount;e.features.selectionHasRangeCount=j;var F=!1,I=!0;x.areHostMethods(_,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof _.rangeCount&&e.features.implementsDomRange&&!function(){var e=document.createElement("iframe");e.frameBorder=0,e.style.position="absolute",e.style.left="-10000px",P.appendChild(e);var t=S.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=S.getIframeWindow(e).getSelection(),r=t.documentElement,i=r.lastChild,s=i.firstChild,o=t.createRange();o.setStart(s,1),o.collapse(!0),n.addRange(o),I=1==n.rangeCount,n.removeAllRanges();var u=o.cloneRange();o.setStart(s,0),u.setEnd(s,2),n.addRange(o),n.addRange(u),F=2==n.rangeCount,o.detach(),u.detach(),P.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=F,e.features.collapsedNonEditableSelectionsSupported=I;var q,R=!1;P&&x.isHostMethod(P,"createControlRange")&&(q=P.createControlRange(),x.areHostProperties(q,["item","add"])&&(R=!0)),e.features.implementsControlRange=R,b=H?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var U;x.isHostMethod(_,"getRangeAt")?U=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:H&&(U=function(t){var n=S.getDocument(t.anchorNode),r=e.createRange(n);return r.setStart(t.anchorNode,t.anchorOffset),r.setEnd(t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&(r.setStart(t.focusNode,t.focusOffset),r.setEnd(t.anchorNode,t.anchorOffset)),r}),e.getSelection=function(e){e=e||window;var t=e[E],n=y(e),i=O?r(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh(e)):(t=new d(n,i,e),e[E]=t),t},e.getIframeSelection=function(t){return e.getSelection(S.getIframeWindow(t))};var z=d.prototype;if(!M&&H&&x.areHostMethods(_,["removeAllRanges","addRange"])){z.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),o(this)};var W=function(t,n){var r=T.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(u(i)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};z.addRange=j?function(t,n){if(R&&O&&this.docSelection.type==L)p(this,t);else if(n&&B)W(this,t);else{var r;if(F?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(u(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var s=U(this.nativeSelection,this.rangeCount-1);s&&!T.rangesEqual(s,t)&&(t=new N(s))}this._ranges[this.rangeCount-1]=t,i(this,t,$(this.nativeSelection)),this.isCollapsed=b(this)}else this.refresh()}}:function(e,t){t&&B?W(this,e):(this.nativeSelection.addRange(u(e)),this.refresh())},z.setRanges=function(e){if(R&&e.length>1)v(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(x.isHostMethod(_,"empty")&&x.isHostMethod(D,"select")&&R&&M))return t.fail("No means of selecting a Range or TextRange was found"),!1;z.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=S.getDocument(this.anchorNode);else if(this.docSelection.type==L){var t=this.docSelection.createRange();t.length&&(e=S.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}o(this)},z.addRange=function(e){this.docSelection.type==L?p(this,e):(N.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,i(this,e,!1))},z.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?v(this,e):t&&this.addRange(e[0])}}z.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new C("INDEX_SIZE_ERR");return this._ranges[e]};var X;if(M)X=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=S.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==L?h(t):l(n)?c(t,n):o(t)};else if(x.isHostMethod(_,"getRangeAt")&&"number"==typeof _.rangeCount)X=function(t){if(R&&O&&t.docSelection.type==L)h(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));i(t,t._ranges[t.rangeCount-1],$(t.nativeSelection)),t.isCollapsed=b(t)}else o(t)};else{if(!H||typeof _.isCollapsed!=w||typeof D.collapsed!=w||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;X=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=U(n,0),e._ranges=[t],e.rangeCount=1,s(e),e.isCollapsed=b(e)):o(e)}}z.refresh=function(e){var t=e?this._ranges.slice(0):null;if(X(this),e){var n=t.length;if(n!=this._ranges.length)return!1;for(;n--;)if(!T.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var V=function(e,t){var n=e.getAllRanges(),r=!1;e.removeAllRanges();for(var i=0,s=n.length;s>i;++i)r||t!==n[i]?e.addRange(n[i]):r=!0;e.rangeCount||o(e)};z.removeRange=R?function(e){if(this.docSelection.type==L){for(var t,n=this.docSelection.createRange(),r=f(e),i=S.getDocument(n.item(0)),s=S.getBody(i).createControlRange(),o=!1,u=0,a=n.length;a>u;++u)t=n.item(u),t!==r||o?s.add(n.item(u)):o=!0;s.select(),h(this)}else V(this,e)}:function(e){V(this,e)};var $;!M&&H&&e.features.implementsDomRange?($=function(e){var t=!1;return e.anchorNode&&(t=1==S.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},z.isBackwards=function(){return $(this)}):$=z.isBackwards=function(){return!1},z.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},z.collapse=function(t,n){m(this,t);var r=e.createRange(S.getDocument(t));r.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(r),this.isCollapsed=!0},z.collapseToStart=function(){if(!this.rangeCount)throw new C("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},z.collapseToEnd=function(){if(!this.rangeCount)throw new C("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},z.selectAllChildren=function(t){m(this,t);var n=e.createRange(S.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},z.deleteFromDocument=function(){if(R&&O&&this.docSelection.type==L){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var r=0,i=n.length;i>r;++r)n[r].deleteContents();this.addRange(n[i-1])}},z.getAllRanges=function(){return this._ranges.slice(0)},z.setSingleRange=function(e){this.setRanges([e])},z.containsNode=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},z.toHtml=function(){var e="";if(this.rangeCount){for(var t=T.getRangeDocument(this._ranges[0]).createElement("div"),n=0,r=this._ranges.length;r>n;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},z.getName=function(){return"WrappedSelection"},z.inspect=function(){return g(this)},z.detach=function(){this.win[E]=null,this.win=this.anchorNode=this.focusNode=null},d.inspect=g,e.Selection=d,e.selectionPrototype=z,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),rangy.createModule("SaveRestore",function(e,t){function n(e,t){return(t||document).getElementById(e)}function r(e,t){var n,r="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),i=l.getDocument(e.startContainer),s=e.cloneRange();return s.collapse(t),n=i.createElement("span"),n.id=r,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(i.createTextNode(c)),s.insertNode(n),s.detach(),n}function i(e,r,i,s){var o=n(i,e);o?(r[s?"setStartBefore":"setEndBefore"](o),o.parentNode.removeChild(o)):t.warn("Marker element has been removed. Cannot restore selection.")}function s(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function o(i){i=i||window;var o=i.document;if(!e.isSelectionValid(i))return void t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");var u,a,f,l=e.getSelection(i),c=l.getAllRanges(),h=[];c.sort(s);for(var p=0,v=c.length;v>p;++p)f=c[p],f.collapsed?(a=r(f,!1),h.push({markerId:a.id,collapsed:!0})):(a=r(f,!1),u=r(f,!0),h[p]={startMarkerId:u.id,endMarkerId:a.id,collapsed:!1,backwards:1==c.length&&l.isBackwards()});for(p=v-1;p>=0;--p)f=c[p],f.collapsed?f.collapseBefore(n(h[p].markerId,o)):(f.setEndBefore(n(h[p].endMarkerId,o)),f.setStartAfter(n(h[p].startMarkerId,o)));return l.setRanges(c),{win:i,doc:o,rangeInfos:h,restored:!1}}function u(r,s){if(!r.restored){for(var o,u,a=r.rangeInfos,f=e.getSelection(r.win),l=[],c=a.length,h=c-1;h>=0;--h){if(o=a[h],u=e.createRange(r.doc),o.collapsed){var p=n(o.markerId,r.doc);if(p){p.style.display="inline";var d=p.previousSibling;d&&3==d.nodeType?(p.parentNode.removeChild(p),u.collapseToPoint(d,d.length)):(u.collapseBefore(p),p.parentNode.removeChild(p))}else t.warn("Marker element has been removed. Cannot restore selection.")}else i(r.doc,u,o.startMarkerId,!0),i(r.doc,u,o.endMarkerId,!1);1==c&&u.normalizeBoundaries(),l[h]=u}1==c&&s&&e.features.selectionHasExtend&&a[0].backwards?(f.removeAllRanges(),f.addRange(l[0],!0)):f.setRanges(l),r.restored=!0}}function a(e,t){var r=n(t,e);r&&r.parentNode.removeChild(r)}function f(e){for(var t,n=e.rangeInfos,r=0,i=n.length;i>r;++r)t=n[r],t.collapsed?a(e.doc,t.markerId):(a(e.doc,t.startMarkerId),a(e.doc,t.endMarkerId))}e.requireModules(["DomUtil","DomRange","WrappedRange"]);var l=e.dom,c="﻿";e.saveSelection=o,e.restoreSelection=u,e.removeMarkerElement=a,e.removeMarkers=f})}({},function(){return this}()),define("textAngularRangy",function(){}),!function(e,t){t["true"]=e,function(e,t){function n(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return s(t,l(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}function r(e){var n=[],r=l(n,t.noop);return r.chars(e),n.join("")}function i(e){var t,n={},r=e.split(",");for(t=0;t<r.length;t++)n[r[t]]=!0;return n}function s(e,n){function r(e,r,s,u){if(r=t.lowercase(r),C[r])for(;l.last()&&k[l.last()];)i("",l.last());N[r]&&l.last()==r&&i("",r),u=S[r]||!!u,u||l.push(r);var a={};s.replace(d,function(e,t,n,r,i){var s=n||r||i||"";a[t]=o(s)}),n.start&&n.start(r,a,u)}function i(e,r){var i,s=0;if(r=t.lowercase(r))for(s=l.length-1;s>=0&&l[s]!=r;s--);if(s>=0){for(i=l.length-1;i>=s;i--)n.end&&n.end(l[i]);l.length=s}}"string"!=typeof e&&(e=null===e||"undefined"==typeof e?"":""+e);var s,u,a,f,l=[],w=e;for(l.last=function(){return l[l.length-1]};e;){if(f="",u=!0,l.last()&&A[l.last()]?(e=e.replace(new RegExp("([^]*)<\\s*\\/\\s*"+l.last()+"[^>]*>","i"),function(e,t){return t=t.replace(g,"$1").replace(b,"$1"),n.chars&&n.chars(o(t)),""}),i("",l.last())):(0===e.indexOf("<!--")?(s=e.indexOf("--",4),s>=0&&e.lastIndexOf("-->",s)===s&&(n.comment&&n.comment(e.substring(4,s)),e=e.substring(s+3),u=!1)):y.test(e)?(a=e.match(y),a&&(e=e.replace(a[0],""),u=!1)):m.test(e)?(a=e.match(p),a&&(e=e.substring(a[0].length),a[0].replace(p,i),u=!1)):v.test(e)&&(a=e.match(h),a?(a[4]&&(e=e.substring(a[0].length),a[0].replace(h,r)),u=!1):(f+="<",e=e.substring(1))),u&&(s=e.indexOf("<"),f+=0>s?e:e.substring(0,s),e=0>s?"":e.substring(s),n.chars&&n.chars(o(f)))),e==w)throw c("badparse","The sanitizer was unable to parse the following block of html: {0}",e);w=e}i()}function o(e){if(!e)return"";var t=B.exec(e),n=t[1],r=t[3],i=t[2];return i&&(H.innerHTML=i.replace(/</g,"&lt;"),i="textContent"in H?H.textContent:H.innerText),n+i+r}function u(e){return e.replace(/&/g,"&amp;").replace(w,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(n-56320)+65536)+";"}).replace(E,function(e){var t=e.charCodeAt(0);return 159>=t||173==t||t>=1536&&1540>=t||1807==t||6068==t||6069==t||t>=8204&&8207>=t||t>=8232&&8239>=t||t>=8288&&8303>=t||65279==t||t>=65520&&65535>=t?"&#"+t+";":e}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function a(e){var n="",r=e.split(";");return t.forEach(r,function(e){var r=e.split(":");if(2==r.length){var i=j(t.lowercase(r[0])),e=j(t.lowercase(r[1]));(("color"===i||"background-color"===i)&&(e.match(/^rgb\([0-9%,\. ]*\)$/i)||e.match(/^rgba\([0-9%,\. ]*\)$/i)||e.match(/^hsl\([0-9%,\. ]*\)$/i)||e.match(/^hsla\([0-9%,\. ]*\)$/i)||e.match(/^#[0-9a-f]{3,6}$/i)||e.match(/^[a-z]*$/i))||"text-align"===i&&("left"===e||"right"===e||"center"===e||"justify"===e)||"float"===i&&("left"===e||"right"===e||"none"===e)||("width"===i||"height"===i)&&e.match(/[0-9\.]*(px|em|rem|%)/)||"direction"===i&&e.match(/^ltr|rtl|initial|inherit$/))&&(n+=i+": "+e+";")}}),n}function f(e,t,n,r){return"img"===e&&t["ta-insert-video"]&&("ta-insert-video"===n||"allowfullscreen"===n||"frameborder"===n||"contenteditable"===n&&"false"===r)?!0:!1}function l(e,n){var r=!1,i=t.bind(e,e.push);return{start:function(e,s,o){e=t.lowercase(e),!r&&A[e]&&(r=e),r||O[e]!==!0||(i("<"),i(e),t.forEach(s,function(r,o){var l=t.lowercase(o),c="img"===e&&"src"===l||"background"===l;("style"===l&&""!==(r=a(r))||f(e,s,l,r)||P[l]===!0&&(M[l]!==!0||n(r,c)))&&(i(" "),i(o),i('="'),i(u(r)),i('"'))}),i(o?"/>":">"))},end:function(e){e=t.lowercase(e),r||O[e]!==!0||(i("</"),i(e),i(">")),e==r&&(r=!1)},chars:function(e){r||i(u(e))}}}var c=t.$$minErr("$sanitize"),h=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,p=/^<\/\s*([\w:-]+)[^>]*>/,d=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,v=/^</,m=/^<\//,g=/<!--(.*?)-->/g,y=/<!DOCTYPE([^>]*?)>/i,b=/<!\[CDATA\[(.*?)]]>/g,w=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,E=/([^\#-~| |!])/g,S=i("area,br,col,hr,img,wbr"),x=i("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),T=i("rp,rt"),N=t.extend({},T,x),C=t.extend({},x,i("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),k=t.extend({},T,i("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),L=i("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),A=i("script,style"),O=t.extend({},S,C,k,N,L),M=i("background,cite,href,longdesc,src,usemap,xlink:href"),_=i("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,id,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),D=i("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),P=t.extend({},M,D,_),H=document.createElement("pre"),B=/^(\s*)([\s\S]*?)(\s*)$/,j=function(){return String.prototype.trim?function(e){return t.isString(e)?e.trim():e}:function(e){return t.isString(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}();t.module("ngSanitize",[]).provider("$sanitize",n),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,i=/^mailto:/;return function(s,o){function u(e){e&&p.push(r(e))}function a(e,n){p.push("<a "),t.isDefined(o)&&p.push('target="',o,'" '),p.push('href="',e.replace(/"/g,"&quot;"),'">'),u(n),p.push("</a>")}if(!s)return s;for(var f,l,c,h=s,p=[];f=h.match(n);)l=f[0],f[2]||f[4]||(l=(f[3]?"http://":"mailto:")+l),c=f.index,u(h.substr(0,c)),a(l,f[0].replace(i,"")),h=h.substring(c+f[0].length);return u(h),e(p.join(""))}}])}(window,window.angular)}({},function(){return this}()),define("textAngularSanitize",function(){}),!function(e,t){t["true"]=e,angular.module("textAngularSetup",[]).value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},setup:{textEditorSetup:function(){},htmlEditorSetup:function(){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)?(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).run(["taRegisterTool","$window","taTranslations","taSelection",function(e,t,n,r){e("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var i=function(e){return function(){return this.$editor().queryFormatBlockState(e)}},s=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){e(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:n.heading.tooltip+t.charAt(1),action:s,activeState:i(t.toLowerCase())})}),e("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),e("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),e("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),e("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),e("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),e("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),e("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t=t||this.$editor().queryCommandState("justifyLeft")}}),e("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){var t=!1;return e&&(t="right"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyRight")}}),e("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){var t=!1;return e&&(t="center"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyCenter")}}),e("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1}}),e("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),e("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),e("strikeThrough",{iconclass:"fa fa-strikethrough",action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),e("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var i=angular.element(r.getSelectionElement()),s=function(e){e=angular.element(e);var t=e;angular.forEach(e.children(),function(e){var n=angular.element("<p></p>");n.html(angular.element(e).html()),t.after(n),t=n}),e.remove()};if(angular.forEach(i.find("ul"),s),angular.forEach(i.find("ol"),s),"li"===i[0].tagName.toLowerCase()){var o=i[0].parentNode.childNodes,u=[],a=[],f=!1;for(n=0;n<o.length;n++)o[n]===i[0]?f=!0:f?a.push(o[n]):u.push(o[n]);var l=angular.element(i[0].parentNode),c=angular.element("<p></p>");if(c.html(angular.element(i[0]).html()),0===u.length||0===a.length)0===a.length?l.after(c):l[0].parentNode.insertBefore(c[0],l[0]),0===u.length&&0===a.length?l.remove():angular.element(i[0]).remove();else{var h=angular.element("<"+l[0].tagName+"></"+l[0].tagName+">"),p=angular.element("<"+l[0].tagName+"></"+l[0].tagName+">");for(n=0;n<u.length;n++)h.append(angular.element(u[n]));for(n=0;n<a.length;n++)p.append(angular.element(a[n]));l.after(p),l.after(c),l.after(h),l.remove()}r.setSelectionToElementEnd(c[0])}var v=this.$editor(),m=function(e){e=angular.element(e),e[0]!==v.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),m)};angular.forEach(i,m),"li"!==i[0].tagName.toLowerCase()&&"ol"!==i[0].tagName.toLowerCase()&&"ul"!==i[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}});var o=function(e,t,n){var r=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var i=n.displayElements.popoverContainer;i.empty();var s=angular.element('<div class="btn-group" style="padding-right: 6px;">'),o=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');o.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),r()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');u.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),r()});var a=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');a.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),r()});var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');f.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),r()}),s.append(o),s.append(u),s.append(a),s.append(f),i.append(s),s=angular.element('<div class="btn-group" style="padding-right: 6px;">');var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');l.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),r()});var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');c.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),r()});var h=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');h.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),r()}),s.append(l),s.append(h),s.append(c),i.append(s),s=angular.element('<div class="btn-group">');var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');p.on("click",function(e){e.preventDefault(),t.remove(),r()}),s.append(p),i.append(s),n.showPopover(t),n.showResizeOverlay(t)};e("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var e;return e=t.prompt(n.insertImage.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("insertImage",e,!0):void 0},onElementSelect:{element:"img",action:o}}),e("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var e;if(e=t.prompt(n.insertVideo.dialogPrompt,"https://"),e&&""!==e&&"https://"!==e){var r=e.match(/(\?|&)v=[^&]*/);if(r&&r.length>0){var i="https://www.youtube.com/embed/"+r[0].substring(3),s='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+r[0].substring(3)+'/hqdefault.jpg" ta-insert-video="'+i+'" contenteditable="false" src="" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",s,!0)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:o}}),e("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;return e=t.prompt(n.insertLink.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("createLink",e,!0):void 0},activeState:function(e){return e?"A"===e[0].tagName:!1},onElementSelect:{element:"a",action:function(e,r,i){e.preventDefault(),i.displayElements.popover.css("width","436px");var s=i.displayElements.popoverContainer;s.empty(),s.css("line-height","28px");var o=angular.element('<a href="'+r.attr("href")+'" target="_blank">'+r.attr("href")+"</a>");o.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),s.append(o);var u=angular.element('<div class="btn-group pull-right">'),a=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+n.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');a.on("click",function(e){e.preventDefault();var s=t.prompt(n.insertLink.dialogPrompt,r.attr("href"));s&&""!==s&&"http://"!==s&&(r.attr("href",s),i.updateTaBindtaTextElement()),i.hidePopover()}),u.append(a);var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+n.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');f.on("click",function(e){e.preventDefault(),r.replaceWith(r.contents()),i.updateTaBindtaTextElement(),i.hidePopover()}),u.append(f);var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+n.editLink.targetToggle.buttontext+"</button>");"_blank"===r.attr("target")&&l.addClass("active"),l.on("click",function(e){e.preventDefault(),r.attr("target","_blank"===r.attr("target")?"":"_blank"),l.toggleClass("active"),i.updateTaBindtaTextElement()}),u.append(l),s.append(u),i.showPopover(r)}}}),e("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerHTML,n=t.replace(/(<[^>]*?>)/gi," "),r=n.match(/\S+/g),i=r&&r.length||0;return this.wordcount=i,this.$editor().wordcount=i,!1}}),e("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerText||e[0].textContent,n=t.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=n,this.$editor().charcount=n,!1}})}]),function(){function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(t,n){if(!t||""===t||g.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(n.display&&(""===n.display||!e(n.display))||!n.display&&!n.buttontext&&!n.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';g[t]=n}var n={ie:function(){for(var e,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",r[0];);return t>4?t:e}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},r=!1;n.webkit&&(document.addEventListener("mousedown",function(e){var t=e||window.event,n=t.target;if(r&&null!==n){for(var i=!1,s=n;null!==s&&"html"!==s.tagName.toLowerCase()&&!i;)i="true"===s.contentEditable,s=s.parentNode;i||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),n.focus(),n.select&&n.select())}r=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" unselectable="on" tabIndex="-1">'))}));var i=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,s=/^(ul|li|ol)$/i,o=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var u,a,f,l,c,h;if(n.ie>8||void 0===n.ie){for(var p=document.styleSheets,d=0;d<p.length;d++)if((0===p[d].media.length||p[d].media.mediaText.match(/(all|screen)/gi))&&p[d].href&&p[d].href.match(/textangular\.(min\.|)css/gi)){u=p[d];break}u||(u=function(){var e=document.createElement("style");return n.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),a=function(e,t){return l(u,e,t)},l=function(e,t,n){var r,i;return e.cssRules?r=Math.max(e.cssRules.length-1,0):e.rules&&(r=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",r):e.addRule(t,n,r),u.rules?i=u.rules[r]:u.cssRules&&(i=u.cssRules[r]),i},h=function(e,t){var n,r;for(n=0;n<t.length;n++)if(t[n].cssText===e.cssText){r=n;break}return r},f=function(e){c(u,e)},c=function(e,t){var n=h(t,e.cssRules||e.rules);e.removeRule?e.removeRule(n):e.deleteRule(n)}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===n.ie?"div":n.ie<=8?"P":"p":n.ie<=8?e.toUpperCase():e:n.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(e,t){return function(n){var r=angular.element("<div></div>");return r[0].innerHTML=n,angular.forEach(e,function(e){var n=[];e.selector&&""!==e.selector?n=r.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(n=t.getByAttribute(r,e.customAttribute)),angular.forEach(n,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),r[0].innerHTML}}]).factory("taFixChrome",function(){var e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n,r,i=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,s="",o=0;t=i.exec(e);)n=t[3]||t[4],n&&n.match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,""),r="<"+t[1].trim(),n.length>0&&(r+=" style="+t[2].substring(0,1)+n+t[2].substring(0,1)),r+=t[5].trim()+">",s+=e.substring(o,t.index)+r,o=t.index+t[0].length);return s+=e.substring(o),o>0?s.replace(/<span\s*>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e};return e}).factory("taSanitize",["$sanitize",function(e){function t(e,t){for(var n,r=0,i=0,s=/<[^>]*>/gi;n=s.exec(e);)if(i=n.index,"/"===n[0].substr(1,1)){if(0===r)break;r--}else r++;return t+e.substring(0,i)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(i)}function n(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var r,s,o,u,a,l,c=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,h="",p="",d=0;s=c.exec(e);){u=s[3]||s[4];var v=new RegExp(f,"i");if(angular.isString(u)&&v.test(u)){a="";for(var m=new RegExp(f,"ig");o=m.exec(u);)for(r=0;r<i.length;r++)o[2*r+2]&&(a+="<"+i[r].tag+">");l=n(e.substring(d,s.index)),p+=h.length>0?t(l,h):l,u=u.replace(new RegExp(f,"ig"),""),p+="<"+s[1].trim(),u.length>0&&(p+=' style="'+u+'"'),p+=s[5]+">",d=s.index+s[0].length,h=a}}return p+=h.length>0?t(e.substring(d),h):e.substring(d)}function r(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,r="",i=0;t=n.exec(e);){r+=e.substring(i,t.index),i=t.index+t[0].length;var s="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(s)?s=s.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):s+=' style="text-align:'+(t[3]||t[4])+';"',s+=">",r+=s}return r+e.substring(i)}for(var i=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],s=[],o=0;o<i.length;o++){for(var u="("+i[o].property+":\\s*(",a=0;a<i[o].values.length;a++)a>0&&(u+="|"),u+=i[o].values[a];u+=");)",s.push(u)}var f="("+s.join("|")+")";return function(t,i,s){if(!s)try{t=n(t)}catch(o){}t=r(t);var u;try{u=e(t),s&&(u=t)}catch(o){u=i||""}var a,f=u.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),l=u.replace(/(&#(9|10);)*/gi,""),c=/<pre[^>]*>.*?<\/pre[^>]*>/gi,h=0,p=0;for(u="";null!==(a=c.exec(l))&&h<f.length;)u+=l.substring(p,a.index)+f[h],p=a.index+a[0].length,h++;return u+l.substring(p)}}]).factory("taToolExecuteAction",["$q","$log",function(e,t){return function(n){void 0!==n&&(this.$editor=function(){return n});var r=e.defer(),i=r.promise,s=this.$editor();i["finally"](function(){s.endAction.call(s)});var o;try{o=this.action(r,s.startAction())}catch(u){t.error(u)}(o||void 0===o)&&r.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,n){var r=function(t,n){var r,i,s=t.find("li");for(i=s.length-1;i>=0;i--)r=angular.element("<"+n+">"+s[i].innerHTML+"</"+n+">"),t.after(r);t.remove(),e.setSelectionToElementEnd(r[0])},o=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?e.setSelectionBeforeElement(angular.element(t).find("br")[0]):e.setSelectionToElementEnd(t)},u=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),o(n.find("li")[0])},a=function(e,n,r){for(var i="",s=0;s<e.length;s++)i+="<"+t("li")+">"+e[s].innerHTML+"</"+t("li")+">";var u=angular.element("<"+r+">"+i+"</"+r+">");n.after(u),n.remove(),o(u.find("li")[0])};return function(o,f){return o=t(o),function(l,c,h){var p,d,v,m,g,y,w,E=angular.element("<"+o+">");try{w=e.getSelectionElement()}catch(S){}var x=angular.element(w);if(void 0!==w){var T=w.tagName.toLowerCase();if("insertorderedlist"===l.toLowerCase()||"insertunorderedlist"===l.toLowerCase()){var N=t("insertorderedlist"===l.toLowerCase()?"ol":"ul");if(T===N)return r(x,o);if("li"===T&&x.parent()[0].tagName.toLowerCase()===N&&1===x.parent().children().length)return r(x.parent(),o);if("li"===T&&x.parent()[0].tagName.toLowerCase()!==N&&1===x.parent().children().length)return u(x.parent(),N);if(T.match(i)&&!x.hasClass("ta-bind")){if("ol"===T||"ul"===T)return u(x,N);var C=!1;return angular.forEach(x.children(),function(e){e.tagName.match(i)&&(C=!0)}),C?a(x.children(),x,N):a([angular.element("<div>"+w.innerHTML+"</div>")[0]],x,N)}if(T.match(i)){if(m=e.getOnlySelectedElements(),0===m.length)d=angular.element("<"+N+"><li>"+w.innerHTML+"</li></"+N+">"),x.html(""),x.append(d);else{if(1===m.length&&("ol"===m[0].tagName.toLowerCase()||"ul"===m[0].tagName.toLowerCase()))return m[0].tagName.toLowerCase()===N?r(angular.element(m[0]),o):u(angular.element(m[0]),N);v="";var k=[];for(p=0;p<m.length;p++)if(3!==m[p].nodeType){var L=angular.element(m[p]);if("li"===m[p].tagName.toLowerCase())continue;v+="ol"===m[p].tagName.toLowerCase()||"ul"===m[p].tagName.toLowerCase()?L[0].innerHTML:"span"!==m[p].tagName.toLowerCase()||"ol"!==m[p].childNodes[0].tagName.toLowerCase()&&"ul"!==m[p].childNodes[0].tagName.toLowerCase()?"<"+t("li")+">"+L[0].innerHTML+"</"+t("li")+">":L[0].childNodes[0].innerHTML,k.unshift(L)}d=angular.element("<"+N+">"+v+"</"+N+">"),k.pop().replaceWith(d),angular.forEach(k,function(e){e.remove()})}return void e.setSelectionToElementEnd(d[0])}}else{if("formatblock"===l.toLowerCase()){for(y=h.toLowerCase().replace(/[<>]/gi,""),"default"===y.trim()&&(y=o,h="<"+o+">"),d="li"===T?x.parent():x;!d[0].tagName||!d[0].tagName.match(i)&&!d.parent().attr("contenteditable");)d=d.parent(),T=(d[0].tagName||"").toLowerCase();if(T===y){m=d.children();var A=!1;for(p=0;p<m.length;p++)A=A||m[p].tagName.match(i);A?(d.after(m),g=d.next(),d.remove(),d=g):(E.append(d[0].childNodes),d.after(E),d.remove(),d=E)}else if(d.parent()[0].tagName.toLowerCase()!==y||d.parent().hasClass("ta-bind"))if(T.match(s))d.wrap(h);else{for(m=e.getOnlySelectedElements(),0===m.length&&(m=[d[0]]),p=0;p<m.length;p++)if(3===m[p].nodeType||!m[p].tagName.match(i))for(;3===m[p].nodeType||!m[p].tagName||!m[p].tagName.match(i);)m[p]=m[p].parentNode;if(angular.element(m[0]).hasClass("ta-bind"))d=angular.element(h),d[0].innerHTML=m[0].innerHTML,m[0].innerHTML=d[0].outerHTML;else if("blockquote"===y){for(v="",p=0;p<m.length;p++)v+=m[p].outerHTML;for(d=angular.element(h),d[0].innerHTML=v,m[0].parentNode.insertBefore(d[0],m[0]),p=m.length-1;p>=0;p--)m[p].parentNode&&m[p].parentNode.removeChild(m[p])}else for(p=0;p<m.length;p++)d=angular.element(h),d[0].innerHTML=m[p].innerHTML,m[p].parentNode.insertBefore(d[0],m[p]),m[p].parentNode.removeChild(m[p])}else{var O=d.parent(),M=O.contents();for(p=0;p<M.length;p++)O.parent().hasClass("ta-bind")&&3===M[p].nodeType&&(E=angular.element("<"+o+">"),E[0].innerHTML=M[p].outerHTML,M[p]=E[0]),O.parent()[0].insertBefore(M[p],O[0]);O.remove()}return void e.setSelectionToElementEnd(d[0])}if("createlink"===l.toLowerCase()){var _=e.getSelection();if(_.collapsed)return void e.insertHtml('<a href="'+h+'">'+h+"</a>",f)}else if("inserthtml"===l.toLowerCase())return void e.insertHtml(h,f)}}try{n[0].execCommand(l,c,h)}catch(S){}}}}]).service("taSelection",["$window","$document","taDOM",function(e,t,n){var r=t[0],s=e.rangy,u=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},a={getSelection:function(){var e=s.getSelection().getRangeAt(0),t=e.commonAncestorContainer,n={start:u(e.startContainer,e.startOffset),end:u(e.endContainer,e.endOffset),collapsed:e.collapsed};return t=3===t.nodeType?t.parentNode:t,n.container=t.parentNode===n.start.element||t.parentNode===n.end.element?t.parentNode:t,n},getOnlySelectedElements:function(){var e=s.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getSelectionElement:function(){return a.getSelection().container},setSelection:function(e,t,n){var r=s.createRange();r.setStart(e,t),r.setEnd(e,n),s.getSelection().setSingleRange(r)},setSelectionBeforeElement:function(e){var t=s.createRange();t.selectNode(e),t.collapse(!0),s.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=s.createRange();t.selectNode(e),t.collapse(!1),s.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=s.createRange();t.selectNodeContents(e),t.collapse(!0),s.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=s.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),s.getSelection().setSingleRange(t)},insertHtml:function(e,t){var u,f,l,c,h,p,d,v=angular.element("<div>"+e+"</div>"),m=s.getSelection().getRangeAt(0),g=r.createDocumentFragment(),y=v[0].childNodes,b=!0;if(y.length>0){for(c=[],l=0;l<y.length;l++)"p"===y[l].nodeName.toLowerCase()&&""===y[l].innerHTML.trim()||3===y[l].nodeType&&""===y[l].nodeValue.trim()||(b=b&&!i.test(y[l].nodeName),c.push(y[l]));for(var w=0;w<c.length;w++)p=g.appendChild(c[w]);!b&&m.collapsed&&/^(|<br(|\/)>)$/i.test(m.startContainer.innerHTML)&&m.selectNode(m.startContainer)}else b=!0,p=g=r.createTextNode(e);if(b)m.deleteContents();else if(m.collapsed&&m.startContainer!==t)if(m.startContainer.innerHTML&&m.startContainer.innerHTML.match(/^<[^>]*>$/i))u=m.startContainer,1===m.startOffset?(m.setStartAfter(u),m.setEndAfter(u)):(m.setStartBefore(u),m.setEndBefore(u));else{if(3===m.startContainer.nodeType&&m.startContainer.parentNode!==t)for(u=m.startContainer.parentNode,f=u.cloneNode(),n.splitNodes(u.childNodes,u,f,m.startContainer,m.startOffset);!o.test(u.nodeName);){angular.element(u).after(f),u=u.parentNode;var E=f;f=u.cloneNode(),n.splitNodes(u.childNodes,u,f,E)}else u=m.startContainer,f=u.cloneNode(),n.splitNodes(u.childNodes,u,f,void 0,void 0,m.startOffset);if(angular.element(u).after(f),m.setStartAfter(u),m.setEndAfter(u),/^(|<br(|\/)>)$/i.test(u.innerHTML.trim())&&(m.setStartBefore(u),m.setEndBefore(u),angular.element(u).remove()),/^(|<br(|\/)>)$/i.test(f.innerHTML.trim())&&angular.element(f).remove(),"li"===u.nodeName.toLowerCase()){for(d=r.createDocumentFragment(),h=0;h<g.childNodes.length;h++)v=angular.element("<li>"),n.transferChildNodes(g.childNodes[h],v[0]),n.transferNodeAttributes(g.childNodes[h],v[0]),d.appendChild(v[0]);g=d,p&&(p=g.childNodes[g.childNodes.length-1],p=p.childNodes[p.childNodes.length-1])}}else m.deleteContents();m.insertNode(g),p&&a.setSelectionToElementEnd(p)}};return a}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var r=[],i=t.children();return i.length&&angular.forEach(i,function(t){r=r.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&r.push(t),r},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,r,i,s,o){if(!i&&isNaN(o))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var u=document.createDocumentFragment(),a=document.createDocumentFragment(),f=0;t.length>0&&(isNaN(o)||o!==f)&&t[0]!==i;)u.appendChild(t[0]),f++;for(!isNaN(s)&&s>=0&&t[0]&&(u.appendChild(document.createTextNode(t[0].nodeValue.substring(0,s))),t[0].nodeValue=t[0].nodeValue.substring(s));t.length>0;)a.appendChild(t[0]);e.transferChildNodes(u,n),e.transferChildNodes(a,r)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){function i(e){var t=angular.element("<div/>");t.html(e);var n=t.text().length;return s>=n?(r.$setValidity("taMaxText",!0),e):void r.$setValidity("taMaxText",!1)}var s=parseInt(e.$eval(n.taMaxText));if(isNaN(s))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(s=parseInt(e),isNaN(s))throw"Max text must be an integer";r.$dirty&&r.$setViewValue(r.$viewValue)}),r.$parsers.unshift(i)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){function i(e){var t=angular.element("<div/>");t.html(e);var n=t.text().length;return!n||n>=s?(r.$setValidity("taMinText",!0),e):void r.$setValidity("taMinText",!1)}var s=parseInt(e.$eval(n.taMinText));if(isNaN(s))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(s=parseInt(e),isNaN(s))throw"Min text must be an integer";r.$dirty&&r.$setViewValue(r.$viewValue)}),r.$parsers.unshift(i)}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var e=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(n){if(!n)return!0;var r,i=/(^[^<]|>)[^<]/i.exec(n);return i?r=i.index:(n=n.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),r=n.indexOf(">")),n=n.trim().substring(r,r+100),/^[^<>]+$/i.test(n)?!1:0===n.length||n===t||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(n)?!0:/>\s*[^\s<]/i.test(n)||e.test(n)?!1:!0}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM",function(e,t,i,s,u,l,c,h,p,d,m,g,y){return{require:"ngModel",link:function(l,w,E,S){var x,T,N,C,k=void 0!==w.attr("contenteditable")&&w.attr("contenteditable"),L=k||"textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase(),A=!1,O=!1,M=!1,_=E.taUnsafeSanitizer||d.disableSanitizer,D=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,P=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i;void 0===E.taDefaultWrap&&(E.taDefaultWrap="p"),""===E.taDefaultWrap?(N="",C=void 0===n.ie?"<div><br></div>":n.ie>=11?"<p><br></p>":n.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(N=void 0===n.ie||n.ie>=11?"<"+E.taDefaultWrap+"><br></"+E.taDefaultWrap+">":n.ie<=8?"<"+E.taDefaultWrap.toUpperCase()+"></"+E.taDefaultWrap.toUpperCase()+">":"<"+E.taDefaultWrap+"></"+E.taDefaultWrap+">",C=void 0===n.ie||n.ie>=11?"<"+E.taDefaultWrap+"><br></"+E.taDefaultWrap+">":n.ie<=8?"<"+E.taDefaultWrap.toUpperCase()+">&nbsp;</"+E.taDefaultWrap.toUpperCase()+">":"<"+E.taDefaultWrap+">&nbsp;</"+E.taDefaultWrap+">");var H=m(C),B=function(e){if(H(e))return e;var t=angular.element("<div>"+e+"</div>");return 0===t.children().length&&(e="<"+E.taDefaultWrap+">"+e+"</"+E.taDefaultWrap+">"),e};E.taPaste&&(T=g(E.taPaste)),w.addClass("ta-bind");var F;l["$undoManager"+(E.id||"")]=S.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return"undefined"==typeof e||null===e||"undefined"!=typeof this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),F&&t.cancel(F),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var I=l["$undoTaBind"+(E.id||"")]=function(){if(!A&&k){var e=S.$undoManager.undo();"undefined"!=typeof e&&null!==e&&(et(e),z(e,!1),c.setSelectionToElementEnd(w[0].childNodes.length?w[0].childNodes[w[0].childNodes.length-1]:w[0]))}},R=l["$redoTaBind"+(E.id||"")]=function(){if(!A&&k){var e=S.$undoManager.redo();"undefined"!=typeof e&&null!==e&&(et(e),z(e,!1),c.setSelectionToElementEnd(w[0].childNodes.length?w[0].childNodes[w[0].childNodes.length-1]:w[0]))}},U=function(){if(k)return w[0].innerHTML;if(L)return w.val();throw"textAngular Error: attempting to update non-editable taBind"},z=function(e,t){M=!0,("undefined"==typeof t||null===t)&&(t=k),("undefined"==typeof e||null===e)&&(e=U()),H(e)?(""!==S.$viewValue&&S.$setViewValue(""),t&&""!==S.$undoManager.current()&&S.$undoManager.push("")):(Z(),S.$viewValue!==e&&(S.$setViewValue(e),t&&S.$undoManager.push(e)))};if(l["updateTaBind"+(E.id||"")]=function(){A||z()},L)if(l.events={},k){var W=!1,X=function(n){if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)){var r=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);r=r?r[1]:n,r=r.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var i=angular.element("<div>"+r+"</div>"),s=angular.element("<div></div>"),o={element:null,lastIndent:[],lastLi:null,isUl:!1};o.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var u=function(e){o.isUl=e,o.element=angular.element(e?"<ul>":"<ol>"),o.lastIndent=[],o.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},o.lastLevelMatch=null},a=0;a<=i[0].childNodes.length;a++)if(i[0].childNodes[a]&&"#text"!==i[0].childNodes[a].nodeName&&"p"===i[0].childNodes[a].tagName.toLowerCase()){var f=angular.element(i[0].childNodes[a]),h=(f.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(h){if(f[0].childNodes.length<2||f[0].childNodes[1].childNodes.length<1)continue;var p="bullet"===h[1].toLowerCase()||"number"!==h[1].toLowerCase()&&!/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(f[0].childNodes[1].innerHTML)&&!/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(f[0].childNodes[1].childNodes[0].innerHTML),d=(f.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),v=parseFloat(d?d[1]:0),m=(f.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(m&&m[2]&&(v=parseInt(m[2])),m&&(!o.lastLevelMatch||m[1]!==o.lastLevelMatch[1])||!h[3]||"first"===h[3].toLowerCase()||null===o.lastIndent.peek()||o.isUl!==p&&o.lastIndent.peek()===v)u(p),s.append(o.element);else if(null!=o.lastIndent.peek()&&o.lastIndent.peek()<v)o.element=angular.element(p?"<ul>":"<ol>"),o.lastLi.append(o.element);else if(null!=o.lastIndent.peek()&&o.lastIndent.peek()>v){for(;null!=o.lastIndent.peek()&&o.lastIndent.peek()>v;)if("li"!==o.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(o.element.parent()[0].tagName.toLowerCase()))break;o.element=o.element.parent(),o.lastIndent.pop()}else o.element=o.element.parent();o.isUl="ul"===o.element[0].tagName.toLowerCase(),p!==o.isUl&&(u(p),s.append(o.element))}o.lastLevelMatch=m,v!==o.lastIndent.peek()&&o.lastIndent.push(v),o.lastLi=angular.element("<li>"),o.element.append(o.lastLi),o.lastLi.html(f.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),f.remove()}else u(!1),s.append(f)}var g=function(e){e=angular.element(e);for(var t=e[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(s.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&g(e)}),angular.forEach(s.find("font"),g),n=s.html()}else{if(n=n.replace(/<(|\/)meta[^>]*?>/gi,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){var E=angular.element("<div>"+n+"</div>");E.find("textarea").remove();for(var x=y.getByAttribute(E,"ta-bind"),N=0;N<x.length;N++){for(var C=x[N][0].parentNode.parentNode,k=0;k<x[N][0].childNodes.length;k++)C.parentNode.insertBefore(x[N][0].childNodes[k],C);C.parentNode.removeChild(C)}n=E.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n=n.replace(/<(|\/)span[^>]*?>/gi,""));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}n=e(n,"",_),T&&(n=T(l,{$html:n})||n),c.insertHtml(n,w[0]),t(function(){S.$setViewValue(U()),W=!1,w.removeClass("processing-paste")},0)}else W=!1,w.removeClass("processing-paste")};if(w.on("paste",l.events.paste=function(e,n){if(n&&angular.extend(e,n),A||W)return e.stopPropagation(),e.preventDefault(),!1;W=!0,w.addClass("processing-paste");var r,o=(e.originalEvent||e).clipboardData;if(o&&o.getData&&o.types.length>0){for(var u="",a=0;a<o.types.length;a++)u+=" "+o.types[a];return/text\/html/i.test(u)?r=o.getData("text/html"):/text\/plain/i.test(u)&&(r=o.getData("text/plain")),X(r),e.stopPropagation(),e.preventDefault(),!1}var f=i.rangy.saveSelection(),l=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');s.find("body").append(l),l[0].focus(),t(function(){i.rangy.restoreSelection(f),X(l[0].innerHTML),w[0].focus(),l.remove()},0)}),w.on("cut",l.events.cut=function(e){A?e.preventDefault():t(function(){S.$setViewValue(U())},0)}),w.on("keydown",l.events.keydown=function(e,t){if(t&&angular.extend(e,t),!A)if(!e.altKey&&e.metaKey||e.ctrlKey)90!==e.keyCode||e.shiftKey?(90===e.keyCode&&e.shiftKey||89===e.keyCode&&!e.shiftKey)&&(R(),e.preventDefault()):(I(),e.preventDefault());else if(13===e.keyCode&&!e.shiftKey){var n,r=c.getSelectionElement();if(!r.tagName.match(o))return;var i=angular.element(N);if(/^<br(|\/)>$/i.test(r.innerHTML.trim())&&"blockquote"===r.parentNode.tagName.toLowerCase()&&!r.nextSibling){n=angular.element(r);var s=n.parent();s.after(i),n.remove(),0===s.children().length&&s.remove(),c.setSelectionToElementStart(i[0]),e.preventDefault()}else/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(r.innerHTML.trim())&&"blockquote"===r.tagName.toLowerCase()&&(n=angular.element(r),n.after(i),n.remove(),c.setSelectionToElementStart(i[0]),e.preventDefault())}}),w.on("keyup",l.events.keyup=function(e,n){if(n&&angular.extend(e,n),9===e.keyCode){var r=c.getSelection();return void (r.start.element===w[0]&&w.children().length&&c.setSelectionToElementStart(w.children()[0]))}if(F&&t.cancel(F),!A&&!D.test(e.keyCode)){if(""!==N&&13===e.keyCode&&!e.shiftKey){for(var s=c.getSelectionElement();!s.tagName.match(o)&&s!==w[0];)s=s.parentNode;if(s.tagName.toLowerCase()!==E.taDefaultWrap&&"li"!==s.tagName.toLowerCase()&&(""===s.innerHTML.trim()||"<br>"===s.innerHTML.trim())){var u=angular.element(N);angular.element(s).replaceWith(u),c.setSelectionToElementStart(u[0])}}var a=U();if(""!==N&&""===a.trim())et(N),c.setSelectionToElementStart(w.children()[0]);else if("<"!==a.substring(0,1)&&""!==E.taDefaultWrap){var f=i.rangy.saveSelection();a=U(),a="<"+E.taDefaultWrap+">"+a+"</"+E.taDefaultWrap+">",et(a),i.rangy.restoreSelection(f)}var l=x!==e.keyCode&&P.test(e.keyCode);z(a,l),l||(F=t(function(){S.$undoManager.push(a)},250)),x=e.keyCode}}),w.on("blur",l.events.blur=function(){O=!1,A||z(),M=!0,S.$render()}),E.placeholder&&(n.ie>8||void 0===n.ie)){var V;if(!E.id)throw"textAngular Error: An unique ID is required for placeholders to work";V=a("#"+E.id+".placeholder-text:before",'content: "'+E.placeholder+'"'),l.$on("$destroy",function(){f(V)})}w.on("focus",l.events.focus=function(){O=!0,w.removeClass("placeholder-text")}),w.on("mouseup",l.events.mouseup=function(){var e=c.getSelection();e.start.element===w[0]&&w.children().length&&c.setSelectionToElementStart(w.children()[0])}),w.on("mousedown",l.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{w.on("change blur",l.events.change=l.events.blur=function(){A||S.$setViewValue(U())}),w.on("keydown",l.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,r=this.selectionEnd,i=w.val();if(e.shiftKey){var s=i.lastIndexOf("\n",n),o=i.lastIndexOf("	",n);-1!==o&&o>=s&&(w.val(i.substring(0,o)+i.substring(o+1)),this.selectionStart=this.selectionEnd=n-1)}else w.val(i.substring(0,n)+"	"+i.substring(r)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var $=function(e,t){for(var n="",r=0;t>r;r++)n+=e;return n},J=function(e,t){var n="",r=e.childNodes;t++,n+=$("	",t-1)+e.outerHTML.substring(0,e.outerHTML.indexOf("<li"));for(var i=0;i<r.length;i++)r[i].outerHTML&&(n+="ul"===r[i].nodeName.toLowerCase()||"ol"===r[i].nodeName.toLowerCase()?"\n"+J(r[i],t):"\n"+$("	",t)+r[i].outerHTML);return n+="\n"+$("	",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};S.$formatters.unshift(B),S.$formatters.unshift(function(e){var t=angular.element("<div>"+e+"</div>")[0].childNodes;if(t.length>0){e="";for(var n=0;n<t.length;n++)t[n].outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===t[n].nodeName.toLowerCase()||"ol"===t[n].nodeName.toLowerCase()?""+J(t[n],0):""+t[n].outerHTML)}return e})}var K=function(t){return S.$oldViewValue=e(u(t),S.$oldViewValue,_)},Q=function(e){return E.required&&S.$setValidity("required",!H(e)),e};S.$parsers.push(K),S.$parsers.unshift(Q),S.$formatters.push(K),S.$formatters.unshift(B),S.$formatters.unshift(Q),S.$formatters.unshift(function(e){return S.$undoManager.push(e||"")});var G=function(e){return l.$emit("ta-element-select",this),e.preventDefault(),!1},Y=function(e,n){if(n&&angular.extend(e,n),!v&&!A){v=!0;var r;r=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,l.$emit("ta-drop-event",this,e,r),t(function(){v=!1,z()},100)}},Z=l["reApplyOnSelectorHandlers"+(E.id||"")]=function(){A||angular.forEach(h,function(e){w.find(e).off("click",G).on("click",G)})},et=function(e){w[0].innerHTML=e};S.$render=function(){var e=S.$viewValue||"";M||(k&&O&&(w.removeClass("placeholder-text"),w[0].blur(),t(function(){w[0].focus(),c.setSelectionToElementEnd(w.children()[w.children().length-1])},1)),k?(et(E.placeholder?""===e?N:e:""===e?N:e),A?w.off("drop",Y):(Z(),w.on("drop",Y))):"textarea"!==w[0].tagName.toLowerCase()&&"input"!==w[0].tagName.toLowerCase()?et(p(e)):w.val(e)),k&&E.placeholder&&(""===e?O?w.removeClass("placeholder-text"):w.addClass("placeholder-text"):w.removeClass("placeholder-text")),M=!1},E.taReadonly&&(A=l.$eval(E.taReadonly),A?(w.addClass("ta-readonly"),("textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase())&&w.attr("disabled","disabled"),void 0!==w.attr("contenteditable")&&w.attr("contenteditable")&&w.removeAttr("contenteditable")):(w.removeClass("ta-readonly"),"textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase()?w.removeAttr("disabled"):k&&w.attr("contenteditable","true")),l.$watch(E.taReadonly,function(e,t){t!==e&&(e?(w.addClass("ta-readonly"),("textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase())&&w.attr("disabled","disabled"),void 0!==w.attr("contenteditable")&&w.attr("contenteditable")&&w.removeAttr("contenteditable"),angular.forEach(h,function(e){w.find(e).on("click",G)}),w.off("drop",Y)):(w.removeClass("ta-readonly"),"textarea"===w[0].tagName.toLowerCase()||"input"===w[0].tagName.toLowerCase()?w.removeAttr("disabled"):k&&w.attr("contenteditable","true"),angular.forEach(h,function(e){w.find(e).off("click",G)}),w.on("drop",Y)),A=e)})),k&&!A&&(angular.forEach(h,function(e){w.find(e).on("click",G)}),w.on("drop",Y),w.on("blur",function(){n.webkit&&(r=!0)}))}}}]);var v=!1,m=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]),g={};m.constant("taRegisterTool",t),m.value("taTools",g),m.config([function(){angular.forEach(g,function(e,t){delete g[t]})}]),m.run([function(){if(!window.rangy)throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly."}]),m.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(e,t,n,r,i,s,o,u,a,f,l,c){return{require:"?ngModel",scope:{},restrict:"EA",link:function(h,p,d,v){var m,g,y,w,E,S,x,T,N,C,L,A=d.serial?d.serial:Math.floor(1e16*Math.random());h._name=d.name?d.name:"textAngularEditor"+A;var O=function(e,n,r){t(function(){var t=function(){e.off(n,t),r.apply(this,arguments)};e.on(n,t)},100)};N=i(d.taDefaultWrap),angular.extend(h,angular.copy(n),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?h["$undoTaBindtaTextElement"+A]():"redo"===e.toLowerCase()?h["$redoTaBindtaTextElement"+A]():(N(e,!1,t),n&&h["reApplyOnSelectorHandlerstaTextElement"+A](),h.displayElements.text[0].focus())},showHtml:h.$eval(d.taShowHtml)||!1}),d.taFocussedClass&&(h.classes.focussed=d.taFocussedClass),d.taTextEditorClass&&(h.classes.textEditor=d.taTextEditorClass),d.taHtmlEditorClass&&(h.classes.htmlEditor=d.taHtmlEditorClass),d.taTextEditorSetup&&(h.setup.textEditorSetup=h.$parent.$eval(d.taTextEditorSetup)),d.taHtmlEditorSetup&&(h.setup.htmlEditorSetup=h.$parent.$eval(d.taHtmlEditorSetup)),h.fileDropHandler=d.taFileDrop?h.$parent.$eval(d.taFileDrop):h.defaultFileDropHandler,x=p[0].innerHTML,p[0].innerHTML="",h.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},h.displayElements.popover.append(h.displayElements.popoverArrow),h.displayElements.popover.append(h.displayElements.popoverContainer),h.displayElements.scrollWindow.append(h.displayElements.popover),h.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),h.showPopover=function(e){h.displayElements.popover.css("display","block"),h.reflowPopover(e),a.addClass(h.displayElements.popover,"in"),O(u.find("body"),"click keyup",function(){h.hidePopover()})},h.reflowPopover=function(e){h.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(h.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+h.displayElements.scrollWindow[0].scrollTop+"px"),h.displayElements.popover.removeClass("top").addClass("bottom")):(h.displayElements.popover.css("top",e[0].offsetTop-54+h.displayElements.scrollWindow[0].scrollTop+"px"),h.displayElements.popover.removeClass("bottom").addClass("top"));var t=h.displayElements.text[0].offsetWidth-h.displayElements.popover[0].offsetWidth,n=e[0].offsetLeft+e[0].offsetWidth/2-h.displayElements.popover[0].offsetWidth/2;h.displayElements.popover.css("left",Math.max(0,Math.min(t,n))+"px"),h.displayElements.popoverArrow.css("margin-left",Math.min(n,Math.max(0,n-t))-11+"px")},h.hidePopover=function(){var e=function(){h.displayElements.popover.css("display",""),h.displayElements.popoverContainer.attr("style",""),h.displayElements.popoverContainer.attr("class","popover-content")};l.when(a.removeClass(h.displayElements.popover,"in",e)).then(e)},h.displayElements.resize.overlay.append(h.displayElements.resize.background),angular.forEach(h.displayElements.resize.anchors,function(e){h.displayElements.resize.overlay.append(e)}),h.displayElements.resize.overlay.append(h.displayElements.resize.info),h.displayElements.scrollWindow.append(h.displayElements.resize.overlay),h.reflowResizeOverlay=function(e){e=angular.element(e)[0],h.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),h.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},h.showResizeOverlay=function(e){var t=u.find("body");C=function(n){var r={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:n.clientX,y:n.clientY};(void 0===r.width||isNaN(r.width))&&(r.width=e[0].offsetWidth),(void 0===r.height||isNaN(r.height))&&(r.height=e[0].offsetHeight),h.hidePopover();var i=r.height/r.width,s=function(t){var n={x:Math.max(0,r.width+(t.clientX-r.x)),y:Math.max(0,r.height+(t.clientY-r.y))};if(t.shiftKey){var s=n.y/n.x;n.x=i>s?n.x:n.y/i,n.y=i>s?n.x*i:n.y}el=angular.element(e),el.attr("height",Math.max(0,n.y)),el.attr("width",Math.max(0,n.x)),h.reflowResizeOverlay(e)};t.on("mousemove",s),O(t,"mouseup",function(n){n.preventDefault(),n.stopPropagation(),t.off("mousemove",s),h.showPopover(e)}),n.stopPropagation(),n.preventDefault()},h.displayElements.resize.anchors[3].on("mousedown",C),h.reflowResizeOverlay(e),O(t,"click",function(){h.hideResizeOverlay()})},h.hideResizeOverlay=function(){h.displayElements.resize.anchors[3].off("mousedown",C),h.displayElements.resize.overlay.css("display","")},h.setup.htmlEditorSetup(h.displayElements.html),h.setup.textEditorSetup(h.displayElements.text),h.displayElements.html.attr({id:"taHtmlElement"+A,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),h.displayElements.text.attr({id:"taTextElement"+A,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),h.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),d.taDefaultWrap&&h.displayElements.text.attr("ta-default-wrap",d.taDefaultWrap),d.taUnsafeSanitizer&&(h.displayElements.text.attr("ta-unsafe-sanitizer",d.taUnsafeSanitizer),h.displayElements.html.attr("ta-unsafe-sanitizer",d.taUnsafeSanitizer)),h.displayElements.scrollWindow.append(h.displayElements.text),p.append(h.displayElements.scrollWindow),p.append(h.displayElements.html),h.displayElements.forminput.attr("name",h._name),p.append(h.displayElements.forminput),d.tabindex&&(p.removeAttr("tabindex"),h.displayElements.text.attr("tabindex",d.tabindex),h.displayElements.html.attr("tabindex",d.tabindex)),d.placeholder&&(h.displayElements.text.attr("placeholder",d.placeholder),h.displayElements.html.attr("placeholder",d.placeholder)),d.taDisabled&&(h.displayElements.text.attr("ta-readonly","disabled"),h.displayElements.html.attr("ta-readonly","disabled"),h.disabled=h.$parent.$eval(d.taDisabled),h.$parent.$watch(d.taDisabled,function(e){h.disabled=e,h.disabled?p.addClass(h.classes.disabled):p.removeClass(h.classes.disabled)})),d.taPaste&&(h._pasteHandler=function(e){return c(d.taPaste)(h.$parent,{$html:e})},h.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(h.displayElements.scrollWindow)(h),e(h.displayElements.html)(h),h.updateTaBindtaTextElement=h["updateTaBindtaTextElement"+A],h.updateTaBindtaHtmlElement=h["updateTaBindtaHtmlElement"+A],p.addClass("ta-root"),h.displayElements.scrollWindow.addClass("ta-text ta-editor "+h.classes.textEditor),h.displayElements.html.addClass("ta-html ta-editor "+h.classes.htmlEditor),h._actionRunning=!1;var M=!1;if(h.startAction=function(){return h._actionRunning=!0,M=o.rangy.saveSelection(),function(){M&&o.rangy.restoreSelection(M)}},h.endAction=function(){h._actionRunning=!1,M&&o.rangy.removeMarkers(M),M=!1,h.updateSelectedStyles(),h.showHtml||h["updateTaBindtaTextElement"+A]()},E=function(){h.focussed=!0,p.addClass(h.classes.focussed),T.focus(),p.triggerHandler("focus")},h.displayElements.html.on("focus",E),h.displayElements.text.on("focus",E),S=function(e){return h._actionRunning||u[0].activeElement===h.displayElements.html[0]||u[0].activeElement===h.displayElements.text[0]||(p.removeClass(h.classes.focussed),T.unfocus(),t(function(){h._bUpdateSelectedStyles=!1,p.triggerHandler("blur"),h.focussed=!1},0)),e.preventDefault(),!1},h.displayElements.html.on("blur",S),h.displayElements.text.on("blur",S),h.displayElements.text.on("paste",function(e){p.triggerHandler("paste",e)}),h.queryFormatBlockState=function(e){return!h.showHtml&&e.toLowerCase()===u[0].queryCommandValue("formatBlock").toLowerCase()},h.queryCommandState=function(e){return h.showHtml?"":u[0].queryCommandState(e)},h.switchView=function(){h.showHtml=!h.showHtml,a.enabled(!1,h.displayElements.html),a.enabled(!1,h.displayElements.text),h.showHtml?t(function(){return a.enabled(!0,h.displayElements.html),a.enabled(!0,h.displayElements.text),h.displayElements.html[0].focus()},100):t(function(){return a.enabled(!0,h.displayElements.html),a.enabled(!0,h.displayElements.text),h.displayElements.text[0].focus()},100)},d.ngModel){var _=!0;v.$render=function(){if(_){_=!1;var e=h.$parent.$eval(d.ngModel);void 0!==e&&null!==e||!x||""===x||v.$setViewValue(x)}h.displayElements.forminput.val(v.$viewValue),h._elementSelectTriggered||(h.html=v.$viewValue||"")};var D=function(e){return d.required&&v.$setValidity("required",!!e&&""!==e.trim()),e};v.$parsers.push(D),v.$formatters.push(D)}else h.displayElements.forminput.val(x),h.html=x;if(h.$watch("html",function(e,t){e!==t&&(d.ngModel&&v.$viewValue!==e&&v.$setViewValue(e),h.displayElements.forminput.val(e))}),d.taTargetToolbars)T=s.registerEditor(h._name,h,d.taTargetToolbars.split(","));else{var P=angular.element('<div text-angular-toolbar name="textAngularToolbar'+A+'">');d.taToolbar&&P.attr("ta-toolbar",d.taToolbar),d.taToolbarClass&&P.attr("ta-toolbar-class",d.taToolbarClass),d.taToolbarGroupClass&&P.attr("ta-toolbar-group-class",d.taToolbarGroupClass),d.taToolbarButtonClass&&P.attr("ta-toolbar-button-class",d.taToolbarButtonClass),d.taToolbarActiveButtonClass&&P.attr("ta-toolbar-active-button-class",d.taToolbarActiveButtonClass),d.taFocussedClass&&P.attr("ta-focussed-class",d.taFocussedClass),p.prepend(P),e(P)(h.$parent),T=s.registerEditor(h._name,h,["textAngularToolbar"+A])}h.$on("$destroy",function(){s.unregisterEditor(h._name)}),h.$on("ta-element-select",function(e,t){T.triggerElementSelect(e,t)&&h["reApplyOnSelectorHandlerstaTextElement"+A]()}),h.$on("ta-drop-event",function(e,n,r,i){h.displayElements.text[0].focus(),i&&i.files&&i.files.length>0?(angular.forEach(i.files,function(e){try{l.when(h.fileDropHandler(e,h.wrapSelection)||h.fileDropHandler!==h.defaultFileDropHandler&&l.when(h.defaultFileDropHandler(e,h.wrapSelection))).then(function(){h["updateTaBindtaTextElement"+A]()})}catch(t){f.error(t)}}),r.preventDefault(),r.stopPropagation()):t(function(){h["updateTaBindtaTextElement"+A]()},0)}),h._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){h._bUpdateSelectedStyles=!1,h.focussed=!1}),h.updateSelectedStyles=function(){var e;L&&t.cancel(L),void 0!==(e=r.getSelectionElement())&&e.parentNode!==h.displayElements.text[0]?T.updateSelectedStyles(angular.element(e)):T.updateSelectedStyles(),h._bUpdateSelectedStyles&&(L=t(h.updateSelectedStyles,200))},m=function(){return h.focussed?void (h._bUpdateSelectedStyles||(h._bUpdateSelectedStyles=!0,h.$apply(function(){h.updateSelectedStyles()}))):void (h._bUpdateSelectedStyles=!1)},h.displayElements.html.on("keydown",m),h.displayElements.text.on("keydown",m),g=function(){h._bUpdateSelectedStyles=!1},h.displayElements.html.on("keyup",g),h.displayElements.text.on("keyup",g),y=function(e,t){t&&angular.extend(e,t),h.$apply(function(){return T.sendKeyCommand(e)?(h._bUpdateSelectedStyles||h.updateSelectedStyles(),e.preventDefault(),!1):void 0})},h.displayElements.html.on("keypress",y),h.displayElements.text.on("keypress",y),w=function(){h._bUpdateSelectedStyles=!1,h.$apply(function(){h.updateSelectedStyles()})},h.displayElements.html.on("mouseup",w),h.displayElements.text.on("mouseup",w)}}}]),m.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,n){var r={},i={};return{registerEditor:function(n,s,o){if(!n||""===n)throw"textAngular Error: An editor requires a name";if(!s)throw"textAngular Error: An editor requires a scope";if(i[n])throw'textAngular Error: An Editor with name "'+n+'" already exists';var u=[];return angular.forEach(o,function(e){r[e]&&u.push(r[e])}),i[n]={scope:s,toolbars:o,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&u.push(e)},editorFunctions:{disable:function(){angular.forEach(u,function(e){e.disabled=!0})},enable:function(){angular.forEach(u,function(e){e.disabled=!1})},focus:function(){angular.forEach(u,function(e){e._parent=s,e.disabled=!1,e.focussed=!0,s.focussed=!0})},unfocus:function(){angular.forEach(u,function(e){e.disabled=!0,e.focussed=!1}),s.focussed=!1},updateSelectedStyles:function(e){angular.forEach(u,function(t){angular.forEach(t.tools,function(n){n.activeState&&(t._parent=s,n.active=n.activeState(e))})})},sendKeyCommand:function(n){var r=!1;return(n.ctrlKey||n.metaKey)&&angular.forEach(t,function(t,i){if(t.commandKeyCode&&t.commandKeyCode===n.which)for(var o=0;o<u.length;o++)if(void 0!==u[o].tools[i]){e.call(u[o].tools[i],s),r=!0;break}}),r},triggerElementSelect:function(e,n){var r=function(e,t){for(var n=!0,r=0;r<t.length;r++)n=n&&e.attr(t[r]);return n},i=[],o={},a=!1;n=angular.element(n);var f=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(f=f||angular.isArray(e.onElementSelect.onlyWithAttrs)&&r(n,e.onElementSelect.onlyWithAttrs),(!e.onElementSelect.onlyWithAttrs||r(n,e.onElementSelect.onlyWithAttrs))&&(o[t]=e))}),f?(angular.forEach(o,function(e,t){e.onElementSelect.onlyWithAttrs&&r(n,e.onElementSelect.onlyWithAttrs)&&i.push({name:t,tool:e})}),i.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(o,function(e,t){i.push({name:t,tool:e})}),i.length>0)for(var l=0;l<i.length;l++){for(var c=i[l].tool,h=i[l].name,p=0;p<u.length;p++)if(void 0!==u[p].tools[h]){c.onElementSelect.action.call(u[p].tools[h],e,n,s),a=!0;break}if(a)break}return a}}},i[n].editorFunctions},retrieveEditor:function(e){return i[e]},unregisterEditor:function(e){delete i[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(r[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';r[e.name]=e,angular.forEach(i,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return r[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete r[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,n){t.updateToolDisplay(n,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,n){e.resetToolDisplay(n)})},updateToolDisplay:function(e,t){var n=this;angular.forEach(r,function(r,i){n.updateToolbarToolDisplay(i,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(r,function(n,r){t.resetToolbarToolDisplay(r,e)})},updateToolbarToolDisplay:function(e,t,n){if(!r[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';r[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,n){if(!r[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';r[e].updateToolDisplay(n,t[n],!0)},removeTool:function(e){delete t[e],angular.forEach(r,function(t){delete t.tools[e];for(var n=0;n<t.toolbar.length;n++){for(var r,i=0;i<t.toolbar[n].length;i++){if(t.toolbar[n][i]===e){r={group:n,index:i};break}if(void 0!==r)break}void 0!==r&&(t.toolbar[r.group].slice(r.index,1),t._$element.children().eq(r.group).children().eq(r.index).remove())}})},addTool:function(e,t,i,s){n(e,t),angular.forEach(r,function(n){n.addTool(e,t,i,s)})},addToolToToolbar:function(e,t,i,s,o){n(e,t),r[i].addTool(e,t,s,o)},refreshEditor:function(e){if(!i[e])throw'textAngular Error: No Editor with name "'+e+'" exists';i[e].scope.updateTaBindtaTextElement(),i[e].scope.$$phase||i[e].scope.$digest()}}}]),m.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,n,r,i,s){return{scope:{name:"@"},restrict:"EA",link:function(o,u,a){if(!o.name||""===o.name)throw"textAngular Error: A toolbar requires a name";angular.extend(o,angular.copy(n)),a.taToolbar&&(o.toolbar=o.$parent.$eval(a.taToolbar)),a.taToolbarClass&&(o.classes.toolbar=a.taToolbarClass),a.taToolbarGroupClass&&(o.classes.toolbarGroup=a.taToolbarGroupClass),a.taToolbarButtonClass&&(o.classes.toolbarButton=a.taToolbarButtonClass),a.taToolbarActiveButtonClass&&(o.classes.toolbarButtonActive=a.taToolbarActiveButtonClass),a.taFocussedClass&&(o.classes.focussed=a.taFocussedClass),o.disabled=!0,o.focussed=!1,o._$element=u,u[0].innerHTML="",u.addClass("ta-toolbar "+o.classes.toolbar),o.$watch("focussed",function(){o.focussed?u.addClass(o.classes.focussed):u.removeClass(o.classes.focussed)});var f=function(t,n){var r;if(r=angular.element(t&&t.display?t.display:"<button type='button'>"),r.addClass(t&&t["class"]?t["class"]:o.classes.toolbarButton),r.attr("name",n.name),r.attr("unselectable","on"),r.attr("ng-disabled","isDisabled()"),r.attr("tabindex","-1"),r.attr("ng-click","executeAction()"),r.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&r.attr("title",t.tooltiptext),r.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),t&&!t.display&&!n._display&&(r[0].innerHTML="",t.buttontext&&(r[0].innerHTML=t.buttontext),t.iconclass)){var i=angular.element("<i>"),s=r[0].innerHTML;i.addClass(t.iconclass),r[0].innerHTML="",r.append(i),s&&""!==s&&r.append("&nbsp;"+s)}return n._lastToolDefinition=angular.copy(t),e(r)(n)};o.tools={},o._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var l={$window:s,$editor:function(){return o._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?o.classes.toolbarButtonActive:""},executeAction:i};angular.forEach(o.toolbar,function(e){var t=angular.element("<div>");t.addClass(o.classes.toolbarGroup),angular.forEach(e,function(e){o.tools[e]=angular.extend(o.$new(!0),r[e],l,{name:e}),o.tools[e].$element=f(r[e],o.tools[e]),t.append(o.tools[e].$element)}),u.append(t)}),o.updateToolDisplay=function(e,t,n){var r=o.tools[e];if(r){if(r._lastToolDefinition&&!n&&(t=angular.extend({},r._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var i=f(t,r);r.$element.replaceWith(i),r.$element=i}},o.addTool=function(e,t,n,i){o.tools[e]=angular.extend(o.$new(!0),r[e],l,{name:e}),o.tools[e].$element=f(r[e],o.tools[e]);var s;void 0===n&&(n=o.toolbar.length-1),s=angular.element(u.children()[n]),void 0===i?(s.append(o.tools[e].$element),o.toolbar[n][o.toolbar[n].length-1]=e):(s.children().eq(i).after(o.tools[e].$element),o.toolbar[n][i]=e)},t.registerToolbar(o),o.$on("$destroy",function(){t.unregisterToolbar(o.name)})}}}])}()}({},function(){return this}()),define("textAngular",["textAngularRangy","textAngularSanitize"],function(){}),define("config",[],function(){"use strict";var e=angular.module("civitasks.config",[]);return e.constant("config",{DEBUG:+CRM.debug,CLASS_NAME_PREFIX:"ct-",CONTACT_ID:CRM.contactId||null,LOGGED_IN_CONTACT_ID:CRM.adminId||null,path:{EXT:CRM.Tasksassignments.extensionPath,TPL:CRM.Tasksassignments.extensionPath+"views/"},url:{REST:CRM.url("civicrm/ajax/rest"),ASSIGNMENTS:CRM.url("civicrm/case"),CIVI_DASHBOARD:CRM.url("civicrm/"),CONTACT:CRM.url("civicrm/contact/view"),FILE:CRM.url("civicrm/tasksassignments/file")},status:{resolve:{DOCUMENT:["3","4"],TASK:["2","3","6","8"]}}}),e}),define("settings",[],function(){"use strict";var e=angular.module("civitasks.settings",[]);return e.value("settings",{tabEnabled:{documents:CRM.Tasksassignments.settings.documents_tab,keyDates:CRM.Tasksassignments.settings.keydates_tab},extEnabled:{assignments:CRM.Tasksassignments.case_extension},copy:{button:{assignmentAdd:CRM.Tasksassignments.settings.add_assignment_button_title}}}),e}),define("controllers/controllers",[],function(){"use strict";return angular.module("civitasks.controllers",[])}),define("directives/directives",[],function(){"use strict";return angular.module("civitasks.directives",[])}),define("filters/filters",[],function(){"use strict";return angular.module("civitasks.filters",[])}),define("services/services",[],function(){"use strict";return angular.module("civitasks.services",[])}),define("app",["moment","angularBootstrapCalendar","angularChecklistModel","angularRouter","angularSelect","textAngular","config","settings","controllers/controllers","directives/directives","filters/filters","services/services"],function(e){angular.module("civitasks.run",["angularFileUpload","ngRoute","ngResource","ngSanitize","ui.bootstrap","ui.router","ui.select","mwl.calendar","textAngular","checklist-model","civitasks.config","civitasks.controllers","civitasks.directives","civitasks.filters","civitasks.services","civitasks.settings"]).run(["config","settings","$rootScope","$rootElement","$q","$location","DocumentService","TaskService","AssignmentService","KeyDateService","ContactService","$log",function(e,t,n,r,i,s,o,u,a,f,l,c){c.debug("civitasks.run"),n.pathTpl=e.path.TPL,n.prefix=e.CLASS_NAME_PREFIX,n.url=e.url,n.location=s,n.settings=t,n.cache={contact:{obj:{},arr:[],addSearch:[]},assignment:{obj:{},arr:[],arrSearch:[]},assignmentType:{obj:{},arr:[]},dateType:{obj:{period_start_date:"Contract Start Date",period_end_date:"Contract End Date",birth_date:"Birthday",initial_join_date:"Initial Join Date",final_termination_date:"Final Termination Date",probation_end_date:"Probation End Date"},arr:[]},documentType:{obj:{},arr:[]},documentStatus:{obj:{},arr:[]},documentStatusResolve:e.status.resolve.DOCUMENT,taskType:{obj:{},arr:[]},taskStatus:{obj:{},arr:[]},taskStatusResolve:e.status.resolve.TASK},u.getOptions().then(function(e){angular.extend(n.cache,e)}),o.getOptions().then(function(e){angular.extend(n.cache,e)}),a.getTypes().then(function(e){angular.extend(n.cache.assignmentType.obj,e),angular.forEach(e,function(e){this.push(e)},n.cache.assignmentType.arr)}),l.get({IN:[e.LOGGED_IN_CONTACT_ID]}).then(function(e){l.updateCache(e)}),angular.forEach(n.cache.dateType.obj,function(e,t){this.push({key:t,value:e})},n.cache.dateType.arr),n.$on("$stateChangeSuccess",function(){r.removeClass("ct-page-loading")})}]),angular.module("civitasks.appDashboard",["civitasks.run"]).config(["config","$resourceProvider","$httpProvider","$logProvider","$urlRouterProvider","$stateProvider","calendarConfigProvider","uiSelectConfig",function(t,n,r,i,s,o,u,a){i.debugEnabled(t.debug),s.otherwise("/tasks"),o.state("tasks",{url:"/tasks",controller:"TaskListCtrl",templateUrl:t.path.TPL+"dashboard/tasks.html",resolve:{taskList:["$q","TaskService",function(e,n){var r=e.defer();return e.all([n.get({sequential:0,assignee_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.TASK}}),n.get({sequential:0,source_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.TASK}})]).then(function(e){var t,n=[];angular.extend(e[0],e[1]);for(t in e[0])n.push(e[0][t]);r.resolve(n)}),r.promise}]}}).state("documents",{url:"/documents",controller:"DocumentListCtrl",templateUrl:t.path.TPL+"dashboard/documents.html",resolve:{documentList:["$q","DocumentService",function(e,n){var r=e.defer();return e.all([n.get({sequential:0,assignee_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.DOCUMENT}}),n.get({sequential:0,source_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.DOCUMENT}})]).then(function(e){var t,n=[];angular.extend(e[0],e[1]);for(t in e[0])n.push(e[0][t]);r.resolve(n)}),r.promise}]}}).state("assignments",{url:"/assignments",controller:"ExternalPageCtrl",templateUrl:t.path.TPL+"dashboard/assignments.html"}).state("calendar",{"abstract":!0,controller:"CalendarCtrl",templateUrl:t.path.TPL+"dashboard/calendar.html",resolve:{documentList:["$q","DocumentService","settings",function(e,n,r){var i=e.defer();return+r.tabEnabled.documents||i.resolve([]),e.all([n.get({sequential:0,assignee_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.DOCUMENT}}),n.get({sequential:0,source_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.DOCUMENT}})]).then(function(e){var t,n=[];angular.extend(e[0],e[1]);for(t in e[0])n.push(e[0][t]);i.resolve(n)}),i.promise}],taskList:["$q","TaskService",function(e,n){var r=e.defer();return e.all([n.get({sequential:0,assignee_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.TASK}}),n.get({sequential:0,source_contact_id:t.LOGGED_IN_CONTACT_ID,status_id:{"NOT IN":t.status.resolve.TASK}})]).then(function(e){var t,n=[];angular.extend(e[0],e[1]);for(t in e[0])n.push(e[0][t]);r.resolve(n)}),r.promise}]}}).state("calendar.mwl",{url:"/calendar",views:{documentList:{controller:"DocumentListCtrl",templateUrl:t.path.TPL+"dashboard/calendar.documentList.html"},taskList:{controller:"TaskListCtrl",templateUrl:t.path.TPL+"dashboard/calendar.taskList.html"}}}).state("calendar.mwl.day",{params:{calendarView:"day"}}).state("calendar.mwl.month",{params:{calendarView:"month"}}).state("calendar.mwl.week",{params:{calendarView:"week"}}).state("reports",{url:"/reports",controller:"ExternalPageCtrl",templateUrl:t.path.TPL+"dashboard/reports.html"}).state("keyDates",{url:"/key-dates",controller:"DateListCtrl",templateUrl:t.path.TPL+"dashboard/key-dates.html",resolve:{contactList:["KeyDateService",function(t){return t.get(e().startOf("month"),e().endOf("month"))}]}}).state("settings",{url:"/settings",controller:"SettingsCtrl",templateUrl:t.path.TPL+"dashboard/settings.html"}),n.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",u.setDateFormats({weekDay:"ddd"}),a.theme="bootstrap"}]),angular.module("civitasks.appDocuments",["civitasks.run"]).config(["config","$routeProvider","$resourceProvider","$httpProvider","uiSelectConfig","$logProvider",function(e,t,n,r,i,s){s.debugEnabled(e.debug),t.when("/",{controller:"DocumentListCtrl",templateUrl:e.path.TPL+"contact/documents.html",resolve:{documentList:["DocumentService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.DOCUMENT}})}]}}).otherwise({redirectTo:"/"}),n.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.theme="bootstrap"}]),angular.module("civitasks.appTasks",["civitasks.run"]).config(["config","$routeProvider","$resourceProvider","$httpProvider","uiSelectConfig","$logProvider",function(e,t,n,r,i,s){s.debugEnabled(e.debug),t.when("/",{controller:"TaskListCtrl",templateUrl:e.path.TPL+"contact/tasks.html",resolve:{taskList:["TaskService",function(t){return t.get({target_contact_id:e.CONTACT_ID,status_id:{"NOT IN":e.status.resolve.TASK}})}]}}).otherwise({redirectTo:"/"}),n.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.theme="bootstrap"}])}),define("services/utils",["services/services"],function(e){e.factory("UtilsService",["config","$q","$log","$rootScope",function(e,t,n){return n.debug("Service: UtilsService"),{errorHandler:function(e,t,r){var i="",s=t||"Unknown Error";if(e.is_error)return i=e.error_code||i,s=e.error_message||s,n.error(i+"\n"+s),r&&r.reject(i+"\n"+s),e.trace&&n.error(e.trace),!0;if(!e.values)return n.error(s),r&&r.reject(s),!0}}}])}),define("services/task",["services/services","services/utils"],function(e){e.factory("Task",["$resource","config","$log",function(e,t,n){return n.debug("Service: Task"),e(t.url.REST,{action:"get",entity:"Task",json:{}})}]),e.factory("TaskService",["Task","$q","config","UtilsService","$log",function(e,t,n,r,i){return i.debug("Service: TaskService"),{assign:function(i,s){if(!i||!angular.isArray(i)||!s||typeof +s!="number")return null;if(!i.length)return i;var o=t.defer();return e.save({action:"copy_to_assignment",json:{sequential:1,debug:n.DEBUG,id:i,case_id:s}},null,function(e){if(r.errorHandler(e,"Unable to assign tasks",o))return;o.resolve(e.values)},function(){o.reject("Unable to assign tasks")}),o.promise},get:function(n){var r=t.defer();return n=n&&typeof n=="object"?n:{},n=angular.extend({component:"CiviTask",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1","return":"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id"},n),e.get({json:n},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch tasks list")}),r.promise},getOptions:function(){var n=t.defer(),r=t.defer(),i=t.defer(),s={arr:[],obj:{}},o={arr:[],obj:{}};return e.get({action:"getoptions",json:{field:"activity_type_id"}},function(e){var t;for(t in e.values)s.arr.push({key:t,value:e.values[t]});s.obj=e.values,r.resolve(s)}),e.get({action:"getoptions",json:{field:"status_id"}},function(e){var t;for(t in e.values)o.arr.push({key:t,value:e.values[t]});o.obj=e.values,i.resolve(o)}),t.all({taskType:r.promise,taskStatus:i.promise}).then(function(e){n.resolve(e)}),n.promise},save:function(i){if(!i||typeof i!="object")return null;var s=t.defer(),o=angular.extend({sequential:1,debug:n.DEBUG},i),u;return e.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to save task",s))return;u=e.values,s.resolve(u.length==1?u[0]:null)},function(){s.reject("Unable to save task")}),s.promise},saveMultiple:function(i){if(!i||!angular.isArray(i))return null;if(!i.length)return i;var s=t.defer();return e.save({action:"create_multiple",json:{sequential:1,debug:n.DEBUG,task:i}},null,function(e){if(r.errorHandler(e,"Unable to save tasks",s))return;s.resolve(e.values)},function(){s.reject("Unable to save tasks")}),s.promise},sendReminder:function(i,s){if(!i||typeof +i!="number")return null;var o=t.defer();return e.save({action:"sendreminder",json:{sequential:1,debug:n.DEBUG,activity_id:i,notes:s||""}},null,function(e){if(r.errorHandler(e,"Unable to send a reminder",o))return;o.resolve(e)},function(){o.reject("Unable to send a reminder")}),o.promise},"delete":function(n){if(!n||typeof +n!="number")return null;var r=t.defer();return e.delete({action:"delete",json:{id:n}},function(e){r.resolve(e)},function(){r.reject("Could not delete task ID: "+n)}),r.promise}}}])}),define("controllers/calendar",["controllers/controllers","moment","services/task"],function(e,t){e.controller("CalendarCtrl",["$scope","$log","$rootScope","$filter","$timeout","$state","$stateParams","taskList","documentList","settings",function(e,n,r,i,s,o,u,a,f,l){function c(e,n,r,i){var s=t(e.activity_date_time).toDate(),o=i[e.activity_type_id],u=angular.equals({},n),a=r.length,f=0;if(!u){var l=t(n.activity_date_time).toDate(),c=i[n.activity_type_id];for(;f<a;f++)if(r[f].title==c&&+r[f].startsAt==+l){r.splice(f,1);break}}r.push({title:o,type:"task",startsAt:s,endsAt:s,editable:!1,deletable:!1,incrementsBadgeTotal:!0})}this.init=function(){e.calTaskList=this.createCalTaskList(a);if(!+l.tabEnabled.documents)return;e.calDocList=this.createCalDocList(f)},this.createCalDocList=function(e){var n=r.cache,i,s,o=[];return angular.forEach(e,function(e){i=t(e.activity_date_time).toDate(),this.push({title:n.documentType.obj[e.activity_type_id],type:"document",startsAt:i,endsAt:i,editable:!1,deletable:!1,incrementsBadgeTotal:!0}),!e.expire_date||(s=t(e.expire_date).toDate(),this.push({title:n.documentType.obj[e.activity_type_id],type:"document",startsAt:s,endsAt:s,editable:!1,deletable:!1,incrementsBadgeTotal:!0}))},o),o},this.createCalTaskList=function(e){var n=r.cache,i,s=[];return angular.forEach(e,function(e){i=t(e.activity_date_time).toDate(),this.push({title:n.taskType.obj[e.activity_type_id],type:"task",startsAt:i,endsAt:i,editable:!1,deletable:!1,incrementsBadgeTotal:!0})},s),s},e.calendarDay=new Date,e.calendarTitle="",e.calendarView=o.params.calendarView||"month",e.calTaskList=[],e.calDocList=[],e.displayDayView=function(n){e.calendarDay=t(n).toDate(),e.calendarView="day"},e.$on("taskFormSuccess",function(t,n,i){c(n,i,e.calTaskList,r.cache.taskType.obj)}),e.$on("documentFormSuccess",function(t,n,i){c(n,i,e.calDocList,r.cache.documentType.obj)}),e.$on("assignmentFormSuccess",function(t,n){Array.prototype.push.apply(e.calTaskList,this.createCalTaskList(n.taskList)),console.log(o);if(!+l.tabEnabled.documents)return;Array.prototype.push.apply(e.calDocList,this.createCalDocList(n.documentList))}.bind(this)),this.init()}])}),+define("services/keyDate",["services/services","moment","services/utils"],function(e,t){e.factory("KeyDate",["$resource","config","$log",function(e,t,n){return n.debug("Service: KeyDate"),e(t.url.REST,{action:"get",entity:"KeyDates",json:{}})}]),e.factory("KeyDateService",["KeyDate","$q","config","UtilsService","$log",function(e,n,r,i,s){return s.debug("Service: KeyDateService"),{get:function(r,i){var s=n.defer();return!r||!i?null:(r=r?t(r).format("YYYY-MM-DD"):null,i=i?t(i).format("YYYY-MM-DD"):null,e.get({json:{start_date:r,end_date:i}},function(e){s.resolve(e.values)},function(){s.reject("Unable to fetch documents list")}),s.promise)}}}])}),define("services/contact",["services/services","services/utils"],function(e){e.factory("ContactService",["$resource","config","$q","$filter","$rootScope","UtilsService","$log",function(e,t,n,r,i,s,o){o.debug("Service: ContactService");var u=e(t.url.REST,{action:"get",entity:"contact",json:{}});return{get:function(e){if(!e||typeof +e!="number"&&typeof e!="object")return null;var r=n.defer();return u.get({json:{id:e,"return":"sort_name, id, contact_id, contact_type, email",debug:t.DEBUG}},function(e){if(s.errorHandler(e,"Unable to fetch contacts",r))return;r.resolve(e.values)},function(){r.reject("Unable to fetch contact")}),r.promise},search:function(e,r){if(r&&typeof r!="object")return null;var i=n.defer(),r=r||{};return u.get({action:"getlist",json:{input:e,params:r,debug:t.DEBUG}},function(e){if(s.errorHandler(e,"Unable to fetch contact list",i))return;i.resolve(e.values)},function(){i.reject("Unable to fetch contact list")}),i.promise},updateCache:function(e){var t=i.cache.contact.obj||{},n=[],s=[],o,u;angular.extend(t,e);for(u in t)o=t[u],n.push(o),s.push({description:o.email?[o.email]:[],label:o.sort_name,icon_class:o.contact_type,id:o.contact_id});n=r("orderBy")(n,"sort_name"),s=r("orderBy")(s,"label"),i.cache.contact={arr:n,obj:t,arrSearch:s}}}}])}),define("controllers/dateList",["controllers/controllers","moment","services/keyDate","services/contact"],function(e,t){e.controller("DateListCtrl",["$scope","$modal","$rootElement","$rootScope","$route","$filter","$log","$timeout","contactList","KeyDateService",function(e,n,r,i,s,o,u,a,f,l){u.debug("Controller: DateListCtrl"),this.init=function(){e.dateList=this.createDateList(f),i.$broadcast("ct-spinner-hide"),l.get(t().startOf("year"),t().endOf("year")).then(function(t){e.dateList=this.createDateList(t),e.dataLoading=!1}.bind(this))},this.createDateList=function(e){var t=0,n=e.length,r,i={},s=[];for(;t<n;t++)i[e[t].keydate]=i[e[t].keydate]||[],i[e[t].keydate].push(e[t]);for(r in i)s.push({date:r,dateContactList:i[r]});return s},e.dataLoading=!0,e.dateList=[],e.dateListLimit=5,e.dateListSelected=[],e.dpOpened={filterDates:{}},e.isCollapsed={filterDates:!0},e.filterParams={dateRange:{from:(new Date).setHours(0,0,0,0),until:t().add(1,"month").toDate().setHours(0,0,0,0)},date:"month",dateType:[]},e.label={isoWeek:"Week",month:"Month",year:"Year",dateRange:""},e.labelDateRange=function(t,n){var r=o("date")(t,"dd/MM/yyyy")||"",i=o("date")(n,"dd/MM/yyyy")||"";i&&(i=r?" - "+i:"Until: "+i),r&&(r=i?r:"From: "+r),e.label.dateRange=r+i},e.showDateRange=function(n,r){e.$broadcast("ct-spinner-show","dateList"),l.get(t(n),t(r)).then(function(t){e.dateListSelected=this.createDateList(t),e.filterParams.date="dateRange",e.$broadcast("ct-spinner-hide","dateList")}.bind(this))}.bind(this),this.init()}])}),+define("services/document",["services/services","services/utils"],function(e){e.factory("Document",["$resource","config","$log",function(e,t,n){return n.debug("Service: Document"),e(t.url.REST,{action:"get",entity:"Document",json:{}})}]),e.factory("DocumentService",["Document","$q","config","UtilsService","$log",function(e,t,n,r,i){return i.debug("Service: DocumentService"),{assign:function(i,s){if(!i||!angular.isArray(i)||!s||typeof +s!="number")return null;if(!i.length)return i;var o=t.defer();return e.save({action:"copy_to_assignment",json:{sequential:1,debug:n.DEBUG,id:i,case_id:s}},null,function(e){if(r.errorHandler(e,"Unable to assign documents",o))return;o.resolve(e.values)},function(){o.reject("Unable to assign documents")}),o.promise},get:function(n){var r=t.defer();return n=n&&typeof n=="object"?n:{},n=angular.extend({component:"CiviDocument",options:{limit:0},is_current_revision:"1",is_deleted:"0",sequential:"1","return":"activity_date_time, activity_type_id, assignee_contact_id, details, id, source_contact_id, target_contact_id, subject, status_id, expire_date"},n),e.get({json:n},function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch documents list")}),r.promise},getOptions:function(){var n=t.defer(),r=t.defer(),i=t.defer(),s={arr:[],obj:{}},o={arr:[],obj:{}};return e.get({action:"getoptions",json:{field:"activity_type_id"}},function(e){var t;for(t in e.values)s.arr.push({key:t,value:e.values[t]});s.obj=e.values,r.resolve(s)}),e.get({action:"getoptions",json:{field:"status_id"}},function(e){var t;for(t in e.values)o.arr.push({key:t,value:e.values[t]});o.obj=e.values,i.resolve(o)}),t.all({documentType:r.promise,documentStatus:i.promise}).then(function(e){n.resolve(e)}),n.promise},save:function(i){if(!i||typeof i!="object")return null;var s=t.defer(),o=angular.extend({sequential:1,debug:n.DEBUG},i),u;return e.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to save document",s))return;u=e.values,s.resolve(u.length==1?u[0]:null)},function(){s.reject("Unable to save document")}),s.promise},saveMultiple:function(i){if(!i||!angular.isArray(i))return null;if(!i.length)return i;var s=t.defer();return e.save({action:"create_multiple",json:{sequential:1,debug:n.DEBUG,document:i}},null,function(e){if(r.errorHandler(e,"Unable to save documents",s))return;s.resolve(e.values)},function(){s.reject("Unable to save documents")}),s.promise},sendReminder:function(i,s){if(!i||typeof +i!="number")return null;var o=t.defer();return e.save({action:"sendreminder",json:{sequential:1,debug:n.DEBUG,activity_id:i,notes:s||""}},null,function(e){if(r.errorHandler(e,"Unable to send a reminder",o))return;o.resolve(e)},function(){o.reject("Unable to send a reminder")}),o.promise},"delete":function(n){if(!n||typeof +n!="number")return null;var r=t.defer();return e.delete({action:"delete",json:{id:n}},function(e){r.resolve(e)},function(){r.reject("Could not delete document ID: "+n)}),r.promise}}}])}),define("services/file",["services/services","services/utils"],function(e){e.factory("FileService",["$resource","config","$q","UtilsService","FileUploader","$log",function(e,t,n,r,i,s){s.debug("Service: FileService");var o=e(t.url.FILE+"/:action");return i.prototype.queueDelete=[],{"delete":function(e,t,i){if(!e||typeof +e!="number"||!t||typeof +t!="number"||!i||typeof i!="string")return null;var s=n.defer();return o.save({action:"delete",entityTable:i,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1);if(r.errorHandler(e,"Unable to delete file",s))return;s.resolve(e.values[0])},function(){s.reject("Unable to delete file")}),s.promise},get:function(e,t){if(!e||typeof +e!="number"||!t||typeof t!="string")return null;var i=n.defer();return o.get({action:"list",entityTable:t,entityID:e},function(e){if(r.errorHandler(e,"Unable to fetch files",i))return;i.resolve(e.values)},function(){i.reject("Unable to fetch files")}),i.promise},uploader:function(e,n){if(!e||typeof e!="string")return null;var r={url:t.url.FILE+"/upload",formData:[{entityTable:e}]};return n&&typeof n=="number"&&(r.queueLimit=n),new i(r)},upload:function(e,t){if(!e||typeof e!="object"||!t||typeof +t!="number")return null;var r=n.defer(),i=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){i.push(t)},e.onErrorItem=function(e,t,n,i){r.reject("Could not upload file: "+e.file.name),s.error(" ===== Item Error: "+n+" ======"),s.error(" =====  - item ======"),s.error(e),s.error(" =====  - response ======"),s.error(t),s.error(" =====  - headers ======"),s.error(i)},e.onCompleteAll=function(){r.resolve(i)},e.uploadAll(),r.promise}}}])}),define("services/assignment",["services/services","services/utils"],function(e){e.factory("Relationship",["$resource","config","$log",function(e,t,n){return n.debug("Service: Relationship"),e(t.url.REST,{action:"get",entity:"Relationship",json:{}})}]),e.factory("Assignment",["$resource","config","$log",function(e,t,n){return n.debug("Service: Assignment"),e(t.url.REST,{action:"get",entity:"Assignment",json:{}})}]),e.factory("AssignmentSearch",["$resource","config","$log",function(e,t,n){return n.debug("Service: AssignmentSearch"),e(t.url.ASSIGNMENTS+"/ajax/unclosed")}]),e.factory("AssignmentType",["$resource","config","$log",function(e,t,n){return n.debug("Service: AssignmentType"),e(t.url.REST,{action:"get",entity:"CaseType",json:{}})}]),e.factory("AssignmentService",["Relationship","Assignment","AssignmentSearch","AssignmentType","$q","config","UtilsService","$filter","$location","$route","$rootScope","$log",function(e,t,n,r,i,s,o,u,a,f,l,c){return c.debug("Service: AssignmentService"),{get:function(e){if(!e||typeof +e!="number"&&typeof e!="object")return null;var n=i.defer();return t.get({json:{options:{limit:0},id:e,debug:s.DEBUG}},function(e){if(o.errorHandler(e,"Unable to fetch assignments",n))return;n.resolve(e.values)},function(){n.reject("Unable to fetch assignments")}),n.promise},assignCoordinator:function(t,n){if(!t||typeof +t!="number"||!n||typeof +n!="number")return null;var r=i.defer();return e.save({action:"create",json:{sequential:1,contact_id_a:t,contact_id_b:s.LOGGED_IN_CONTACT_ID,relationship_type_id:9,case_id:n}},null,function(e){if(o.errorHandler(e,"Unable to assign coordinator",r))return;r.resolve(e.values)},function(){r.reject("Unable to assign coordinator")}),r.promise},getTypes:function(){var e=i.defer();return r.get({},function(t){if(o.errorHandler(t,"Unable to fetch assignment types",e))return;e.resolve(t.values)},function(){e.reject("Unable to fetch assignment types")}),e.promise},save:function(e){if(!e||typeof e!="object")return null;var n=i.defer(),r=angular.extend({sequential:1,debug:s.DEBUG},e),u;return t.save({action:"create",json:r},null,function(e){if(o.errorHandler(e,"Unable to save an assignment",n))return;u=e.values,n.resolve(u.length==1?u[0]:null)},function(){n.reject("Unable to save an assignment")}),n.promise},search:function(e,t){return n.query({term:e,excludeCaseIds:t}).$promise},updateTab:function(e){if(document.getElementsByClassName("CRM_Case_Form_Search").length){CRM.refreshParent(".CRM_Case_Form_Search");return}if(!!document.getElementById("tab_case")){CRM.tabHeader.updateCount("#tab_case",CRM.tabHeader.getCount("#tab_case")+(e||0));return}a.path()=="/assignments"&&f.reload()},updateCache:function(e){c.debug("updateCache"),c.debug(e);var t=l.cache.assignment.obj||{},n=[],r=[],i,s,o;angular.extend(t,e);for(s in t)i=t[s],o=l.cache.assignmentType.obj[i.case_type_id].title,n.push(i),r.push({label:i.contacts[0].sort_name+" - "+o+(i.end_date?" (closed)":""),label_class:+i.is_deleted||i.end_date?"strikethrough":"",id:s,extra:{case_subject:i.subject,case_type:o,contact_id:i.contacts[0].contact_id,end_date:i.end_date,sort_name:i.contacts[0].sort_name,start_date:i.start_date}});n=u("orderBy")(n,"subject"),r=u("orderBy")(r,"label"),l.cache.assignment={arr:n,obj:t,arrSearch:r}}}}])}),define("controllers/documentList",["controllers/controllers","moment","services/contact","services/document","services/file","services/assignment","moment"],function(e,t){e.controller("DocumentListCtrl",["$scope","$modal","$dialog","$rootElement","$rootScope","$route","$filter","$log","$q","$timeout","$state","documentList","config","ContactService","AssignmentService","DocumentService","FileService","settings",function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){a.debug("Controller: DocumentListCtrl"),this.init=function(){var e=this.contactIds,t=this.assignmentIds;this.collectId(h),e&&e.length&&d.get({IN:e}).then(function(e){d.updateCache(e)}),t&&t.length&&v.get({IN:t}).then(function(e){v.updateCache(e)}),s.$broadcast("ct-spinner-hide"),a.debug(s.cache)},this.assignmentIds=[],this.contactIds=[],this.collectId=function(e){function r(e){t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&t.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0])}function i(e){e.case_id&&n.push(e.case_id)}var t=this.contactIds,n=this.assignmentIds;t.push(p.LOGGED_IN_CONTACT_ID),p.CONTACT_ID&&t.push(p.CONTACT_ID),angular.forEach(e,function(e){r(e),i(e)})},e.pagination={currentPage:1,itemsPerPage:10,maxSize:5},e.dueToday=0,e.dueThisWeek=0,e.overdue=0,e.documentList=h,e.documentListFiltered=[],e.documentListOngoing=[],e.documentListPaginated=[],e.documentListResolved=[],e.documentListResolvedLoaded=!1,e.actionApplyTo="selected",e.checklist={selected:{},isCheckedAll:{}},e.dpOpened={filterDates:{}},e.isCollapsed={filterAdvanced:!0,filterDates:!0,documentListResolved:!0},e.filterParams={contactId:null,documentStatus:[],userRole:{field:null,isEqual:null},dateRange:{from:null,until:null},due:null,assignmentType:[]},e.filterParamsHolder={documentStatus:[],dateRange:{from:(new Date).setHours(0,0,0,0),until:t().add(1,"month").toDate().setHours(0,0,0,0)}},e.label={addNew:"Add Document",overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:""},e.apply=function(t,n){var i=n.length,s=[],o;if(!t||!i)return;switch(t){case"delete":r.open({msg:"Are you sure you want to delete "+i+" document(s)?"}).then(function(t){if(!t)return;e.$broadcast("ct-spinner-show","documentList"),o=0;for(;o<i;o++)s.push(m.delete(n[o].id));f.all(s).then(function(t){o=0;for(;o<i;o++)e.documentList.splice(e.documentList.indexOf(n[o]),1);e.checklist.isCheckedAll={},e.checklist.selected={},e.$broadcast("ct-spinner-hide","documentList")})})}},e.changeStatus=function(t,n){if(!n||typeof +n!="number")return null;e.$broadcast("ct-spinner-show","documentList"),m.save({id:t.id,status_id:n}).then(function(n){t.id=n.id,t.status_id=n.status_id,e.$broadcast("ct-spinner-hide","documentList")})},e.toggleAll=function(t){e.checklist.isCheckedAll[t]?e.checklist.selected[t]=angular.copy(e.documentListPaginated):e.checklist.selected[t]=[]},e.toggleIsCheckedAll=function(){l(function(){e.checklist.isCheckedAll[e.pagination.currentPage]=e.checklist.selected[e.pagination.currentPage].length==e.documentListPaginated.length})},e.labelDateRange=function(t,n){var r=u("date")(t,"dd/MM/yyyy")||"",i=u("date")(n,"dd/MM/yyyy")||"";i&&(i=r?" - "+i:"Until: "+i),r&&(r=i?r:"From: "+r),e.label.dateRange=r+i},e.loadDocumentsResolved=function(){if(e.documentListResolvedLoaded)return;e.documentList=e.documentListOngoing,m.get({target_contact_id:p.CONTACT_ID,status_id:{IN:p.status.resolve.DOCUMENT}}).then(function(t){e.documentList.push.apply(e.documentList,t),l(function(){e.documentListResolvedLoaded=!0})})},e.deleteDocument=function(t){r.open({msg:"Are you sure you want to delete this document?"}).then(function(n){if(!n)return;m.delete(t.id).then(function(n){e.documentList.splice(e.documentList.indexOf(t),1),e.checklist.selected.splice(e.checklist.selected.indexOf(t),1)})})},e.viewInCalendar=function(e){c.go("calendar.mwl."+e)},e.$on("assignmentFormSuccess",function(t,n){Array.prototype.push.apply(e.documentList,n.documentList)}),e.$on("documentFormSuccess",function(t,n,r){angular.equals({},r)?e.documentList.push(n):angular.extend(r,n)}),e.$on("crmFormSuccess",function(e,t){if(t.status=="success"){var n=/case|activity|assignment/i;if(n.test(t.title)||t.crmMessages.length&&(n.test(t.crmMessages[0].title)||n.test(t.crmMessages[0].text)))s.cache.assignment={obj:{},arr:[]},o.reload()}}),this.init()}])}),define("controllers/document",["controllers/controllers","moment","services/document"],function(e,t){e.controller("DocumentCtrl",["$scope","$rootScope","config","$log",function(e,n,r,i){i.debug("Controller: DocumentCtrl"),e.document.activity_date_time=e.document.activity_date_time?t(e.document.activity_date_time).toDate():null,e.document.expire_date=e.document.expire_date?t(e.document.expire_date).toDate():null,e.urlFile=r.url.FILE+"/zip?entityID="+e.document.id+"&entityTable=civicrm_activity",e.$watch("document.activity_date_time",function(t){e.document.due=(new Date(t)).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}])}),define("controllers/main",["controllers/controllers","services/file"],function(e){e.controller("MainCtrl",["$scope","$rootScope","$rootElement","$log","$modal","FileService","config","settings",function(e,t,n,r,i,s,o,u){r.debug("Controller: MainCtrl"),t.modalDocument=function(t,u){u&&u.preventDefault();var t=t||{},a=i.open({targetDomEl:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/document.html?v="+(new Date).getTime(),controller:"ModalDocumentCtrl",resolve:{data:function(){return t},files:function(){return!t.id||!+t.file_count?[]:s.get(t.id,"civicrm_activity")}}});a.result.then(function(n){e.$broadcast("documentFormSuccess",n,t)},function(){r.info("Modal dismissed")})},t.modalTask=function(t){var t=t||{},s=i.open({targetDomEl:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/task.html?v="+(new Date).getTime(),controller:"ModalTaskCtrl",resolve:{data:function(){return t}}});s.result.then(function(n){e.$broadcast("taskFormSuccess",n,t)},function(){r.info("Modal dismissed")})},t.modalAssignment=function(t){var t=t||{},s=i.open({targetDomEl:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/assignment.html?v="+(new Date).getTime(),controller:"ModalAssignmentCtrl",size:"lg",resolve:{data:function(){return t}}});s.result.then(function(n){e.$broadcast("assignmentFormSuccess",n,t)},function(){r.info("Modal dismissed")})},t.modalReminder=function(e,t){if(!e||typeof e!="object"||!t||typeof t!="string")return null;i.open({targetDomEl:n.find("div").eq(0),templateUrl:o.path.TPL+"modal/reminder.html?v="+(new Date).getTime(),controller:"ModalReminderCtrl",resolve:{data:function(){return e},type:function(){return t}}})}}])}),define("services/dialog",["services/services"],function(e){e.factory("$dialog",["$modal","config","$rootElement","$log",function(e,t,n,r){return r.debug("Service: $dialog"),{open:function(r){if(r&&typeof r!="object")return;return e.open({targetDomEl:n.find("div").eq(0),templateUrl:t.path.TPL+"modal/dialog.html",size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{copyCancel:r.copyCancel||"",copyConfirm:r.copyConfirm||"",title:r.title||"",msg:r.msg||""}}}}).result}}}])}),define("controllers/taskList",["controllers/controllers","moment","services/contact","services/dialog","services/task","services/assignment"],function(e,t){e.controller("TaskListCtrl",["$scope","$modal","$dialog","$rootElement","$rootScope","$route","$filter","$timeout","$state","$log","taskList","config","ContactService","AssignmentService","TaskService",function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v){l.debug("Controller: TaskListCtrl"),this.init=function(){var e=this.contactIds,t=this.assignmentIds;this.collectId(c),e&&e.length&&p.get({IN:e}).then(function(e){p.updateCache(e)}),t&&t.length&&d.get({IN:t}).then(function(e){d.updateCache(e)}),s.$broadcast("ct-spinner-hide"),l.debug(s.cache)},this.assignmentIds=[],this.contactIds=[],this.collectId=function(e){function r(e){t.push(e.source_contact_id),e.assignee_contact_id&&e.assignee_contact_id.length&&t.push(e.assignee_contact_id[0]),e.target_contact_id&&e.target_contact_id.length&&t.push(e.target_contact_id[0])}function i(e){e.case_id&&n.push(e.case_id)}var t=this.contactIds,n=this.assignmentIds;t.push(h.LOGGED_IN_CONTACT_ID),h.CONTACT_ID&&t.push(h.CONTACT_ID),angular.forEach(e,function(e){r(e),i(e)})},e.dueToday=0,e.dueThisWeek=0,e.overdue=0,e.taskList=c,e.taskListFiltered=[],e.taskListLimit=5,e.taskListOngoing=[],e.taskListResolved=[],e.taskListResolvedLoaded=!1,e.dpOpened={filterDates:{}},e.isCollapsed={filterAdvanced:!0,filterDates:!0,taskListResolved:!0},e.filterParams={contactId:null,userRole:{field:null,isEqual:null},dateRange:{from:null,until:null},due:null,assignmentType:[]},e.filterParamsHolder={dateRange:{from:(new Date).setHours(0,0,0,0),until:t().add(1,"month").toDate().setHours(0,0,0,0)}},e.label={overdue:"Overdue",dueToday:"Due Today",dueThisWeek:"Due This Week",dateRange:""},e.changeStatus=function(t,n){e.$broadcast("ct-spinner-show","task"+t.id),v.save({id:t.id,status_id:n||"2"}).then(function(n){t.status_id=n.status_id,e.$broadcast("ct-spinner-hide","task"+t.id)})},e.labelDateRange=function(t,n){var r=u("date")(t,"dd/MM/yyyy")||"",i=u("date")(n,"dd/MM/yyyy")||"";i&&(i=r?" - "+i:"Until: "+i),r&&(r=i?r:"From: "+r),e.label.dateRange=r+i},e.loadTasksResolved=function(){if(e.taskListResolvedLoaded)return;e.taskList=e.taskListOngoing,v.get({target_contact_id:h.CONTACT_ID,status_id:{IN:h.status.resolve.TASK}}).then(function(t){e.taskList.push.apply(e.taskList,t),a(function(){e.taskListResolvedLoaded=!0})})},e.deleteTask=function(t){r.open({msg:"Are you sure you want to delete this task?"}).then(function(n){if(!n)return;v.delete(t.id).then(function(n){e.taskList.splice(e.taskList.indexOf(t),1)})})},e.viewInCalendar=function(e){f.go("calendar.mwl."+e)},e.$on("assignmentFormSuccess",function(t,n){Array.prototype.push.apply(e.taskList,n.taskList)}),e.$on("taskFormSuccess",function(t,n,r){angular.equals({},r)?e.taskList.push(n):angular.extend(r,n)}),e.$on("crmFormSuccess",function(e,t){if(t.status=="success"){var n=/case|activity|assignment/i;if(n.test(t.title)||t.crmMessages.length&&(n.test(t.crmMessages[0].title)||n.test(t.crmMessages[0].text)))s.cache.assignment={obj:{},arr:[]},o.reload()}}),this.init()}])}),define("controllers/task",["controllers/controllers","moment","services/task"],function(e,t){e.controller("TaskCtrl",["$scope","$log","$rootScope",function(e,n,r){n.debug("Controller: TaskCtrl"),e.isCollapsed=!0,e.task.activity_date_time=e.task.activity_date_time?t(e.task.activity_date_time).toDate():null,e.$watch("task.status_id",function(t){var n=r.cache.taskStatusResolve.indexOf(t)>-1;e.task.resolved=n,e.task.completed=n}),e.$watch("task.activity_date_time",function(t){e.task.due=(new Date(t)).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}])}),define("controllers/dashboard/navMain",["controllers/controllers"],function(e){e.controller("NavMainCtrl",["$scope","$state","$log",function(e,t,n){n.debug("Controller: NavMainCtrl"),e.isActive=function(e){return t.includes(e)}}])}),define("controllers/dashboard/topBar",["controllers/controllers"],function(e){e.controller("TopBarCtrl",["$scope","$rootScope","$location","$log",function(e,t,n,r){r.debug("Controller: TopBarCtrl"),t.itemAdd={},t.itemAdd.fn=function(){n.path()=="/documents"?t.modalDocument():t.modalTask()},t.itemAdd.label=function(){return n.path()=="/documents"?"Add Document":"Add Task"}}])}),define("controllers/modal/modalDialog",["controllers/controllers"],function(e){e.controller("ModalDialogCtrl",["$scope","$modalInstance","$timeout","content","$log",function(e,t,n,r,i){i.debug("Controller: ModalDialogCtrl"),e.title=r.title||"CiviHR Tasks & Assignments",e.msg=r.msg||"",e.copyConfirm=r.copyConfirm||"Yes",e.copyCancel=r.copyCancel||"Cancel",e.confirm=function(e){t.close(e||!0)},e.cancel=function(){t.close(!1)}}])}),define("controllers/modal/modalDocument",["controllers/controllers","services/contact","services/file","services/dialog","services/document"],function(e){e.controller("ModalDocumentCtrl",["$scope","$modalInstance","$rootScope","$rootElement","$q","$log","$filter","$modal","$dialog","AssignmentService","DocumentService","ContactService","FileService","data","files","config",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){s.debug("Controller: ModalDocumentCtrl"),e.files=[],e.document={},angular.copy(p,e.document),angular.copy(d,e.files),e.data=p,e.document.assignee_contact_id=e.document.assignee_contact_id||[],e.document.source_contact_id=e.document.source_contact_id||v.LOGGED_IN_CONTACT_ID,e.document.target_contact_id=e.document.target_contact_id||[v.CONTACT_ID],e.document.status_id=e.document.status_id||"1",e.contacts=n.cache.contact.arrSearch,e.filesTrash=[],e.uploader=h.uploader("civicrm_activity"),e.showCId=!v.CONTACT_ID,e.assignments=o("filter")(n.cache.assignment.arrSearch,function(t){return+t.extra.contact_id==+e.document.target_contact_id}),e.cacheAssignment=function(e){if(n.cache.assignment.obj[e.id])return;var t={};t[e.id]={case_type_id:o("filter")(n.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:e.label_class=="strikethrough"?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},f.updateCache(t)},e.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,email:e.description.length?e.description[0]:""},c.updateCache(t)},e.fileMoveToTrash=function(t){e.filesTrash.push(e.files[t]),e.files.splice(t,1)},e.refreshAssignments=function(t){if(!t)return;var n=e.document.target_contact_id;f.search(t,e.document.case_id).then(function(t){e.assignments=o("filter")(t,function(e){return+e.extra.contact_id==+n})})},e.refreshContacts=function(t){if(!t)return;c.search(t,{contact_type:"Individual"}).then(function(t){e.contacts=t})},e.dpOpened={due:!1,exp:!1},e.cancel=function(){if(e.documentForm.$pristine){t.dismiss("cancel");return}a.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(n){if(!n)return;e.$broadcast("ct-spinner-hide"),t.dismiss("cancel")})},e.confirm=function(){if(angular.equals(p,e.document)&&angular.equals(d,e.files)&&!e.uploader.queue.length){t.dismiss("cancel");return}var n=e.uploader,s=e.filesTrash,o=[],a,c,m;e.$broadcast("ct-spinner-show"),+e.document.case_id==+p.case_id&&delete e.document.case_id,e.document.activity_date_time=e.document.activity_date_time||new Date;if(s.length){c=0,m=s.length;for(;c<m;c++)a=s[c],o.push(h.delete(a.fileID,a.entityID,a.entityTable))}i.all({document:l.save(e.document),files:o.length?i.all(o):[]}).then(function(e){if(n.queue.length){var t=u.open({targetDomEl:r.find("div").eq(0),templateUrl:v.path.TPL+"/modal/progress.html?v="+(new Date).getTime(),size:"sm",controller:"ModalProgressCtrl",resolve:{uploader:function(){return n},entityId:function(){return e.document.id}}});return e.files=t.result,i.all(e)}return e}).then(function(r){e.document.id=r.document.id,e.document.case_id=r.document.case_id,e.document.file_count=e.files.length+n.queue.length,f.updateTab(),t.close(e.document),e.$broadcast("ta-spinner-hide")},function(n){return CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ta-spinner-hide"),i.reject()})}}])}),define("controllers/modal/modalProgress",["controllers/controllers","services/file"],function(e){e.controller("ModalProgressCtrl",["$scope","$modalInstance","$q","$timeout","uploader","entityId","FileService","$log",function(e,t,n,r,i,s,o,u){u.debug("Controller: ModalProgressCtrl"),e.uploader=i,i.queue.length&&(i.item=i.queue[0].file.name),i.onProgressItem=function(e){this.item=e.file.name},o.upload(i,s).then(function(e){r(function(){t.close(e)},500)}),e.cancel=function(){t.dismiss("File upload canceled")}}])}),define("controllers/modal/modalTask",["controllers/controllers","services/contact","services/dialog","services/task"],function(e){e.controller("ModalTaskCtrl",["$scope","$modalInstance","$rootScope","$rootElement","$q","$log","$filter","$modal","$dialog","AssignmentService","TaskService","ContactService","data","config",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){s.debug("Controller: ModalTaskCtrl"),e.data=h,e.task={},angular.copy(h,e.task),e.task.assignee_contact_id=e.task.assignee_contact_id||[],e.task.source_contact_id=e.task.source_contact_id||p.LOGGED_IN_CONTACT_ID,e.task.target_contact_id=e.task.target_contact_id||[p.CONTACT_ID],e.contacts=n.cache.contact.arrSearch,e.showCId=!p.CONTACT_ID,e.assignments=o("filter")(n.cache.assignment.arrSearch,function(t){return+t.extra.contact_id==+e.task.target_contact_id}),e.cacheAssignment=function(e){if(n.cache.assignment.obj[e.id])return;var t={};t[e.id]={case_type_id:o("filter")(n.cache.assignmentType.arr,{title:e.extra.case_type})[0].id,client_id:{1:e.extra.contact_id},contact_id:{1:e.extra.contact_id},contacts:[{sort_name:e.extra.sort_name,contact_id:e.extra.contact_id}],end_date:e.extra.end_date,id:e.id,is_deleted:e.label_class=="strikethrough"?"1":"0",start_date:e.extra.start_date,subject:e.extra.case_subject},f.updateCache(t)},e.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,email:e.description.length?e.description[0]:""},c.updateCache(t)},e.refreshAssignments=function(t){if(!t)return;var n=e.task.target_contact_id;f.search(t,e.task.case_id).then(function(t){e.assignments=o("filter")(t,function(e){return+e.extra.contact_id==+n})})},e.refreshContacts=function(t){if(!t)return;c.search(t,{contact_type:"Individual"}).then(function(t){e.contacts=t})},e.dpOpen=function(t){t.preventDefault(),t.stopPropagation(),e.dpOpened=!0},e.cancel=function(){if(e.taskForm.$pristine){t.dismiss("cancel");return}a.open({copyCancel:"No",msg:"Are you sure you want to cancel? Changes will be lost!"}).then(function(n){if(!n)return;e.$broadcast("ct-spinner-hide"),t.dismiss("cancel")})},e.confirm=function(){if(angular.equals(h,e.task)){t.dismiss("cancel");return}e.$broadcast("ct-spinner-show"),+e.task.case_id==+h.case_id&&delete e.task.case_id,e.task.activity_date_time=e.task.activity_date_time||new Date,l.save(e.task).then(function(n){e.task.id=n.id,e.task.case_id=n.case_id,f.updateTab(),t.close(e.task),e.$broadcast("ct-spinner-hide");return},function(n){return CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ct-spinner-hide"),i.reject()})}}])}),define("controllers/modal/modalReminder",["controllers/controllers","services/contact","services/dialog","services/document","services/task"],function(e){e.controller("ModalReminderCtrl",["$scope","$modalInstance","$dialog","$rootScope","$q","$log","$filter","TaskService","DocumentService","data","type","config",function(e,t,n,r,i,s,o,u,a,f,l,c){s.debug("Controller: ModalReminderCtrl"),e.data={},e.type=l,angular.copy(f,e.data),e.reminder={},e.data.assignee_contact_id=e.data.assignee_contact_id||[],e.data.target_contact_id=e.data.target_contact_id||[c.CONTACT_ID],e.contacts=r.cache.contact.arrSearch,e.showCId=!c.CONTACT_ID,e.cancel=function(){t.dismiss("cancel")},e.confirm=function(){e.$broadcast("ct-spinner-show"),(l==="task"?u:a).sendReminder(e.data.id,e.reminder.notes).then(function(){CRM.alert("Message sent to: "+r.cache.contact.obj[e.data.assignee_contact_id[0]].sort_name,"Reminder sent","success"),t.close(),e.$broadcast("ta-spinner-hide");return},function(n){return CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ta-spinner-hide"),i.reject()})}}])}),define("controllers/modal/modalAssignment",["controllers/controllers","services/contact","services/document","services/task","services/assignment"],function(e){e.controller("ModalAssignmentCtrl",["$scope","$modalInstance","$rootScope","$q","$log","$filter","AssignmentService","TaskService","DocumentService","ContactService","data","config","settings",function(e,t,n,r,i,s,o,u,a,f,l,c,h){i.debug("Controller: ModalAssignmentCtrl");var p={activity_type_id:null,assignee_contact_id:[],case_id:null,create:!0,isAdded:!1,name:null,source_contact_id:c.LOGGED_IN_CONTACT_ID,status_id:"1"};e.assignment={},e.assignment.status_id="1",e.assignment.contact_id=c.CONTACT_ID,e.assignment.client_id=e.assignment.contact_id,e.assignment.subject="",e.contacts=n.cache.contact.arrSearch,e.dpOpened={},e.showCId=!c.CONTACT_ID,e.activitySet={},e.taskList=[],e.documentList=[],e.addActivity=function(e){if(!e)return;e.push(angular.extend({},p,{isAdded:!0}))},e.removeActivity=function(e,t){if(!e)return;e.splice(t,1)},e.dpOpen=function(t,n){t.preventDefault(),t.stopPropagation(),e.dpOpened[n]=!0},e.refreshContacts=function(t){if(!t)return;f.search(t,{contact_type:"Individual"}).then(function(t){e.contacts=t})},e.cacheContact=function(e){var t={};t[e.id]={contact_id:e.id,contact_type:e.icon_class,sort_name:e.label,email:e.description.length?e.description[0]:""},f.updateCache(t)},e.setAssignmentDueDate=function(t){if(!e.assignment.dueDate||e.assignment.dueDate<t)e.assignment.dueDate=t},e.setData=function(){var t=n.cache.assignmentType.obj[e.assignment.case_type_id];if(!t){e.activitySet={},e.assignment.subject="";return}e.activitySet=t.definition.activitySets[0],e.assignment.subject=n.cache.assignmentType.obj[e.assignment.case_type_id].title},e.cancel=function(){t.dismiss("cancel")},e.confirm=function(){e.$broadcast("ct-spinner-show");var i=[],s=[],f=[],l=[],h={},p,d;e.assignment.start_date=new Date,o.save(e.assignment).then(function(v){angular.forEach(e.taskList,function(e){e.create&&(e.case_id=v.id,this.push(e))},s),angular.forEach(e.documentList,function(e){e.create&&(e.case_id=v.id,this.push(e))},i),r.all({task:u.saveMultiple(s),document:a.saveMultiple(i),relationship:o.assignCoordinator(e.assignment.contact_id,v.id)}).then(function(r){p=0,d=r.task.length;for(p;p<d;p++)s[p].id=r.task[p].id,f.push(r.task[p].id);p=0,d=r.document.length;for(p;p<d;p++)i[p].id=r.document[p].id,l.push(r.document[p].id);h[v.id]=angular.extend(angular.copy(e.assignment),{id:v.id,client_id:{1:e.assignment.client_id},contact_id:{1:e.assignment.contact_id},contacts:[{sort_name:n.cache.contact.obj[e.assignment.contact_id].sort_name,contact_id:e.assignment.contact_id,role:"Client"},{sort_name:n.cache.contact.obj[c.LOGGED_IN_CONTACT_ID].sort_name,contact_id:c.LOGGED_IN_CONTACT_ID,role:"Case Coordinator"}],is_deleted:"0",end_date:"",activities:f.concat(l)}),o.updateCache(h),o.updateTab(1),t.close({documentList:i,taskList:s}),e.$broadcast("ct-spinner-hide");return},function(n){return CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ct-spinner-hide"),r.reject()})},function(n){return CRM.alert(n,"Error","error"),t.dismiss(),e.$broadcast("ct-spinner-hide"),r.reject()})},e.$watch("activitySet",function(t){if(!t.activityTypes)return;var r,i=t.activityTypes,o=i.length,u=[],a,f=[],l,c=0;for(;c<o;c++){r=angular.copy(p),r.name=i[c].name,a=r.name?s("filter")(n.cache.documentType.arr,{value:r.name},!0)[0]:"";if(a){r.activity_type_id=a.key,u.push(r);continue}l=r.name?s("filter")(n.cache.taskType.arr,{value:r.name},!0)[0]:"",r.activity_type_id=l?l.key:null,f.push(r)}angular.copy(f,e.taskList);if(!+h.tabEnabled.documents)return;angular.copy(u,e.documentList)})}]),e.controller("ModalAssignmentActivityCtrl",["$scope","$log",function(e,t){t.debug("Controller: ModalAssignmentTaskCtrl"),e.isDisabled=!e.activity.activity_type_id&&!e.activity.isAdded,e.activity.create=!e.isDisabled;if(e.isDisabled)return;e.$watch("$parent.assignment.contact_id",function(t){if(!t)return;e.activity.target_contact_id=[t]}),e.$watch("$parent.assignment.dueDate",function(t){if(!e.activity.create)return;if(!e.activity.activity_date_time||e.activity.activity_date_time>t)e.activity.activity_date_time=t})}])}),define("controllers/externalPage",["controllers/controllers","services/contact"],function(e){e.controller("ExternalPageCtrl",["$scope","$log","$modal","$rootElement","$rootScope","$state","config",function(e,t,n,r,i,s,o){t.debug("Controller: ExternalPageCtrl"),e.assignmentsUrl=o.url.ASSIGNMENTS+"?reset=1",e.reportsUrl=o.url.CIVI_DASHBOARD+"?reset=1",e.$on("assignmentFormSuccess",function(){s.go(s.current,{},{reload:!0})}),e.$on("iframe-ready",function(){i.$broadcast("ct-spinner-hide")})}])}),define("services/settings",["services/services","services/utils"],function(e){e.factory("Settings",["$resource","config","$log",function(e,t,n){return n.debug("Service: Settings"),e(t.url.REST,{action:"get",entity:"TASettings",json:{}})}]),e.factory("SettingsService",["Settings","$q","config","UtilsService","$log","settings",function(e,t,n,r,i,s){return i.debug("Service: SettingsService"),{get:function(r){var i=t.defer();return r=r&&typeof r=="object"?r:[],e.get({json:{sequential:"1",debug:n.DEBUG,fields:r}},function(e){i.resolve(e.values)},function(){i.reject("Unable to fetch tasks list")}),i.promise},set:function(i){if(!i||typeof i!="object")return null;var o=t.defer();return e.save({action:"set",json:{sequential:1,debug:n.DEBUG,fields:i}},null,function(e){if(r.errorHandler(e,"Unable to save",o))return;s.tabEnabled={documents:i.documents_tab||s.tabEnabled.documents_tab,keyDates:i.keydates_tab||s.tabEnabled.keydates_tab},s.copy.button.assignmentAdd=i.add_assignment_button_title,o.resolve(e.values)},function(){o.reject("Unable to save")}),o.promise}}}])}),define("controllers/settings",["controllers/controllers","services/settings"],function(e){e.controller("SettingsCtrl",["$scope","$rootScope","$location","$dialog","$log","$state","SettingsService","config","settings",function(e,t,n,r,i,s,o,u,a){i.debug("Controller: SettingsCtrl"),e.settings=angular.copy(a),e.configureAddAssignmentBtn=!!e.settings.copy.button.assignmentAdd,e.confirm=function(){e.$broadcast("ct-spinner-show"),o.set({documents_tab:e.settings.tabEnabled.documents,keydates_tab:e.settings.tabEnabled.keyDates,add_assignment_button_title:e.settings.copy.button.assignmentAdd}).then(function(t){e.$broadcast("ct-spinner-hide"),e.settingsForm.$pristine=!0},function(t){CRM.alert(t,"Error","error"),e.$broadcast("ct-spinner-hide")})},e.$on("$stateChangeStart",function(n,i,o,u,a){if(e.settingsForm.$pristine)return;n.preventDefault(),r.open({copyCancel:"No",msg:"Are you sure you want to leave this page? Changes will be lost!"}).then(function(e){if(!e){t.$broadcast("$stateChangeSuccess");return}s.go(i.name,o,{notify:!1}).then(function(){t.$broadcast("$stateChangeSuccess",i,o,u,a)})})}),t.$broadcast("ct-spinner-hide")}])}),define("directives/civiEvents",["directives/directives"],function(e){e.directive("ctCiviEvents",["$rootScope","$log",function(e,t){return t.debug("Directive: ctCiviEvents"),{link:function(e){CRM.$(document).on("crmFormSuccess",function(n,r){t.debug("crmFormSuccess"),t.debug(r),e.$broadcast("crmFormSuccess",r)}),CRM.$(document).on("crmFormSubmit",function(n,r){t.debug("crmFormSubmit"),t.debug(r),e.$broadcast("crmFormSubmit",r)}),CRM.$(document).on("crmFormCancel",function(n,r){t.debug("crmFormCancel"),t.debug(r),e.$broadcast("crmFormCancel",r)})}}}])}),define("directives/iframe",["directives/directives"],function(e){e.directive("taIframe",["$rootScope","$log",function(e,t){return t.debug("Directive: taIframe"),{link:function(t,n,r){var i=n[0];i.addEventListener("load",function(){var t=frames[r.name].document,s=["branding","toolbar","civicrm-menu","civicrm-footer","access"],o=0,u,a=s.length;for(o;o<a;o++){u=t.getElementById(s[o]);if(!u)continue;u.style.display="none"}t.body.style.paddingTop="10px",i.height=t.body.scrollHeight+"px",n.addClass("ct-iframe-ready"),e.$broadcast("iframe-ready")})}}}])}),define("directives/spinner",["directives/directives"],function(e){e.directive("ctSpinner",["$rootScope","$log",function(e,t){return t.debug("Directive: ctSpinner"),{link:function(t,n,r){function u(){var e=window.getComputedStyle(n[0]).position;return e=="relative"||e=="absolute"||e=="fixed"}function a(){u()||(n.css("position","relative"),s=!0),n.append(i)}function f(){i.remove(),s&&n.css("position","")}var i=document.createElement("div"),s=!1,o;i.className="ct-spinner-cover ct-spinner-img",typeof r.ctSpinnerShow!="undefined"&&a(),typeof r.ctSpinnerMainView!="undefined"&&(i.className="ct-spinner-cover",o=document.createElement("div"),o.className="ct-spinner ct-spinner-img",e.$on("$stateChangeStart",function(){a(),document.body.appendChild(o)}),e.$on("$stateChangeSuccess",function(){f(),o.remove()}),e.$on("$stateChangeError",function(){f(),o.remove()})),t.$on("ct-spinner-show",function(e,t){if(!t||r.ctSpinnerId&&r.ctSpinnerId==t){a();return}}),t.$on("ct-spinner-hide",function(e,t){if(!t||r.ctSpinnerId&&r.ctSpinnerId==t){f();return}})}}}])}),define("directives/validate",["directives/directives"],function(e){e.directive("taValidate",["$log",function(e){return e.debug("Directive: taValidate"),{restrict:"A",require:"^form",scope:{isWarning:"=?taValidateWarning"},link:function(e,t,n,r){function f(e,n){t.toggleClass("has-success",!e&&!n),a.toggleClass("glyphicon-ok",!e&&!n)}function l(e,n){t.toggleClass("has-warning",!e&&n),a.toggleClass("glyphicon-warning-sign",!e&&n)}function c(e){t.toggleClass("has-error",e),a.toggleClass("glyphicon-remove",e)}var i=t[0].querySelector("[name]"),s=angular.element(i),o=s.attr("name"),u=document.createElement("span"),a=angular.element(u);if(!o)return;t.addClass("has-feedback"),a.addClass("glyphicon form-control-feedback"),s.after(a),e.$watch(function(){return r[o]&&r[o].$invalid},function(t){r[o].$dirty&&(f(t,e.isWarning),c(t))}),typeof e.isWarning!="undefined"&&e.$watch("isWarning",function(e){var t=r[o].$invalid;r[o].$dirty&&(f(t,e),l(t,e))}),s.bind("blur",function(){c(r[o].$invalid)})}}}])}),define("filters/assignmentType",["filters/filters"],function(e){e.filter("filterBy.assignmentType",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterBy.assignmentType"),function(e,n){var r,i=t.cache.assignment.obj,s=n.length,o=[],u=0,a=e.length;if(!a||!s)return e;for(u;u<a;u++)r=i[e[u].case_id],r&&n.indexOf(r.case_type_id)!==-1&&o.push(e[u]);return o}}])}),define("filters/contactId",["filters/filters"],function(e){e.filter("filterBy.contactId",["$filter","config","$log",function(e,t,n){return n.debug("Filter: filterBy.contactId"),function(e,t){var n=[],r=0,i=e.length;if(!i||!t||typeof +t!="number")return e;for(r;r<i;r++)(+e[r].assignee_contact_id[0]===+t||+e[r].source_contact_id===+t||+e[r].target_contact_id===+t)&&n.push(e[r]);return n}}])}),define("filters/date",["filters/filters","moment"],function(e,t){e.filter("filterBy.date",["$filter","$log",function(e,n){return n.debug("Filter: filterBy.date"),function(e,n){if(!e||!e.length||!n)return[];var r=[],i=0,s=e.length,o,u,a;o=t().startOf(n),u=t().endOf(n);for(;i<s;i++)a=t(e[i].date),a>o&&a<u&&r.push(e[i]);return r}}])}),define("filters/dateParse",["filters/filters","moment"],function(e,t){e.filter("dateParse",["$filter","$log",function(e,n){return n.debug("Filter: dateParse"),function(e){return t(e).toDate()}}])}),define("filters/dateType",["filters/filters"],function(e){e.filter("filterBy.dateType",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterBy.dateType"),function(e,t){var n=[],r=0,i,s=e.length,o=t.length,u,a;if(!s||!o)return e;for(r;r<s;r++){i=0,u=e[r].dateContactList,a=u.length;for(i;i<a;i++)if(t.indexOf(u[i].type)!==-1){n.push(e[r]);break}}return n}}])}),define("filters/due",["filters/filters"],function(e){e.filter("filterBy.due",["$filter","$log",function(e,t){return t.debug("Filter: filterBy.due"),function(e,t,n){if(!e)return null;var r=[],i=0,s=e.length,o=(new Date).setHours(0,0,0,0);if(!s||!t)return e;switch(t){case"overdue":for(i;i<s;i++)((new Date(e[i].activity_date_time)).setHours(0,0,0,0)<o||e[i].expire_date&&(new Date(e[i].expire_date)).setHours(0,0,0,0)<o)&&r.push(e[i]);break;case"dateRange":if(!n||typeof n!="object")return e;var u,a,f=n.from?(new Date(n.from)).setHours(0,0,0,0):-Infinity,l=n.until?(new Date(n.until)).setHours(0,0,0,0):Infinity;for(i;i<s;i++)u=(new Date(e[i].activity_date_time)).setHours(0,0,0,0),a=e[i].expire_date?(new Date(e[i].expire_date)).setHours(0,0,0,0):!1,(u>=f&&u<=l||a&&a>=f&&a<=l)&&r.push(e[i]);break;case"dueToday":for(i;i<s;i++)((new Date(e[i].activity_date_time)).setHours(0,0,0,0)==o||e[i].expire_date&&(new Date(e[i].expire_date)).setHours(0,0,0,0)==o)&&r.push(e[i]);break;case"dueThisWeek":var c=new Date,h=c.getDay(),p=c.getDate()-h+(h==0?-6:1),d=new Date(c.setDate(p)),v=new Date(c.setDate(d.getDate()+7)),u,a;for(i;i<s;i++)u=(new Date(e[i].activity_date_time)).setHours(0,0,0,0),a=e[i].expire_date?(new Date(e[i].expire_date)).setHours(0,0,0,0):!1,(u>=d.setHours(0,0,0,0)&&u<v.setHours(0,0,0,0)||a&&a>=d.setHours(0,0,0,0)&&a<v.setHours(0,0,0,0))&&r.push(e[i])}return r}}])}),define("filters/offset",["filters/filters"],function(e){e.filter("offset",["$log",function(e){return e.debug("Filter: offset"),function(e,t){return t=t||0,e.slice(parseInt(t,10))}}])}),define("filters/userRole",["filters/filters"],function(e){e.filter("filterBy.userRole",["$filter","config","$log",function(e,t,n){return n.debug("Filter: filterBy.userRole"),function(e,n,r){var i=[],s=0,o=e.length,r=typeof r!="undefined"?r:!0;if(!o||!n)return e;for(s;s<o;s++)e[s][n]==t.LOGGED_IN_CONTACT_ID==r&&i.push(e[s]);return i}}])}),define("filters/status",["filters/filters"],function(e){e.filter("filterBy.status",["$filter","$rootScope","$log",function(e,t,n){return n.debug("Filter: filterBy.status"),function(e,t,n){var r=[],i=0,s=e.length,o=t.length,n=typeof n!="undefined"?n:!0;if(!s||!o)return e;for(i;i<s;i++)t.indexOf(e[i].status_id)!==-1==n&&r.push(e[i]);return r}}])});var e,t=require.config({context:"tasksassignments",baseUrl:CRM.Tasksassignments.extensionPath+"js",urlArgs:"bust="+(new Date).getTime(),paths:{angularSelect:"vendor/angular/select",angularBootstrapCalendar:"vendor/angular/angular-bootstrap-calendar-tpls-custom",angularChecklistModel:"vendor/angular/checklist-model",angularRouter:"vendor/angular/angular-ui-router",moment:"vendor/moment.min",requireLib:CRM.vars.reqAngular.requireLib,textAngular:"vendor/angular/textAngular.min",textAngularRangy:"vendor/angular/textAngular-rangy.min",textAngularSanitize:"vendor/angular/textAngular-sanitize.min"},shim:{textAngular:{deps:["textAngularRangy","textAngularSanitize"]}},config:{moment:{noGlobal:!0}}});t(["app","controllers/calendar","controllers/dateList","controllers/documentList","controllers/document","controllers/main","controllers/taskList","controllers/task","controllers/dashboard/navMain","controllers/dashboard/topBar","controllers/modal/modalDialog","controllers/modal/modalDocument","controllers/modal/modalProgress","controllers/modal/modalTask","controllers/modal/modalReminder","controllers/modal/modalAssignment","controllers/externalPage","controllers/settings","directives/civiEvents","directives/iframe","directives/spinner","directives/validate","filters/assignmentType","filters/contactId","filters/date","filters/dateParse","filters/dateType","filters/due","filters/offset","filters/userRole","filters/status","requireLib"],function(){document.addEventListener("taInit",function(e){angular.bootstrap(document.getElementById(e.detail.module),["civitasks."+e.detail.app])}),document.dispatchEvent(new CustomEvent("taReady"))}),define("ta-main",function(){})})();